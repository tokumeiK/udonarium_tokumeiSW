(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[9437],{4200:(oe,le,_e)=>{_e(9993),Opal.modules["bcdice/dice_table/table"]=function(t){var V,I,a,f,E,e,C,q,L,U=t.module,v=t.klass,i=t.hash2,y=t.defs,j=t.truthy,D=t.def,H=t.rb_minus,k=[],_=t.nil;return V=k,I=L=[U(k[0],"BCDice")].concat(V),a=q=[U(L[0],"DiceTable")].concat(I),E=[f=v(q[0],null,"Table")].concat(a),e=t.$r(E),(C=f.$$prototype).times=C.sides=C.name=C.items=_,y(f,"$from_i18n",function(A,z){var m=_;return m=e("I18n").$t(A,i(["locale"],{locale:z})),this.$new(m["$[]"]("name"),m["$[]"]("type"),m["$[]"]("items"))}),D(f,"$initialize",function(A,z,P){var m=this,Y=_;return m.name=A,m.items=P.$freeze(),Y=/(\d+)D(\d+)/i.$match(z),j(Y)||m.$raise(e("ArgumentError"),"Unexpected table type: "+z),m.times=Y["$[]"](1).$to_i(),m.sides=Y["$[]"](2).$to_i()}),D(f,"$roll",function(A){var P,z=this;return P=A.$roll_sum(z.times,z.sides),z.$choice(P)}),D(f,"$choice",function(A){var P,z=this;return P=H(A,z.times),e("RollResult").$new(z.name,A,z.items["$[]"](P))})},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(t){var W,T,f,E,e,C,S,R,d,U=t.module,v=t.klass,i=t.hash2,y=t.defs,j=t.def,D=t.rb_plus,H=t.rb_times,k=t.rb_minus,_=[],u=t.nil;return W=_,T=d=[U(_[0],"BCDice")].concat(W),f=R=[U(d[0],"DiceTable")].concat(T),e=[E=v(R[0],null,"D66GridTable")].concat(f),C=t.$r(e),(S=E.$$prototype).name=S.items=u,y(E,"$from_i18n",function(z,P){var Y=u;return Y=C("I18n").$t(z,i(["locale","raise"],{locale:P,raise:!0})),this.$new(Y["$[]"]("name"),Y["$[]"]("items"))}),j(E,"$initialize",function(z,P){return this.name=z,this.items=P.$freeze()}),j(E,"$roll",function(z){var m,Y,B,M,b;return m=z.$roll_once(6),Y=z.$roll_once(6),B=D(H(m,10),Y),M=k(m,1),b=k(Y,1),C("RollResult").$new(this.name,B,this.items["$[]"](M)["$[]"](b))})},Opal.modules["bcdice/arithmetic/node"]=function(t){var $,e,z,b,l,m,Y,S,f,U=t.module,v=t.klass,i=t.def,y=t.thrower,j=t.return_ivar,D=t.send2,H=t.find_super,k=t.eqeq,_=t.const_set,u=t.eqeqeq,V=t.rb_divide,W=t.truthy,L=t.assign_ivar,d=t.alias,I=[],T=t.nil,q=t.$$$;return $=I,e=f=[U(I[0],"BCDice")].concat($),z=S=[U(f[0],"Arithmetic")].concat(e),m=[U(S[0],"Node")].concat(z),Y=t.$r(m),(l=(b=v(m[0],null,"BinaryOp")).$$prototype).lhs=l.rhs=l.op=T,i(b,"$initialize",function(p,N,o){var c=this;return c.lhs=p,c.op=N,c.rhs=o}),i(b,"$eval",function(p){try{y("eval_return");var g,o=this,c=T;return c=o.lhs.$eval(p),g=o.rhs.$eval(p),c.$send(o.op,g)}catch(r){if(r===t.t_eval_return)return r.$v;throw r}}),i(b,"$output",function(){var p=this;return""+p.lhs.$output()+p.op+p.rhs.$output()}),i(b,"$s_exp",function(){var p=this;return"("+p.$op_for_s_exp()+" "+p.lhs.$s_exp()+" "+p.rhs.$s_exp()+")"}),i(b,"$op_for_s_exp",j("op")),function(B,M,b){var l=v(B,M,"DivideBase"),x=[l].concat(b),p=t.$r(x),N=l.$$prototype;N.lhs=N.rhs=N.op=T,i(l,"$initialize",function o(c,g){return o.$$p=null,D(this,H(this,"initialize",o,!1,!0),"initialize",[c,"/",g],null)}),i(l,"$eval",function(c){try{y("eval_return");var s,n,r=this;return s=r.lhs.$eval(c),n=r.rhs.$eval(c),k(n,0)&&r.$raise(p("ZeroDivisionError")),r.$divide_and_round(s,n,c)}catch(h){if(h===t.t_eval_return)return h.$v;throw h}}),i(l,"$output",function o(){var c=o.$$p||T,g=this;return o.$$p=null,""+D(g,H(g,"output",o,!1,!0),"output",[],c)+g.$rounding_method()}),l.$private(),i(l,"$rounding_method",function(){return q(this.$class(),"ROUNDING_METHOD")}),i(l,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()}),i(l,"$divide_and_round",function(c,g,r){return this.$raise(p("NotImplementedError"))})}(m[0],Y("BinaryOp"),m),function(B,M,b){var l=v(B,M,"DivideWithGameSystemDefault"),x=[l].concat(b),p=t.$r(x);_(x[0],"ROUNDING_METHOD",""),l.$private(),i(l,"$divide_and_round",function(o,c,g){var r,s=T;return u(q(p("RoundType"),"CEIL"),r=g)?V(o.$to_f(),c).$ceil():u(q(p("RoundType"),"ROUND"),r)?(s=V(o.$to_f(),c),W(s["$negative?"]())?s.$abs().$round()["$-@"]():s.$round()):V(o,c).$floor()})}(m[0],Y("DivideBase"),m),function(B,M,b){var l=v(B,M,"DivideWithCeil"),x=[l].concat(b);_(x[0],"ROUNDING_METHOD","C"),l.$private(),i(l,"$divide_and_round",function(N,o,c){return V(N.$to_f(),o).$ceil()})}(m[0],Y("DivideBase"),m),function(B,M,b){var l=v(B,M,"DivideWithRound"),x=[l].concat(b);_(x[0],"ROUNDING_METHOD","R"),l.$private(),i(l,"$divide_and_round",function(N,o,c){var g=T;return g=V(N.$to_f(),o),W(g["$negative?"]())?g.$abs().$round()["$-@"]():g.$round()})}(m[0],Y("DivideBase"),m),function(B,M,b){var l=v(B,M,"DivideWithFloor"),x=[l].concat(b);_(x[0],"ROUNDING_METHOD","F"),l.$private(),i(l,"$divide_and_round",function(N,o,c){return V(N,o).$floor()})}(m[0],Y("DivideBase"),m),function(B,M){var b=v(B,null,"Negative");b.$$prototype.body=T,i(b,"$initialize",L("body")),i(b,"$eval",function(p){try{return y("eval_return"),this.body.$eval(p)["$-@"]()}catch(c){if(c===t.t_eval_return)return c.$v;throw c}}),i(b,"$output",function(){return"-"+this.body.$output()}),i(b,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"})}(m[0]),function(B,M){var b=v(B,null,"Parenthesis");b.$$prototype.expr=T,i(b,"$initialize",L("expr")),i(b,"$eval",function(p){try{return y("eval_return"),this.expr.$eval(p)}catch(c){if(c===t.t_eval_return)return c.$v;throw c}}),i(b,"$output",function(){return"("+this.expr.$output()+")"}),i(b,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"})}(m[0]),function(B,M){var b=v(B,null,"Number");return b.$$prototype.value=T,i(b,"$initialize",L("value")),i(b,"$eval",j("value")),i(b,"$output",function(){return this.value.$to_s()}),d(b,"s_exp","output")}(m[0])},Opal.modules["racc/parser"]=function(t){var A,P,m,U=t.module,v=t.klass,i=t.truthy,y=t.const_set,j=t.defs,D=t.gvars,H=t.rb_lt,k=t.def,_=t.to_ary,u=t.send,V=t.neqeq,W=t.rb_plus,L=t.eqeq,d=t.rb_ge,I=t.rb_gt,T=t.rb_minus,q=t.rb_le,R=t.rb_times,$=t.assign_ivar_val,f=[],E=t.$r(f),e=t.nil,C=t.$$$;return A=f,P=[U(f[0],"Racc")].concat(A),m=t.$r(P),v(P[0],m("StandardError"),"ParseError"),i(C("::","ParseError","skip_raise")?"constant":e)||y(f[0],"ParseError",C(E("Racc"),"ParseError")),function(S,A){var b,l,x,p,N,m=[U(S,"Racc")].concat(A),Y=t.$r(m);return i(Y("Racc_No_Extensions","skip_raise")?"constant":e)||y(m[0],"Racc_No_Extensions",!1),b=m,x=[l=v(m[0],null,"Parser")].concat(b),p=t.$r(x),(N=l.$$prototype).yydebug=N.racc_debug_out=N.racc_error_status=N.racc_t=N.racc_vstack=N.racc_val=N.racc_state=N.racc_tstack=e,y(x[0],"Racc_Runtime_Version","1.4.6"),y(x[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),y(x[0],"Racc_Runtime_Core_Version_R","1.4.6"),y(x[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),y(x[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),y(x[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),y(x[0],"Racc_Runtime_Core_Version",p("Racc_Runtime_Core_Version_R")),y(x[0],"Racc_Runtime_Core_Revision",p("Racc_Runtime_Core_Revision_R")),y(x[0],"Racc_Runtime_Type","ruby"),j(p("Parser"),"$racc_runtime_type",function(){return p("Racc_Runtime_Type")}),k(l,"$_racc_setup",function(){var c,g,r=this,s=e,n=e;return null==D.stderr&&(D.stderr=e),i(C(r.$class(),"Racc_debug_parser"))||(r.yydebug=!1),i(null!=(c=r.yydebug)&&c!==e?"instance-variable":e)||(r.yydebug=!1),i(r.yydebug)&&(i(null!=(g=r.racc_debug_out)&&g!==e?"instance-variable":e)||(r.racc_debug_out=D.stderr),r.racc_debug_out=i(s=r.racc_debug_out)?s:D.stderr),n=C(r.$class(),"Racc_arg"),i(H(n.$size(),14))&&n["$[]="](13,!0),n}),k(l,"$_racc_init_sysvars",function(){var c=this;return c.racc_state=[0],c.racc_tstack=[],c.racc_vstack=[],c.racc_t=e,c.racc_val=e,c.racc_read_next=!0,c.racc_user_yyerror=!1,c.racc_error_status=0}),k(l,"$do_parse",function(){return this.$__send__(p("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)}),k(l,"$next_token",function(){return this.$raise(p("NotImplementedError"),this.$class()+"#next_token is not defined")}),k(l,"$_racc_do_parse_rb",function(c,g){var r,n=this,h=e,F=e,K=e,ee=e,te=e,X=e,re=e,J=e;return r=_(c),h=null==r[0]?e:r[0],F=null==r[1]?e:r[1],K=null==r[2]?e:r[2],ee=null==r[3]?e:r[3],te=null==r[10]?e:r[10],n.$_racc_init_sysvars(),X=re=J=e,u(n,"catch",["racc_end_parse"],function G(){var ne,O,w=null==G.$$s?this:G.$$s,ce=e;for(null==w.racc_state&&(w.racc_state=e),null==w.racc_read_next&&(w.racc_read_next=e),null==w.racc_t&&(w.racc_t=e),null==w.yydebug&&(w.yydebug=e),null==w.racc_val&&(w.racc_val=e);i(!0);)for(i(J=ee["$[]"](w.racc_state["$[]"](-1)))?(i(w.racc_read_next)&&V(w.racc_t,0)&&(O=w.$next_token(),ne=_(O),X=null==ne[0]?e:ne[0],w.racc_val=null==ne[1]?e:ne[1],w.racc_t=i(X)?i(ce=te["$[]"](X))?ce:1:0,i(w.yydebug)&&w.$racc_read_token(w.racc_t,X,w.racc_val),w.racc_read_next=!1),J=W(J,w.racc_t),i(d(J,0))&&i(re=h["$[]"](J))&&L(F["$[]"](J),w.racc_state["$[]"](-1))||(re=K["$[]"](w.racc_state["$[]"](-1)))):re=K["$[]"](w.racc_state["$[]"](-1));i(re=w.$_racc_evalact(re,c)););},{$$s:n})}),k(l,"$yyparse",function(c,g){return this.$__send__(p("Racc_YY_Parse_Method"),c,g,this.$_racc_setup(),!0)}),k(l,"$_racc_yyparse_rb",function(c,g,r,s){var n,F=this,K=e,ee=e,Z=e,te=e,re=e,J=e,G=e;return n=_(r),K=null==n[0]?e:n[0],ee=null==n[1]?e:n[1],Z=null==n[2]?e:n[2],te=null==n[3]?e:n[3],re=null==n[10]?e:n[10],F.$_racc_init_sysvars(),J=e,G=e,u(F,"catch",["racc_end_parse"],function ne(){var O=null==ne.$$s?this:ne.$$s;for(null==O.racc_state&&(O.racc_state=e);!i(G=te["$[]"](O.racc_state["$[]"](-1)));)for(;i(J=O.$_racc_evalact(Z["$[]"](O.racc_state["$[]"](-1)),r)););return u(c,"__send__",[g],function w(ce,$e){var Q=null==w.$$s?this:w.$$s,ie=e,ae=e;for(null==Q.racc_t&&(Q.racc_t=e),null==Q.racc_state&&(Q.racc_state=e),null==Q.racc_read_next&&(Q.racc_read_next=e),null==ce&&(ce=e),null==$e&&($e=e),Q.racc_t=i(ce)?i(ie=re["$[]"](ce))?ie:1:0,Q.racc_val=$e,Q.racc_read_next=!1,G=W(G,Q.racc_t),i(d(G,0))&&i(J=K["$[]"](G))&&L(ee["$[]"](G),Q.racc_state["$[]"](-1))||(J=Z["$[]"](Q.racc_state["$[]"](-1)));i(J=Q.$_racc_evalact(J,r)););for(;i(i(ie=i(ae=(G=te["$[]"](Q.racc_state["$[]"](-1)))["$!"]())?ae:Q.racc_read_next["$!"]())?ie:Q.racc_t["$=="](0));)for(i(G)&&i(G=W(G,Q.racc_t))&&i(d(G,0))&&i(J=K["$[]"](G))&&L(ee["$[]"](G),Q.racc_state["$[]"](-1))||(J=Z["$[]"](Q.racc_state["$[]"](-1)));i(J=Q.$_racc_evalact(J,r)););},{$$s:O})},{$$s:F})}),k(l,"$_racc_evalact",function(c,g){var r,Z,n=this,h=e,F=e,ee=e,te=e,X=e,re=e;if(h=null==(r=_(g))[0]?e:r[0],F=null==r[1]?e:r[1],ee=null==r[3]?e:r[3],Z=null==r[11]?e:r[11],te=null==r[12]?e:r[12],i(I(c,0))&&i(H(c,Z)))i(I(n.racc_error_status,0))&&(L(n.racc_t,1)||(n.racc_error_status=T(n.racc_error_status,1))),n.racc_vstack.$push(n.racc_val),n.racc_state.$push(c),n.racc_read_next=!0,i(n.yydebug)&&(n.racc_tstack.$push(n.racc_t),n.$racc_shift(n.racc_t,n.racc_tstack,n.racc_vstack));else if(i(H(c,0))&&i(I(c,te["$-@"]()))){if(X=u(n,"catch",["racc_jump"],function J(){var G=null==J.$$s?this:J.$$s;return null==G.racc_state&&(G.racc_state=e),G.racc_state.$push(G.$_racc_do_reduce(g,c)),!1},{$$s:n}),i(X))switch(X){case 1:return n.racc_user_yyerror=!0,te["$-@"]();case 2:return Z;default:n.$raise("[Racc Bug] unknown jump code")}}else if(L(c,Z))i(n.yydebug)&&n.$racc_accept(),n.$throw("racc_end_parse",n.racc_vstack["$[]"](0));else{if(L(c,te["$-@"]())){switch(n.racc_error_status){case 0:i(g["$[]"](21))||n.$on_error(n.racc_t,n.racc_val,n.racc_vstack);break;case 3:L(n.racc_t,0)&&n.$throw("racc_end_parse",e),n.racc_read_next=!0}for(n.racc_user_yyerror=!1,n.racc_error_status=3;i(!0)&&!(i(re=ee["$[]"](n.racc_state["$[]"](-1)))&&(re=W(re,1),i(d(re,0))&&i(c=h["$[]"](re))&&L(F["$[]"](re),n.racc_state["$[]"](-1))));)i(q(n.racc_state.$size(),1))&&n.$throw("racc_end_parse",e),n.racc_state.$pop(),n.racc_vstack.$pop(),i(n.yydebug)&&(n.racc_tstack.$pop(),n.$racc_e_pop(n.racc_state,n.racc_tstack,n.racc_vstack));return c}n.$raise("[Racc Bug] unknown action "+c.$inspect())}return i(n.yydebug)&&n.$racc_next_state(n.racc_state["$[]"](-1),n.racc_state),e}),k(l,"$_racc_do_reduce",function(c,g){var r,te,re,ce,$e,Q,se,n=this,F=e,K=e,ee=e,Z=e,X=e,J=e,G=e,ne=e,O=e,w=e,ie=e,ae=e,ue=e;return F=null==(r=_(c))[4]?e:r[4],K=null==r[5]?e:r[5],ee=null==r[6]?e:r[6],Z=null==r[7]?e:r[7],te=null==r[8]?e:r[8],X=null==r[9]?e:r[9],re=null==r[13]?e:r[13],J=n.racc_state,G=n.racc_vstack,ne=n.racc_tstack,O=R(g,-3),w=X["$[]"](O),ce=X["$[]"](W(O,1)),$e=X["$[]"](W(O,2)),Q=[],i(n.yydebug)&&(ie=ne["$[]"](w["$-@"](),w)),ae=G["$[]"](w["$-@"](),w),i(n.yydebug)&&ne["$[]="](w["$-@"](),w,Q),G["$[]="](w["$-@"](),w,Q),J["$[]="](w["$-@"](),w,Q),i(re)?G.$push(n.$__send__($e,ae,G,ae["$[]"](0))):G.$push(n.$__send__($e,ae,G)),ne.$push(ce),i(n.yydebug)&&n.$racc_reduce(ie,ce,ne,G),se=T(ce,te),i(O=Z["$[]"](se))&&(O=W(O,J["$[]"](-1)),i(d(O,0))&&i(ue=F["$[]"](O))&&L(K["$[]"](O),se))?ue:ee["$[]"](se)}),k(l,"$on_error",function(c,g,r){var n,s=this;return s.$raise(p("ParseError"),s.$sprintf("\nparse error on value %s (%s)",g.$inspect(),i(n=s.$token_to_str(c))?n:"?"))}),k(l,"$yyerror",function(){return this.$throw("racc_jump",1)}),k(l,"$yyaccept",function(){return this.$throw("racc_jump",2)}),k(l,"$yyerrok",$("racc_error_status",0)),k(l,"$racc_read_token",function(c,g,r){var s=this;return s.racc_debug_out.$print("read    "),s.racc_debug_out.$print(g.$inspect(),"(",s.$racc_token2str(c),") "),s.racc_debug_out.$puts(r.$inspect()),s.racc_debug_out.$puts()}),k(l,"$racc_shift",function(c,g,r){var s=this;return s.racc_debug_out.$puts("shift   "+s.$racc_token2str(c)),s.$racc_print_stacks(g,r),s.racc_debug_out.$puts()}),k(l,"$racc_reduce",function(c,g,r,s){var n=this,h=e;return(h=n.racc_debug_out).$print("reduce "),i(c["$empty?"]())?h.$print(" <none>"):u(c,"each",[],function F(K){return null==K&&(K=e),h.$print(" ",(null==F.$$s?this:F.$$s).$racc_token2str(K))},{$$s:n}),h.$puts(" --\x3e "+n.$racc_token2str(g)),n.$racc_print_stacks(r,s),n.racc_debug_out.$puts()}),k(l,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()}),k(l,"$racc_e_pop",function(c,g,r){var s=this;return s.racc_debug_out.$puts("error recovering mode: pop token"),s.$racc_print_states(c),s.$racc_print_stacks(g,r),s.racc_debug_out.$puts()}),k(l,"$racc_next_state",function(c,g){var r=this;return r.racc_debug_out.$puts("goto    "+c),r.$racc_print_states(g),r.racc_debug_out.$puts()}),k(l,"$racc_print_stacks",function(c,g){var s=e;return(s=this.racc_debug_out).$print("        ["),u(c,"each_index",[],function n(h){return null==h&&(h=e),s.$print(" (",(null==n.$$s?this:n.$$s).$racc_token2str(c["$[]"](h))," ",g["$[]"](h).$inspect(),")")},{$$s:this}),s.$puts(" ]")}),k(l,"$racc_print_states",function(c){var r=e;return(r=this.racc_debug_out).$print("        ["),u(c,"each",[],function(n){return null==n&&(n=e),r.$print(" ",n)}),r.$puts(" ]")}),k(l,"$racc_token2str",function(c){var r;return i(r=C(this.$class(),"Racc_token_to_s_table")["$[]"](c))?r:this.$raise("[Racc Bug] can't convert token "+c+" to string")}),k(l,"$token_to_str",function(c){return C(this.$class(),"Racc_token_to_s_table")["$[]"](c)})}(f[0],f)},Opal.modules.strscan=function(t){var L,d,I,T,q,v=t.def,i=t.truthy,y=t.eqeqeq,j=t.Opal,D=t.return_ivar,H=t.send,k=t.alias,_=[],u=t.nil;return L=_,I=[d=(0,t.klass)(_[0],null,"StringScanner")].concat(L),T=t.$r(I),(q=d.$$prototype).pos=q.string=q.working=q.matched=q.prev_pos=q.match=u,d.$attr_reader("pos","matched"),v(d,"$initialize",function($){var a=this;return a.string=$,a.pos=0,a.matched=u,a.working=$,a.match=[]}),d.$attr_reader("string"),v(d,"$beginning_of_line?",function(){var $=this;return 0===$.pos||"\n"===$.string.charAt($.pos-1)}),v(d,"$scan",function($){var a=this,f=($=a.$anchor($)).exec(a.working);return null==f?a.matched=u:(a.prev_pos=a.pos,a.pos+=f[0].length,a.working=a.working.substring(f[0].length),a.matched=f[0],a.match=f,f[0])}),v(d,"$scan_until",function($){var a=this;$=a.$anchor($);for(var f=a.working,E=0;f.length!=E;++E){var e=$.exec(f.substr(E));if(null!==e){var C=E+e[0].length,S=f.substr(0,C);return a.matched=e[0],a.match=e,a.prev_pos=a.pos+E,a.pos+=C,a.working=f.substr(C),S}}return a.matched=u}),v(d,"$[]",function($){var f;if(i(this.match["$empty?"]()))return u;y(T("Symbol"),f=$)?$=$.$to_s():y(T("String"),f)||($=j["$coerce_to!"]($,T("Integer"),"to_int"));var E=this.match;return $<0&&($+=E.length),$<0||$>=E.length||null==E[$]?u:E[$]}),v(d,"$check",function($){var a=this,f=($=a.$anchor($)).exec(a.working);return a.matched=null==f?u:f[0]}),v(d,"$check_until",function($){var a=this,f=a.prev_pos,E=a.pos,e=a.working,C=a.$scan_until($);return a.prev_pos=f,a.pos=E,a.working=e,C}),v(d,"$peek",function($){return this.working.substring(0,$)}),v(d,"$eos?",function(){return 0===this.working.length}),v(d,"$exist?",function($){var f=$.exec(this.working);return null==f?u:0==f.index?0:f.index+1}),v(d,"$skip",function($){var a=this,f=($=a.$anchor($)).exec(a.working);if(null==f)return a.match=[],a.matched=u;var E=f[0],e=E.length;return a.matched=E,a.match=f,a.prev_pos=a.pos,a.pos+=e,a.working=a.working.substring(e),e}),v(d,"$skip_until",function($){var f=this.$scan_until($);return f===u?u:(this.matched=f.substr(-1),f.length)}),v(d,"$get_byte",function(){var $=this,a=u;return $.pos<$.string.length?($.prev_pos=$.pos,$.pos+=1,a=$.matched=$.working.substring(0,1),$.working=$.working.substring(1)):$.matched=u,a}),v(d,"$match?",function($){var a=this,f=($=a.$anchor($)).exec(a.working);return null==f?u:(a.prev_pos=a.pos,f[0].length)}),v(d,"$pos=",function($){var a=this;return $<0&&($+=a.string.$length()),a.pos=$,a.working=a.string.slice($)}),v(d,"$matched_size",function(){return this.matched===u?u:this.matched.length}),v(d,"$post_match",function(){var $=this;return $.matched===u?u:$.string.substr($.pos)}),v(d,"$pre_match",function(){var $=this;return $.matched===u?u:$.string.substr(0,$.prev_pos)}),v(d,"$reset",function(){var $=this;return $.working=$.string,$.matched=u,$.pos=0}),v(d,"$rest",D("working")),v(d,"$rest?",function(){return 0!==this.working.length}),v(d,"$rest_size",function(){return this.$rest().$size()}),v(d,"$terminate",function(){var $,a=this;return a.match=u,$=[a.string.$length()],H(a,"pos=",$),$[$.length-1]}),v(d,"$unscan",function(){var $=this;return $.pos=$.prev_pos,$.prev_pos=u,$.match=u,$}),k(d,"bol?","beginning_of_line?"),k(d,"getch","get_byte"),d.$private(),v(d,"$anchor",function($){var a=$.toString().match(/\/([^\/]+)$/);return a=a?a[1]:void 0,new RegExp("^(?:"+$.source+")",a)})},Opal.modules["bcdice/normalize"]=function(t){var k,W,u,U=t.module,v=t.eqeqeq,i=t.def,y=t.eqeq,j=[],D=t.nil;return k=j,u=[U(j[0],"BCDice")].concat(k),(W=U(u[0],"Normalize")).$module_function(),i(W,"$comparison_operator",function(d){var I;return v(/<=|=</,I=d)?"<=":v(/>=|=>/,I)?">=":v(/<>|!=|=!/,I)?"!=":v(/</,I)?"<":v(/>/,I)?">":v(/=/,I)?"==":D}),i(W,"$target_number",function(d){return y(d,"?")?d:d.$to_i()})},Opal.modules["bcdice/common_command/lexer"]=function(t){var V,I,a,f,E,e,q,L,U=t.module,v=t.klass,i=t.const_set,y=t.hash2,j=t.truthy,D=t.def,H=t.top,k=[],_=t.nil;return H.$require("strscan"),H.$require("bcdice/normalize"),V=k,I=L=[U(k[0],"BCDice")].concat(V),a=q=[U(L[0],"CommonCommand")].concat(I),E=[f=v(q[0],null,"Lexer")].concat(a),e=t.$r(E),f.$$prototype.scanner=_,i(E[0],"SYMBOLS",y(["+","-","*","/","(",")","[","]","?","@"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","[":"BRACKETL","]":"BRACKETR","?":"QUESTION","@":"AT"}).$freeze()),D(f,"$initialize",function(A){var P;return A=j(P=A.$split(" ",2).$first())?P:"",this.scanner=e("StringScanner").$new(A)}),D(f,"$next_token",function(){var A=this,z=_,P=_,m=_,B=_;return j(A.scanner["$eos?"]())?[!1,"$"]:j(z=A.scanner.$scan(/\d+/))?["NUMBER",z.$to_i()]:j(P=A.scanner.$scan(/[<>!=]+/))?["CMP_OP",e("Normalize").$comparison_operator(P)]:(m=A.scanner.$getch().$upcase(),[j(B=e("SYMBOLS")["$[]"](m))?B:m.$to_sym(),m])}),D(f,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/arithmetic/parser"]=function(t){var W,T,E,A,z,P,m,Y,B,M,b,l,N,e,C,S,R,$,d,U=t.module,v=t.klass,i=t.defs,y=t.def,j=t.hash,D=t.const_set,H=t.top,k=[],_=t.nil,u=t.$$$;return H.$require("racc/parser.rb"),H.$require("bcdice/common_command/lexer"),H.$require("bcdice/arithmetic/node"),W=k,T=d=[U(k[0],"BCDice")].concat(W),R=[U(d[0],"Arithmetic")].concat(T),$=t.$r(R),E=R,C=[e=v(R[0],u($("Racc"),"Parser"),"Parser")].concat(E),S=t.$r(C),e.$$prototype.lexer=_,i(e,"$parse",function(s){return this.$new().$parse(s)}),y(e,"$parse",function(s){try{return this.lexer=u(u(S("BCDice"),"CommonCommand"),"Lexer").$new(s),this.$do_parse()}catch(h){if(!t.rescue(h,[S("ParseError")]))throw h;try{return _}finally{t.pop_exception()}}}),e.$private(),y(e,"$next_token",function(){return this.lexer.$next_token()}),A=t.large_array_unpack("8,17,8,12,13,4,5,4,5,7,8,7,8,12,13,4,5,4,5,7,8,7,8,12,13,4,5,4,5,7,8,7,8,,,4,5,4,5,7,9,7,,,10,11,,10,11,22,26,24,25,27"),z=t.large_array_unpack("0,9,4,2,2,0,0,4,4,0,5,4,7,18,18,5,5,7,7,5,10,7,11,19,19,10,10,11,11,10,12,11,13,,,12,12,13,13,12,1,13,,,16,16,,1,1,16,21,21,21,21"),P=[-2,40,-6,_,0,8,_,10,_,1,18,20,28,30,_,_,37,_,4,14,_,47,_,_,_,_,_,_],m=[-17,-17,-3,-6,-17,-17,-14,-17,-16,-17,-17,-17,-17,-17,-12,-13,-17,28,-1,-2,-4,-7,-15,-5,-8,-9,-10,-11],Y=[14,15,23,1,18,19,_,_,20,21,16],B=[3,3,4,1,2,2,_,_,3,3,1],M=[_,3,-6,-4,-19,_],b=[_,_,2,3,_,6],l=t.large_array_unpack("0,0,racc_error,3,14,_reduce_1,3,14,_reduce_2,1,14,_reduce_none,3,15,_reduce_4,4,15,_reduce_5,1,15,_reduce_none,0,17,_reduce_7,1,17,_reduce_8,1,17,_reduce_9,1,17,_reduce_10,1,17,_reduce_11,2,16,_reduce_12,2,16,_reduce_13,1,16,_reduce_none,3,18,_reduce_15,1,18,_reduce_16"),N=j(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12),D(C[0],"Racc_arg",[A,z,m,P,Y,B,b,M,13,l,N,28,17,!0]),D(C[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","$start","add","mul","unary","round_type","term"]),D(C[0],"Racc_debug_parser",!1),y(e,"$_reduce_1",function(s,n,h){return u(u(S("Arithmetic"),"Node"),"BinaryOp").$new(s["$[]"](0),"+",s["$[]"](2))}),y(e,"$_reduce_2",function(s,n,h){return u(u(S("Arithmetic"),"Node"),"BinaryOp").$new(s["$[]"](0),"-",s["$[]"](2))}),y(e,"$_reduce_4",function(s,n,h){return u(u(S("Arithmetic"),"Node"),"BinaryOp").$new(s["$[]"](0),"*",s["$[]"](2))}),y(e,"$_reduce_5",function(s,n,h){return s["$[]"](3).$new(s["$[]"](0),s["$[]"](2))}),y(e,"$_reduce_7",function(s,n,h){return u(u(S("Arithmetic"),"Node"),"DivideWithGameSystemDefault")}),y(e,"$_reduce_8",function(s,n,h){return u(u(S("Arithmetic"),"Node"),"DivideWithCeil")}),y(e,"$_reduce_9",function(s,n,h){return u(u(S("Arithmetic"),"Node"),"DivideWithCeil")}),y(e,"$_reduce_10",function(s,n,h){return u(u(S("Arithmetic"),"Node"),"DivideWithRound")}),y(e,"$_reduce_11",function(s,n,h){return u(u(S("Arithmetic"),"Node"),"DivideWithFloor")}),y(e,"$_reduce_12",function(s,n,h){return s["$[]"](1)}),y(e,"$_reduce_13",function(s,n,h){return u(u(S("Arithmetic"),"Node"),"Negative").$new(s["$[]"](1))}),y(e,"$_reduce_15",function(s,n,h){return s["$[]"](1)}),y(e,"$_reduce_16",function(s,n,h){return u(u(S("Arithmetic"),"Node"),"Number").$new(s["$[]"](0))}),y(e,"$_reduce_none",function(s,n,h){return s["$[]"](0)})},Opal.modules["bcdice/arithmetic"]=function(t){var k,W,I,q,R,L,d,u,U=t.module,v=t.thrower,i=t.def,y=t.top,j=[],D=t.nil;return y.$require("bcdice/arithmetic/node"),y.$require("bcdice/arithmetic/parser"),k=j,W=u=[U(j[0],"BCDice")].concat(k),d=[L=U(u[0],"Arithmetic")].concat(W),q=[I=t.get_singleton_class(L)].concat(d),R=t.$r(q),i(I,"$eval",function(a,f){try{var e;v("eval_return");try{return(e=R("Parser").$parse(a))===D||null==e?D:e.$eval(f)}catch(S){if(!t.rescue(S,[R("ZeroDivisionError")]))throw S;try{return D}finally{t.pop_exception()}}}catch(S){if(S===t.t_eval_return)return S.$v;throw S}})},Opal.queue(function(t){var a,C,Y,B,M,b,A,z,E,U=t.module,v=t.klass,i=t.const_set,y=t.send2,j=t.find_super,D=t.def,H=t.truthy,k=t.send,_=t.rb_le,u=t.rb_ge,V=t.rb_plus,W=t.rb_lt,L=t.thrower,d=t.hash2,I=t.top,T=[],q=t.nil,R=t.$$$;return I.$require("bcdice/dice_table/table"),I.$require("bcdice/dice_table/d66_grid_table"),I.$require("bcdice/arithmetic"),a=T,C=E=[U(T[0],"BCDice")].concat(a),A=[U(E[0],"GameSystem")].concat(C),z=t.$r(A),Y=A,M=[B=v(A[0],z("Base"),"AngelGear")].concat(Y),b=t.$r(M),B.$$prototype.randomizer=q,i(M[0],"ID","AngelGear"),i(M[0],"NAME","\u30a8\u30f3\u30bc\u30eb\u30ae\u30a2 \u5929\u4f7f\u5927\u6226TRPG The 2nd Editon"),i(M[0],"SORT_KEY","\u3048\u3093\u305b\u308b\u304d\u30422"),i(M[0],"HELP_MESSAGE","\u30fb\u5224\u5b9a\u3000nAG[s][\xb1a]\n[]\u5185\u306f\u7701\u7565\u53ef\u80fd\u3002\nn:\u5224\u5b9a\u5024\ns:\u6280\u80fd\u5024\na:\u4fee\u6b63\n\uff08\u4f8b\uff09\n12AG 10AG3\xb120\n\n\u30fb\u611f\u60c5\u8868\u3000ET\n"),D(B,"$initialize",function x(p){var o=this;return x.$$p=null,y(o,j(o,"initialize",x,!1,!0),"initialize",[p],null),o.sort_barabara_dice=!0}),D(B,"$eval_game_system_specific_command",function(p){var N,c=q;return H(c=/^(\d+)AG(\d+)?(([+-]\d+)*)$/.$match(p))?this.$resolute_action(c["$[]"](1).$to_i(),(N=c["$[]"](2))===q||null==N?q:N.$to_i(),c["$[]"](3),p):this.$roll_tables(p,b("TABLES"))}),D(B,"$resolute_action",function(p,N,o,c){try{L("eval_return");var n,ee,s=q,h=q,F=q,K=q;return n=(s=this.randomizer.$roll_barabara(p,6).$sort()).$join(","),h=0,F=0,H(N)&&(F=k(s,"count",[],function(te){return null==te&&(te=q),_(te,N)}),H(o["$empty?"]())||(h=b("Arithmetic").$eval(o,R(b("RoundType"),"FLOOR")))),H(u(V(F,h),100))&&(K="(\u798f\u97f3\u767a\u751f)"),ee="("+c+") \uff1e "+F+"["+n+"]"+this.$format("%+d",h)+" \uff1e \u6210\u529f\u6570: "+V(F,h)+K,H(u(V(F,h),100))?b("Result").$critical(ee):W(0,V(F,h))?b("Result").$success(ee):b("Result").$failure(ee)}catch(Z){if(Z===t.t_eval_return)return Z.$v;throw Z}}),i(M[0],"TABLES",d(["ET"],{ET:R(b("DiceTable"),"D66GridTable").$new("\u611f\u60c5\u8868",[["\u597d\u5947\u5fc3\uff08\u597d\u5947\u5fc3\uff09","\u61a7\u308c\uff08\u3042\u3053\u304c\u308c\uff09","\u5c0a\u656c\uff08\u305d\u3093\u3051\u3044\uff09","\u4ef2\u9593\u610f\u8b58\uff08\u306a\u304b\u307e\u3044\u3057\u304d\uff09","\u6bcd\u6027\u611b\uff08\u307c\u305b\u3044\u3042\u3044\uff09","\u611f\u5fc3\uff08\u304b\u3093\u3057\u3093\uff09"],["\u7d14\u611b\uff08\u3058\u3085\u3093\u3042\u3044\uff09","\u53cb\u60c5\uff08\u3086\u3046\u3058\u3087\u3046\uff09","\u540c\u60c5\uff08\u3069\u3046\u3058\u3087\u3046\uff09","\u7236\u6027\u611b\uff08\u3075\u305b\u3044\u3042\u3044\uff09","\u5e78\u798f\u611f\uff08\u3053\u3046\u3075\u304f\u304b\u3093\uff09","\u4fe1\u983c\uff08\u3057\u3093\u3089\u3044\uff09"],["\u7af6\u4e89\u5fc3\uff08\u304d\u3087\u3046\u305d\u3046\u3057\u3093\uff09","\u89aa\u8fd1\u611f\uff08\u3057\u3093\u304d\u3093\u304b\u3093\uff09","\u307e\u3054\u3053\u308d","\u597d\u610f\uff08\u3053\u3046\u3044\uff09","\u6709\u70ba\uff08\u3086\u3046\u3044\uff09","\u5d07\u62dd\uff08\u3059\u3046\u306f\u3044\uff09"],["\u5927\u5acc\u3044\uff08\u3060\u3044\u304d\u3089\u3044\uff09","\u59ac\u307f\uff08\u306d\u305f\u307f\uff09","\u4fae\u8511\uff08\u3076\u3079\u3064\uff09","\u8150\u308c\u7e01\uff08\u304f\u3055\u308c\u3048\u3093\uff09","\u6050\u6016\uff08\u304d\u3087\u3046\u3075\uff09","\u52a3\u7b49\u611f\uff08\u308c\u3063\u3068\u3046\u304b\u3093\uff09"],["\u504f\u611b\uff08\u3078\u3093\u3042\u3044\uff09","\u5bc2\u3057\u3055\uff08\u3055\u3073\u3057\u3055\uff09","\u6190\u61ab\uff08\u308c\u3093\u3073\u3093\uff09","\u95d8\u4e89\u5fc3\uff08\u3068\u3046\u305d\u3046\u3057\u3093\uff09","\u98df\u50b7\uff08\u3057\u3087\u304f\u3057\u3087\u3046\uff09","\u5618\u3064\u304d\uff08\u3046\u305d\u3064\u304d\uff09"],["\u7518\u3048\uff08\u3042\u307e\u3048\uff09","\u82db\u7acb\u3061\uff08\u3044\u3089\u3060\u3061\uff09","\u4e0b\u5fc3\uff08\u3057\u305f\u3054\u3053\u308d\uff09","\u618e\u60aa\uff08\u305e\u3046\u304a\uff09","\u7591\u60d1\uff08\u304e\u308f\u304f\uff09","\u652f\u914d\uff08\u3057\u306f\u3044\uff09"]])}).$freeze()),B.$register_prefix("\\d+AG",b("TABLES").$keys())})}}]);