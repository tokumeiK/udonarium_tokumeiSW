(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[6152],{8463:(ye,pe,ge)=>{ge(9993),Opal.modules["bcdice/arithmetic_evaluator"]=function(e){var M,j,u,l,k,A,q,Z,Y=e.module,U=e.ensure_kwargs,c=e.truthy,I=e.thrower,C=e.def,d=[],F=e.nil,b=e.$$$;return M=d,j=Z=[Y(d[0],"BCDice")].concat(M),q=[A=Y(Z[0],"ArithmeticEvaluator")].concat(j),l=[u=e.get_singleton_class(A)].concat(q),k=e.$r(l),C(u,"$eval",function(K,r){try{I("eval_return");var p,H=F;return null==(p=(r=U(r)).$$smap.round_type)&&(p=b(k("RoundType"),"FLOOR")),c(K)&&c(H=k("Arithmetic").$eval(K,p))?H:0}catch(P){if(P===e.t_eval_return)return P.$v;throw P}},-2)},Opal.modules["i18n/backend/fallbacks"]=function(e){var L,_,r,n,l,k,Y=e.module,U=e.class_variable_set,c=e.truthy,I=e.class_variable_get,C=e.def,d=e.send,F=e.send2,b=e.find_super,N=e.hash2,M=e.find_block_super,E=e.neqeq,Z=e.thrower,W=e.return_val,j=[],A=e.nil,q=e.$$$;return L=j,k=[l=Y(j[0],"I18n")].concat(L),U(k[0],"@@fallbacks",A),_=e.get_singleton_class(l),r=[_].concat(k),n=e.$r(r),C(_,"$fallbacks",function(){var P=A;return U(r[1],"@@fallbacks",c(null!=r[1].$$cvars["@@fallbacks"]?"class variable":A)&&c(P=I(r[1],"@@fallbacks",!1))?P:q(q(n("I18n"),"Locale"),"Fallbacks").$new()),c(P=n("Thread").$current()["$[]"]("i18n_fallbacks"))?P:I(r[1],"@@fallbacks",!1)}),C(_,"$fallbacks=",function(H){var P;return U(r[1],"@@fallbacks",c(H["$is_a?"](n("Array")))?q(q(n("I18n"),"Locale"),"Fallbacks").$new(H):H),P=["i18n_fallbacks",I(r[1],"@@fallbacks",!1)],d(n("Thread").$current(),"[]=",P),P[P.length-1]}),function(_,K){var H,P,R,g,n=[Y(_,"Backend")].concat(K);return H=n,R=[P=Y(n[0],"Fallbacks")].concat(H),g=e.$r(R),C(P,"$translate",function z(h,y,$){try{var o=Z("return"),f=z.$$p||A,S=this,s=A,m=A;return z.$$p=null,null==$&&($=g("EMPTY_HASH")),c($.$fetch("fallback",!0))?c($["$[]"]("fallback_in_progress"))?F(S,b(S,"translate",z,!1,!0),"translate",[h,y,$],f):(c($["$[]"]("default"))&&(s=S["$extract_non_symbol_default!"]($)),m=$.$merge(N(["fallback_in_progress"],{fallback_in_progress:!0})),d(g("I18n").$fallbacks()["$[]"](h),"each",[],function t(T){var i=null==t.$$s?this:t.$$s;null==T&&(T=A);try{return d(i,"catch",["exception"],function v(){var a=null==v.$$s?this:v.$$s,X=A;if(X=F(a,M(a,"translate",v.$$def||t.$$def||z,!1,!1),"translate",[T,y,m],null),c(X["$nil?"]()))return A;E(h.$to_s(),T.$to_s())&&a.$on_fallback(h,T,y,$),o.$throw(X)},{$$s:i,$$ret:o})}catch(v){if(!e.rescue(v,[q(g("I18n"),"InvalidLocale")]))throw v;try{return A}finally{e.pop_exception()}}},{$$s:S}),c($["$key?"]("default"))&&c($["$[]"]("default")["$nil?"]())?A:c(s)?F(S,b(S,"translate",z,!1,!0),"translate",[h,A,$.$merge(N(["default"],{default:s}))],null):S.$throw("exception",q(g("I18n"),"MissingTranslation").$new(h,y,$))):F(S,b(S,"translate",z,!1,!0),"translate",[h,y,$],f)}catch(t){if(t===o)return t.$v;throw t}},-3),C(P,"$extract_non_symbol_default!",function(h){var $,y=A;return y=[h["$[]"]("default")].$flatten(),$=d(y,"detect",[],function(f){return null==f&&(f=A),f["$is_a?"](g("Symbol"))["$!"]()}),c($)&&h["$[]="]("default",y["$[]"](0,y.$index($))),$}),C(P,"$exists?",function z(h,y,$){try{var o=Z("return"),f=z.$$p||A,S=this;return z.$$p=null,null==$&&($=g("EMPTY_HASH")),c($.$fetch("fallback",!0))?(d(g("I18n").$fallbacks()["$[]"](h),"each",[],function s(m){var t=null==s.$$s?this:s.$$s;null==m&&(m=A);try{if(!c(F(t,M(t,"exists?",s.$$def||z,!1,!1),"exists?",[m,y],null)))return A;o.$throw(!0)}catch(T){if(!e.rescue(T,[q(g("I18n"),"InvalidLocale")]))throw T;try{return A}finally{e.pop_exception()}}},{$$s:S,$$ret:o}),!1):F(S,b(S,"exists?",z,!1,!0),"exists?",[h,y,$],f)}catch(s){if(s===o)return s.$v;throw s}},-3),P.$private(),C(P,"$on_fallback",W(A))}(k[0],k)},Opal.modules["bcdice/randomizer"]=function(e){var l,p,H,P,R,g,_,K,U=e.klass,c=e.const_set,I=e.def,C=e.truthy,d=e.rb_gt,F=e.rb_plus,b=e.rb_le,N=e.send,M=e.rb_minus,E=e.eqeq,Z=e.rb_times,W=e.eqeqeq,j=e.rb_ge,A=[],q=e.nil,u=e.$$$;return l=A,_=[(0,e.module)(A[0],"BCDice")].concat(l),K=e.$r(_),p=_,P=[H=U(_[0],null,"Randomizer")].concat(p),R=e.$r(P),(g=H.$$prototype).rand_results=g.detailed_rand_results=q,c(P[0],"UPPER_LIMIT_DICE_TIMES",200),c(P[0],"UPPER_LIMIT_DICE_SIDES",1e4),c(P[0],"UPPER_LIMIT_RANDS",1e4),I(H,"$initialize",function(){return this.rand_results=[],this.detailed_rand_results=[]}),H.$attr_reader("rand_results"),H.$attr_reader("detailed_rand_results"),c(P[0],"DetailedRandResult",R("Struct").$new("kind","sides","value")),I(H,"$roll_barabara",function(h,y){var $=this;return C(d(F($.rand_results.$size(),h),R("UPPER_LIMIT_RANDS")))&&$.$raise(R("TooManyRandsError")),C(b(h,0))||C(d(h,R("UPPER_LIMIT_DICE_TIMES")))?[]:N(R("Array"),"new",[h],function o(){return(null==o.$$s?this:o.$$s).$roll_once(y)},{$$s:$})}),I(H,"$roll_sum",function(h,y){return this.$roll_barabara(h,y).$sum()}),I(H,"$roll_once",function(h){var $=q;return C(b(h,0))||C(d(h,R("UPPER_LIMIT_DICE_SIDES")))?0:($=this.$rand_inner(h),this.$push_to_detail("normal",h,$),$)}),I(H,"$roll_index",function(h){return M(this.$roll_once(h),1)}),I(H,"$roll_tens_d10",function(){var $,y=q;return y=this.$rand_inner(10),E(y,10)&&(y=0),$=Z(y,10),this.$push_to_detail("tens_d10",10,$),$}),I(H,"$roll_d9",function(){var y;return y=M(this.$rand_inner(10),1),this.$push_to_detail("d9",10,y),y}),I(H,"$roll_d66",function(h){var o,$=q;return $=N(R("Array"),"new",[2],function f(){return(null==f.$$s?this:f.$$s).$roll_once(6)},{$$s:this}),W(u(R("D66SortType"),"ASC"),o=h)?$["$sort!"]():W(u(R("D66SortType"),"DESC"),o)&&$["$sort!"]()["$reverse!"](),F(Z($["$[]"](0),10),$["$[]"](1))}),H.$private(),I(H,"$rand_inner",function(h){var $,y=this;return C(j(y.rand_results.$size(),R("UPPER_LIMIT_RANDS")))&&y.$raise(R("TooManyRandsError")),$=y.$random(h),y.rand_results["$<<"]([$,h]),$}),I(H,"$random",function(h){return F(R("Kernel").$rand(h),1)}),I(H,"$push_to_detail",function(h,y,$){var f;return f=R("DetailedRandResult").$new(h,y,$),this.detailed_rand_results.$push(f)}),U(_[0],K("StandardError"),"TooManyRandsError"),q},Opal.modules["bcdice/dice_table/roll_result"]=function(e){var N,W,L,l,k,_,K,A,E,Y=e.module,U=e.klass,c=e.def,I=e.truthy,C=e.return_val,d=[],F=e.nil;return N=d,W=E=[Y(d[0],"BCDice")].concat(N),L=A=[Y(E[0],"DiceTable")].concat(W),k=[l=U(A[0],null,"RollResult")].concat(L),_=e.$r(k),(K=l.$$prototype).table_name=K.value=K.body=F,c(l,"$initialize",function(n,p,H){var P=this;return P.table_name=n,P.value=p,P.body=H}),l.$attr_reader("table_name"),l.$attr_reader("value"),l.$attr_reader("body"),c(l,"$to_s",function(){var n=this;return n.table_name+"("+n.value+") \uff1e "+n.body}),c(l,"$last_body",function(){var n=this;return I(n.body["$is_a?"](_("RollResult")))?n.body.$last_body():n.body}),c(l,"$empty?",C(!1))},Opal.modules["bcdice/dice_table/chain_table"]=function(e){var N,W,L,l,k,_,K,A,E,Y=e.module,U=e.klass,c=e.truthy,I=e.def,C=e.rb_minus,d=[],F=e.nil;return N=d,W=E=[Y(d[0],"BCDice")].concat(N),L=A=[Y(E[0],"DiceTable")].concat(W),k=[l=U(A[0],null,"ChainTable")].concat(L),_=e.$r(k),(K=l.$$prototype).times=K.sides=K.items=K.name=F,I(l,"$initialize",function(n,p,H){var P=this,R=F;return P.name=n,P.items=H.$freeze(),R=/(\d+)D(\d+)/i.$match(p),c(R)||P.$raise(_("ArgumentError"),"Unexpected table type: "+p),P.times=R["$[]"](1).$to_i(),P.sides=R["$[]"](2).$to_i()}),I(l,"$roll",function(n){var H,P,p=this,R=F;return H=n.$roll_sum(p.times,p.sides),P=C(H,p.times),R=p.items["$[]"](P),c(R["$respond_to?"]("roll"))&&(R=R.$roll(n)),_("RollResult").$new(p.name,H,R)})},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(e){var Z,q,_,K,r,n,p,L,j,Y=e.module,U=e.klass,c=e.hash2,I=e.defs,C=e.def,d=e.rb_plus,F=e.rb_times,b=e.rb_minus,N=[],M=e.nil;return Z=N,q=j=[Y(N[0],"BCDice")].concat(Z),_=L=[Y(j[0],"DiceTable")].concat(q),r=[K=U(L[0],null,"D66GridTable")].concat(_),n=e.$r(r),(p=K.$$prototype).name=p.items=M,I(K,"$from_i18n",function(P,R){var z=M;return z=n("I18n").$t(P,c(["locale","raise"],{locale:R,raise:!0})),this.$new(z["$[]"]("name"),z["$[]"]("items"))}),C(K,"$initialize",function(P,R){return this.name=P,this.items=R.$freeze()}),C(K,"$roll",function(P){var g,z,h,y,$;return g=P.$roll_once(6),z=P.$roll_once(6),h=d(F(g,10),z),y=b(g,1),$=b(z,1),n("RollResult").$new(this.name,h,this.items["$[]"](y)["$[]"]($))})},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(e){var M,j,k,_,K,r,q,u,Z,Y=e.module,U=e.klass,c=e.hash2,I=e.defs,C=e.def,F=[],b=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),M=F,j=Z=[Y(F[0],"BCDice")].concat(M),q=[Y(Z[0],"DiceTable")].concat(j),u=e.$r(q),k=q,K=[_=U(q[0],u("D66GridTable"),"D66HalfGridTable")].concat(k),r=e.$r(K),I(_,"$from_i18n",function(p,H){var R=b;return R=r("I18n").$t(p,c(["locale","raise"],{locale:H,raise:!0})),this.$new(R["$[]"]("name"),R["$[]"]("items_1_2_3"),R["$[]"]("items_4_5_6"))}),C(_,"$initialize",function(p,H,P){return this.name=p,this.items=[H,H,H,P,P,P].$freeze()})},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(e){var M,j,k,_,K,r,q,u,Z,Y=e.module,U=e.klass,c=e.hash2,I=e.defs,C=e.def,F=[],b=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),M=F,j=Z=[Y(F[0],"BCDice")].concat(M),q=[Y(Z[0],"DiceTable")].concat(j),u=e.$r(q),k=q,K=[_=U(q[0],u("D66GridTable"),"D66OneThirdTable")].concat(k),r=e.$r(K),I(_,"$from_i18n",function(p,H){var R=b;return R=r("I18n").$t(p,c(["locale","raise"],{locale:H,raise:!0})),this.$new(R["$[]"]("name"),R["$[]"]("items_1_2"),R["$[]"]("items_3_4"),R["$[]"]("items_5_6"))}),C(_,"$initialize",function(p,H,P,R){return this.name=p,this.items=[H,H,P,P,R,R].$freeze()})},Opal.modules["bcdice/dice_table/d66_table"]=function(e){var j,L,r,n,p,H,P,k,q,Y=e.module,U=e.klass,c=e.hash2,I=e.defs,C=e.def,d=e.eqeqeq,F=e.rb_plus,b=e.rb_times,N=e.truthy,M=[],E=e.nil,Z=e.$$$;return j=M,L=q=[Y(M[0],"BCDice")].concat(j),r=k=[Y(q[0],"DiceTable")].concat(L),p=[n=U(k[0],null,"D66Table")].concat(r),H=e.$r(p),(P=n.$$prototype).sort_type=P.items=P.name=E,I(n,"$from_i18n",function(g,z){var $,y=E;return y=H("I18n").$t(g,c(["locale"],{locale:z})),$=H("D66SortType").$const_get(y["$[]"]("d66_sort_type")),this.$new(y["$[]"]("name"),$,y["$[]"]("items"))}),C(n,"$initialize",function(g,z,h){var y=this;return y.name=g,y.sort_type=z,y.items=h.$freeze()}),C(n,"$roll",function(g){var z=this,h=E,y=E,$=E,o=E;return h=g.$roll_barabara(2,6),d(Z(H("D66SortType"),"ASC"),y=z.sort_type)?h["$sort!"]():d(Z(H("D66SortType"),"DESC"),y)&&h["$sort!"]()["$reverse!"](),$=F(b(h["$[]"](0),10),h["$[]"](1)),o=N(y=z.items["$[]"]($))?y:z.items["$[]"]($.$to_s()),N(o["$respond_to?"]("roll"))&&(o=o.$roll(g)),H("RollResult").$new(z.name,$,o)}),C(n,"$choice",function(g){return H("RollResult").$new(this.name,g,this.items["$[]"](g))})},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(e){var A,l,_,K,u,Y=e.module,U=e.klass,c=e.hash2,I=e.send,C=e.to_ary,d=e.rb_plus,F=e.rb_times,b=e.send2,N=e.find_super,M=e.def,Z=[],W=e.nil;return e.top.$require("bcdice/dice_table/d66_table"),A=Z,l=u=[Y(Z[0],"BCDice")].concat(A),_=[Y(u[0],"DiceTable")].concat(l),K=e.$r(_),M(U(_[0],K("D66Table"),"D66LeftRangeTable"),"$initialize",function H(P,R,g){var y;return H.$$p=null,y=c([],{}),I(g,"each",[],function(o){var f,m;return null==o&&(o=W),f=C(o),m=null==f[1]?W:f[1],I(null==f[0]?W:f[0],"each",[],function(T){return null==T&&(T=W),I(m,"each_with_index",[],function(v,a){var X,te;return null==v&&(v=W),null==a&&(a=W),te=d(F(T,10),d(a,1)),I(y,"[]=",X=[te,v]),X[X.length-1]})})}),b(this,N(this,"initialize",H,!1,!0),"initialize",[P,R,y],null)})},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(e){var W,u,K,r,n,p,H,l,A,Y=e.module,U=e.klass,c=e.hash2,I=e.defs,C=e.def,d=e.truthy,F=e.rb_minus,b=e.rb_plus,N=e.rb_times,M=[],E=e.nil;return W=M,u=A=[Y(M[0],"BCDice")].concat(W),K=l=[Y(A[0],"DiceTable")].concat(u),n=[r=U(l[0],null,"D66ParityTable")].concat(K),p=e.$r(n),(H=r.$$prototype).odd=H.even=H.name=E,I(r,"$from_i18n",function(R,g){var h=E;return h=p("I18n").$t(R,c(["locale","raise"],{locale:g,raise:!0})),this.$new(h["$[]"]("name"),h["$[]"]("odd"),h["$[]"]("even"))}),C(r,"$initialize",function(R,g,z){var h=this;return h.name=R,h.odd=g.$freeze(),h.even=z.$freeze()}),C(r,"$roll",function(R){var h,$,o,g=this,z=E;return z=R.$roll_once(6),h=R.$roll_once(6),$=(d(z["$odd?"]())?g.odd:g.even)["$[]"](F(h,1)),o=b(N(z,10),h),p("RollResult").$new(g.name,o,$)})},Opal.modules["bcdice/dice_table/d66_range_table"]=function(e){var M,j,l,k,_,K,r,q,Z,Y=e.module,U=e.klass,c=e.def,I=e.rb_plus,C=e.rb_times,d=e.send,F=[],b=e.nil;return M=F,j=Z=[Y(F[0],"BCDice")].concat(M),l=q=[Y(Z[0],"DiceTable")].concat(j),_=[k=U(q[0],null,"D66RangeTable")].concat(l),K=e.$r(_),(r=k.$$prototype).items=r.name=b,c(k,"$initialize",function(p,H){return this.name=p,this.items=H.$freeze()}),c(k,"$roll",function(p){var P,R,g,z=b;return P=p.$roll_once(6),R=p.$roll_once(6),g=I(C(P,10),R),z=d(this.items,"find",[],function(y){return null==y&&(y=b),y["$[]"](0)["$include?"](g)}),K("RollResult").$new(this.name,g,z["$[]"](1))})},Opal.modules["bcdice/dice_table/range_table"]=function(e){var W,u,K,r,n,p,H,l,A,Y=e.module,U=e.klass,c=e.const_set,I=e.send,C=e.truthy,d=e.def,F=e.eqeqeq,b=e.rb_times,N=e.rb_plus,M=[],E=e.nil;return W=M,u=A=[Y(M[0],"BCDice")].concat(W),K=l=[Y(A[0],"DiceTable")].concat(u),n=[r=U(l[0],null,"RangeTable")].concat(K),p=e.$r(n),(H=r.$$prototype).name=H.items=H.num_of_dice=H.num_of_sides=H.formatter=E,c(n[0],"RollResult",I(p("Struct"),"new",["sum","values","content","formatted"],function P(){return(null==P.$$s?this:P.$$s).$alias_method("to_s","formatted")},{$$s:r})),c(n[0],"Item",p("Struct").$new("range","content")),c(n[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),c(n[0],"DEFAULT_FORMATTER",I(r,"lambda",[],function(R,g){return null==R&&(R=E),null==g&&(g=E),R.$name()+"("+g.$sum()+") \uff1e "+g.$content()})),r.$attr_reader("name"),r.$attr_reader("num_of_dice"),r.$attr_reader("num_of_sides"),d(r,"$initialize",function P(R,g,z){var $,h=P.$$p||E,y=this,o=E;return P.$$p=null,y.name=R.$freeze(),y.formatter=C($=h)?$:p("DEFAULT_FORMATTER"),o=p("DICE_ROLL_METHOD_RE").$match(g),C(o)||y.$raise(p("ArgumentError"),y.name+": invalid dice roll method: "+g),y.num_of_dice=o["$[]"](1).$to_i(),y.num_of_sides=o["$[]"](2).$to_i(),y.$store(z)}),d(r,"$fetch",function(R){var z,g=this;return z=I(g.items,"find",[],function(y){return null==y&&(y=E),y.$range()["$include?"](R)}),C(z)||g.$raise(p("RangeError"),g.name+": value is out of range: "+R),z}),d(r,"$roll",function(R){var h,g=this,z=E,y=E;return h=(z=R.$roll_barabara(g.num_of_dice,g.num_of_sides)).$sum(),(y=p("RollResult").$new(h,z,g.$fetch(h).$content()))["$formatted="](g.formatter["$[]"](g,y)),y}),r.$private(),d(r,"$store",function(R){var z,h,g=this;return z=I(R,"map",[],function y($,o){return null==$&&($=E),null==o&&(o=E),[(null==y.$$s?this:y.$$s).$coerce_to_int_range($),o]},{$$s:g}),h=I(z,"sort_by",[],function($,o){return null==$&&($=E),null==o&&(o=E),$.$min()}),g.$assert_min_sum_is_covered(h),g.$assert_max_sum_is_covered(h),g.$assert_no_gap_or_overlap_in_ranges(h),g.items=I(h,"map",[],function($,o){return null==$&&($=E),null==o&&(o=E),p("Item").$new($,o.$freeze()).$freeze()}).$freeze(),g}),d(r,"$coerce_to_int_range",function(R){var z;return F(p("Integer"),z=R)?p("Range").$new(R,R):F(p("Range"),z)&&C(R.$begin()["$is_a?"](p("Integer")))&&C(R.$end()["$is_a?"](p("Integer")))?R:this.$raise(p("TypeError"),this.name+": "+R+" ("+R.$class()+") must be an Integer or a Range with Integers ")}),d(r,"$assert_min_sum_is_covered",function(R){var z,g=this,h=E;return z=g.num_of_dice,h=R.$first()["$[]"](0),C(h["$include?"](z))||g.$raise(p("RangeError"),g.name+": min value ("+z+") is not covered: "+h),g}),d(r,"$assert_max_sum_is_covered",function(R){var z,g=this,h=E;return z=b(g.num_of_dice,g.num_of_sides),h=R.$last()["$[]"](0),C(h["$include?"](z))||g.$raise(p("RangeError"),g.name+": max value ("+z+") is not covered: "+h),g}),d(r,"$assert_no_gap_or_overlap_in_ranges",function(R){return I(R,"each_cons",[2],function z(h,y){var S,s,$=null==z.$$s?this:z.$$s,o=E,f=E;return null==$.name&&($.name=E),null==h&&(h=E),null==y&&(y=E),o=h["$[]"](0),f=y["$[]"](0),S=o.$max(),s=N(S,1),C(f["$include?"](S))&&$.$raise(p("RangeError"),$.name+": Range overlap: "+o+" and "+f),C(f["$include?"](s))?E:$.$raise(p("RangeError"),$.name+": Range gap: "+o+" and "+f)},{$$s:this}),this})},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(e){var E,A,k,p,H,P,R,K,u,W,Y=e.module,U=e.klass,c=e.send,I=e.def,C=e.rb_minus,d=e.return_ivar,F=[],b=e.nil,N=e.$$$;return E=F,A=W=[Y(F[0],"BCDice")].concat(E),k=u=[Y(W[0],"DiceTable")].concat(A),p=K=[U(u[0],null,"SaiFicSkillTable")].concat(k),P=[H=U(K[0],null,"Category")].concat(p),R=e.$r(P),I(H,"$initialize",function(z,h,y,$){var o=this;return o.name=z,o.skills=c(h.$map(),"with_index",[2],function(S,s){return null==S&&(S=b),null==s&&(s=b),N(R("SaiFicSkillTable"),"Skill").$new(z,S,y,s,$)}),o.dice=y}),I(H,"$roll",function(z){return this.$skills()["$[]"](C(z.$roll_sum(2,6),2))}),I(H,"$to_s",d("name")),H.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(e){var b,Z,u,K,r,l,j,M,Y=e.module,U=e.klass,c=e.def,I=e.hash2,C=[],d=e.nil;return b=C,Z=M=[Y(C[0],"BCDice")].concat(b),u=j=[Y(M[0],"DiceTable")].concat(Z),l=[U(j[0],null,"SaiFicSkillTable")].concat(u),(r=(K=U(l[0],null,"Skill")).$$prototype).s_format=r.category_dice=r.row_dice=r.category_name=r.name=d,c(K,"$initialize",function(p,H,P,R,g){var z=this;return z.category_name=p,z.name=H,z.category_dice=P,z.row_dice=R,z.s_format=g}),c(K,"$to_s",function(){var p=this;return p.$format(p.s_format,I(["category_dice","row_dice","category_name","skill_name"],{category_dice:p.category_dice,row_dice:p.row_dice,category_name:p.category_name,skill_name:p.name}))}),K.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(e){var l,r,R,g,z,h,y,p,_,Y=e.module,U=e.klass,c=e.ensure_kwargs,I=e.hash2,C=e.send,F=e.defs,b=e.const_set,N=e.to_ary,M=e.def,E=e.truthy,Z=e.rb_minus,W=e.rb_plus,j=e.top,A=[],q=e.nil,u=e.$$$;return j.$require("bcdice/dice_table/sai_fic_skill_table/category"),j.$require("bcdice/dice_table/sai_fic_skill_table/skill"),l=A,r=_=[Y(A[0],"BCDice")].concat(l),R=p=[Y(_[0],"DiceTable")].concat(r),z=[g=U(p[0],null,"SaiFicSkillTable")].concat(R),h=e.$r(z),(y=g.$$prototype).rtt=y.rtt_format=y.rct=y.rct_format=y.rttn=y.rttn_format=y.categories=q,F(g,"$from_i18n",function(o,f,S){var s,m,t,a,v=q;return null==(s=(S=c(S)).$$smap.rtt)&&(s=q),null==(m=S.$$smap.rct)&&(m=q),null==(t=S.$$smap.rttn)&&(t=q),a=(v=h("I18n").$t("RTT",I(["locale","raise","default"],{locale:f,raise:!1,default:I([],{})})).$merge(h("I18n").$t(o,I(["locale","raise"],{locale:f,raise:!0}))))["$[]"]("items"),v=C(v,"select",[],function(te,O){return null==te&&(te=q),null==O&&(O=q),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](te)}),this.$new(a,e.to_hash(v).$merge(I(["rtt","rct","rttn"],{rtt:s,rct:m,rttn:t})))},-3),b(z[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),b(z[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),b(z[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),b(z[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),M(g,"$initialize",function(o,f){var S,s,m,t,T,i,v,a=this;return null==(S=(f=c(f)).$$smap.rtt)&&(S=q),null==(s=f.$$smap.rct)&&(s=q),null==(m=f.$$smap.rttn)&&(m=q),null==(t=f.$$smap.rtt_format)&&(t=h("DEFAULT_RTT")),null==(T=f.$$smap.rct_format)&&(T=h("DEFAULT_RCT")),null==(i=f.$$smap.rttn_format)&&(i=h("DEFAULT_RTTN")),null==(v=f.$$smap.s_format)&&(v=h("DEFAULT_S")),a.categories=C(o.$map(),"with_index",[1],function(te,O){var ue,ce,se;return null==te&&(te=q),null==O&&(O=q),ce=null==(ue=N(te))[0]?q:ue[0],se=null==ue[1]?q:ue[1],u(h("SaiFicSkillTable"),"Category").$new(ce,se,O,v)},{$$has_top_level_mlhs_arg:!0}),a.rtt=S,a.rct=s,a.rttn=m.$to_a(),a.rtt_format=t,a.rct_format=T,a.rttn_format=i},-2),b(z[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),g.$attr_reader("categories"),M(g,"$roll_command",function(o,f){var s,S=this,m=q,t=q;return E(["RTT",S.rtt]["$include?"](s=f))?S.$format_skill(S.rtt_format,S.$roll_skill(o)):E(["RCT",S.rct]["$include?"](s))?(m=S.$roll_category(o),S.$format(S.rct_format,I(["category_dice","category_name"],{category_dice:m.$dice(),category_name:m.$name()}))):E(t=h("RTTN").$index(s))||E(t=S.rttn.$index(s))?S.$format_skill(S.rttn_format,S.categories["$[]"](t).$roll(o)):q}),M(g,"$roll_category",function(o){return this.categories["$[]"](Z(o.$roll_once(6),1))}),M(g,"$roll_skill",function(o){return this.$roll_category(o).$roll(o)}),M(g,"$prefixes",function(){var o=this;return W(["RTT[1-6]?","RCT",o.rtt,o.rct],o.rttn).$compact()}),g.$private(),M(g,"$format_skill",function(o,f){return this.$format(o,I(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:f.$category_dice(),row_dice:f.$row_dice(),category_name:f.$category_name(),skill_name:f.$name(),text:f.$to_s()}))})},Opal.modules["bcdice/dice_table/table"]=function(e){var E,A,k,_,K,r,n,u,W,Y=e.module,U=e.klass,c=e.hash2,I=e.defs,C=e.truthy,d=e.def,F=e.rb_minus,b=[],N=e.nil;return E=b,A=W=[Y(b[0],"BCDice")].concat(E),k=u=[Y(W[0],"DiceTable")].concat(A),K=[_=U(u[0],null,"Table")].concat(k),r=e.$r(K),(n=_.$$prototype).times=n.sides=n.name=n.items=N,I(_,"$from_i18n",function(H,P){var g=N;return g=r("I18n").$t(H,c(["locale"],{locale:P})),this.$new(g["$[]"]("name"),g["$[]"]("type"),g["$[]"]("items"))}),d(_,"$initialize",function(H,P,R){var g=this,z=N;return g.name=H,g.items=R.$freeze(),z=/(\d+)D(\d+)/i.$match(P),C(z)||g.$raise(r("ArgumentError"),"Unexpected table type: "+P),g.times=z["$[]"](1).$to_i(),g.sides=z["$[]"](2).$to_i()}),d(_,"$roll",function(H){var R,P=this;return R=H.$roll_sum(P.times,P.sides),P.$choice(R)}),d(_,"$choice",function(H){var R,P=this;return R=F(H,P.times),r("RollResult").$new(P.name,H,P.items["$[]"](R))})},Opal.modules["bcdice/dice_table"]=function(e){var Y=e.top;return Y.$require("bcdice/dice_table/roll_result"),Y.$require("bcdice/dice_table/chain_table"),Y.$require("bcdice/dice_table/d66_grid_table"),Y.$require("bcdice/dice_table/d66_half_grid_table"),Y.$require("bcdice/dice_table/d66_one_third_table"),Y.$require("bcdice/dice_table/d66_left_range_table"),Y.$require("bcdice/dice_table/d66_parity_table"),Y.$require("bcdice/dice_table/d66_range_table"),Y.$require("bcdice/dice_table/d66_table"),Y.$require("bcdice/dice_table/range_table"),Y.$require("bcdice/dice_table/sai_fic_skill_table"),Y.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(e){var d,M,Z,b,Y=e.module,U=e.const_set,c=[];return d=c,M=b=[Y(c[0],"BCDice")].concat(d),Z=[Y(b[0],"D66SortType")].concat(M),U(Z[0],"NO_SORT","no_sort"),U(Z[0],"ASC","asc"),U(Z[0],"DESC","desc"),function(N,M){var Z=[Y(N,"RoundType")].concat(M);return U(Z[0],"CEIL","ceil"),U(Z[0],"FLOOR","floor"),U(Z[0],"ROUND","round")}(b[0],b)},Opal.modules["bcdice/translate"]=function(e){var M,j,A,q,u,Z,Y=e.module,U=e.ensure_kwargs,c=e.kwrestargs,C=e.hash2,d=e.def,F=[],b=e.nil;return M=F,j=Z=[Y(F[0],"BCDice")].concat(M),q=[A=Y(Z[0],"Translate")].concat(j),u=e.$r(q),d(A,"$translate",function(l,k){var _,K=this;return null==K.locale&&(K.locale=b),k=U(k),_=c(k,{}),u("I18n").$translate(l,C(["locale","raise"],{locale:K.locale,raise:!0}).$merge(e.to_hash(_)))},-2)},Opal.modules["bcdice/result"]=function(e){var A,L,q,M,Z,U=e.klass,c=e.send,I=e.def,C=e.return_val,d=e.return_ivar,F=[],b=e.nil;return M=F,A=Z=[(0,e.module)(F[0],"BCDice")].concat(M),[q=U(Z[0],null,"Result")].concat(A),I(L=e.get_singleton_class(q),"$success",function(_){return c(this.$new(),"tap",[],function(n){var p;return null==n&&(n=b),n["$text="](_),c(n,"success=",p=[!0]),p[p.length-1]})}),I(L,"$failure",function(_){return c(this.$new(),"tap",[],function(n){var p;return null==n&&(n=b),n["$text="](_),c(n,"failure=",p=[!0]),p[p.length-1]})}),I(L,"$critical",function(_){return c(this.$new(),"tap",[],function(n){var p;return null==n&&(n=b),n["$text="](_),n["$critical="](!0),c(n,"success=",p=[!0]),p[p.length-1]})}),I(L,"$fumble",function(_){return c(this.$new(),"tap",[],function(n){var p;return null==n&&(n=b),n["$text="](_),n["$fumble="](!0),c(n,"failure=",p=[!0]),p[p.length-1]})}),I(L,"$nothing",C("nothing")),I(q,"$initialize",function(l){var k=this;return null==l&&(l=b),k.text=l,k.rands=b,k.detailed_rands=b,k.secret=!1,k.success=!1,k.failure=!1,k.critical=!1,k.fumble=!1},-1),q.$attr_accessor("text","rands","detailed_rands"),q.$attr_writer("secret","success","failure","critical","fumble"),I(q,"$secret?",d("secret")),I(q,"$success?",d("success")),I(q,"$failure?",d("failure")),I(q,"$critical?",d("critical")),I(q,"$fumble?",d("fumble")),I(q,"$condition=",function(l){return this.success=l,this.failure=l["$!"]()})},Opal.modules["racc/parser"]=function(e){var H,R,g,Y=e.module,U=e.klass,c=e.truthy,I=e.const_set,C=e.defs,d=e.gvars,F=e.rb_lt,b=e.def,N=e.to_ary,M=e.send,E=e.neqeq,Z=e.rb_plus,W=e.eqeq,j=e.rb_ge,A=e.rb_gt,q=e.rb_minus,u=e.rb_le,L=e.rb_times,l=e.assign_ivar_val,_=[],K=e.$r(_),r=e.nil,n=e.$$$;return H=_,R=[Y(_[0],"Racc")].concat(H),g=e.$r(R),U(R[0],g("StandardError"),"ParseError"),c(n("::","ParseError","skip_raise")?"constant":r)||I(_[0],"ParseError",n(K("Racc"),"ParseError")),function(p,H){var $,o,f,S,s,g=[Y(p,"Racc")].concat(H),z=e.$r(g);return c(z("Racc_No_Extensions","skip_raise")?"constant":r)||I(g[0],"Racc_No_Extensions",!1),$=g,f=[o=U(g[0],null,"Parser")].concat($),S=e.$r(f),(s=o.$$prototype).yydebug=s.racc_debug_out=s.racc_error_status=s.racc_t=s.racc_vstack=s.racc_val=s.racc_state=s.racc_tstack=r,I(f[0],"Racc_Runtime_Version","1.4.6"),I(f[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),I(f[0],"Racc_Runtime_Core_Version_R","1.4.6"),I(f[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),I(f[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),I(f[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),I(f[0],"Racc_Runtime_Core_Version",S("Racc_Runtime_Core_Version_R")),I(f[0],"Racc_Runtime_Core_Revision",S("Racc_Runtime_Core_Revision_R")),I(f[0],"Racc_Runtime_Type","ruby"),C(S("Parser"),"$racc_runtime_type",function(){return S("Racc_Runtime_Type")}),b(o,"$_racc_setup",function(){var t,T,i=this,v=r,a=r;return null==d.stderr&&(d.stderr=r),c(n(i.$class(),"Racc_debug_parser"))||(i.yydebug=!1),c(null!=(t=i.yydebug)&&t!==r?"instance-variable":r)||(i.yydebug=!1),c(i.yydebug)&&(c(null!=(T=i.racc_debug_out)&&T!==r?"instance-variable":r)||(i.racc_debug_out=d.stderr),i.racc_debug_out=c(v=i.racc_debug_out)?v:d.stderr),a=n(i.$class(),"Racc_arg"),c(F(a.$size(),14))&&a["$[]="](13,!0),a}),b(o,"$_racc_init_sysvars",function(){var t=this;return t.racc_state=[0],t.racc_tstack=[],t.racc_vstack=[],t.racc_t=r,t.racc_val=r,t.racc_read_next=!0,t.racc_user_yyerror=!1,t.racc_error_status=0}),b(o,"$do_parse",function(){return this.$__send__(S("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)}),b(o,"$next_token",function(){return this.$raise(S("NotImplementedError"),this.$class()+"#next_token is not defined")}),b(o,"$_racc_do_parse_rb",function(t,T){var i,a=this,X=r,te=r,O=r,ue=r,ce=r,se=r,_e=r,ae=r;return i=N(t),X=null==i[0]?r:i[0],te=null==i[1]?r:i[1],O=null==i[2]?r:i[2],ue=null==i[3]?r:i[3],ce=null==i[10]?r:i[10],a.$_racc_init_sysvars(),se=_e=ae=r,M(a,"catch",["racc_end_parse"],function ee(){var B,V,x=null==ee.$$s?this:ee.$$s,D=r;for(null==x.racc_state&&(x.racc_state=r),null==x.racc_read_next&&(x.racc_read_next=r),null==x.racc_t&&(x.racc_t=r),null==x.yydebug&&(x.yydebug=r),null==x.racc_val&&(x.racc_val=r);c(!0);)for(c(ae=ue["$[]"](x.racc_state["$[]"](-1)))?(c(x.racc_read_next)&&E(x.racc_t,0)&&(V=x.$next_token(),B=N(V),se=null==B[0]?r:B[0],x.racc_val=null==B[1]?r:B[1],x.racc_t=c(se)?c(D=ce["$[]"](se))?D:1:0,c(x.yydebug)&&x.$racc_read_token(x.racc_t,se,x.racc_val),x.racc_read_next=!1),ae=Z(ae,x.racc_t),c(j(ae,0))&&c(_e=X["$[]"](ae))&&W(te["$[]"](ae),x.racc_state["$[]"](-1))||(_e=O["$[]"](x.racc_state["$[]"](-1)))):_e=O["$[]"](x.racc_state["$[]"](-1));c(_e=x.$_racc_evalact(_e,t)););},{$$s:a})}),b(o,"$yyparse",function(t,T){return this.$__send__(S("Racc_YY_Parse_Method"),t,T,this.$_racc_setup(),!0)}),b(o,"$_racc_yyparse_rb",function(t,T,i,v){var a,O=r,ue=r,$e=r,ce=r,_e=r,ae=r,ee=r;return a=N(i),O=null==a[0]?r:a[0],ue=null==a[1]?r:a[1],$e=null==a[2]?r:a[2],ce=null==a[3]?r:a[3],_e=null==a[10]?r:a[10],this.$_racc_init_sysvars(),ae=r,ee=r,M(this,"catch",["racc_end_parse"],function B(){var V=null==B.$$s?this:B.$$s;for(null==V.racc_state&&(V.racc_state=r);!c(ee=ce["$[]"](V.racc_state["$[]"](-1)));)for(;c(ae=V.$_racc_evalact($e["$[]"](V.racc_state["$[]"](-1)),i)););return M(t,"__send__",[T],function x(D,re){var w=null==x.$$s?this:x.$$s,G=r,J=r;for(null==w.racc_t&&(w.racc_t=r),null==w.racc_state&&(w.racc_state=r),null==w.racc_read_next&&(w.racc_read_next=r),null==D&&(D=r),null==re&&(re=r),w.racc_t=c(D)?c(G=_e["$[]"](D))?G:1:0,w.racc_val=re,w.racc_read_next=!1,ee=Z(ee,w.racc_t),c(j(ee,0))&&c(ae=O["$[]"](ee))&&W(ue["$[]"](ee),w.racc_state["$[]"](-1))||(ae=$e["$[]"](w.racc_state["$[]"](-1)));c(ae=w.$_racc_evalact(ae,i)););for(;c(c(G=c(J=(ee=ce["$[]"](w.racc_state["$[]"](-1)))["$!"]())?J:w.racc_read_next["$!"]())?G:w.racc_t["$=="](0));)for(c(ee)&&c(ee=Z(ee,w.racc_t))&&c(j(ee,0))&&c(ae=O["$[]"](ee))&&W(ue["$[]"](ee),w.racc_state["$[]"](-1))||(ae=$e["$[]"](w.racc_state["$[]"](-1)));c(ae=w.$_racc_evalact(ae,i)););},{$$s:V})},{$$s:this})}),b(o,"$_racc_evalact",function(t,T){var i,$e,a=this,X=r,te=r,ue=r,ce=r,se=r,_e=r;if(X=null==(i=N(T))[0]?r:i[0],te=null==i[1]?r:i[1],ue=null==i[3]?r:i[3],$e=null==i[11]?r:i[11],ce=null==i[12]?r:i[12],c(A(t,0))&&c(F(t,$e)))c(A(a.racc_error_status,0))&&(W(a.racc_t,1)||(a.racc_error_status=q(a.racc_error_status,1))),a.racc_vstack.$push(a.racc_val),a.racc_state.$push(t),a.racc_read_next=!0,c(a.yydebug)&&(a.racc_tstack.$push(a.racc_t),a.$racc_shift(a.racc_t,a.racc_tstack,a.racc_vstack));else if(c(F(t,0))&&c(A(t,ce["$-@"]()))){if(se=M(a,"catch",["racc_jump"],function ae(){var ee=null==ae.$$s?this:ae.$$s;return null==ee.racc_state&&(ee.racc_state=r),ee.racc_state.$push(ee.$_racc_do_reduce(T,t)),!1},{$$s:a}),c(se))switch(se){case 1:return a.racc_user_yyerror=!0,ce["$-@"]();case 2:return $e;default:a.$raise("[Racc Bug] unknown jump code")}}else if(W(t,$e))c(a.yydebug)&&a.$racc_accept(),a.$throw("racc_end_parse",a.racc_vstack["$[]"](0));else{if(W(t,ce["$-@"]())){switch(a.racc_error_status){case 0:c(T["$[]"](21))||a.$on_error(a.racc_t,a.racc_val,a.racc_vstack);break;case 3:W(a.racc_t,0)&&a.$throw("racc_end_parse",r),a.racc_read_next=!0}for(a.racc_user_yyerror=!1,a.racc_error_status=3;c(!0)&&!(c(_e=ue["$[]"](a.racc_state["$[]"](-1)))&&(_e=Z(_e,1),c(j(_e,0))&&c(t=X["$[]"](_e))&&W(te["$[]"](_e),a.racc_state["$[]"](-1))));)c(u(a.racc_state.$size(),1))&&a.$throw("racc_end_parse",r),a.racc_state.$pop(),a.racc_vstack.$pop(),c(a.yydebug)&&(a.racc_tstack.$pop(),a.$racc_e_pop(a.racc_state,a.racc_tstack,a.racc_vstack));return t}a.$raise("[Racc Bug] unknown action "+t.$inspect())}return c(a.yydebug)&&a.$racc_next_state(a.racc_state["$[]"](-1),a.racc_state),r}),b(o,"$_racc_do_reduce",function(t,T){var i,ce,_e,D,re,w,Q,a=this,te=r,O=r,ue=r,$e=r,se=r,ae=r,ee=r,B=r,V=r,x=r,G=r,J=r,ne=r;return te=null==(i=N(t))[4]?r:i[4],O=null==i[5]?r:i[5],ue=null==i[6]?r:i[6],$e=null==i[7]?r:i[7],ce=null==i[8]?r:i[8],se=null==i[9]?r:i[9],_e=null==i[13]?r:i[13],ae=a.racc_state,ee=a.racc_vstack,B=a.racc_tstack,V=L(T,-3),x=se["$[]"](V),D=se["$[]"](Z(V,1)),re=se["$[]"](Z(V,2)),w=[],c(a.yydebug)&&(G=B["$[]"](x["$-@"](),x)),J=ee["$[]"](x["$-@"](),x),c(a.yydebug)&&B["$[]="](x["$-@"](),x,w),ee["$[]="](x["$-@"](),x,w),ae["$[]="](x["$-@"](),x,w),c(_e)?ee.$push(a.$__send__(re,J,ee,J["$[]"](0))):ee.$push(a.$__send__(re,J,ee)),B.$push(D),c(a.yydebug)&&a.$racc_reduce(G,D,B,ee),Q=q(D,ce),c(V=$e["$[]"](Q))&&(V=Z(V,ae["$[]"](-1)),c(j(V,0))&&c(ne=te["$[]"](V))&&W(O["$[]"](V),Q))?ne:ue["$[]"](Q)}),b(o,"$on_error",function(t,T,i){var a,v=this;return v.$raise(S("ParseError"),v.$sprintf("\nparse error on value %s (%s)",T.$inspect(),c(a=v.$token_to_str(t))?a:"?"))}),b(o,"$yyerror",function(){return this.$throw("racc_jump",1)}),b(o,"$yyaccept",function(){return this.$throw("racc_jump",2)}),b(o,"$yyerrok",l("racc_error_status",0)),b(o,"$racc_read_token",function(t,T,i){var v=this;return v.racc_debug_out.$print("read    "),v.racc_debug_out.$print(T.$inspect(),"(",v.$racc_token2str(t),") "),v.racc_debug_out.$puts(i.$inspect()),v.racc_debug_out.$puts()}),b(o,"$racc_shift",function(t,T,i){var v=this;return v.racc_debug_out.$puts("shift   "+v.$racc_token2str(t)),v.$racc_print_stacks(T,i),v.racc_debug_out.$puts()}),b(o,"$racc_reduce",function(t,T,i,v){var a=this,X=r;return(X=a.racc_debug_out).$print("reduce "),c(t["$empty?"]())?X.$print(" <none>"):M(t,"each",[],function te(O){return null==O&&(O=r),X.$print(" ",(null==te.$$s?this:te.$$s).$racc_token2str(O))},{$$s:a}),X.$puts(" --\x3e "+a.$racc_token2str(T)),a.$racc_print_stacks(i,v),a.racc_debug_out.$puts()}),b(o,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()}),b(o,"$racc_e_pop",function(t,T,i){var v=this;return v.racc_debug_out.$puts("error recovering mode: pop token"),v.$racc_print_states(t),v.$racc_print_stacks(T,i),v.racc_debug_out.$puts()}),b(o,"$racc_next_state",function(t,T){var i=this;return i.racc_debug_out.$puts("goto    "+t),i.$racc_print_states(T),i.racc_debug_out.$puts()}),b(o,"$racc_print_stacks",function(t,T){var v=r;return(v=this.racc_debug_out).$print("        ["),M(t,"each_index",[],function a(X){return null==X&&(X=r),v.$print(" (",(null==a.$$s?this:a.$$s).$racc_token2str(t["$[]"](X))," ",T["$[]"](X).$inspect(),")")},{$$s:this}),v.$puts(" ]")}),b(o,"$racc_print_states",function(t){var i=r;return(i=this.racc_debug_out).$print("        ["),M(t,"each",[],function(a){return null==a&&(a=r),i.$print(" ",a)}),i.$puts(" ]")}),b(o,"$racc_token2str",function(t){var i;return c(i=n(this.$class(),"Racc_token_to_s_table")["$[]"](t))?i:this.$raise("[Racc Bug] can't convert token "+t+" to string")}),b(o,"$token_to_str",function(t){return n(this.$class(),"Racc_token_to_s_table")["$[]"](t)})}(_[0],_)},Opal.modules["bcdice/arithmetic/node"]=function(e){var l,r,P,$,o,g,z,p,_,Y=e.module,U=e.klass,c=e.def,I=e.thrower,C=e.return_ivar,d=e.send2,F=e.find_super,b=e.eqeq,N=e.const_set,M=e.eqeqeq,E=e.rb_divide,Z=e.truthy,W=e.assign_ivar,j=e.alias,A=[],q=e.nil,u=e.$$$;return l=A,r=_=[Y(A[0],"BCDice")].concat(l),P=p=[Y(_[0],"Arithmetic")].concat(r),g=[Y(p[0],"Node")].concat(P),z=e.$r(g),(o=($=U(g[0],null,"BinaryOp")).$$prototype).lhs=o.rhs=o.op=q,c($,"$initialize",function(S,s,m){var t=this;return t.lhs=S,t.op=s,t.rhs=m}),c($,"$eval",function(S){try{I("eval_return");var T,m=this,t=q;return t=m.lhs.$eval(S),T=m.rhs.$eval(S),t.$send(m.op,T)}catch(i){if(i===e.t_eval_return)return i.$v;throw i}}),c($,"$output",function(){var S=this;return""+S.lhs.$output()+S.op+S.rhs.$output()}),c($,"$s_exp",function(){var S=this;return"("+S.$op_for_s_exp()+" "+S.lhs.$s_exp()+" "+S.rhs.$s_exp()+")"}),c($,"$op_for_s_exp",C("op")),function(h,y,$){var o=U(h,y,"DivideBase"),f=[o].concat($),S=e.$r(f),s=o.$$prototype;s.lhs=s.rhs=s.op=q,c(o,"$initialize",function m(t,T){return m.$$p=null,d(this,F(this,"initialize",m,!1,!0),"initialize",[t,"/",T],null)}),c(o,"$eval",function(t){try{I("eval_return");var v,a,i=this;return v=i.lhs.$eval(t),a=i.rhs.$eval(t),b(a,0)&&i.$raise(S("ZeroDivisionError")),i.$divide_and_round(v,a,t)}catch(X){if(X===e.t_eval_return)return X.$v;throw X}}),c(o,"$output",function m(){var t=m.$$p||q,T=this;return m.$$p=null,""+d(T,F(T,"output",m,!1,!0),"output",[],t)+T.$rounding_method()}),o.$private(),c(o,"$rounding_method",function(){return u(this.$class(),"ROUNDING_METHOD")}),c(o,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()}),c(o,"$divide_and_round",function(t,T,i){return this.$raise(S("NotImplementedError"))})}(g[0],z("BinaryOp"),g),function(h,y,$){var o=U(h,y,"DivideWithGameSystemDefault"),f=[o].concat($),S=e.$r(f);N(f[0],"ROUNDING_METHOD",""),o.$private(),c(o,"$divide_and_round",function(m,t,T){var i,v=q;return M(u(S("RoundType"),"CEIL"),i=T)?E(m.$to_f(),t).$ceil():M(u(S("RoundType"),"ROUND"),i)?(v=E(m.$to_f(),t),Z(v["$negative?"]())?v.$abs().$round()["$-@"]():v.$round()):E(m,t).$floor()})}(g[0],z("DivideBase"),g),function(h,y,$){var o=U(h,y,"DivideWithCeil"),f=[o].concat($);N(f[0],"ROUNDING_METHOD","C"),o.$private(),c(o,"$divide_and_round",function(s,m,t){return E(s.$to_f(),m).$ceil()})}(g[0],z("DivideBase"),g),function(h,y,$){var o=U(h,y,"DivideWithRound"),f=[o].concat($);N(f[0],"ROUNDING_METHOD","R"),o.$private(),c(o,"$divide_and_round",function(s,m,t){var T=q;return T=E(s.$to_f(),m),Z(T["$negative?"]())?T.$abs().$round()["$-@"]():T.$round()})}(g[0],z("DivideBase"),g),function(h,y,$){var o=U(h,y,"DivideWithFloor"),f=[o].concat($);N(f[0],"ROUNDING_METHOD","F"),o.$private(),c(o,"$divide_and_round",function(s,m,t){return E(s,m).$floor()})}(g[0],z("DivideBase"),g),function(h,y){var $=U(h,null,"Negative");$.$$prototype.body=q,c($,"$initialize",W("body")),c($,"$eval",function(S){try{return I("eval_return"),this.body.$eval(S)["$-@"]()}catch(t){if(t===e.t_eval_return)return t.$v;throw t}}),c($,"$output",function(){return"-"+this.body.$output()}),c($,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"})}(g[0]),function(h,y){var $=U(h,null,"Parenthesis");$.$$prototype.expr=q,c($,"$initialize",W("expr")),c($,"$eval",function(S){try{return I("eval_return"),this.expr.$eval(S)}catch(t){if(t===e.t_eval_return)return t.$v;throw t}}),c($,"$output",function(){return"("+this.expr.$output()+")"}),c($,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"})}(g[0]),function(h,y){var $=U(h,null,"Number");return $.$$prototype.value=q,c($,"$initialize",W("value")),c($,"$eval",C("value")),c($,"$output",function(){return this.value.$to_s()}),j($,"s_exp","output")}(g[0])},Opal.modules.strscan=function(e){var W,j,A,q,u,U=e.def,c=e.truthy,I=e.eqeqeq,C=e.Opal,d=e.return_ivar,F=e.send,b=e.alias,N=[],M=e.nil;return W=N,A=[j=(0,e.klass)(N[0],null,"StringScanner")].concat(W),q=e.$r(A),(u=j.$$prototype).pos=u.string=u.working=u.matched=u.prev_pos=u.match=M,j.$attr_reader("pos","matched"),U(j,"$initialize",function(l){var k=this;return k.string=l,k.pos=0,k.matched=M,k.working=l,k.match=[]}),j.$attr_reader("string"),U(j,"$beginning_of_line?",function(){var l=this;return 0===l.pos||"\n"===l.string.charAt(l.pos-1)}),U(j,"$scan",function(l){var k=this,_=(l=k.$anchor(l)).exec(k.working);return null==_?k.matched=M:(k.prev_pos=k.pos,k.pos+=_[0].length,k.working=k.working.substring(_[0].length),k.matched=_[0],k.match=_,_[0])}),U(j,"$scan_until",function(l){var k=this;l=k.$anchor(l);for(var _=k.working,K=0;_.length!=K;++K){var r=l.exec(_.substr(K));if(null!==r){var n=K+r[0].length,p=_.substr(0,n);return k.matched=r[0],k.match=r,k.prev_pos=k.pos+K,k.pos+=n,k.working=_.substr(n),p}}return k.matched=M}),U(j,"$[]",function(l){var _;if(c(this.match["$empty?"]()))return M;I(q("Symbol"),_=l)?l=l.$to_s():I(q("String"),_)||(l=C["$coerce_to!"](l,q("Integer"),"to_int"));var K=this.match;return l<0&&(l+=K.length),l<0||l>=K.length||null==K[l]?M:K[l]}),U(j,"$check",function(l){var k=this,_=(l=k.$anchor(l)).exec(k.working);return k.matched=null==_?M:_[0]}),U(j,"$check_until",function(l){var k=this,_=k.prev_pos,K=k.pos,r=k.working,n=k.$scan_until(l);return k.prev_pos=_,k.pos=K,k.working=r,n}),U(j,"$peek",function(l){return this.working.substring(0,l)}),U(j,"$eos?",function(){return 0===this.working.length}),U(j,"$exist?",function(l){var _=l.exec(this.working);return null==_?M:0==_.index?0:_.index+1}),U(j,"$skip",function(l){var k=this,_=(l=k.$anchor(l)).exec(k.working);if(null==_)return k.match=[],k.matched=M;var K=_[0],r=K.length;return k.matched=K,k.match=_,k.prev_pos=k.pos,k.pos+=r,k.working=k.working.substring(r),r}),U(j,"$skip_until",function(l){var _=this.$scan_until(l);return _===M?M:(this.matched=_.substr(-1),_.length)}),U(j,"$get_byte",function(){var l=this,k=M;return l.pos<l.string.length?(l.prev_pos=l.pos,l.pos+=1,k=l.matched=l.working.substring(0,1),l.working=l.working.substring(1)):l.matched=M,k}),U(j,"$match?",function(l){var k=this,_=(l=k.$anchor(l)).exec(k.working);return null==_?M:(k.prev_pos=k.pos,_[0].length)}),U(j,"$pos=",function(l){var k=this;return l<0&&(l+=k.string.$length()),k.pos=l,k.working=k.string.slice(l)}),U(j,"$matched_size",function(){return this.matched===M?M:this.matched.length}),U(j,"$post_match",function(){var l=this;return l.matched===M?M:l.string.substr(l.pos)}),U(j,"$pre_match",function(){var l=this;return l.matched===M?M:l.string.substr(0,l.prev_pos)}),U(j,"$reset",function(){var l=this;return l.working=l.string,l.matched=M,l.pos=0}),U(j,"$rest",d("working")),U(j,"$rest?",function(){return 0!==this.working.length}),U(j,"$rest_size",function(){return this.$rest().$size()}),U(j,"$terminate",function(){var l,k=this;return k.match=M,l=[k.string.$length()],F(k,"pos=",l),l[l.length-1]}),U(j,"$unscan",function(){var l=this;return l.pos=l.prev_pos,l.prev_pos=M,l.match=M,l}),b(j,"bol?","beginning_of_line?"),b(j,"getch","get_byte"),j.$private(),U(j,"$anchor",function(l){var k=l.toString().match(/\/([^\/]+)$/);return k=k?k[1]:void 0,new RegExp("^(?:"+l.source+")",k)})},Opal.modules["bcdice/normalize"]=function(e){var b,Z,M,Y=e.module,U=e.eqeqeq,c=e.def,I=e.eqeq,C=[],d=e.nil;return b=C,M=[Y(C[0],"BCDice")].concat(b),(Z=Y(M[0],"Normalize")).$module_function(),c(Z,"$comparison_operator",function(j){var A;return U(/<=|=</,A=j)?"<=":U(/>=|=>/,A)?">=":U(/<>|!=|=!/,A)?"!=":U(/</,A)?"<":U(/>/,A)?">":U(/=/,A)?"==":d}),c(Z,"$target_number",function(j){return I(j,"?")?j:j.$to_i()})},Opal.modules["bcdice/command/lexer"]=function(e){var W,u,K,r,n,p,H,l,A,Y=e.module,U=e.klass,c=e.const_set,I=e.hash2,C=e.truthy,d=e.send,F=e.def,b=e.thrower,N=e.top,M=[],E=e.nil;return N.$require("strscan"),N.$require("bcdice/normalize"),W=M,u=A=[Y(M[0],"BCDice")].concat(W),K=l=[Y(A[0],"Command")].concat(u),n=[r=U(l[0],null,"Lexer")].concat(K),p=e.$r(n),(H=r.$$prototype).scanner=H.notations=E,c(n[0],"SYMBOLS",I(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),F(r,"$initialize",function(R,g){var z,h,$;return R=C($=(z=(h=R)===E||null==h?E:h.$split(" ",2))===E||null==z?E:z.$first())?$:"",this.scanner=p("StringScanner").$new(R),this.notations=d(g,"map",[],function(f){return null==f&&(f=E),C(f["$is_a?"](p("String")))?p("Regexp").$new(f):f})}),F(r,"$next_token",function(){try{var R=b("return"),g=this,z=E,h=E,$=E,o=E;return C(g.scanner["$eos?"]())?[!1,"$"]:(d(g.notations,"each",[],function f(S){var m,s=null==f.$$s?this:f.$$s;if(null==s.scanner&&(s.scanner=E),null==S&&(S=E),m=s.scanner.$scan(S),!C(m))return E;R.$throw(["NOTATION",m])},{$$s:g,$$ret:R}),C(z=g.scanner.$scan(/\d+/))?["NUMBER",z.$to_i()]:C(h=g.scanner.$scan(/[<>!=]+/))?(h=p("Normalize").$comparison_operator(h),[C(h)?"CMP_OP":"ILLEGAL",h]):($=g.scanner.$getch().$upcase(),[C(o=p("SYMBOLS")["$[]"]($))?o:$.$to_sym(),$]))}catch(f){if(f===R)return f.$v;throw f}}),F(r,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/command/parsed"]=function(e){var N,W,L,l,k,_,K,A,E,Y=e.module,U=e.klass,c=e.def,I=e.return_ivar,C=e.truthy,d=[],F=e.nil;return N=d,W=E=[Y(d[0],"BCDice")].concat(N),L=A=[Y(E[0],"Command")].concat(W),k=[l=U(A[0],null,"Parsed")].concat(L),_=e.$r(k),(K=l.$$prototype).critical=K.fumble=K.dollar=K.modify_number=K.question_target=K.target_number=K.prefix_number=K.command=K.suffix_number=K.cmp_op=F,l.$attr_accessor("command"),l.$attr_accessor("prefix_number"),l.$attr_accessor("suffix_number"),l.$attr_accessor("critical"),l.$attr_accessor("fumble"),l.$attr_accessor("dollar"),l.$attr_accessor("modify_number"),l.$attr_accessor("cmp_op"),l.$attr_accessor("target_number"),l.$attr_writer("question_target"),c(l,"$initialize",function(){var n=this;return n.prefix_number=F,n.suffix_number=F,n.critical=F,n.fumble=F,n.dollar=F,n.cmp_op=F,n.target_number=F,n.question_target=!1}),c(l,"$question_target?",I("question_target")),c(l,"$to_s",function(n){var p=this,H=F,P=F,R=F,g=F,z=F;switch(null==n&&(n="after_command"),H=C(p.critical)?"@"+p.critical:F,P=C(p.fumble)?"#"+p.fumble:F,R=C(p.dollar)?"$"+p.dollar:F,g=_("Format").$modifier(p.modify_number),z=C(p.question_target)?"?":p.target_number,n){case"after_command":return[p.prefix_number,p.command,p.suffix_number,H,P,R,g,p.cmp_op,z].$join();case"after_modify_number":return[p.prefix_number,p.command,p.suffix_number,g,H,P,R,p.cmp_op,z].$join();case"after_target_number":return[p.prefix_number,p.command,p.suffix_number,g,p.cmp_op,z,H,P,R].$join();default:return F}},-1)},Opal.modules["bcdice/command/parser"]=function(e){var n,R,o,m,t,T,i,v,a,X,te,O,ce,f,S,s,ae,z,h,H,Y=e.klass,U=e.module,c=e.slice,I=e.extract_kwargs,C=e.ensure_kwargs,d=e.get_kwarg,F=e.send2,b=e.find_super,N=e.def,M=e.send,E=e.eqeq,Z=e.thrower,W=e.hash,j=e.const_set,A=e.truthy,q=e.to_ary,u=e.hash2,L=e.top,l=[],k=e.$r(l),_=e.nil,K=e.$$$;return L.$require("racc/parser.rb"),L.$require("bcdice/arithmetic/node"),L.$require("bcdice/command/lexer"),L.$require("bcdice/command/parsed"),Y(K(k("BCDice"),"Command"),K(k("Racc"),"Parser"),"Parser"),n=l,R=H=[U(l[0],"BCDice")].concat(n),z=[U(H[0],"Command")].concat(R),h=e.$r(z),o=z,S=[f=Y(z[0],K(h("Racc"),"Parser"),"Parser")].concat(o),s=e.$r(S),(ae=f.$$prototype).notations=ae.lexer=ae.modifier=ae.suffix_number=ae.prefix_number=ae.need_suffix_number=ae.need_prefix_number=ae.critical=ae.fumble=ae.dollar=ae.allowed_cmp_op=ae.question_target=_,N(f,"$initialize",function ee(B,V){var x,D,re,w,J=this;return ee.$$p=null,x=c(arguments),D=I(x),D=C(D),re=x,w=d(D,"round_type"),F(J,b(J,"initialize",ee,!1,!0),"initialize",[],null),J.notations=re,J.round_type=w,J.prefix_number=!1,J.suffix_number=!1,J.need_prefix_number=!1,J.need_suffix_number=!1,J.modifier=!0,J.critical=!1,J.fumble=!1,J.dollar=!1,J.allowed_cmp_op=[_,">=",">","<=","<","==","!="],J.question_target=!1},-2),N(f,"$disable_modifier",function(){return this.modifier=!1,this}),N(f,"$enable_prefix_number",function(){return this.prefix_number=!0,this}),N(f,"$enable_suffix_number",function(){return this.suffix_number=!0,this}),N(f,"$has_prefix_number",function(){var B=this;return B.prefix_number=!0,B.need_prefix_number=!0,B}),N(f,"$has_suffix_number",function(){var B=this;return B.suffix_number=!0,B.need_suffix_number=!0,B}),N(f,"$enable_critical",function(){return this.critical=!0,this}),N(f,"$enable_fumble",function(){return this.fumble=!0,this}),N(f,"$enable_dollar",function(){return this.dollar=!0,this}),N(f,"$restrict_cmp_op_to",function(B){var V,D=this;return V=c(arguments),D.allowed_cmp_op=V,D},-1),N(f,"$enable_question_target",function(){return this.question_target=!0,this}),N(f,"$parse",function(B){var V=this;try{return V.lexer=s("Lexer").$new(B,V.notations),V.$do_parse()}catch(x){if(!e.rescue(x,[s("ParseError"),s("ZeroDivisionError")]))throw x;try{return _}finally{e.pop_exception()}}}),f.$private(),N(f,"$parsed",function(B,V,x,D){try{return Z("eval_return"),M(s("Parsed").$new(),"tap",[],function G(J){var Q,ne,ie,le,fe,oe,de,me=null==G.$$s?this:G.$$s;return null==me.round_type&&(me.round_type=_),null==J&&(J=_),J["$command="](B["$[]"]("command")),J["$prefix_number="]((Q=B["$[]"]("prefix"))===_||null==Q?_:Q.$eval(me.round_type)),J["$suffix_number="]((ne=B["$[]"]("suffix"))===_||null==ne?_:ne.$eval(me.round_type)),J["$critical="]((ie=V["$[]"]("critical"))===_||null==ie?_:ie.$eval(me.round_type)),J["$fumble="]((le=V["$[]"]("fumble"))===_||null==le?_:le.$eval(me.round_type)),J["$dollar="]((fe=V["$[]"]("dollar"))===_||null==fe?_:fe.$eval(me.round_type)),J["$modify_number="](x.$eval(me.round_type)),J["$cmp_op="](D["$[]"]("cmp_op")),E(D["$[]"]("target"),"?")?(J["$question_target="](!0),M(J,"target_number=",oe=[0]),oe[oe.length-1]):(J["$question_target="](!1),oe=[(de=D["$[]"]("target"),de===_||null==de?_:de.$eval(me.round_type))],M(J,"target_number=",oe),oe[oe.length-1])},{$$s:this})}catch(G){if(G===e.t_eval_return)return G.$v;throw G}}),N(f,"$next_token",function(){return this.lexer.$next_token()}),m=e.large_array_unpack("6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,33,34,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,,,17,18,6,,5,,,17,18,,,5,23,24,25,26,56,54,55,57"),t=e.large_array_unpack("0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,,17,15,15,18,18,23,,18,30,30,23,23,24,,23,31,31,24,24,25,,24,44,44,25,25,28,,25,47,47,28,28,29,,28,48,48,29,29,33,,29,49,49,33,33,34,,33,50,50,34,34,36,,34,,,36,36,37,,36,,,37,37,,,37,27,27,27,27,52,52,52,52"),T=e.large_array_unpack("-2,4,16,-3,-1,11,,33,13,35,23,30,1,,28,40,,37,44,,,-2,,51,58,65,0,106,72,79,47,54,,86,93,,100,107,,,,,,,63,,,68,75,82,89,,120,,,,,"),i=e.large_array_unpack("-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29"),v=e.large_array_unpack("30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,,,21,47,48,40,51,52,49,50,44,46,3,,,,13,,,,,,,,32"),a=e.large_array_unpack("8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,,,4,8,8,5,7,7,8,8,9,5,6,,,,6,,,,,,,,6"),X=[_,6,13,3,9,-1,27,-15,-10,-1,-38],te=[_,_,_,_,_,_,19,16,15,_,_],O=e.large_array_unpack("0,0,racc_error,4,20,_reduce_1,4,20,_reduce_2,3,20,_reduce_3,3,21,_reduce_4,2,21,_reduce_5,2,21,_reduce_6,1,21,_reduce_7,0,22,_reduce_8,3,22,_reduce_9,3,22,_reduce_10,3,22,_reduce_11,2,23,_reduce_12,2,23,_reduce_13,3,23,_reduce_14,3,23,_reduce_15,0,24,_reduce_16,2,24,_reduce_17,2,24,_reduce_18,3,28,_reduce_19,3,28,_reduce_20,1,28,_reduce_none,3,27,_reduce_22,4,27,_reduce_23,1,27,_reduce_none,0,29,_reduce_25,1,29,_reduce_26,1,29,_reduce_27,1,29,_reduce_28,1,29,_reduce_29,2,26,_reduce_30,2,26,_reduce_31,1,26,_reduce_none,3,25,_reduce_33,1,25,_reduce_34"),ce=W(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),j(S[0],"Racc_arg",[m,t,i,T,v,a,te,X,19,O,ce,58,35,!0]),j(S[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),j(S[0],"Racc_debug_parser",!1),N(f,"$_reduce_1",function(B,V,x){var D,w=this;return A(w.modifier)||w.$raise(s("ParseError")),D=q(B),w.$parsed(null==D[0]?_:D[0],null==D[1]?_:D[1],null==D[2]?_:D[2],null==D[3]?_:D[3])}),N(f,"$_reduce_2",function(B,V,x){var D,w=this;return A(w.modifier)||w.$raise(s("ParseError")),D=q(B),w.$parsed(null==D[0]?_:D[0],null==D[2]?_:D[2],null==D[1]?_:D[1],null==D[3]?_:D[3])}),N(f,"$_reduce_3",function(B,V,x){var D,Q;return Q=null==(D=q(B))[2]?_:D[2],this.$parsed(null==D[0]?_:D[0],null==D[1]?_:D[1],K(K(s("Arithmetic"),"Node"),"Number").$new(0),Q)}),N(f,"$_reduce_4",function(B,V,x){var D=this;return A(D.prefix_number)&&A(D.suffix_number)||D.$raise(s("ParseError")),u(["command","prefix","suffix"],{command:B["$[]"](1),prefix:B["$[]"](0),suffix:B["$[]"](2)})}),N(f,"$_reduce_5",function(B,V,x){var D=this;return A(D.prefix_number)||D.$raise(s("ParseError")),A(D.need_suffix_number)&&D.$raise(s("ParseError")),u(["command","prefix"],{command:B["$[]"](1),prefix:B["$[]"](0)})}),N(f,"$_reduce_6",function(B,V,x){var D=this;return A(D.suffix_number)||D.$raise(s("ParseError")),A(D.need_prefix_number)&&D.$raise(s("ParseError")),u(["command","suffix"],{command:B["$[]"](0),suffix:B["$[]"](1)})}),N(f,"$_reduce_7",function(B,V,x){var D=this;return(A(D.need_prefix_number)||A(D.need_suffix_number))&&D.$raise(s("ParseError")),u(["command"],{command:B["$[]"](0)})}),N(f,"$_reduce_8",function(B,V,x){return u([],{})}),N(f,"$_reduce_9",function(B,V,x){var D,Q,G=_;return G=null==(D=q(B))[0]?_:D[0],Q=null==D[2]?_:D[2],A(this.critical)&&A(G["$[]"]("critical")["$nil?"]())||this.$raise(s("ParseError")),G["$[]="]("critical",Q),G}),N(f,"$_reduce_10",function(B,V,x){var D,Q,G=_;return G=null==(D=q(B))[0]?_:D[0],Q=null==D[2]?_:D[2],A(this.fumble)&&A(G["$[]"]("fumble")["$nil?"]())||this.$raise(s("ParseError")),G["$[]="]("fumble",Q),G}),N(f,"$_reduce_11",function(B,V,x){var D,Q,G=_;return G=null==(D=q(B))[0]?_:D[0],Q=null==D[2]?_:D[2],A(this.dollar)&&A(G["$[]"]("dollar")["$nil?"]())||this.$raise(s("ParseError")),G["$[]="]("dollar",Q),G}),N(f,"$_reduce_12",function(B,V,x){return B["$[]"](1)}),N(f,"$_reduce_13",function(B,V,x){return K(K(s("Arithmetic"),"Node"),"Negative").$new(B["$[]"](1))}),N(f,"$_reduce_14",function(B,V,x){return K(K(s("Arithmetic"),"Node"),"BinaryOp").$new(B["$[]"](0),"+",B["$[]"](2))}),N(f,"$_reduce_15",function(B,V,x){return K(K(s("Arithmetic"),"Node"),"BinaryOp").$new(B["$[]"](0),"-",B["$[]"](2))}),N(f,"$_reduce_16",function(B,V,x){return A(this.allowed_cmp_op["$include?"](_))||this.$raise(s("ParseError")),u([],{})}),N(f,"$_reduce_17",function(B,V,x){var D,G,J;return J=null==(D=q(B))[1]?_:D[1],A(this.allowed_cmp_op["$include?"](G=null==D[0]?_:D[0]))||this.$raise(s("ParseError")),u(["cmp_op","target"],{cmp_op:G,target:J})}),N(f,"$_reduce_18",function(B,V,x){var re,D=this;return re=B["$[]"](0),A(D.question_target)||D.$raise(s("ParseError")),A(D.allowed_cmp_op["$include?"](re))||D.$raise(s("ParseError")),u(["cmp_op","target"],{cmp_op:re,target:"?"})}),N(f,"$_reduce_19",function(B,V,x){return K(K(s("Arithmetic"),"Node"),"BinaryOp").$new(B["$[]"](0),"+",B["$[]"](2))}),N(f,"$_reduce_20",function(B,V,x){return K(K(s("Arithmetic"),"Node"),"BinaryOp").$new(B["$[]"](0),"-",B["$[]"](2))}),N(f,"$_reduce_22",function(B,V,x){return K(K(s("Arithmetic"),"Node"),"BinaryOp").$new(B["$[]"](0),"*",B["$[]"](2))}),N(f,"$_reduce_23",function(B,V,x){return B["$[]"](3).$new(B["$[]"](0),B["$[]"](2))}),N(f,"$_reduce_25",function(B,V,x){return K(K(s("Arithmetic"),"Node"),"DivideWithGameSystemDefault")}),N(f,"$_reduce_26",function(B,V,x){return K(K(s("Arithmetic"),"Node"),"DivideWithCeil")}),N(f,"$_reduce_27",function(B,V,x){return K(K(s("Arithmetic"),"Node"),"DivideWithCeil")}),N(f,"$_reduce_28",function(B,V,x){return K(K(s("Arithmetic"),"Node"),"DivideWithRound")}),N(f,"$_reduce_29",function(B,V,x){return K(K(s("Arithmetic"),"Node"),"DivideWithFloor")}),N(f,"$_reduce_30",function(B,V,x){return B["$[]"](1)}),N(f,"$_reduce_31",function(B,V,x){return K(K(s("Arithmetic"),"Node"),"Negative").$new(B["$[]"](1))}),N(f,"$_reduce_33",function(B,V,x){return B["$[]"](1)}),N(f,"$_reduce_34",function(B,V,x){return K(K(s("Arithmetic"),"Node"),"Number").$new(B["$[]"](0))}),N(f,"$_reduce_none",function(B,V,x){return B["$[]"](0)})},Opal.modules["bcdice/deprecated/checker"]=function(e){var M,j,L,l,k,_,q,Z,Y=e.module,U=e.send,c=e.eqeqeq,I=e.truthy,C=e.def,d=e.return_val,F=[],b=e.nil;return M=F,j=Z=[Y(F[0],"BCDice")].concat(M),L=q=[Y(Z[0],"Deprecated")].concat(j),k=[l=Y(q[0],"Checker")].concat(L),_=e.$r(k),l.$private(),C(l,"$check_result_legacy",function(r,n,p,H){var z,P=this,R=b,g=b,h=b,y=b;return R=U(n,"map",[],"sides".$to_proc()),z=(g=U(n,"map",[],"value".$to_proc())).$sum(),h=c([100],y=R)?P.$check_1D100(r,z,p,H):c([20],y)?P.$check_1D20(r,z,p,H):c([6,6],y)?P.$check_2D6(r,z,g,p,H):b,(I(h["$nil?"]())||I(h["$empty?"]()))&&(h=c([10],y=R.$uniq())?P.$check_nD10(r,z,g,p,H):c([6],y)?P.$check_nD6(r,z,g,p,H):b,I(h["$nil?"]())||I(h["$empty?"]()))?b:_("Result").$new(h.$delete_prefix(" \uff1e "))}),C(l,"$check_1D100",d(b)),C(l,"$check_1D20",d(b)),C(l,"$check_nD10",d(b)),C(l,"$check_2D6",d(b)),C(l,"$check_nD6",d(b))},Opal.modules["bcdice/base"]=function(e){var k,P,y,s,t,T,$,o,f,S,g,Y=e.module,U=e.klass,c=e.slice,I=e.rb_plus,C=e.truthy,d=e.def,F=e.regexp,b=e.send,N=e.thrower,M=e.return_ivar,E=e.assign_ivar_val,Z=e.eqeqeq,W=e.eqeq,j=e.return_val,A=e.range,q=e.rb_minus,u=e.rb_divide,L=e.rb_times,l=e.rb_ge,_=e.top,K=[],r=e.$r(K),n=e.nil,p=e.$$$;return _.$require("i18n"),_.$require("i18n/backend/fallbacks"),_.$require("bcdice/randomizer"),_.$require("bcdice/dice_table"),_.$require("bcdice/enum"),_.$require("bcdice/translate"),_.$require("bcdice/result"),_.$require("bcdice/command/parser"),_.$require("bcdice/deprecated/checker"),P=K,y=g=[Y(K[0],"BCDice")].concat(P),o=[$=U(g[0],null,"Base")].concat(y),f=e.$r(o),(S=$.$$prototype).raw_input=S.randomizer=S.enabled_upcase_input=S.debug=n,t=[s=e.get_singleton_class($)].concat(o),T=e.$r(t),s.$attr_reader("prefixes"),d(s,"$register_prefix",function(v){var X,te=this,O=n;return null==te.prefixes&&(te.prefixes=n),X=c(arguments),te.prefixes=I(C(O=te.prefixes)?O:[],X.$flatten())},-1),d(s,"$register_prefix_from_super_class",function(){return this.$register_prefix(this.$superclass().$prefixes())}),d(s,"$prefixes_pattern",function(){var v=this,a=n;return null==v.prefixes_pattern&&(v.prefixes_pattern=n),null==v.prefixes&&(v.prefixes=n),v.prefixes_pattern=C(a=v.prefixes_pattern)?a:n,C(v.prefixes_pattern)?v.prefixes_pattern:(v.prefixes=C(a=v.prefixes)?a:[],v.prefixes.$freeze(),v.prefixes_pattern=(C(v.prefixes["$empty?"]())?/(?!)/:F(["^(S)?(",v.prefixes.$join("|"),")"],"i")).$freeze())}),d(s,"$command_pattern",function(){var v=this,a=n,X=n;return null==v.command_pattern&&(v.command_pattern=n),null==v.prefixes&&(v.prefixes=n),v.command_pattern=C(a=v.command_pattern)?a:n,C(v.command_pattern)?v.command_pattern:(v.prefixes=C(a=v.prefixes)?a:[],v.prefixes.$freeze(),X=I(b(p(T("CommonCommand"),"COMMANDS"),"map",[],function(O){return null==O&&(O=n),p(O,"PREFIX_PATTERN").$source()}),v.prefixes),v.command_pattern=F(["^S?(",X.$join("|"),")"],"i").$freeze())}),d(s,"$eval",function(v){try{return N("eval_return"),this.$new(v).$eval()}catch(te){if(te===e.t_eval_return)return te.$v;throw te}}),$.$include(f("Translate")),$.$include(p(f("Deprecated"),"Checker")),d($,"$initialize",function(m){var t=this;return t.raw_input=m,t.sort_add_dice=!1,t.sort_barabara_dice=!1,t.d66_sort_type=p(f("D66SortType"),"NO_SORT"),t.enabled_d9=!1,t.round_type=p(f("RoundType"),"FLOOR"),t.sides_implicit_d=6,t.upper_dice_reroll_threshold=n,t.reroll_dice_reroll_threshold=n,t.default_cmp_op=n,t.default_target_number=n,t.enabled_upcase_input=!0,t.locale="ja_jp",t.randomizer=p(f("BCDice"),"Randomizer").$new(),t.debug=!1}),$.$attr_accessor("randomizer"),$.$attr_reader("d66_sort_type"),$.$attr_reader("round_type"),$.$attr_reader("sides_implicit_d"),$.$attr_reader("upper_dice_reroll_threshold"),$.$attr_reader("reroll_dice_reroll_threshold"),$.$attr_reader("default_cmp_op"),$.$attr_reader("default_target_number"),d($,"$sort_add_dice?",M("sort_add_dice")),d($,"$sort_barabara_dice?",M("sort_barabara_dice")),d($,"$enabled_d9?",M("enabled_d9")),d($,"$enable_debug",E("debug",!0)),d($,"$eval",function(){var t,i,m=this,T=n;return t=p(f("BCDice"),"Preprocessor").$process(m.raw_input,m),T=C(i=m.$dice_command(t))?i:m.$eval_common_command(m.raw_input),C(T)?(T["$rands="](m.randomizer.$rand_results()),T["$detailed_rands="](m.randomizer.$detailed_rand_results()),T):n}),d($,"$change_text",function(m){return m}),d($,"$check_result",function(m,t,T,i){var v=this,a=n,X=n,te=n,O=n,ue=n;return a=v.$check_result_legacy(m,t,T,i),C(a)?a:(X=b(t,"map",[],"sides".$to_proc()),O=(te=b(t,"map",[],"value".$to_proc())).$sum(),a=Z([100],ue=X)?v.$result_1d100(m,O,T,i):Z([20],ue)?v.$result_1d20(m,O,T,i):Z([6,6],ue)?v.$result_2d6(m,O,te,T,i):n,W(a,f("Result").$nothing())?n:C(a)?a:(a=Z([10],ue=X.$uniq())?v.$result_nd10(m,O,te,T,i):Z([6],ue)?v.$result_nd6(m,O,te,T,i):n,W(a,f("Result").$nothing())?n:C(a)?a:v.$result_ndx(m,T,i)))}),d($,"$grich_text",j(n)),$.$private(),d($,"$eval_common_command",function(m){try{N("eval_return");var T=N("return");return m=this.$change_text(m),b(p(f("CommonCommand"),"COMMANDS"),"each",[],function v(a){var te,X=null==v.$$s?this:v.$$s;if(null==X.randomizer&&(X.randomizer=n),null==a&&(a=n),te=a.$eval(m,X,X.randomizer),!C(te))return n;T.$throw(te)},{$$s:this,$$ret:T}),n}catch(v){if(v===e.t_eval_return||v===T)return v.$v;throw v}}),d($,"$dice_command",function(m){var t=this,T=n,i=n,v=n,a=n;return C(t.enabled_upcase_input)&&(m=m.$upcase()),T=t.$class().$prefixes_pattern().$match(m),C(T)?(i=T["$[]"](1)["$nil?"]()["$!"](),C(i)&&(m=m["$[]"](A(1,-1,!1))),v=t.$eval_game_system_specific_command(m),C(v["$is_a?"](f("Result")))?(v["$secret="](C(a=v["$secret?"]())?a:i),v):C(v["$nil?"]())||C(v["$empty?"]())||W(v,"1")?n:b(f("Result").$new(),"tap",[],function(te){var O;return null==te&&(te=n),te["$text="](v.$to_s()),b(te,"secret=",O=[i]),O[O.length-1]})):n}),d($,"$eval_game_system_specific_command",j(n)),d($,"$result_ndx",function(m,t,T){return C(T["$is_a?"](f("String")))?n:C(m.$send(t,T))?f("Result").$success(this.$translate("success")):f("Result").$failure(this.$translate("failure"))}),d($,"$result_1d100",j(n)),d($,"$result_1d20",j(n)),d($,"$result_nd10",j(n)),d($,"$result_2d6",j(n)),d($,"$result_nd6",j(n)),d($,"$get_table_by_2d6",function(m){return this.$get_table_by_nD6(m,2)}),d($,"$get_table_by_1d6",function(m){return this.$get_table_by_nD6(m,1)}),d($,"$get_table_by_nD6",function(m,t){return this.$get_table_by_nDx(m,t,6)}),d($,"$get_table_by_nDx",function(m,t,T){var v,a=n;return v=this.randomizer.$roll_sum(t,T),a=this.$get_table_value(m["$[]"](q(v,t))),C(a["$nil?"]())?["1",0]:[a,v]}),d($,"$get_table_by_1d3",function(m){var i,v,t=this,a=n;return t.$debug("get_table_by_1d3"),i=t.randomizer.$roll_sum(1,6),t.$debug("num",i),v=u(q(i,1),2).$to_i(),t.$debug("index",v),a=m["$[]"](v),C(a["$nil?"]())?["1",0]:[a,i]}),d($,"$get_table_by_d66_swap",function(m){var T;return T=this.randomizer.$roll_d66(p(f("D66SortType"),"ASC")),[this.$get_table_by_number(T,m),T]}),d($,"$get_table_by_d66",function(m){var T,i,v,X,a=n;return T=this.randomizer.$roll_once(6),i=this.randomizer.$roll_once(6),v=I(L(q(T,1),6),q(i,1)),a=m["$[]"](v),X=""+T+i,C(a["$nil?"]())?["1",X]:[a,X]}),d($,"$get_table_by_number",function(m,t,T){try{var i=N("return");return null==T&&(T="1"),b(t,"each",[],function a(X){var O,te=null==a.$$s?this:a.$$s;if(null==X&&(X=n),O=X["$[]"](0),!C(l(O,m)))return n;i.$throw(te.$get_table_value(X["$[]"](1)))},{$$s:this,$$ret:i}),this.$get_table_value(T)}catch(a){if(a===i)return a.$v;throw a}},-3),d($,"$get_table_value",function(m){return C(m["$is_a?"](f("Proc")))?m.$call():m}),d($,"$roll_tables",function(m,t){var i=n;return i=t["$[]"](m),C(i)?i.$roll(this.randomizer).$to_s():n}),d($,"$debug",function(m,t){var i,v=this,a=n,X=n;return i=c(arguments,1),C(v.debug)?(a=C(m["$is_a?"](f("String")))?m:m.$inspect(),C(i["$empty?"]())?v.$warn(a):(X=b(i,"map",[],function(O){return null==O&&(O=n),C(O["$is_a?"](f("String")))?'"'+O+'"':O.$inspect()}),v.$warn(a+": "+X.$join(", ")))):n},-2),p(p(r("I18n"),"Backend"),"Simple").$include(p(p(r("I18n"),"Backend"),"Fallbacks")),r("I18n").$load_path()["$<<"](r("Dir")["$[]"](r("File").$join("bcdice","../../i18n/**/*.yml"))),r("I18n")["$default_locale="]("ja_jp"),k=[["ja_jp"]],b(r("I18n").$fallbacks(),"defaults=",k),k[k.length-1]},Opal.modules["bcdice/game_system/sword_world/rating_lexer"]=function(e){var E,A,_,H,P,R,g,r,u,L,W,Y=e.module,U=e.klass,c=e.const_set,I=e.hash2,C=e.truthy,d=e.def,b=[],N=e.nil;return e.top.$require("strscan"),E=b,A=W=[Y(b[0],"BCDice")].concat(E),u=[Y(W[0],"GameSystem")].concat(A),L=e.$r(u),_=u,H=r=[U(u[0],L("Base"),"SwordWorld")].concat(_),R=[P=U(r[0],null,"RatingLexer")].concat(H),g=e.$r(R),P.$$prototype.scanner=N,c(R[0],"SYMBOLS",I(["+","-","*","/","(",")","[","]","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","[":"BRACKETL","]":"BRACKETR","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),d(P,"$initialize",function(y){var $,o,S;return y=C(S=($=(o=y)===N||null==o?N:o.$split(" ",2))===N||null==$?N:$.$first())?S:"",this.scanner=g("StringScanner").$new(y)}),d(P,"$next_token",function(){var y=this,$=N,o=N,S=N;return C(y.scanner["$eos?"]())?[!1,"$"]:C($=y.scanner.$scan(/\d+/))?["NUMBER",$.$to_i()]:(o=y.scanner.$getch().$upcase(),[C(S=g("SYMBOLS")["$[]"](o))?S:o.$to_sym(),o])}),d(P,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/game_system/sword_world/rating_parsed"]=function(e){var Z,q,K,P,R,g,z,h,n,L,l,j,Y=e.module,U=e.klass,c=e.def,I=e.truthy,C=e.rb_le,d=e.rb_plus,F=e.rb_lt,b=e.neqeq,N=[],M=e.nil;return Z=N,q=j=[Y(N[0],"BCDice")].concat(Z),L=[Y(j[0],"GameSystem")].concat(q),l=e.$r(L),K=L,P=n=[U(L[0],l("Base"),"SwordWorld")].concat(K),g=[R=U(n[0],null,"RatingParsed")].concat(P),z=e.$r(g),(h=R.$$prototype).modifier_after_half=h.semi_fixed_val=h.kept_modify=h.rate=h.greatest_fortune=h.modifier=M,R.$attr_accessor("rate"),R.$attr_accessor("critical"),R.$attr_accessor("kept_modify"),R.$attr_accessor("first_to"),R.$attr_accessor("first_modify"),R.$attr_accessor("rateup"),R.$attr_accessor("greatest_fortune"),R.$attr_accessor("semi_fixed_val"),R.$attr_accessor("tmp_fixed_val"),R.$attr_accessor("modifier"),R.$attr_accessor("modifier_after_half"),c(R,"$initialize",function($,o){var f=this;return f.rate=$,f.modifier=o,f.critical=13,f.kept_modify=0,f.first_to=0,f.first_modify=0,f.greatest_fortune=!1,f.rateup=0,f.semi_fixed_val=0,f.tmp_fixed_val=0,f.modifier_after_half=M}),c(R,"$half",function(){return this.modifier_after_half["$nil?"]()["$!"]()}),c(R,"$min_critical",function(){var $=this;return I(C($.semi_fixed_val,1))?3:d(d($.semi_fixed_val,$.kept_modify),2).$clamp(3,13)}),c(R,"$infinite_roll?",function(){return F(this.$critical(),this.$min_critical())}),c(R,"$to_s",function(){var $=this,o=M;return o="KeyNo."+$.rate,I(F($.$critical(),13))&&(o=d(o,"c["+$.$critical()+"]")),b($.$first_modify(),0)&&(o=d(o,"m["+z("Format").$modifier($.$first_modify())+"]")),b($.$first_to(),0)&&(o=d(o,"m["+$.$first_to()+"]")),b($.$rateup(),0)&&(o=d(o,"r["+$.$rateup()+"]")),I($.greatest_fortune)&&(o=d(o,"gf")),b($.$semi_fixed_val(),0)&&(o=d(o,"sf["+$.$semi_fixed_val()+"]")),b($.$tmp_fixed_val(),0)&&(o=d(o,"tf["+$.$tmp_fixed_val()+"]")),b($.$kept_modify(),0)&&(o=d(o,"a["+z("Format").$modifier($.$kept_modify())+"]")),b($.modifier,0)&&(o=d(o,z("Format").$modifier($.modifier))),o})},Opal.modules["bcdice/game_system/sword_world/rating_options"]=function(e){var b,Z,L,r,k,j,A,M,Y=e.module,U=e.klass,c=e.truthy,I=e.def,C=[];return b=C,Z=M=[Y(C[0],"BCDice")].concat(b),j=[Y(M[0],"GameSystem")].concat(Z),A=e.$r(j),L=j,k=[U(j[0],A("Base"),"SwordWorld")].concat(L),(r=U(k[0],null,"RatingOptions")).$attr_accessor("critical"),r.$attr_accessor("kept_modify"),r.$attr_accessor("first_to"),r.$attr_accessor("first_modify"),r.$attr_accessor("rateup"),r.$attr_accessor("greatest_fortune"),r.$attr_accessor("semi_fixed_val"),r.$attr_accessor("tmp_fixed_val"),r.$attr_accessor("modifier"),r.$attr_accessor("modifier_after_half"),I(r,"$settable_first_roll_adjust_option?",function(){var H;return c(H=this.$first_modify()["$nil?"]())?this.$first_to()["$nil?"]():H}),I(r,"$settable_non_2d_roll_option?",function(){var H,P,p=this;return c(H=c(P=p.$greatest_fortune()["$nil?"]())?p.$semi_fixed_val()["$nil?"]():P)?p.$tmp_fixed_val()["$nil?"]():H})},Opal.modules["bcdice/game_system/sword_world/rating_parser"]=function(e){var k,n,z,S,T,i,v,a,X,te,O,ue,$e,_e,s,m,t,B,y,$,H,P,K,Y=e.module,U=e.klass,c=e.ensure_kwargs,I=e.send2,C=e.find_super,d=e.def,F=e.send,b=e.truthy,N=e.not,M=e.thrower,E=e.hash,Z=e.const_set,W=e.to_ary,j=e.eqeq,A=e.top,q=[],u=e.nil,L=e.$$$;return A.$require("racc/parser.rb"),A.$require("bcdice/arithmetic/node"),A.$require("bcdice/enum"),A.$require("bcdice/game_system/sword_world/rating_lexer"),A.$require("bcdice/game_system/sword_world/rating_parsed"),A.$require("bcdice/game_system/sword_world/rating_options"),k=q,n=K=[Y(q[0],"BCDice")].concat(k),H=[Y(K[0],"GameSystem")].concat(n),P=e.$r(H),z=H,y=[U(H[0],P("Base"),"SwordWorld")].concat(z),$=e.$r(y),S=y,m=[s=U(y[0],L($("Racc"),"Parser"),"RatingParser")].concat(S),t=e.$r(m),(B=s.$$prototype).lexer=B.round_type=B.version=u,d(s,"$initialize",function V(x){var D,re,G=this;return V.$$p=null,null==(D=(x=c(x)).$$smap.version)&&(D="v1_0"),null==(re=x.$$smap.round_type)&&(re=L(t("RoundType"),"CEIL")),I(G,C(G,"initialize",V,!1,!0),"initialize",[],null),G.version=D,G.round_type=re},-1),d(s,"$set_debug",function(){return this.yydebug=!0,this}),d(s,"$parse",function(x){try{return this.lexer=t("RatingLexer").$new(x),this.$do_parse()}catch(re){if(!e.rescue(re,[t("ParseError"),t("ZeroDivisionError")]))throw re;try{return u}finally{e.pop_exception()}}}),s.$private(),d(s,"$parsed",function(x,D,re){try{return M("eval_return"),F(t("RatingParsed").$new(x,D),"tap",[],function J(Q){var ne,ie,le,fe,oe,de,me,be,he=null==J.$$s?this:J.$$s,ve=u;return null==he.round_type&&(he.round_type=u),null==Q&&(Q=u),Q["$kept_modify="](b(ve=(ne=re.$kept_modify())===u||null==ne?u:ne.$eval(he.round_type))?ve:0),Q["$first_to="](b(ve=re.$first_to())?ve:0),Q["$first_modify="](b(ve=re.$first_modify())?ve:0),Q["$rateup="](b(ve=(ie=re.$rateup())===u||null==ie?u:ie.$eval(he.round_type))?ve:0),N(re.$greatest_fortune()["$nil?"]())&&Q["$greatest_fortune="](re.$greatest_fortune()),Q["$semi_fixed_val="](b(ve=(le=re.$semi_fixed_val())===u||null==le?u:le.$clamp(1,6))?ve:0),Q["$tmp_fixed_val="](b(ve=(fe=re.$tmp_fixed_val())===u||null==fe?u:fe.$clamp(1,6))?ve:0),Q["$modifier_after_half="]((oe=re.$modifier_after_half())===u||null==oe?u:oe.$eval(he.round_type)),de=[b((be=re.$critical(),me=be===u||null==be?u:be.$eval(he.round_type),ve=me===u||null==me?u:me.$clamp(0,13)))?ve:b(Q.$half())?13:10],F(Q,"critical=",de),de[de.length-1]},{$$s:this})}catch(J){if(J===e.t_eval_return)return J.$v;throw J}}),d(s,"$next_token",function(){return this.lexer.$next_token()}),T=e.large_array_unpack("15,14,16,5,17,18,20,21,57,58,23,24,11,59,12,19,13,15,14,16,4,17,18,20,21,4,30,3,30,11,8,12,19,13,26,27,26,27,29,30,29,30,55,56,55,56,30,26,27,26,27,29,30,29,26,27,9,30,29,30,26,27,55,56,29,26,27,26,27,29,30,29,30,55,56,55,56,30,26,27,26,27,29,30,29,26,27,37,30,29,30,26,27,55,56,29,26,27,26,27,29,30,29,30,55,56,38,39,32,26,27,26,27,29,46,29,33,34,51,52,53,54"),i=e.large_array_unpack("6,6,6,1,6,6,6,6,49,49,10,10,6,49,6,6,6,22,22,22,3,22,22,22,22,0,11,0,12,22,4,22,22,22,11,11,12,12,11,14,12,15,41,41,43,43,19,14,14,15,15,14,20,15,19,19,5,21,19,23,20,20,44,44,20,21,21,23,23,21,24,23,26,45,45,50,50,27,24,24,26,26,24,29,26,27,27,16,55,27,56,29,29,62,62,29,55,55,56,56,55,57,56,58,63,63,17,18,13,57,57,58,58,57,25,58,13,13,33,34,38,39"),v=e.large_array_unpack("22,3,,17,28,56,-4,,,,0,24,26,106,37,39,80,99,100,44,50,55,13,57,68,97,70,75,,81,,,,116,117,,,,118,119,,30,,32,50,61,,,,-2,63,,,,,86,88,99,101,,,,81,92"),a=e.large_array_unpack("-33,-33,-4,-33,-33,-33,-1,-4,-3,64,-5,-33,-33,-33,-11,-33,-33,-33,-33,-33,-33,-33,-2,-33,-33,-33,-33,-33,-30,-33,-32,-7,-8,-33,-33,-12,-13,-14,-33,-33,-17,-18,-27,-19,-20,-21,-6,-28,-29,-33,-24,-9,-10,-15,-16,-33,-33,-33,-33,-31,-25,-26,-22,-23"),X=e.large_array_unpack("25,31,6,35,36,1,49,22,40,41,43,2,44,45,7,47,48,,50,,,,,,,,,,,,,,,,,,,,,,,,,,60,61,62,63"),te=e.large_array_unpack("5,5,3,5,5,1,7,3,5,6,6,2,6,6,2,5,5,,6,,,,,,,,,,,,,,,,,,,,,,,,,,5,5,6,6"),O=[u,5,11,0,u,-11,-11,-23,u],ue=[u,u,u,u,10,42,u,u,28],$e=e.large_array_unpack("0,0,racc_error,2,22,_reduce_1,3,22,_reduce_2,2,23,_reduce_3,0,24,_reduce_4,2,24,_reduce_5,4,24,_reduce_6,3,24,_reduce_7,3,24,_reduce_8,4,24,_reduce_9,4,24,_reduce_10,2,24,_reduce_11,3,24,_reduce_12,3,24,_reduce_13,3,24,_reduce_14,4,24,_reduce_15,4,24,_reduce_16,3,24,_reduce_17,2,25,_reduce_18,2,25,_reduce_19,3,25,_reduce_20,3,25,_reduce_21,3,28,_reduce_22,3,28,_reduce_23,1,28,_reduce_none,3,27,_reduce_25,3,27,_reduce_26,1,27,_reduce_none,2,26,_reduce_28,2,26,_reduce_29,1,26,_reduce_none,3,29,_reduce_31,1,29,_reduce_32"),_e=E(!1,0,"error",1,"NUMBER",2,"K",3,"R",4,"H",5,"G",6,"F",7,"S",8,"T",9,"PLUS",10,"MINUS",11,"ASTERISK",12,"SLASH",13,"PARENL",14,"PARENR",15,"BRACKETL",16,"BRACKETR",17,"AT",18,"SHARP",19,"DOLLAR",20),Z(m[0],"Racc_arg",[T,i,a,v,X,te,ue,O,21,$e,_e,64,33,!0]),Z(m[0],"Racc_token_to_s_table",["$end","error","NUMBER","K","R","H","G","F","S","T","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","BRACKETL","BRACKETR","AT","SHARP","DOLLAR","$start","expr","rate","option","modifier","unary","mul","add","term"]),Z(m[0],"Racc_debug_parser",!1),d(s,"$_reduce_1",function(x,D,re){try{M("eval_return");var G,ne,fe,ie=u,le=u;return ne=null==(G=W(x))[0]?u:G[0],le=b(fe=(ie=null==G[1]?u:G[1]).$modifier())?fe:L(L(t("Arithmetic"),"Node"),"Number").$new(0),this.$parsed(ne,le.$eval(this.round_type),ie)}catch(oe){if(oe===e.t_eval_return)return oe.$v;throw oe}}),d(s,"$_reduce_2",function(x,D,re){try{M("eval_return");var G,ie,fe,le=u,oe=u;return ie=null==(G=W(x))[1]?u:G[1],b((le=null==G[2]?u:G[2]).$modifier_after_half())||le["$modifier_after_half="](L(L(t("Arithmetic"),"Node"),"Number").$new(0)),oe=b(fe=le.$modifier())?fe:L(L(t("Arithmetic"),"Node"),"Number").$new(0),this.$parsed(ie,oe.$eval(this.round_type),le)}catch(de){if(de===e.t_eval_return)return de.$v;throw de}}),d(s,"$_reduce_3",function(x,D,re){return x["$[]"](1).$to_i()}),d(s,"$_reduce_4",function(x,D,re){return t("RatingOptions").$new()}),d(s,"$_reduce_5",function(x,D,re){var w,ne,Q=u;return ne=null==(w=W(x))[1]?u:w[1],b((Q=null==w[0]?u:w[0]).$modifier()["$nil?"]())||this.$raise(t("ParseError")),Q["$modifier="](ne),Q}),d(s,"$_reduce_6",function(x,D,re){var w,ie,Q=u;return ie=null==(w=W(x))[2]?u:w[2],b((Q=null==w[0]?u:w[0]).$critical()["$nil?"]())||this.$raise(t("ParseError")),Q["$critical="](ie),Q}),d(s,"$_reduce_7",function(x,D,re){var w,ie,Q=u;return ie=null==(w=W(x))[2]?u:w[2],b((Q=null==w[0]?u:w[0]).$critical()["$nil?"]())||this.$raise(t("ParseError")),Q["$critical="](ie),Q}),d(s,"$_reduce_8",function(x,D,re){var w,Q=u,ie=u;return ie=null==(w=W(x))[2]?u:w[2],b((Q=null==w[0]?u:w[0])["$settable_first_roll_adjust_option?"]())||this.$raise(t("ParseError")),Q["$first_to="](ie.$to_i()),Q}),d(s,"$_reduce_9",function(x,D,re){var w,Q=u,ie=u;return ie=null==(w=W(x))[3]?u:w[3],b((Q=null==w[0]?u:w[0])["$settable_first_roll_adjust_option?"]())||this.$raise(t("ParseError")),Q["$first_modify="](ie.$to_i()),Q}),d(s,"$_reduce_10",function(x,D,re){var w,Q=u,ie=u;return ie=null==(w=W(x))[3]?u:w[3],b((Q=null==w[0]?u:w[0])["$settable_first_roll_adjust_option?"]())||this.$raise(t("ParseError")),Q["$first_modify="](ie.$to_i()["$-@"]()),Q}),d(s,"$_reduce_11",function(x,D,re){var w,Q=u;return w=W(x),b((Q=null==w[0]?u:w[0]).$modifier_after_half()["$nil?"]())||this.$raise(t("ParseError")),Q["$modifier_after_half="](L(L(t("Arithmetic"),"Node"),"Number").$new(0)),Q}),d(s,"$_reduce_12",function(x,D,re){var w,ie,Q=u;return ie=null==(w=W(x))[2]?u:w[2],b((Q=null==w[0]?u:w[0]).$modifier_after_half()["$nil?"]())||this.$raise(t("ParseError")),Q["$modifier_after_half="](ie),Q}),d(s,"$_reduce_13",function(x,D,re){var w,ie,Q=u;return Q=null==(w=W(x))[0]?u:w[0],ie=null==w[2]?u:w[2],b(["v2_5","v2_0"]["$include?"](this.version))&&b(Q.$rateup()["$nil?"]())||this.$raise(t("ParseError")),Q["$rateup="](ie),Q}),d(s,"$_reduce_14",function(x,D,re){var w,Q=u;return Q=null==(w=W(x))[0]?u:w[0],b(["v2_5","v2_0"]["$include?"](this.version))&&b(Q["$settable_non_2d_roll_option?"]())||this.$raise(t("ParseError")),Q["$greatest_fortune="](!0),Q}),d(s,"$_reduce_15",function(x,D,re){var w,Q=u,ie=u;return Q=null==(w=W(x))[0]?u:w[0],ie=null==w[3]?u:w[3],b(["v2_5","v2_0"]["$include?"](this.version))&&b(Q["$settable_non_2d_roll_option?"]())||this.$raise(t("ParseError")),Q["$semi_fixed_val="](ie.$to_i()),Q}),d(s,"$_reduce_16",function(x,D,re){var w,Q=u,ie=u;return Q=null==(w=W(x))[0]?u:w[0],ie=null==w[3]?u:w[3],b(["v2_5","v2_0"]["$include?"](this.version))&&b(Q["$settable_non_2d_roll_option?"]())||this.$raise(t("ParseError")),Q["$tmp_fixed_val="](ie.$to_i()),Q}),d(s,"$_reduce_17",function(x,D,re){var w,ie,Q=u;return Q=null==(w=W(x))[0]?u:w[0],ie=null==w[2]?u:w[2],j(this.version,"v2_5")&&b(Q.$kept_modify()["$nil?"]())||this.$raise(t("ParseError")),Q["$kept_modify="](ie),Q}),d(s,"$_reduce_18",function(x,D,re){return x["$[]"](1)}),d(s,"$_reduce_19",function(x,D,re){return L(L(t("Arithmetic"),"Node"),"Negative").$new(x["$[]"](1))}),d(s,"$_reduce_20",function(x,D,re){return L(L(t("Arithmetic"),"Node"),"BinaryOp").$new(x["$[]"](0),"+",x["$[]"](2))}),d(s,"$_reduce_21",function(x,D,re){return L(L(t("Arithmetic"),"Node"),"BinaryOp").$new(x["$[]"](0),"-",x["$[]"](2))}),d(s,"$_reduce_22",function(x,D,re){return L(L(t("Arithmetic"),"Node"),"BinaryOp").$new(x["$[]"](0),"+",x["$[]"](2))}),d(s,"$_reduce_23",function(x,D,re){return L(L(t("Arithmetic"),"Node"),"BinaryOp").$new(x["$[]"](0),"-",x["$[]"](2))}),d(s,"$_reduce_25",function(x,D,re){return L(L(t("Arithmetic"),"Node"),"BinaryOp").$new(x["$[]"](0),"*",x["$[]"](2))}),d(s,"$_reduce_26",function(x,D,re){return L(L(t("Arithmetic"),"Node"),"DivideWithGameSystemDefault").$new(x["$[]"](0),x["$[]"](2))}),d(s,"$_reduce_28",function(x,D,re){return x["$[]"](1)}),d(s,"$_reduce_29",function(x,D,re){return L(L(t("Arithmetic"),"Node"),"Negative").$new(x["$[]"](1))}),d(s,"$_reduce_31",function(x,D,re){return x["$[]"](1)}),d(s,"$_reduce_32",function(x,D,re){return L(L(t("Arithmetic"),"Node"),"Number").$new(x["$[]"](0))}),d(s,"$_reduce_none",function(x,D,re){return x["$[]"](0)})},Opal.modules["bcdice/game_system/SwordWorld"]=function(e){var H,z,S,s,m,t,T,y,$,R,Y=e.module,U=e.klass,c=e.const_set,I=e.send2,C=e.find_super,d=e.def,F=e.truthy,b=e.rb_ge,N=e.rb_le,M=e.eqeq,E=e.neqeq,Z=e.rb_minus,W=e.rb_gt,j=e.hash2,A=e.send,q=e.to_ary,u=e.rb_plus,L=e.rb_lt,l=e.rb_times,k=e.thrower,_=e.rb_divide,K=e.top,r=[],n=e.nil;return K.$require("bcdice/base"),K.$require("bcdice/game_system/sword_world/rating_parser"),H=r,z=R=[Y(r[0],"BCDice")].concat(H),y=[Y(R[0],"GameSystem")].concat(z),$=e.$r(y),S=y,m=[s=U(y[0],$("Base"),"SwordWorld")].concat(S),t=e.$r(m),(T=s.$$prototype).rating_table=T.randomizer=n,c(m[0],"ID","SwordWorld"),c(m[0],"NAME","\u30bd\u30fc\u30c9\u30fb\u30ef\u30fc\u30eb\u30c9RPG"),c(m[0],"SORT_KEY","\u305d\u304a\u3068\u308f\u3042\u308b\u3068"),c(m[0],"HELP_MESSAGE","\u30fbSW\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3000(Kx[c]+m$f) (x:\u30ad\u30fc, c:\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024, m:\u30dc\u30fc\u30ca\u30b9, f:\u51fa\u76ee\u4fee\u6b63)\n"),s.$register_prefix("H?K"),d(s,"$initialize",function i(v){var X=this;return i.$$p=null,I(X,C(X,"initialize",i,!1,!0),"initialize",[v],null),X.rating_table=0}),d(s,"$result_2d6",function(v,a,X,te,O){return F(b(a,12))?t("Result").$critical(this.$translate("SwordWorld.critical")):F(N(a,2))?t("Result").$fumble(this.$translate("SwordWorld.fumble")):E(te,">=")||M(O,"?")?n:F(b(v,O))?t("Result").$success(this.$translate("success")):t("Result").$failure(this.$translate("failure"))}),d(s,"$eval_game_system_specific_command",function(v){return this.$rating(v)}),s.$private(),d(s,"$rating_parser",function(){return t("RatingParser").$new()}),d(s,"$rating",function(v){var a,X,te=this,O=n,ue=n,$e=n,ce=n,se=n,_e=n,ae=n,ee=n,B=n,V=n,x=n,D=n,re=n,w=n,J=n,Q=n;return te.$debug("rating string",v),O=te.$rating_parser().$parse(v),F(O)?(ue=te.$getSW2_0_RatingTable(),$e=Z(ue.$length(),1),te.$debug("keyMax",$e),F(W(O.$rate(),$e))?t("Result").$new(te.$translate("SwordWorld.keynumber_exceeds",j(["keyMax"],{keyMax:$e}))):F(O["$infinite_roll?"]())?t("Result").$new(te.$translate("SwordWorld.infinite_critical",j(["min_critical"],{min_critical:O.$min_critical()}))):(ce=te.$getNewRates(ue),se=O+" \uff1e ",_e=[],ae=[],ee=[],B=0,V=0,x=0,D=0,re=O.$first_to(),w=O.$first_modify(),function(){try{var ne=k("break");A(te,"loop",[],function ie(){var le,fe,be,he,oe=null==ie.$$s?this:ie.$$s,de=n,me=n;if(fe=oe.$rollDice(O,D),me=null==(le=q(fe))[1]?n:le[1],B=de=null==le[0]?n:le[0],E(re,0)?(B=de=re,re=0):E(w,0)&&(B=u(B,w),w=0),F(N(de,2))&&(_e["$<<"](de.$to_s()),ae["$<<"](me.$to_s()),ee["$<<"]("**"),D=u(D,1),ne.$throw()),E(O.$kept_modify(),0)&&E(B,2)&&(B=u(B,O.$kept_modify())),F(L(B,2))&&(B=2),F(W(B,12))&&(B=12),be=[u(O.$rate(),l(D,O.$rateup())),$e].$min(),oe.$debug("currentKey",be),he=ce["$[]"](B)["$[]"](be),oe.$debug("rateValue",he),x=u(x,he),V=u(V,B),_e["$<<"](B.$to_s()),ae["$<<"](me.$to_s()),ee["$<<"](F(W(B,2))?he:"**"),D=u(D,1),F(b(B,O.$critical())))return n;ne.$throw()},{$$s:te})}catch(ie){if(ie===ne)return ie.$v;throw ie}}(),X=te.$getResultText(x,O,ae,_e,ee,V,D),a=q(X),J=null==a[1]?n:a[1],Q=null==a[2]?n:a[2],se=u(se,null==a[0]?n:a[0]),A(t("Result").$new(),"tap",[],function(ie){var le;return null==ie&&(ie=n),ie["$text="](se),ie["$critical="](J),A(ie,"fumble=",le=[Q]),le[le.length-1]}))):(te.$debug("not matched"),"1")}),d(s,"$getSW2_0_RatingTable",function(){return["*,0,0,0,1,2,2,3,3,4,4","*,0,0,0,1,2,3,3,3,4,4","*,0,0,0,1,2,3,4,4,4,4","*,0,0,1,1,2,3,4,4,4,5","*,0,0,1,2,2,3,4,4,5,5","*,0,1,1,2,2,3,4,5,5,5","*,0,1,1,2,3,3,4,5,5,5","*,0,1,1,2,3,4,4,5,5,6","*,0,1,2,2,3,4,4,5,6,6","*,0,1,2,3,3,4,4,5,6,7","*,1,1,2,3,3,4,5,5,6,7","*,1,2,2,3,3,4,5,6,6,7","*,1,2,2,3,4,4,5,6,6,7","*,1,2,3,3,4,4,5,6,7,7","*,1,2,3,4,4,4,5,6,7,8","*,1,2,3,4,4,5,5,6,7,8","*,1,2,3,4,4,5,6,7,7,8","*,1,2,3,4,5,5,6,7,7,8","*,1,2,3,4,5,6,6,7,7,8","*,1,2,3,4,5,6,7,7,8,9","*,1,2,3,4,5,6,7,8,9,10","*,1,2,3,4,6,6,7,8,9,10","*,1,2,3,5,6,6,7,8,9,10","*,2,2,3,5,6,7,7,8,9,10","*,2,3,4,5,6,7,7,8,9,10","*,2,3,4,5,6,7,8,8,9,10","*,2,3,4,5,6,8,8,9,9,10","*,2,3,4,6,6,8,8,9,9,10","*,2,3,4,6,6,8,9,9,10,10","*,2,3,4,6,7,8,9,9,10,10","*,2,4,4,6,7,8,9,10,10,10","*,2,4,5,6,7,8,9,10,10,11","*,3,4,5,6,7,8,10,10,10,11","*,3,4,5,6,8,8,10,10,10,11","*,3,4,5,6,8,9,10,10,11,11","*,3,4,5,7,8,9,10,10,11,12","*,3,5,5,7,8,9,10,11,11,12","*,3,5,6,7,8,9,10,11,12,12","*,3,5,6,7,8,10,10,11,12,13","*,4,5,6,7,8,10,11,11,12,13","*,4,5,6,7,9,10,11,11,12,13","*,4,6,6,7,9,10,11,12,12,13","*,4,6,7,7,9,10,11,12,13,13","*,4,6,7,8,9,10,11,12,13,14","*,4,6,7,8,10,10,11,12,13,14","*,4,6,7,9,10,10,11,12,13,14","*,4,6,7,9,10,10,12,13,13,14","*,4,6,7,9,10,11,12,13,13,15","*,4,6,7,9,10,12,12,13,13,15","*,4,6,7,10,10,12,12,13,14,15","*,4,6,8,10,10,12,12,13,15,15","*,5,7,8,10,10,12,12,13,15,15","*,5,7,8,10,11,12,12,13,15,15","*,5,7,9,10,11,12,12,14,15,15","*,5,7,9,10,11,12,13,14,15,16","*,5,7,10,10,11,12,13,14,16,16","*,5,8,10,10,11,12,13,15,16,16","*,5,8,10,11,11,12,13,15,16,17","*,5,8,10,11,12,12,13,15,16,17","*,5,9,10,11,12,12,14,15,16,17","*,5,9,10,11,12,13,14,15,16,18","*,5,9,10,11,12,13,14,16,17,18","*,5,9,10,11,13,13,14,16,17,18","*,5,9,10,11,13,13,15,17,17,18","*,5,9,10,11,13,14,15,17,17,18","*,5,9,10,12,13,14,15,17,18,18","*,5,9,10,12,13,15,15,17,18,19","*,5,9,10,12,13,15,16,17,19,19","*,5,9,10,12,14,15,16,17,19,19","*,5,9,10,12,14,16,16,17,19,19","*,5,9,10,12,14,16,17,18,19,19","*,5,9,10,13,14,16,17,18,19,20","*,5,9,10,13,15,16,17,18,19,20","*,5,9,10,13,15,16,17,19,20,21","*,6,9,10,13,15,16,18,19,20,21","*,6,9,10,13,16,16,18,19,20,21","*,6,9,10,13,16,17,18,19,20,21","*,6,9,10,13,16,17,18,20,21,22","*,6,9,10,13,16,17,19,20,22,23","*,6,9,10,13,16,18,19,20,22,23","*,6,9,10,13,16,18,20,21,22,23","*,6,9,10,13,17,18,20,21,22,23","*,6,9,10,14,17,18,20,21,22,24","*,6,9,11,14,17,18,20,21,23,24","*,6,9,11,14,17,19,20,21,23,24","*,6,9,11,14,17,19,21,22,23,24","*,7,10,11,14,17,19,21,22,23,25","*,7,10,12,14,17,19,21,22,24,25","*,7,10,12,14,18,19,21,22,24,25","*,7,10,12,15,18,19,21,22,24,26","*,7,10,12,15,18,19,21,23,25,26","*,7,11,13,15,18,19,21,23,25,26","*,7,11,13,15,18,20,21,23,25,27","*,8,11,13,15,18,20,22,23,25,27","*,8,11,13,16,18,20,22,23,25,28","*,8,11,14,16,18,20,22,23,26,28","*,8,11,14,16,19,20,22,23,26,28","*,8,12,14,16,19,20,22,24,26,28","*,8,12,15,16,19,20,22,24,27,28","*,8,12,15,17,19,20,22,24,27,29","*,8,12,15,18,19,20,22,24,27,30"]}),d(s,"$getNewRates",function(v){var a,X,O=n,ue=n,$e=n,ce=n,se=n,_e=n,ae=n,ee=n,B=n,V=n,x=n;return O=[],ue=[],$e=[],ce=[],se=[],_e=[],ae=[],ee=[],B=[],V=[],x=[],A(v,"each",[],function(w){var G=n;return null==w&&(w=n),G=w.$split(/,/),x.$push(0),O.$push(G["$[]"](1).$to_i()),ue.$push(G["$[]"](2).$to_i()),$e.$push(G["$[]"](3).$to_i()),ce.$push(G["$[]"](4).$to_i()),se.$push(G["$[]"](5).$to_i()),_e.$push(G["$[]"](6).$to_i()),ae.$push(G["$[]"](7).$to_i()),ee.$push(G["$[]"](8).$to_i()),B.$push(G["$[]"](9).$to_i()),V.$push(G["$[]"](10).$to_i())}),M(this.rating_table,1)&&V["$[]="](31,(a=[32,(X=[33,10],A(V,"[]=",X),X[X.length-1])],A(V,"[]=",a),a[a.length-1])),[x,x,x,O,ue,$e,ce,se,_e,ae,ee,B,V]}),d(s,"$rollDice",function(v,a){var te=n;return[(te=this.randomizer.$roll_barabara(2,6)).$sum(),te.$join(",")]}),d(s,"$getResultText",function(v,a,X,te,O,ue,$e){var se=n,_e=n,ae=n,ee=n,B=n;return(se=[]).$push("2D:["+X.$join(" ")+"]="+te.$join(",")),F(N(ue,2))?(se.$push(O.$join(",")),se.$push(this.$translate("SwordWorld.fumble")),[se.$join(" \uff1e "),!1,!0]):(F(W(O.$size(),1))||E(a.$modifier(),0)?(_e=u(O.$join(","),t("Format").$modifier(a.$modifier())),F(a.$half())&&(_e="("+_e+")/2",E(a.$modifier_after_half(),0)&&(_e=u(_e,t("Format").$modifier(a.$modifier_after_half())))),se.$push(_e)):F(a.$half())&&(_e=O.$first()+"/2",E(a.$modifier_after_half(),0)&&(_e=u(_e,t("Format").$modifier(a.$modifier_after_half()))),se.$push(_e)),F(W($e,1))&&(ae=this.$translate("SwordWorld.round_text",j(["reroll_count"],{reroll_count:Z($e,1)})),se.$push(ae)),ee=u(v,a.$modifier()),F(a.$half())&&(ee=_(ee,2).$ceil(),E(a.$modifier_after_half(),0)&&(ee=u(ee,a.$modifier_after_half()))),B=ee.$to_s(),se.$push(B),[se.$join(" \uff1e "),W($e,1),!1])})},Opal.modules["bcdice/game_system/sword_world/transcendent_test"]=function(e){var A,l,p,z,h,y,$,o,P,_,K,u,Y=e.module,U=e.klass,c=e.def,I=e.truthy,C=e.rb_lt,d=e.hash2,F=e.not,b=e.rb_ge,N=e.rb_plus,M=e.send,E=e.top,Z=[],W=e.nil;return E.$require("bcdice/result"),E.$require("bcdice/translate"),A=Z,l=u=[Y(Z[0],"BCDice")].concat(A),_=[Y(u[0],"GameSystem")].concat(l),K=e.$r(_),p=_,z=P=[U(_[0],K("SwordWorld"),"SwordWorld2_0")].concat(p),y=[h=U(P[0],null,"TranscendentTest")].concat(z),$=e.$r(y),(o=h.$$prototype).modifier=o.critical_value=o.expression=o.modifier_str=o.target=o.cmp_op=W,h.$include($("Translate")),c(h,"$initialize",function(S,s,m,t,T){var i=this;return i.critical_value=S,i.modifier=s,i.cmp_op=m,i.target=t,i.locale=T,i.modifier_str=$("Format").$modifier(i.modifier),i.expression=i.$node_expression()}),c(h,"$execute",function(S){var T,i,v,s=this,m=W,t=W,a=W,X=W,te=W,O=W;if(I(C(s.critical_value,3)))return s.$translate("SwordWorld2_0.transcendent_critical_too_small",d(["expression"],{expression:s.expression}));if(t=[m=S.$roll_barabara(2,6)],T=m["$=="]([1,1]),i=m["$=="]([6,6]),F(T)&&F(i))for(;I(b(s.$sum_of_dice(t.$last()),s.critical_value));)t.$push(S.$roll_barabara(2,6));return v=s.$sum_of_dice(t),a=N(v,s.modifier),X=s.$result_status(a,t.$length(),T,i),te=d(["success","failure","super_success","critical","fumble"],{success:s.$translate("success"),failure:s.$translate("failure"),super_success:s.$translate("SwordWorld2_0.super_success"),critical:s.$translate("SwordWorld.critical"),fumble:s.$translate("SwordWorld.fumble")}).$freeze()["$[]"](X),O=["("+s.expression+")",""+s.$dice_str(t,v)+s.modifier_str,a,te].$compact(),M($("Result").$new(),"tap",[],function($e){var ce;return null==$e&&($e=W),$e["$text="](O.$join(" \uff1e ")),$e["$fumble="](X["$=="]("fumble")),$e["$critical="](X["$=="]("critical")),$e["$success="](["success","super_success","critical"]["$include?"](X)),ce=[["failure","fumble"]["$include?"](X)],M($e,"failure=",ce),ce[ce.length-1]})}),h.$private(),c(h,"$node_expression",function(){var s,S=this;return s="2D6@"+S.critical_value+S.modifier_str,I(S.target)?""+s+S.cmp_op+S.target:s}),c(h,"$sum_of_dice",function(S){return S.$flatten().$sum()}),c(h,"$dice_str",function(S,s){return""+s+M(S,"map",[],function(T){return null==T&&(T=W),"["+T.$join(",")+"]"}).$join()}),c(h,"$result_status",function(S,s,m,t){var T=this;return I(T.target)?I(m)?"fumble":I(t)?"critical":I(S.$send(T.cmp_op,T.target))?I(b(s,2))&&I(b(S,41))?"super_success":"success":"failure":"no_target"})},Opal.modules["bcdice/game_system/SwordWorld2_0"]=function(e){var _,p,h,y,$,o,f,P,R,r,Y=e.module,U=e.klass,c=e.const_set,I=e.send2,C=e.find_super,d=e.def,F=e.eqeqeq,b=e.truthy,N=e.hash2,M=e.rb_gt,E=e.rb_plus,Z=e.eqeq,W=e.rb_times,j=e.send,A=e.neqeq,q=e.top,u=[],L=e.nil,l=e.$$$;return q.$require("bcdice/arithmetic_evaluator"),q.$require("bcdice/game_system/SwordWorld"),q.$require("bcdice/game_system/sword_world/transcendent_test"),_=u,p=r=[Y(u[0],"BCDice")].concat(_),P=[Y(r[0],"GameSystem")].concat(p),R=e.$r(P),h=P,$=[y=U(P[0],R("SwordWorld"),"SwordWorld2_0")].concat(h),o=e.$r($),(f=y.$$prototype).locale=f.randomizer=L,c($[0],"ID","SwordWorld2.0"),c($[0],"NAME","\u30bd\u30fc\u30c9\u30fb\u30ef\u30fc\u30eb\u30c92.0"),c($[0],"SORT_KEY","\u305d\u304a\u3068\u308f\u3042\u308b\u30682.0"),c($[0],"HELP_MESSAGE",'\u81ea\u52d5\u7684\u6210\u529f\u3001\u6210\u529f\u3001\u5931\u6557\u3001\u81ea\u52d5\u7684\u5931\u6557\u306e\u81ea\u52d5\u5224\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u30fb\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3000(Kx)\n\u3000"K\u30ad\u30fc\u30ca\u30f3\u30d0\u30fc+\u30dc\u30fc\u30ca\u30b9"\u306e\u5f62\u3067\u8a18\u5165\u3057\u307e\u3059\u3002\n\u3000\u30dc\u30fc\u30ca\u30b9\u306e\u90e8\u5206\u306b\u300cK20+K30\u300d\u306e\u3088\u3046\u306b\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u53d6\u308b\u3053\u3068\u306f\u51fa\u6765\u307e\u305b\u3093\u3002\n\u3000\u307e\u305f\u3001\u30dc\u30fc\u30ca\u30b9\u306f\u8907\u6570\u53d6\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3082\u30c0\u30a4\u30b9\u30ed\u30fc\u30eb\u3068\u540c\u69d8\u306b\u3001\u4ed6\u306e\u30d7\u30ec\u30a4\u30e4\u30fc\u306b\u96a0\u308c\u3066\u30ed\u30fc\u30eb\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n\u3000\u4f8b\uff09K20\u3000\u3000\u3000K10+5\u3000\u3000\u3000k30\u3000\u3000\u3000k10+10\u3000\u3000\u3000Sk10-1\u3000\u3000\u3000k10+5+2\n\n\u30fb\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u306e\u8a2d\u5b9a\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u306f"[\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024]"\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u3000\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306f\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u502410\u3068\u3057\u307e\u3059\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u51e6\u7406\u304c\u5fc5\u8981\u306a\u3044\u3068\u304d\u306f13\u306a\u3069\u3068\u3057\u3066\u304f\u3060\u3055\u3044\u3002(\u9632\u5fa1\u6642\u306a\u3069\u306e\u5bfe\u5fdc)\n\u3000\u307e\u305f\u30bf\u30a4\u30d7\u306e\u8efd\u6e1b\u5316\u306e\u305f\u3081\u306b\u672b\u5c3e\u306b\u300c@\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u300d\u3067\u3082\u51e6\u7406\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\u3000\u4f8b\uff09K20[10]\u3000\u3000\u3000K10+5[9]\u3000\u3000\u3000k30[10]\u3000\u3000\u3000k10[9]+10\u3000\u3000\u3000k10-5@9\n\n\u30fb\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u306e\u534a\u6e1b (HKx, KxH+N)\n\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u306e\u5148\u982d\u307e\u305f\u306f\u672b\u5c3e\u306b"H"\u3092\u3064\u3051\u308b\u3068\u3001\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3092\u632f\u3063\u3066\u6700\u7d42\u7d50\u679c\u3092\u534a\u6e1b\u3055\u305b\u307e\u3059\u3002\n\u3000\u672b\u5c3e\u306b\u3064\u3051\u305f\u5834\u5408\u3001\u76f4\u5f8c\u306b\u4fee\u6b63\u3092\u3092\u3064\u3051\u308b\u3053\u3068\u3067\u3001\u534a\u6e1b\u5f8c\u306e\u52a0\u6e1b\u7b97\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u3000\u3053\u306e\u969b\u3001\u8907\u6570\u306e\u9805\u306b\u3088\u308b\u4fee\u6b63\u306b\u306f\u30ab\u30c3\u30b3\u3067\u56f2\u3046\u3053\u3068\u304c\u5fc5\u8981\u3067\u3059\uff08\u30ab\u30c3\u30b3\u304c\u306a\u3044\u3068\u30d1\u30fc\u30b9\u306b\u5931\u6557\u3057\u307e\u3059\uff09\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u3092\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u306a\u3057\u3068\u6271\u308f\u308c\u307e\u3059\u3002\n\u3000\u4f8b\uff09HK20\u3000\u3000K20h\u3000\u3000HK10-5@9\u3000\u3000K10-5@9H\u3000\u3000K20gfH\u3000\u3000K20+8H+2\u3000\u3000K20+8H(1+1)\n\n\u30fb\u30c0\u30a4\u30b9\u76ee\u306e\u4fee\u6b63\uff08\u904b\u547d\u5909\u8ee2\u3084\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u30ec\u30a4\u7528\uff09\n\u3000\u672b\u5c3e\u306b\u300c$\u4fee\u6b63\u5024\u300d\u3067\u30c0\u30a4\u30b9\u76ee\u306b\u4fee\u6b63\u304c\u304b\u304b\u308a\u307e\u3059\u3002\n\u3000$\uff0b\uff11\u3068\u4fee\u6b63\u8868\u8a18\u306a\u3089\u30c0\u30a4\u30b9\u76ee\u306b\uff0b\u4fee\u6b63\u3001\uff04\uff19\u306e\u3088\u3046\u306b\u56fa\u5b9a\u5024\u306a\u3089\u30c0\u30a4\u30b9\u76ee\u3092\u305d\u306e\u51fa\u76ee\u306b\u5dee\u3057\u66ff\u3048\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u3057\u305f\u5834\u5408\u3067\u3082\u56fa\u5b9a\u5024\u3084\u4fee\u6b63\u5024\u306e\u9069\u7528\u306f\u6700\u521d\u306e\u4e00\u56de\u3060\u3051\u3067\u3059\u3002\n\u3000\u4f8b\uff09K20$+1\u3000\u3000\u3000K10+5$9\u3000\u3000\u3000k10-5@9$+2\u3000\u3000\u3000k10[9]+10$9\n\n\u30fb\u9996\u5207\u308a\u5200\u7528\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u4e0a\u6607 r10\n\u3000\u4f8b\uff09K20r10\u3000K30+24@8R10\u3000K40+24@8$12r10\n\n\u30fb\u30b0\u30ec\u30a4\u30c6\u30b9\u30c8\u30d5\u30a9\u30fc\u30c1\u30e5\u30f3\u306f\u672b\u5c3e\u306b gf\n\u3000\u4f8b\uff09K20gf\u3000K30+24@8GF\u3000K40+24@8$12r10gf\n\n\u30fb\u5a01\u529b\u8868\u30921d+sf\u3067\u53c2\u7167 \u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5f8c\u3082\u7d99\u7d9a sf4\n\u3000\u4f8b\uff09k10sf4\u3000k0+5SF4@13\u3000k70+26sf3@9\n\n\u30fb\u5a01\u529b\u8868\u30921d+tf\u3067\u53c2\u7167 \u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5f8c\u306f2d\u3067\u53c2\u7167 tf3\n\u3000\u4f8b\uff09k10tf3\u3000k0+5TF4@13\u3000k70+26tf3@9\n\n\u30fb\u8d85\u8d8a\u5224\u5b9a\u7528\u306b2d6\u30ed\u30fc\u30eb\u306b 2D6@10 \u66f8\u5f0f\u3067\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u4ed8\u4e0e\u304c\u53ef\u80fd\u306b\u3002\n\u3000\u4f8b\uff092D6@10\u30002D6@10+11>=30\n\n\u30fb\u6210\u9577\u3000(Gr)\n\u3000\u672b\u5c3e\u306b\u6570\u5b57\u3092\u4ed8\u52a0\u3059\u308b\u3053\u3068\u3067\u3001\u8907\u6570\u56de\u306e\u6210\u9577\u3092\u307e\u3068\u3081\u3066\u884c\u3048\u307e\u3059\u3002\n\u3000\u4f8b\uff09Gr3\n\n\u30fb\u9632\u5fa1\u30d5\u30a1\u30f3\u30d6\u30eb\u8868\u3000(FT)\n\u3000\u9632\u5fa1\u30d5\u30a1\u30f3\u30d6\u30eb\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30fb\u7d61\u307f\u52b9\u679c\u8868\u3000(TT)\n\u3000\u7d61\u307f\u52b9\u679c\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n'),y.$register_prefix("H?K","Gr","2D6?@\\d+","FT","TT"),d(y,"$initialize",function S(s){var t=this;return S.$$p=null,I(t,C(t,"initialize",S,!1,!0),"initialize",[s],null),t.rating_table=2}),d(y,"$eval_game_system_specific_command",function S(s){var T,t=this,v=L;return S.$$p=null,F(/^Gr(\d+)?/i,T=s)?b(s["$=~"](/^Gr(\d+)/i))?t.$growth(o("Regexp").$last_match(1).$to_i()):t.$growth():F(/^2D6?@\d+/i,T)?(v=l(o("Command"),"Parser").$new(/2D6?/i,N(["round_type"],{round_type:l(l(o("BCDice"),"RoundType"),"CEIL")})).$enable_critical().$restrict_cmp_op_to(L,">=",">").$parse(s),b(v)?o("TranscendentTest").$new(v.$critical(),v.$modify_number(),v.$cmp_op(),v.$target_number(),t.locale).$execute(t.randomizer):L):F("FT",T)?t.$get_fumble_table():F("TT",T)?t.$get_tangle_table():I(t,C(t,"eval_game_system_specific_command",S,!1,!0),"eval_game_system_specific_command",[s],null)}),d(y,"$rating_parser",function(){return o("RatingParser").$new(N(["version"],{version:"v2_0"}))}),d(y,"$rollDice",function S(s,m){var T=this,i=L;return S.$$p=null,b(M(s.$semi_fixed_val(),0))?(i=T.randomizer.$roll_once(6),[E(i,s.$semi_fixed_val()),i+","+s.$semi_fixed_val()]):Z(m,0)&&b(M(s.$tmp_fixed_val(),0))?(i=T.randomizer.$roll_once(6),[E(i,s.$tmp_fixed_val()),i+","+s.$tmp_fixed_val()]):b(s.$greatest_fortune())?(i=T.randomizer.$roll_once(6),[W(i,2),i+","+i]):I(T,C(T,"rollDice",S,!1,!0),"rollDice",[s,m],null)}),d(y,"$growth",function(s){return null==s&&(s=1),j(e.Range.$new(1,s,!1),"map",[],function t(){return(null==t.$$s?this:t.$$s).$growth_step()},{$$s:this}).$join(" | ")},-1),d(y,"$growth_step",function(){var s=this,m=L,t=L,T=L;return t=(m=l(o("DiceTable"),"Table").$from_i18n("SwordWorld2_0.GrowthTable",s.locale)).$roll(s.randomizer),T=m.$roll(s.randomizer),A(t.$value(),T.$value())?"["+t.$value()+","+T.$value()+"]->("+t.$body()+" or "+T.$body()+")":"["+t.$value()+","+T.$value()+"]->("+t.$body()+")"}),d(y,"$get_fumble_table",function(){return l(o("DiceTable"),"Table").$from_i18n("SwordWorld2_0.FumbleTable",this.locale).$roll(this.randomizer)}),d(y,"$get_tangle_table",function(){return l(o("DiceTable"),"Table").$from_i18n("SwordWorld2_0.TangleTable",this.locale).$roll(this.randomizer)})},Opal.modules["bcdice/game_system/SwordWorld2_5"]=function(e){var L,K,R,g,z,h,y,n,p,k,Y=e.module,U=e.klass,c=e.const_set,I=e.eqeqeq,C=e.send,d=e.hash2,F=e.truthy,b=e.send2,N=e.find_super,M=e.def,E=e.range,Z=e.rb_plus,j=[],A=e.nil,q=e.$$$;return e.top.$require("bcdice/game_system/SwordWorld2_0"),L=j,K=k=[Y(j[0],"BCDice")].concat(L),n=[Y(k[0],"GameSystem")].concat(K),p=e.$r(n),R=n,z=[g=U(n[0],p("SwordWorld2_0"),"SwordWorld2_5")].concat(R),h=e.$r(z),(y=g.$$prototype).randomizer=y.locale=A,c(z[0],"ID","SwordWorld2.5"),c(z[0],"NAME","\u30bd\u30fc\u30c9\u30fb\u30ef\u30fc\u30eb\u30c92.5"),c(z[0],"SORT_KEY","\u305d\u304a\u3068\u308f\u3042\u308b\u30682.5"),c(z[0],"HELP_MESSAGE",'\u81ea\u52d5\u7684\u6210\u529f\u3001\u6210\u529f\u3001\u5931\u6557\u3001\u81ea\u52d5\u7684\u5931\u6557\u306e\u81ea\u52d5\u5224\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u30fb\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3000(Kx)\n\u3000"K\u30ad\u30fc\u30ca\u30f3\u30d0\u30fc+\u30dc\u30fc\u30ca\u30b9"\u306e\u5f62\u3067\u8a18\u5165\u3057\u307e\u3059\u3002\n\u3000\u30dc\u30fc\u30ca\u30b9\u306e\u90e8\u5206\u306b\u300cK20+K30\u300d\u306e\u3088\u3046\u306b\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u53d6\u308b\u3053\u3068\u306f\u51fa\u6765\u307e\u305b\u3093\u3002\n\u3000\u307e\u305f\u3001\u30dc\u30fc\u30ca\u30b9\u306f\u8907\u6570\u53d6\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3082\u30c0\u30a4\u30b9\u30ed\u30fc\u30eb\u3068\u540c\u69d8\u306b\u3001\u4ed6\u306e\u30d7\u30ec\u30a4\u30e4\u30fc\u306b\u96a0\u308c\u3066\u30ed\u30fc\u30eb\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n\u3000\u4f8b\uff09K20\u3000\u3000\u3000K10+5\u3000\u3000\u3000k30\u3000\u3000\u3000k10+10\u3000\u3000\u3000Sk10-1\u3000\u3000\u3000k10+5+2\n\n\u30fb\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u306e\u8a2d\u5b9a\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u306f"[\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024]"\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u3000\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306f\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u502410\u3068\u3057\u307e\u3059\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u51e6\u7406\u304c\u5fc5\u8981\u306a\u3044\u3068\u304d\u306f13\u306a\u3069\u3068\u3057\u3066\u304f\u3060\u3055\u3044\u3002(\u9632\u5fa1\u6642\u306a\u3069\u306e\u5bfe\u5fdc)\n\u3000\u307e\u305f\u30bf\u30a4\u30d7\u306e\u8efd\u6e1b\u5316\u306e\u305f\u3081\u306b\u672b\u5c3e\u306b\u300c@\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u300d\u3067\u3082\u51e6\u7406\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\u3000\u4f8b\uff09K20[10]\u3000\u3000\u3000K10+5[9]\u3000\u3000\u3000k30[10]\u3000\u3000\u3000k10[9]+10\u3000\u3000\u3000k10-5@9\n\n\u30fb\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u306e\u534a\u6e1b (HKx, KxH+N)\n\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u306e\u5148\u982d\u307e\u305f\u306f\u672b\u5c3e\u306b"H"\u3092\u3064\u3051\u308b\u3068\u3001\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3092\u632f\u3063\u3066\u6700\u7d42\u7d50\u679c\u3092\u534a\u6e1b\u3055\u305b\u307e\u3059\u3002\n\u3000\u672b\u5c3e\u306b\u3064\u3051\u305f\u5834\u5408\u3001\u76f4\u5f8c\u306b\u4fee\u6b63\u3092\u3092\u3064\u3051\u308b\u3053\u3068\u3067\u3001\u534a\u6e1b\u5f8c\u306e\u52a0\u6e1b\u7b97\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u3000\u3053\u306e\u969b\u3001\u8907\u6570\u306e\u9805\u306b\u3088\u308b\u4fee\u6b63\u306b\u306f\u30ab\u30c3\u30b3\u3067\u56f2\u3046\u3053\u3068\u304c\u5fc5\u8981\u3067\u3059\uff08\u30ab\u30c3\u30b3\u304c\u306a\u3044\u3068\u30d1\u30fc\u30b9\u306b\u5931\u6557\u3057\u307e\u3059\uff09\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u3092\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u306a\u3057\u3068\u6271\u308f\u308c\u307e\u3059\u3002\n\u3000\u4f8b\uff09HK20\u3000\u3000K20h\u3000\u3000HK10-5@9\u3000\u3000K10-5@9H\u3000\u3000K20gfH\u3000\u3000K20+8H+2\u3000\u3000K20+8H+(1+1)\n\n\u30fb\u30c0\u30a4\u30b9\u76ee\u306e\u4fee\u6b63\uff08\u904b\u547d\u5909\u8ee2\u3084\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u30ec\u30a4\u7528\uff09\n\u3000\u672b\u5c3e\u306b\u300c$\u4fee\u6b63\u5024\u300d\u3067\u30c0\u30a4\u30b9\u76ee\u306b\u4fee\u6b63\u304c\u304b\u304b\u308a\u307e\u3059\u3002\n\u3000$\uff0b\uff11\u3068\u4fee\u6b63\u8868\u8a18\u306a\u3089\u30c0\u30a4\u30b9\u76ee\u306b\uff0b\u4fee\u6b63\u3001\uff04\uff19\u306e\u3088\u3046\u306b\u56fa\u5b9a\u5024\u306a\u3089\u30c0\u30a4\u30b9\u76ee\u3092\u305d\u306e\u51fa\u76ee\u306b\u5dee\u3057\u66ff\u3048\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u3057\u305f\u5834\u5408\u3067\u3082\u56fa\u5b9a\u5024\u3084\u4fee\u6b63\u5024\u306e\u9069\u7528\u306f\u6700\u521d\u306e\u4e00\u56de\u3060\u3051\u3067\u3059\u3002\n\u3000\u4f8b\uff09K20$+1\u3000\u3000\u3000K10+5$9\u3000\u3000\u3000k10-5@9$+2\u3000\u3000\u3000k10[9]+10$9\n\n\u30fb\u30c0\u30a4\u30b9\u76ee\u306e\u4fee\u6b63\uff08\u5fc5\u6bba\u653b\u6483\u7528\uff09\n\u3000\u300c\uff03\u4fee\u6b63\u5024\u300d\u3067\u30c0\u30a4\u30b9\u76ee\u306b\u4fee\u6b63\u304c\u304b\u304b\u308a\u307e\u3059\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u3057\u305f\u5834\u5408\u3067\u3082\u4fee\u6b63\u5024\u306e\u9069\u7528\u306f\u7d99\u7d9a\u3055\u308c\u307e\u3059\u3002\n\u3000\u4f8b\uff09K20#1\u3000\u3000\u3000k10-5@9#2\n\n\u30fb\u9996\u5207\u308a\u5200\u7528\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u4e0a\u6607 r5\n\u3000\u4f8b\uff09K20r5\u3000K30+24@8R5\u3000K40+24@8$12r5\n\n\u30fb\u30b0\u30ec\u30a4\u30c6\u30b9\u30c8\u30d5\u30a9\u30fc\u30c1\u30e5\u30f3\u306f\u672b\u5c3e\u306b gf\n\u3000\u4f8b\uff09K20gf\u3000K30+24@8GF\u3000K40+24@8$12r5gf\n\n\u30fb\u5a01\u529b\u8868\u30921d+sf\u3067\u53c2\u7167 \u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5f8c\u3082\u7d99\u7d9a sf4\n\u3000\u4f8b\uff09k10sf4\u3000k0+5sf4@13\u3000k70+26sf3@9\n\n\u30fb\u5a01\u529b\u8868\u30921d+tf\u3067\u53c2\u7167 \u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5f8c\u306f2d\u3067\u53c2\u7167 tf3\n\u3000\u4f8b\uff09k10tf3\u3000k0+5tf4@13\u3000k70+26tf3@9\n\n\u30fb\u8d85\u8d8a\u5224\u5b9a\u7528\u306b2d6\u30ed\u30fc\u30eb\u306b 2D6@10 \u66f8\u5f0f\u3067\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u4ed8\u4e0e\u304c\u53ef\u80fd\u306b\u3002\n\u3000\u4f8b\uff092D6@10\u30002D6@10+11>=30\n\n\u30fb\u6210\u9577\u3000(Gr)\n\u3000\u672b\u5c3e\u306b\u6570\u5b57\u3092\u4ed8\u52a0\u3059\u308b\u3053\u3068\u3067\u3001\u8907\u6570\u56de\u306e\u6210\u9577\u3092\u307e\u3068\u3081\u3066\u884c\u3048\u307e\u3059\u3002\n\u3000\u4f8b\uff09Gr3\n\n\u30fb\u9632\u5fa1\u30d5\u30a1\u30f3\u30d6\u30eb\u8868\u3000(FT)\n\u3000\u9632\u5fa1\u30d5\u30a1\u30f3\u30d6\u30eb\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30fb\u7d61\u307f\u52b9\u679c\u8868\u3000(TT)\n\u3000\u7d61\u307f\u52b9\u679c\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30fb\u30c9\u30eb\u30a4\u30c9\u306e\u7269\u7406\u9b54\u6cd5\u7528\u8868\u3000(Dru[2-6\u306e\u5024,7-9\u306e\u5024,10-12\u306e\u5024])\n\u3000\u4f8b\uff09Dru[0,3,6]+10-3\n\n\u30fb\u30a2\u30d3\u30b9\u30ab\u30fc\u30b9\u8868\u3000(ABT)\n\u3000\u30a2\u30d3\u30b9\u30ab\u30fc\u30b9\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n'),g.$register_prefix("H?K","Gr","2D6?@\\d+","FT","TT","Dru","ABT"),M(g,"$eval_game_system_specific_command",function $(o){var s,S=this,m=A,T=A;return $.$$p=null,I(/^dru\[(\d+),(\d+),(\d+)\]/i,s=o)?(m=C(h("Regexp").$last_match().$captures(),"map",[],"to_i".$to_proc()),T=q(h("Command"),"Parser").$new(/dru\[\d+,\d+,\d+\]/i,d(["round_type"],{round_type:q(q(h("BCDice"),"RoundType"),"CEIL")})).$parse(o),F(T)?S.$druid_dice(T,m):A):I("ABT",s)?S.$get_abyss_curse_table():b(S,N(S,"eval_game_system_specific_command",$,!1,!0),"eval_game_system_specific_command",[o],null)}),M(g,"$rating_parser",function(){return h("RatingParser").$new(d(["version"],{version:"v2_5"}))}),M(g,"$druid_dice",function(o,f){var m,t,T,i,v,s=A;return m=(s=this.randomizer.$roll_barabara(2,6)).$sum(),t=I(E(2,6,!1),T=m)?0:I(E(7,9,!1),T)?1:I(E(10,12,!1),T)?2:A,i=f["$[]"](t),v=Z(i,o.$modify_number()),["("+o.$command().$capitalize()+h("Format").$modifier(o.$modify_number())+")","2D["+s.$join(",")+"]="+m,""+i+h("Format").$modifier(o.$modify_number()),v].$join(" \uff1e ")}),M(g,"$get_abyss_curse_table",function(){var s,o=this,f=A,S=A;return f=q(h("DiceTable"),"D66GridTable").$from_i18n("SwordWorld2_5.AbyssCurseTable",o.locale).$roll(o.randomizer),S=I(14,s=f.$value())?q(h("DiceTable"),"D66ParityTable").$from_i18n("SwordWorld2_5.AbyssCurseCategoryTable",o.locale).$roll(o.randomizer).$to_s():I(25,s)?q(h("DiceTable"),"D66ParityTable").$from_i18n("SwordWorld2_5.AbyssCurseAttrTable",o.locale).$roll(o.randomizer).$to_s():A,[f.$to_s(),S].$compact().$join("\n")})},Opal.queue(function(e){var E,A,_,K,r,u,L,W,Y=e.module,U=e.klass,c=e.const_set,I=e.send2,C=e.find_super,d=e.def,b=[];return e.top.$require("bcdice/game_system/SwordWorld2_5"),E=b,A=W=[Y(b[0],"BCDice")].concat(E),u=[Y(W[0],"GameSystem")].concat(A),L=e.$r(u),_=u,c((r=[K=U(u[0],L("SwordWorld2_5"),"SwordWorld2_5_SimplifiedChinese")].concat(_))[0],"ID","SwordWorld2.5:SimplifiedChinese"),c(r[0],"NAME","\u5251\u4e16\u754c2.5"),c(r[0],"SORT_KEY","\u56fd\u969b\u5316:Simplified Chinese:\u5251\u4e16\u754c2.5"),c(r[0],"HELP_MESSAGE","\u81ea\u52a8\u6210\u529f\u3001\u6210\u529f\u3001\u5931\u8d25\u3001\u81ea\u52a8\u5931\u8d25\u4f1a\u81ea\u52a8\u5224\u5b9a\u3002\n\n  \u30fb\u5a01\u529b\u8868\u3000(Kx)\n  \u3000\u6307\u4ee4\u4e3a\u201cK\u5a01\u529b\u503c+\u52a0\u503c\u201d\u7684\u683c\u5f0f\u3002\n  \u3000\u52a0\u503c\u7684\u90e8\u5206\u4e0d\u80fd\u662f\u50cf\u201cK20+K30\u201d\u8fd9\u6837\u7684\u5a01\u529b\u7684\u5199\u6cd5\u3002\n  \u3000\u53e6\u5916\uff0c\u52a0\u503c\u53ef\u4ee5\u6709\u591a\u4e2a\u3002\n  \u3000\u5a01\u529b\u8868\u548c\u9ab0\u70b9\u4e00\u6837\uff0c\u53ef\u4ee5\u5bf9\u5176\u4ed6\u73a9\u5bb6\u9690\u85cf\u3002\n  \u3000\u4f8b\uff09K20\u3000\u3000\u3000K10+5\u3000\u3000\u3000k30\u3000\u3000\u3000k10+10\u3000\u3000\u3000Sk10-1\u3000\u3000\u3000k10+5+2\n\n  \u30fb\u66b4\u51fb\u503c\u7684\u8bbe\u5b9a\n  \u3000\u66b4\u51fb\u503c\u901a\u8fc7\u201c[\u66b4\u51fb\u503c]\u201d\u6307\u5b9a\u3002\n  \u3000\u6ca1\u6709\u6307\u5b9a\u66b4\u51fb\u503c\u65f6\u9ed8\u8ba4\u4e3a10\u3002\n  \u3000\u5982\u679c\u4e0d\u9700\u8981\u53d1\u751f\u66b4\u51fb\uff0c\u8bf7\u8bbe\u5b9a\u4e3a13\u3002\uff08\u4f8b\u5982\u9632\u5fa1\u65f6\uff09\n  \u3000\u53e6\u5916\u4e5f\u53ef\u5199\u6210\u7ed3\u5c3e\u7684\u201c@\u66b4\u51fb\u503c\u201d\u7684\u5f62\u5f0f\u3002\n  \u3000\u4f8b\uff09K20[10]\u3000\u3000\u3000K10+5[9]\u3000\u3000\u3000k30[10]\u3000\u3000\u3000k10[9]+10\u3000\u3000\u3000k10-5@9\n\n  \u30fb\u5a01\u529b\u8868\u7684\u51cf\u534a (HKx, KxH+N)\n  \u3000\u5728\u5a01\u529b\u8868\u5f00\u5934\u6216\u672b\u5c3e\u52a0\u4e0a\u201cH\u201d\uff0c\u9ab0\u5a01\u529b\u8868\u7684\u6700\u7ec8\u7ed3\u679c\u5c31\u4f1a\u51cf\u534a\u3002\n  \u3000H\u5199\u5728\u5a01\u529b\u8868\u672b\u5c3e\u7684\u60c5\u51b5\u4e0b\u53ef\u4ee5\u5728\u540e\u9762\u76f4\u63a5\u8ddf\u7740\u4fee\u6b63\uff0c\u4f1a\u5728\u51cf\u534a\u540e\u8fdb\u884c\u52a0\u51cf\u8fd0\u7b97\u3002\n  \u3000\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u591a\u4e2a\u4fee\u6b63\u9700\u8981\u7528\u62ec\u53f7\u62ec\u8d77\u6765\uff08\u5426\u5219\u4f1a\u89e3\u6790\u5931\u8d25\uff09\n  \u3000\u6ca1\u6709\u6307\u5b9a\u66b4\u51fb\u503c\u7684\u60c5\u51b5\u4e0b\uff0c\u5219\u89c6\u4e3a\u6ca1\u6709\u66b4\u51fb\u503c\u3002\n  \u3000\u4f8b\uff09HK20\u3000\u3000K20h\u3000\u3000HK10-5@9\u3000\u3000K10-5@9H\u3000\u3000K20gfH\u3000\u3000K20+8H+2\u3000\u3000K20+8H+(1+1)\n\n  \u30fb\u9ab0\u5b50\u51fa\u76ee\u4fee\u6b63\uff08\u547d\u8fd0\u53d8\u8f6c\u6216\u91cd\u51fb\u5149\u8f89\u7528\uff09\n  \u3000\u5728\u6307\u4ee4\u672b\u5c3e\u6dfb\u52a0\u201c$\u4fee\u6b63\u503c\u201d\u6765\u6539\u53d8\u9ab0\u5b50\u51fa\u76ee\u3002\n  \u3000\u53ef\u4ee5\u4f7f\u7528$+1\u7684\u683c\u5f0f\u5728\u9ab0\u5b50\u51fa\u76ee\u4e0a+\u4fee\u6b63\uff0c\u6216\u4f7f\u7528$9\u7684\u683c\u5f0f\u628a\u9ab0\u5b50\u51fa\u76ee\u66ff\u6362\u4e3a\u56fa\u5b9a\u503c\u3002\n  \u3000\u66b4\u51fb\u65f6\u53ea\u6709\u7b2c\u4e00\u6b21\u51fa\u76ee\u5e94\u7528\u8fd9\u4e2a\u4fee\u6b63\u3002\n  \u3000\u4f8b\uff09K20$+1\u3000\u3000\u3000K10+5$9\u3000\u3000\u3000k10-5@9$+2\u3000\u3000\u3000k10[9]+10$9\n\n  \u30fb\u9ab0\u5b50\u51fa\u76ee\u4fee\u6b63\uff08\u5fc5\u6740\u653b\u51fb\u7528\uff09\n  \u3000\u5199\u6210\u201c#\u4fee\u6b63\u503c\u201c\u7684\u683c\u5f0f\u6765\u589e\u52a0\u9ab0\u5b50\u51fa\u76ee\u3002\n  \u3000\u66b4\u51fb\u65f6\u540e\u7eed\u9ab0\u5b50\u4e5f\u4f1a\u7ee7\u7eed\u5e94\u7528\u4fee\u6b63\u503c\u3002\n  \u3000\u4f8b\uff09K20#1\u3000\u3000\u3000k10-5@9#2\n\n  \u30fb\u5a01\u529b\u4e0a\u5347\uff08\u65a9\u9996\u5200\u7528\uff09 r5\n  \u3000r\u540e\u8ddf\u4e0a\u5347\u503c\uff0c\u66b4\u51fb\u540e\u5a01\u529b\u4e0a\u5347r\u540e\u6240\u586b\u5199\u7684\u4e0a\u5347\u503c\u70b9\n  \u3000\u4f8b\uff09K20r5\u3000K30+24@8R5\u3000K40+24@8$12r5\n\n  \u30fb\u6781\u9650\u547d\u8fd0\u5728\u672b\u5c3e\u52a0\u4e0a gf\n  \u3000\u4f8b\uff09K20gf\u3000K30+24@8GF\u3000K40+24@8$12r5gf\n\n  \u30fb\u5a01\u529b\u8868\u4f7f\u75281d+\u56fa\u5b9a\u503c\u5bf9\u5e94 \u66b4\u51fb\u540e\u4ecd\u7ee7\u7eed sf4\n  \u3000\u4f8b\uff09k10sf4\u3000k0+5sf4@13\u3000k70+26sf3@9\n\n  \u30fb\u5a01\u529b\u8868\u4f7f\u75281d+\u56fa\u5b9a\u503c\u5bf9\u5e94 \u66b4\u51fb\u540e\u53d8\u56de\u4f7f\u75282d\u5bf9\u5e94 tf3\n  \u3000\u4f8b\uff09k10tf3\u3000k0+5tf4@13\u3000k70+26tf3@9\n\n  \u30fb\u8d85\u8d8a\u5224\u5b9a\u75282d6\u53ef\u5199\u6210 2d6@10 \u7684\u683c\u5f0f\u52a0\u4e0a\u66b4\u51fb\u503c\u3002\n  \u3000\u4f8b\uff092D6@10\u30002D6@10+11>=30\n\n  \u30fb\u6210\u957f\u3000(Gr)\n  \u3000\u5728Gr\u540e\u9762\u52a0\u4e0a\u6570\u5b57\u53ef\u4ee5\u8fdb\u884c\u591a\u6b21\u6210\u957f\u3002\n  \u3000\u4f8b\uff09Gr3\n\n  \u30fb\u9632\u5fa1\u5927\u5931\u8d25\u8868\u3000(FT)\n  \u3000\u62bd\u53d6\u9632\u5fa1\u5927\u5931\u8d25\u8868\u3002\n\n  \u30fb\u7f20\u7ed5\u6548\u679c\u8868\u3000(TT)\n  \u3000\u62bd\u53d6\u7f20\u7ed5\u6548\u679c\u8868\u3002\n\n  \u30fb\u5fb7\u9c81\u4f0a\u7528\u7269\u7406\u9b54\u6cd5\u8868 (Dru[2~6\u7684\u7ed3\u679c\uff0c7~9\u7684\u7ed3\u679c\uff0c10~12\u7684\u7ed3\u679c])\n  \u3000\u4f8b\uff09Dru[0,3,6]+10-3\n\n  \u30fb\u5948\u843d\u8bc5\u5492\u8868\u3000(ABT)\n  \u3000\u62bd\u53d6\u5948\u843d\u8bc5\u5492\u8868\u3002\n"),K.$register_prefix_from_super_class(),d(K,"$initialize",function n(p){var P=this;return n.$$p=null,I(P,C(P,"initialize",n,!1,!0),"initialize",[p],null),P.locale="zh_hans"})})}}]);