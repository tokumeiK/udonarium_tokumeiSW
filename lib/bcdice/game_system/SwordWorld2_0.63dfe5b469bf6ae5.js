(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[7043],{3840:(ye,pe,ge)=>{ge(9993),Opal.modules["bcdice/arithmetic_evaluator"]=function(e){var F,G,a,l,p,U,z,Z,Y=e.module,H=e.ensure_kwargs,c=e.truthy,L=e.thrower,P=e.def,o=[],K=e.nil,b=e.$$$;return F=o,G=Z=[Y(o[0],"BCDice")].concat(F),z=[U=Y(Z[0],"ArithmeticEvaluator")].concat(G),l=[a=e.get_singleton_class(U)].concat(z),p=e.$r(l),P(a,"$eval",function(I,r){try{L("eval_return");var y,M=K;return null==(y=(r=H(r)).$$smap.round_type)&&(y=b(p("RoundType"),"FLOOR")),c(I)&&c(M=p("Arithmetic").$eval(I,y))?M:0}catch(N){if(N===e.t_eval_return)return N.$v;throw N}},-2)},Opal.modules["i18n/backend/fallbacks"]=function(e){var B,_,r,n,l,p,Y=e.module,H=e.class_variable_set,c=e.truthy,L=e.class_variable_get,P=e.def,o=e.send,K=e.send2,b=e.find_super,A=e.hash2,F=e.find_block_super,D=e.neqeq,Z=e.thrower,j=e.return_val,G=[],U=e.nil,z=e.$$$;return B=G,p=[l=Y(G[0],"I18n")].concat(B),H(p[0],"@@fallbacks",U),_=e.get_singleton_class(l),r=[_].concat(p),n=e.$r(r),P(_,"$fallbacks",function(){var N=U;return H(r[1],"@@fallbacks",c(null!=r[1].$$cvars["@@fallbacks"]?"class variable":U)&&c(N=L(r[1],"@@fallbacks",!1))?N:z(z(n("I18n"),"Locale"),"Fallbacks").$new()),c(N=n("Thread").$current()["$[]"]("i18n_fallbacks"))?N:L(r[1],"@@fallbacks",!1)}),P(_,"$fallbacks=",function(M){var N;return H(r[1],"@@fallbacks",c(M["$is_a?"](n("Array")))?z(z(n("I18n"),"Locale"),"Fallbacks").$new(M):M),N=["i18n_fallbacks",L(r[1],"@@fallbacks",!1)],o(n("Thread").$current(),"[]=",N),N[N.length-1]}),function(_,I){var M,N,w,k,n=[Y(_,"Backend")].concat(I);return M=n,w=[N=Y(n[0],"Fallbacks")].concat(M),k=e.$r(w),P(N,"$translate",function E(h,g,s){try{var d=Z("return"),f=E.$$p||U,S=this,u=U,v=U;return E.$$p=null,null==s&&(s=k("EMPTY_HASH")),c(s.$fetch("fallback",!0))?c(s["$[]"]("fallback_in_progress"))?K(S,b(S,"translate",E,!1,!0),"translate",[h,g,s],f):(c(s["$[]"]("default"))&&(u=S["$extract_non_symbol_default!"](s)),v=s.$merge(A(["fallback_in_progress"],{fallback_in_progress:!0})),o(k("I18n").$fallbacks()["$[]"](h),"each",[],function t(T){var i=null==t.$$s?this:t.$$s;null==T&&(T=U);try{return o(i,"catch",["exception"],function m(){var $=null==m.$$s?this:m.$$s,X=U;if(X=K($,F($,"translate",m.$$def||t.$$def||E,!1,!1),"translate",[T,g,v],null),c(X["$nil?"]()))return U;D(h.$to_s(),T.$to_s())&&$.$on_fallback(h,T,g,s),d.$throw(X)},{$$s:i,$$ret:d})}catch(m){if(!e.rescue(m,[z(k("I18n"),"InvalidLocale")]))throw m;try{return U}finally{e.pop_exception()}}},{$$s:S}),c(s["$key?"]("default"))&&c(s["$[]"]("default")["$nil?"]())?U:c(u)?K(S,b(S,"translate",E,!1,!0),"translate",[h,U,s.$merge(A(["default"],{default:u}))],null):S.$throw("exception",z(k("I18n"),"MissingTranslation").$new(h,g,s))):K(S,b(S,"translate",E,!1,!0),"translate",[h,g,s],f)}catch(t){if(t===d)return t.$v;throw t}},-3),P(N,"$extract_non_symbol_default!",function(h){var s,g=U;return g=[h["$[]"]("default")].$flatten(),s=o(g,"detect",[],function(f){return null==f&&(f=U),f["$is_a?"](k("Symbol"))["$!"]()}),c(s)&&h["$[]="]("default",g["$[]"](0,g.$index(s))),s}),P(N,"$exists?",function E(h,g,s){try{var d=Z("return"),f=E.$$p||U,S=this;return E.$$p=null,null==s&&(s=k("EMPTY_HASH")),c(s.$fetch("fallback",!0))?(o(k("I18n").$fallbacks()["$[]"](h),"each",[],function u(v){var t=null==u.$$s?this:u.$$s;null==v&&(v=U);try{if(!c(K(t,F(t,"exists?",u.$$def||E,!1,!1),"exists?",[v,g],null)))return U;d.$throw(!0)}catch(T){if(!e.rescue(T,[z(k("I18n"),"InvalidLocale")]))throw T;try{return U}finally{e.pop_exception()}}},{$$s:S,$$ret:d}),!1):K(S,b(S,"exists?",E,!1,!0),"exists?",[h,g,s],f)}catch(u){if(u===d)return u.$v;throw u}},-3),N.$private(),P(N,"$on_fallback",j(U))}(p[0],p)},Opal.modules["bcdice/randomizer"]=function(e){var l,y,M,N,w,k,_,I,H=e.klass,c=e.const_set,L=e.def,P=e.truthy,o=e.rb_gt,K=e.rb_plus,b=e.rb_le,A=e.send,F=e.rb_minus,D=e.eqeq,Z=e.rb_times,j=e.eqeqeq,G=e.rb_ge,U=[],z=e.nil,a=e.$$$;return l=U,_=[(0,e.module)(U[0],"BCDice")].concat(l),I=e.$r(_),y=_,N=[M=H(_[0],null,"Randomizer")].concat(y),w=e.$r(N),(k=M.$$prototype).rand_results=k.detailed_rand_results=z,c(N[0],"UPPER_LIMIT_DICE_TIMES",200),c(N[0],"UPPER_LIMIT_DICE_SIDES",1e4),c(N[0],"UPPER_LIMIT_RANDS",1e4),L(M,"$initialize",function(){return this.rand_results=[],this.detailed_rand_results=[]}),M.$attr_reader("rand_results"),M.$attr_reader("detailed_rand_results"),c(N[0],"DetailedRandResult",w("Struct").$new("kind","sides","value")),L(M,"$roll_barabara",function(h,g){var s=this;return P(o(K(s.rand_results.$size(),h),w("UPPER_LIMIT_RANDS")))&&s.$raise(w("TooManyRandsError")),P(b(h,0))||P(o(h,w("UPPER_LIMIT_DICE_TIMES")))?[]:A(w("Array"),"new",[h],function d(){return(null==d.$$s?this:d.$$s).$roll_once(g)},{$$s:s})}),L(M,"$roll_sum",function(h,g){return this.$roll_barabara(h,g).$sum()}),L(M,"$roll_once",function(h){var s=z;return P(b(h,0))||P(o(h,w("UPPER_LIMIT_DICE_SIDES")))?0:(s=this.$rand_inner(h),this.$push_to_detail("normal",h,s),s)}),L(M,"$roll_index",function(h){return F(this.$roll_once(h),1)}),L(M,"$roll_tens_d10",function(){var s,g=z;return g=this.$rand_inner(10),D(g,10)&&(g=0),s=Z(g,10),this.$push_to_detail("tens_d10",10,s),s}),L(M,"$roll_d9",function(){var g;return g=F(this.$rand_inner(10),1),this.$push_to_detail("d9",10,g),g}),L(M,"$roll_d66",function(h){var d,s=z;return s=A(w("Array"),"new",[2],function f(){return(null==f.$$s?this:f.$$s).$roll_once(6)},{$$s:this}),j(a(w("D66SortType"),"ASC"),d=h)?s["$sort!"]():j(a(w("D66SortType"),"DESC"),d)&&s["$sort!"]()["$reverse!"](),K(Z(s["$[]"](0),10),s["$[]"](1))}),M.$private(),L(M,"$rand_inner",function(h){var s,g=this;return P(G(g.rand_results.$size(),w("UPPER_LIMIT_RANDS")))&&g.$raise(w("TooManyRandsError")),s=g.$random(h),g.rand_results["$<<"]([s,h]),s}),L(M,"$random",function(h){return K(w("Kernel").$rand(h),1)}),L(M,"$push_to_detail",function(h,g,s){var f;return f=w("DetailedRandResult").$new(h,g,s),this.detailed_rand_results.$push(f)}),H(_[0],I("StandardError"),"TooManyRandsError"),z},Opal.modules["bcdice/dice_table/roll_result"]=function(e){var A,j,B,l,p,_,I,U,D,Y=e.module,H=e.klass,c=e.def,L=e.truthy,P=e.return_val,o=[],K=e.nil;return A=o,j=D=[Y(o[0],"BCDice")].concat(A),B=U=[Y(D[0],"DiceTable")].concat(j),p=[l=H(U[0],null,"RollResult")].concat(B),_=e.$r(p),(I=l.$$prototype).table_name=I.value=I.body=K,c(l,"$initialize",function(n,y,M){var N=this;return N.table_name=n,N.value=y,N.body=M}),l.$attr_reader("table_name"),l.$attr_reader("value"),l.$attr_reader("body"),c(l,"$to_s",function(){var n=this;return n.table_name+"("+n.value+") \uff1e "+n.body}),c(l,"$last_body",function(){var n=this;return L(n.body["$is_a?"](_("RollResult")))?n.body.$last_body():n.body}),c(l,"$empty?",P(!1))},Opal.modules["bcdice/dice_table/chain_table"]=function(e){var A,j,B,l,p,_,I,U,D,Y=e.module,H=e.klass,c=e.truthy,L=e.def,P=e.rb_minus,o=[],K=e.nil;return A=o,j=D=[Y(o[0],"BCDice")].concat(A),B=U=[Y(D[0],"DiceTable")].concat(j),p=[l=H(U[0],null,"ChainTable")].concat(B),_=e.$r(p),(I=l.$$prototype).times=I.sides=I.items=I.name=K,L(l,"$initialize",function(n,y,M){var N=this,w=K;return N.name=n,N.items=M.$freeze(),w=/(\d+)D(\d+)/i.$match(y),c(w)||N.$raise(_("ArgumentError"),"Unexpected table type: "+y),N.times=w["$[]"](1).$to_i(),N.sides=w["$[]"](2).$to_i()}),L(l,"$roll",function(n){var M,N,y=this,w=K;return M=n.$roll_sum(y.times,y.sides),N=P(M,y.times),w=y.items["$[]"](N),c(w["$respond_to?"]("roll"))&&(w=w.$roll(n)),_("RollResult").$new(y.name,M,w)})},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(e){var Z,z,_,I,r,n,y,B,G,Y=e.module,H=e.klass,c=e.hash2,L=e.defs,P=e.def,o=e.rb_plus,K=e.rb_times,b=e.rb_minus,A=[],F=e.nil;return Z=A,z=G=[Y(A[0],"BCDice")].concat(Z),_=B=[Y(G[0],"DiceTable")].concat(z),r=[I=H(B[0],null,"D66GridTable")].concat(_),n=e.$r(r),(y=I.$$prototype).name=y.items=F,L(I,"$from_i18n",function(N,w){var E=F;return E=n("I18n").$t(N,c(["locale","raise"],{locale:w,raise:!0})),this.$new(E["$[]"]("name"),E["$[]"]("items"))}),P(I,"$initialize",function(N,w){return this.name=N,this.items=w.$freeze()}),P(I,"$roll",function(N){var k,E,h,g,s;return k=N.$roll_once(6),E=N.$roll_once(6),h=o(K(k,10),E),g=b(k,1),s=b(E,1),n("RollResult").$new(this.name,h,this.items["$[]"](g)["$[]"](s))})},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(e){var F,G,p,_,I,r,z,a,Z,Y=e.module,H=e.klass,c=e.hash2,L=e.defs,P=e.def,K=[],b=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),F=K,G=Z=[Y(K[0],"BCDice")].concat(F),z=[Y(Z[0],"DiceTable")].concat(G),a=e.$r(z),p=z,I=[_=H(z[0],a("D66GridTable"),"D66HalfGridTable")].concat(p),r=e.$r(I),L(_,"$from_i18n",function(y,M){var w=b;return w=r("I18n").$t(y,c(["locale","raise"],{locale:M,raise:!0})),this.$new(w["$[]"]("name"),w["$[]"]("items_1_2_3"),w["$[]"]("items_4_5_6"))}),P(_,"$initialize",function(y,M,N){return this.name=y,this.items=[M,M,M,N,N,N].$freeze()})},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(e){var F,G,p,_,I,r,z,a,Z,Y=e.module,H=e.klass,c=e.hash2,L=e.defs,P=e.def,K=[],b=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),F=K,G=Z=[Y(K[0],"BCDice")].concat(F),z=[Y(Z[0],"DiceTable")].concat(G),a=e.$r(z),p=z,I=[_=H(z[0],a("D66GridTable"),"D66OneThirdTable")].concat(p),r=e.$r(I),L(_,"$from_i18n",function(y,M){var w=b;return w=r("I18n").$t(y,c(["locale","raise"],{locale:M,raise:!0})),this.$new(w["$[]"]("name"),w["$[]"]("items_1_2"),w["$[]"]("items_3_4"),w["$[]"]("items_5_6"))}),P(_,"$initialize",function(y,M,N,w){return this.name=y,this.items=[M,M,N,N,w,w].$freeze()})},Opal.modules["bcdice/dice_table/d66_table"]=function(e){var G,B,r,n,y,M,N,p,z,Y=e.module,H=e.klass,c=e.hash2,L=e.defs,P=e.def,o=e.eqeqeq,K=e.rb_plus,b=e.rb_times,A=e.truthy,F=[],D=e.nil,Z=e.$$$;return G=F,B=z=[Y(F[0],"BCDice")].concat(G),r=p=[Y(z[0],"DiceTable")].concat(B),y=[n=H(p[0],null,"D66Table")].concat(r),M=e.$r(y),(N=n.$$prototype).sort_type=N.items=N.name=D,L(n,"$from_i18n",function(k,E){var s,g=D;return g=M("I18n").$t(k,c(["locale"],{locale:E})),s=M("D66SortType").$const_get(g["$[]"]("d66_sort_type")),this.$new(g["$[]"]("name"),s,g["$[]"]("items"))}),P(n,"$initialize",function(k,E,h){var g=this;return g.name=k,g.sort_type=E,g.items=h.$freeze()}),P(n,"$roll",function(k){var E=this,h=D,g=D,s=D,d=D;return h=k.$roll_barabara(2,6),o(Z(M("D66SortType"),"ASC"),g=E.sort_type)?h["$sort!"]():o(Z(M("D66SortType"),"DESC"),g)&&h["$sort!"]()["$reverse!"](),s=K(b(h["$[]"](0),10),h["$[]"](1)),d=A(g=E.items["$[]"](s))?g:E.items["$[]"](s.$to_s()),A(d["$respond_to?"]("roll"))&&(d=d.$roll(k)),M("RollResult").$new(E.name,s,d)}),P(n,"$choice",function(k){return M("RollResult").$new(this.name,k,this.items["$[]"](k))})},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(e){var U,l,_,I,a,Y=e.module,H=e.klass,c=e.hash2,L=e.send,P=e.to_ary,o=e.rb_plus,K=e.rb_times,b=e.send2,A=e.find_super,F=e.def,Z=[],j=e.nil;return e.top.$require("bcdice/dice_table/d66_table"),U=Z,l=a=[Y(Z[0],"BCDice")].concat(U),_=[Y(a[0],"DiceTable")].concat(l),I=e.$r(_),F(H(_[0],I("D66Table"),"D66LeftRangeTable"),"$initialize",function M(N,w,k){var g;return M.$$p=null,g=c([],{}),L(k,"each",[],function(d){var f,v;return null==d&&(d=j),f=P(d),v=null==f[1]?j:f[1],L(null==f[0]?j:f[0],"each",[],function(T){return null==T&&(T=j),L(v,"each_with_index",[],function(m,$){var X,te;return null==m&&(m=j),null==$&&($=j),te=o(K(T,10),o($,1)),L(g,"[]=",X=[te,m]),X[X.length-1]})})}),b(this,A(this,"initialize",M,!1,!0),"initialize",[N,w,g],null)})},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(e){var j,a,I,r,n,y,M,l,U,Y=e.module,H=e.klass,c=e.hash2,L=e.defs,P=e.def,o=e.truthy,K=e.rb_minus,b=e.rb_plus,A=e.rb_times,F=[],D=e.nil;return j=F,a=U=[Y(F[0],"BCDice")].concat(j),I=l=[Y(U[0],"DiceTable")].concat(a),n=[r=H(l[0],null,"D66ParityTable")].concat(I),y=e.$r(n),(M=r.$$prototype).odd=M.even=M.name=D,L(r,"$from_i18n",function(w,k){var h=D;return h=y("I18n").$t(w,c(["locale","raise"],{locale:k,raise:!0})),this.$new(h["$[]"]("name"),h["$[]"]("odd"),h["$[]"]("even"))}),P(r,"$initialize",function(w,k,E){var h=this;return h.name=w,h.odd=k.$freeze(),h.even=E.$freeze()}),P(r,"$roll",function(w){var h,s,d,k=this,E=D;return E=w.$roll_once(6),h=w.$roll_once(6),s=(o(E["$odd?"]())?k.odd:k.even)["$[]"](K(h,1)),d=b(A(E,10),h),y("RollResult").$new(k.name,d,s)})},Opal.modules["bcdice/dice_table/d66_range_table"]=function(e){var F,G,l,p,_,I,r,z,Z,Y=e.module,H=e.klass,c=e.def,L=e.rb_plus,P=e.rb_times,o=e.send,K=[],b=e.nil;return F=K,G=Z=[Y(K[0],"BCDice")].concat(F),l=z=[Y(Z[0],"DiceTable")].concat(G),_=[p=H(z[0],null,"D66RangeTable")].concat(l),I=e.$r(_),(r=p.$$prototype).items=r.name=b,c(p,"$initialize",function(y,M){return this.name=y,this.items=M.$freeze()}),c(p,"$roll",function(y){var N,w,k,E=b;return N=y.$roll_once(6),w=y.$roll_once(6),k=L(P(N,10),w),E=o(this.items,"find",[],function(g){return null==g&&(g=b),g["$[]"](0)["$include?"](k)}),I("RollResult").$new(this.name,k,E["$[]"](1))})},Opal.modules["bcdice/dice_table/range_table"]=function(e){var j,a,I,r,n,y,M,l,U,Y=e.module,H=e.klass,c=e.const_set,L=e.send,P=e.truthy,o=e.def,K=e.eqeqeq,b=e.rb_times,A=e.rb_plus,F=[],D=e.nil;return j=F,a=U=[Y(F[0],"BCDice")].concat(j),I=l=[Y(U[0],"DiceTable")].concat(a),n=[r=H(l[0],null,"RangeTable")].concat(I),y=e.$r(n),(M=r.$$prototype).name=M.items=M.num_of_dice=M.num_of_sides=M.formatter=D,c(n[0],"RollResult",L(y("Struct"),"new",["sum","values","content","formatted"],function N(){return(null==N.$$s?this:N.$$s).$alias_method("to_s","formatted")},{$$s:r})),c(n[0],"Item",y("Struct").$new("range","content")),c(n[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),c(n[0],"DEFAULT_FORMATTER",L(r,"lambda",[],function(w,k){return null==w&&(w=D),null==k&&(k=D),w.$name()+"("+k.$sum()+") \uff1e "+k.$content()})),r.$attr_reader("name"),r.$attr_reader("num_of_dice"),r.$attr_reader("num_of_sides"),o(r,"$initialize",function N(w,k,E){var s,h=N.$$p||D,g=this,d=D;return N.$$p=null,g.name=w.$freeze(),g.formatter=P(s=h)?s:y("DEFAULT_FORMATTER"),d=y("DICE_ROLL_METHOD_RE").$match(k),P(d)||g.$raise(y("ArgumentError"),g.name+": invalid dice roll method: "+k),g.num_of_dice=d["$[]"](1).$to_i(),g.num_of_sides=d["$[]"](2).$to_i(),g.$store(E)}),o(r,"$fetch",function(w){var E,k=this;return E=L(k.items,"find",[],function(g){return null==g&&(g=D),g.$range()["$include?"](w)}),P(E)||k.$raise(y("RangeError"),k.name+": value is out of range: "+w),E}),o(r,"$roll",function(w){var h,k=this,E=D,g=D;return h=(E=w.$roll_barabara(k.num_of_dice,k.num_of_sides)).$sum(),(g=y("RollResult").$new(h,E,k.$fetch(h).$content()))["$formatted="](k.formatter["$[]"](k,g)),g}),r.$private(),o(r,"$store",function(w){var E,h,k=this;return E=L(w,"map",[],function g(s,d){return null==s&&(s=D),null==d&&(d=D),[(null==g.$$s?this:g.$$s).$coerce_to_int_range(s),d]},{$$s:k}),h=L(E,"sort_by",[],function(s,d){return null==s&&(s=D),null==d&&(d=D),s.$min()}),k.$assert_min_sum_is_covered(h),k.$assert_max_sum_is_covered(h),k.$assert_no_gap_or_overlap_in_ranges(h),k.items=L(h,"map",[],function(s,d){return null==s&&(s=D),null==d&&(d=D),y("Item").$new(s,d.$freeze()).$freeze()}).$freeze(),k}),o(r,"$coerce_to_int_range",function(w){var E;return K(y("Integer"),E=w)?y("Range").$new(w,w):K(y("Range"),E)&&P(w.$begin()["$is_a?"](y("Integer")))&&P(w.$end()["$is_a?"](y("Integer")))?w:this.$raise(y("TypeError"),this.name+": "+w+" ("+w.$class()+") must be an Integer or a Range with Integers ")}),o(r,"$assert_min_sum_is_covered",function(w){var E,k=this,h=D;return E=k.num_of_dice,h=w.$first()["$[]"](0),P(h["$include?"](E))||k.$raise(y("RangeError"),k.name+": min value ("+E+") is not covered: "+h),k}),o(r,"$assert_max_sum_is_covered",function(w){var E,k=this,h=D;return E=b(k.num_of_dice,k.num_of_sides),h=w.$last()["$[]"](0),P(h["$include?"](E))||k.$raise(y("RangeError"),k.name+": max value ("+E+") is not covered: "+h),k}),o(r,"$assert_no_gap_or_overlap_in_ranges",function(w){return L(w,"each_cons",[2],function E(h,g){var S,u,s=null==E.$$s?this:E.$$s,d=D,f=D;return null==s.name&&(s.name=D),null==h&&(h=D),null==g&&(g=D),d=h["$[]"](0),f=g["$[]"](0),S=d.$max(),u=A(S,1),P(f["$include?"](S))&&s.$raise(y("RangeError"),s.name+": Range overlap: "+d+" and "+f),P(f["$include?"](u))?D:s.$raise(y("RangeError"),s.name+": Range gap: "+d+" and "+f)},{$$s:this}),this})},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(e){var D,U,p,y,M,N,w,I,a,j,Y=e.module,H=e.klass,c=e.send,L=e.def,P=e.rb_minus,o=e.return_ivar,K=[],b=e.nil,A=e.$$$;return D=K,U=j=[Y(K[0],"BCDice")].concat(D),p=a=[Y(j[0],"DiceTable")].concat(U),y=I=[H(a[0],null,"SaiFicSkillTable")].concat(p),N=[M=H(I[0],null,"Category")].concat(y),w=e.$r(N),L(M,"$initialize",function(E,h,g,s){var d=this;return d.name=E,d.skills=c(h.$map(),"with_index",[2],function(S,u){return null==S&&(S=b),null==u&&(u=b),A(w("SaiFicSkillTable"),"Skill").$new(E,S,g,u,s)}),d.dice=g}),L(M,"$roll",function(E){return this.$skills()["$[]"](P(E.$roll_sum(2,6),2))}),L(M,"$to_s",o("name")),M.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(e){var b,Z,a,I,r,l,G,F,Y=e.module,H=e.klass,c=e.def,L=e.hash2,P=[],o=e.nil;return b=P,Z=F=[Y(P[0],"BCDice")].concat(b),a=G=[Y(F[0],"DiceTable")].concat(Z),l=[H(G[0],null,"SaiFicSkillTable")].concat(a),(r=(I=H(l[0],null,"Skill")).$$prototype).s_format=r.category_dice=r.row_dice=r.category_name=r.name=o,c(I,"$initialize",function(y,M,N,w,k){var E=this;return E.category_name=y,E.name=M,E.category_dice=N,E.row_dice=w,E.s_format=k}),c(I,"$to_s",function(){var y=this;return y.$format(y.s_format,L(["category_dice","row_dice","category_name","skill_name"],{category_dice:y.category_dice,row_dice:y.row_dice,category_name:y.category_name,skill_name:y.name}))}),I.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(e){var l,r,w,k,E,h,g,y,_,Y=e.module,H=e.klass,c=e.ensure_kwargs,L=e.hash2,P=e.send,K=e.defs,b=e.const_set,A=e.to_ary,F=e.def,D=e.truthy,Z=e.rb_minus,j=e.rb_plus,G=e.top,U=[],z=e.nil,a=e.$$$;return G.$require("bcdice/dice_table/sai_fic_skill_table/category"),G.$require("bcdice/dice_table/sai_fic_skill_table/skill"),l=U,r=_=[Y(U[0],"BCDice")].concat(l),w=y=[Y(_[0],"DiceTable")].concat(r),E=[k=H(y[0],null,"SaiFicSkillTable")].concat(w),h=e.$r(E),(g=k.$$prototype).rtt=g.rtt_format=g.rct=g.rct_format=g.rttn=g.rttn_format=g.categories=z,K(k,"$from_i18n",function(d,f,S){var u,v,t,$,m=z;return null==(u=(S=c(S)).$$smap.rtt)&&(u=z),null==(v=S.$$smap.rct)&&(v=z),null==(t=S.$$smap.rttn)&&(t=z),$=(m=h("I18n").$t("RTT",L(["locale","raise","default"],{locale:f,raise:!1,default:L([],{})})).$merge(h("I18n").$t(d,L(["locale","raise"],{locale:f,raise:!0}))))["$[]"]("items"),m=P(m,"select",[],function(te,O){return null==te&&(te=z),null==O&&(O=z),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](te)}),this.$new($,e.to_hash(m).$merge(L(["rtt","rct","rttn"],{rtt:u,rct:v,rttn:t})))},-3),b(E[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),b(E[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),b(E[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),b(E[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),F(k,"$initialize",function(d,f){var S,u,v,t,T,i,m,$=this;return null==(S=(f=c(f)).$$smap.rtt)&&(S=z),null==(u=f.$$smap.rct)&&(u=z),null==(v=f.$$smap.rttn)&&(v=z),null==(t=f.$$smap.rtt_format)&&(t=h("DEFAULT_RTT")),null==(T=f.$$smap.rct_format)&&(T=h("DEFAULT_RCT")),null==(i=f.$$smap.rttn_format)&&(i=h("DEFAULT_RTTN")),null==(m=f.$$smap.s_format)&&(m=h("DEFAULT_S")),$.categories=P(d.$map(),"with_index",[1],function(te,O){var ue,ce,se;return null==te&&(te=z),null==O&&(O=z),ce=null==(ue=A(te))[0]?z:ue[0],se=null==ue[1]?z:ue[1],a(h("SaiFicSkillTable"),"Category").$new(ce,se,O,m)},{$$has_top_level_mlhs_arg:!0}),$.rtt=S,$.rct=u,$.rttn=v.$to_a(),$.rtt_format=t,$.rct_format=T,$.rttn_format=i},-2),b(E[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),k.$attr_reader("categories"),F(k,"$roll_command",function(d,f){var u,S=this,v=z,t=z;return D(["RTT",S.rtt]["$include?"](u=f))?S.$format_skill(S.rtt_format,S.$roll_skill(d)):D(["RCT",S.rct]["$include?"](u))?(v=S.$roll_category(d),S.$format(S.rct_format,L(["category_dice","category_name"],{category_dice:v.$dice(),category_name:v.$name()}))):D(t=h("RTTN").$index(u))||D(t=S.rttn.$index(u))?S.$format_skill(S.rttn_format,S.categories["$[]"](t).$roll(d)):z}),F(k,"$roll_category",function(d){return this.categories["$[]"](Z(d.$roll_once(6),1))}),F(k,"$roll_skill",function(d){return this.$roll_category(d).$roll(d)}),F(k,"$prefixes",function(){var d=this;return j(["RTT[1-6]?","RCT",d.rtt,d.rct],d.rttn).$compact()}),k.$private(),F(k,"$format_skill",function(d,f){return this.$format(d,L(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:f.$category_dice(),row_dice:f.$row_dice(),category_name:f.$category_name(),skill_name:f.$name(),text:f.$to_s()}))})},Opal.modules["bcdice/dice_table/table"]=function(e){var D,U,p,_,I,r,n,a,j,Y=e.module,H=e.klass,c=e.hash2,L=e.defs,P=e.truthy,o=e.def,K=e.rb_minus,b=[],A=e.nil;return D=b,U=j=[Y(b[0],"BCDice")].concat(D),p=a=[Y(j[0],"DiceTable")].concat(U),I=[_=H(a[0],null,"Table")].concat(p),r=e.$r(I),(n=_.$$prototype).times=n.sides=n.name=n.items=A,L(_,"$from_i18n",function(M,N){var k=A;return k=r("I18n").$t(M,c(["locale"],{locale:N})),this.$new(k["$[]"]("name"),k["$[]"]("type"),k["$[]"]("items"))}),o(_,"$initialize",function(M,N,w){var k=this,E=A;return k.name=M,k.items=w.$freeze(),E=/(\d+)D(\d+)/i.$match(N),P(E)||k.$raise(r("ArgumentError"),"Unexpected table type: "+N),k.times=E["$[]"](1).$to_i(),k.sides=E["$[]"](2).$to_i()}),o(_,"$roll",function(M){var w,N=this;return w=M.$roll_sum(N.times,N.sides),N.$choice(w)}),o(_,"$choice",function(M){var w,N=this;return w=K(M,N.times),r("RollResult").$new(N.name,M,N.items["$[]"](w))})},Opal.modules["bcdice/dice_table"]=function(e){var Y=e.top;return Y.$require("bcdice/dice_table/roll_result"),Y.$require("bcdice/dice_table/chain_table"),Y.$require("bcdice/dice_table/d66_grid_table"),Y.$require("bcdice/dice_table/d66_half_grid_table"),Y.$require("bcdice/dice_table/d66_one_third_table"),Y.$require("bcdice/dice_table/d66_left_range_table"),Y.$require("bcdice/dice_table/d66_parity_table"),Y.$require("bcdice/dice_table/d66_range_table"),Y.$require("bcdice/dice_table/d66_table"),Y.$require("bcdice/dice_table/range_table"),Y.$require("bcdice/dice_table/sai_fic_skill_table"),Y.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(e){var o,F,Z,b,Y=e.module,H=e.const_set,c=[];return o=c,F=b=[Y(c[0],"BCDice")].concat(o),Z=[Y(b[0],"D66SortType")].concat(F),H(Z[0],"NO_SORT","no_sort"),H(Z[0],"ASC","asc"),H(Z[0],"DESC","desc"),function(A,F){var Z=[Y(A,"RoundType")].concat(F);return H(Z[0],"CEIL","ceil"),H(Z[0],"FLOOR","floor"),H(Z[0],"ROUND","round")}(b[0],b)},Opal.modules["bcdice/translate"]=function(e){var F,G,U,z,a,Z,Y=e.module,H=e.ensure_kwargs,c=e.kwrestargs,P=e.hash2,o=e.def,K=[],b=e.nil;return F=K,G=Z=[Y(K[0],"BCDice")].concat(F),z=[U=Y(Z[0],"Translate")].concat(G),a=e.$r(z),o(U,"$translate",function(l,p){var _,I=this;return null==I.locale&&(I.locale=b),p=H(p),_=c(p,{}),a("I18n").$translate(l,P(["locale","raise"],{locale:I.locale,raise:!0}).$merge(e.to_hash(_)))},-2)},Opal.modules["bcdice/result"]=function(e){var U,B,z,F,Z,H=e.klass,c=e.send,L=e.def,P=e.return_val,o=e.return_ivar,K=[],b=e.nil;return F=K,U=Z=[(0,e.module)(K[0],"BCDice")].concat(F),[z=H(Z[0],null,"Result")].concat(U),L(B=e.get_singleton_class(z),"$success",function(_){return c(this.$new(),"tap",[],function(n){var y;return null==n&&(n=b),n["$text="](_),c(n,"success=",y=[!0]),y[y.length-1]})}),L(B,"$failure",function(_){return c(this.$new(),"tap",[],function(n){var y;return null==n&&(n=b),n["$text="](_),c(n,"failure=",y=[!0]),y[y.length-1]})}),L(B,"$critical",function(_){return c(this.$new(),"tap",[],function(n){var y;return null==n&&(n=b),n["$text="](_),n["$critical="](!0),c(n,"success=",y=[!0]),y[y.length-1]})}),L(B,"$fumble",function(_){return c(this.$new(),"tap",[],function(n){var y;return null==n&&(n=b),n["$text="](_),n["$fumble="](!0),c(n,"failure=",y=[!0]),y[y.length-1]})}),L(B,"$nothing",P("nothing")),L(z,"$initialize",function(l){var p=this;return null==l&&(l=b),p.text=l,p.rands=b,p.detailed_rands=b,p.secret=!1,p.success=!1,p.failure=!1,p.critical=!1,p.fumble=!1},-1),z.$attr_accessor("text","rands","detailed_rands"),z.$attr_writer("secret","success","failure","critical","fumble"),L(z,"$secret?",o("secret")),L(z,"$success?",o("success")),L(z,"$failure?",o("failure")),L(z,"$critical?",o("critical")),L(z,"$fumble?",o("fumble")),L(z,"$condition=",function(l){return this.success=l,this.failure=l["$!"]()})},Opal.modules["racc/parser"]=function(e){var M,w,k,Y=e.module,H=e.klass,c=e.truthy,L=e.const_set,P=e.defs,o=e.gvars,K=e.rb_lt,b=e.def,A=e.to_ary,F=e.send,D=e.neqeq,Z=e.rb_plus,j=e.eqeq,G=e.rb_ge,U=e.rb_gt,z=e.rb_minus,a=e.rb_le,B=e.rb_times,l=e.assign_ivar_val,_=[],I=e.$r(_),r=e.nil,n=e.$$$;return M=_,w=[Y(_[0],"Racc")].concat(M),k=e.$r(w),H(w[0],k("StandardError"),"ParseError"),c(n("::","ParseError","skip_raise")?"constant":r)||L(_[0],"ParseError",n(I("Racc"),"ParseError")),function(y,M){var s,d,f,S,u,k=[Y(y,"Racc")].concat(M),E=e.$r(k);return c(E("Racc_No_Extensions","skip_raise")?"constant":r)||L(k[0],"Racc_No_Extensions",!1),s=k,f=[d=H(k[0],null,"Parser")].concat(s),S=e.$r(f),(u=d.$$prototype).yydebug=u.racc_debug_out=u.racc_error_status=u.racc_t=u.racc_vstack=u.racc_val=u.racc_state=u.racc_tstack=r,L(f[0],"Racc_Runtime_Version","1.4.6"),L(f[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),L(f[0],"Racc_Runtime_Core_Version_R","1.4.6"),L(f[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),L(f[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),L(f[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),L(f[0],"Racc_Runtime_Core_Version",S("Racc_Runtime_Core_Version_R")),L(f[0],"Racc_Runtime_Core_Revision",S("Racc_Runtime_Core_Revision_R")),L(f[0],"Racc_Runtime_Type","ruby"),P(S("Parser"),"$racc_runtime_type",function(){return S("Racc_Runtime_Type")}),b(d,"$_racc_setup",function(){var t,T,i=this,m=r,$=r;return null==o.stderr&&(o.stderr=r),c(n(i.$class(),"Racc_debug_parser"))||(i.yydebug=!1),c(null!=(t=i.yydebug)&&t!==r?"instance-variable":r)||(i.yydebug=!1),c(i.yydebug)&&(c(null!=(T=i.racc_debug_out)&&T!==r?"instance-variable":r)||(i.racc_debug_out=o.stderr),i.racc_debug_out=c(m=i.racc_debug_out)?m:o.stderr),$=n(i.$class(),"Racc_arg"),c(K($.$size(),14))&&$["$[]="](13,!0),$}),b(d,"$_racc_init_sysvars",function(){var t=this;return t.racc_state=[0],t.racc_tstack=[],t.racc_vstack=[],t.racc_t=r,t.racc_val=r,t.racc_read_next=!0,t.racc_user_yyerror=!1,t.racc_error_status=0}),b(d,"$do_parse",function(){return this.$__send__(S("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)}),b(d,"$next_token",function(){return this.$raise(S("NotImplementedError"),this.$class()+"#next_token is not defined")}),b(d,"$_racc_do_parse_rb",function(t,T){var i,$=this,X=r,te=r,O=r,ue=r,ce=r,se=r,_e=r,ae=r;return i=A(t),X=null==i[0]?r:i[0],te=null==i[1]?r:i[1],O=null==i[2]?r:i[2],ue=null==i[3]?r:i[3],ce=null==i[10]?r:i[10],$.$_racc_init_sysvars(),se=_e=ae=r,F($,"catch",["racc_end_parse"],function ee(){var C,V,x=null==ee.$$s?this:ee.$$s,q=r;for(null==x.racc_state&&(x.racc_state=r),null==x.racc_read_next&&(x.racc_read_next=r),null==x.racc_t&&(x.racc_t=r),null==x.yydebug&&(x.yydebug=r),null==x.racc_val&&(x.racc_val=r);c(!0);)for(c(ae=ue["$[]"](x.racc_state["$[]"](-1)))?(c(x.racc_read_next)&&D(x.racc_t,0)&&(V=x.$next_token(),C=A(V),se=null==C[0]?r:C[0],x.racc_val=null==C[1]?r:C[1],x.racc_t=c(se)?c(q=ce["$[]"](se))?q:1:0,c(x.yydebug)&&x.$racc_read_token(x.racc_t,se,x.racc_val),x.racc_read_next=!1),ae=Z(ae,x.racc_t),c(G(ae,0))&&c(_e=X["$[]"](ae))&&j(te["$[]"](ae),x.racc_state["$[]"](-1))||(_e=O["$[]"](x.racc_state["$[]"](-1)))):_e=O["$[]"](x.racc_state["$[]"](-1));c(_e=x.$_racc_evalact(_e,t)););},{$$s:$})}),b(d,"$yyparse",function(t,T){return this.$__send__(S("Racc_YY_Parse_Method"),t,T,this.$_racc_setup(),!0)}),b(d,"$_racc_yyparse_rb",function(t,T,i,m){var $,O=r,ue=r,$e=r,ce=r,_e=r,ae=r,ee=r;return $=A(i),O=null==$[0]?r:$[0],ue=null==$[1]?r:$[1],$e=null==$[2]?r:$[2],ce=null==$[3]?r:$[3],_e=null==$[10]?r:$[10],this.$_racc_init_sysvars(),ae=r,ee=r,F(this,"catch",["racc_end_parse"],function C(){var V=null==C.$$s?this:C.$$s;for(null==V.racc_state&&(V.racc_state=r);!c(ee=ce["$[]"](V.racc_state["$[]"](-1)));)for(;c(ae=V.$_racc_evalact($e["$[]"](V.racc_state["$[]"](-1)),i)););return F(t,"__send__",[T],function x(q,re){var R=null==x.$$s?this:x.$$s,W=r,J=r;for(null==R.racc_t&&(R.racc_t=r),null==R.racc_state&&(R.racc_state=r),null==R.racc_read_next&&(R.racc_read_next=r),null==q&&(q=r),null==re&&(re=r),R.racc_t=c(q)?c(W=_e["$[]"](q))?W:1:0,R.racc_val=re,R.racc_read_next=!1,ee=Z(ee,R.racc_t),c(G(ee,0))&&c(ae=O["$[]"](ee))&&j(ue["$[]"](ee),R.racc_state["$[]"](-1))||(ae=$e["$[]"](R.racc_state["$[]"](-1)));c(ae=R.$_racc_evalact(ae,i)););for(;c(c(W=c(J=(ee=ce["$[]"](R.racc_state["$[]"](-1)))["$!"]())?J:R.racc_read_next["$!"]())?W:R.racc_t["$=="](0));)for(c(ee)&&c(ee=Z(ee,R.racc_t))&&c(G(ee,0))&&c(ae=O["$[]"](ee))&&j(ue["$[]"](ee),R.racc_state["$[]"](-1))||(ae=$e["$[]"](R.racc_state["$[]"](-1)));c(ae=R.$_racc_evalact(ae,i)););},{$$s:V})},{$$s:this})}),b(d,"$_racc_evalact",function(t,T){var i,$e,$=this,X=r,te=r,ue=r,ce=r,se=r,_e=r;if(X=null==(i=A(T))[0]?r:i[0],te=null==i[1]?r:i[1],ue=null==i[3]?r:i[3],$e=null==i[11]?r:i[11],ce=null==i[12]?r:i[12],c(U(t,0))&&c(K(t,$e)))c(U($.racc_error_status,0))&&(j($.racc_t,1)||($.racc_error_status=z($.racc_error_status,1))),$.racc_vstack.$push($.racc_val),$.racc_state.$push(t),$.racc_read_next=!0,c($.yydebug)&&($.racc_tstack.$push($.racc_t),$.$racc_shift($.racc_t,$.racc_tstack,$.racc_vstack));else if(c(K(t,0))&&c(U(t,ce["$-@"]()))){if(se=F($,"catch",["racc_jump"],function ae(){var ee=null==ae.$$s?this:ae.$$s;return null==ee.racc_state&&(ee.racc_state=r),ee.racc_state.$push(ee.$_racc_do_reduce(T,t)),!1},{$$s:$}),c(se))switch(se){case 1:return $.racc_user_yyerror=!0,ce["$-@"]();case 2:return $e;default:$.$raise("[Racc Bug] unknown jump code")}}else if(j(t,$e))c($.yydebug)&&$.$racc_accept(),$.$throw("racc_end_parse",$.racc_vstack["$[]"](0));else{if(j(t,ce["$-@"]())){switch($.racc_error_status){case 0:c(T["$[]"](21))||$.$on_error($.racc_t,$.racc_val,$.racc_vstack);break;case 3:j($.racc_t,0)&&$.$throw("racc_end_parse",r),$.racc_read_next=!0}for($.racc_user_yyerror=!1,$.racc_error_status=3;c(!0)&&!(c(_e=ue["$[]"]($.racc_state["$[]"](-1)))&&(_e=Z(_e,1),c(G(_e,0))&&c(t=X["$[]"](_e))&&j(te["$[]"](_e),$.racc_state["$[]"](-1))));)c(a($.racc_state.$size(),1))&&$.$throw("racc_end_parse",r),$.racc_state.$pop(),$.racc_vstack.$pop(),c($.yydebug)&&($.racc_tstack.$pop(),$.$racc_e_pop($.racc_state,$.racc_tstack,$.racc_vstack));return t}$.$raise("[Racc Bug] unknown action "+t.$inspect())}return c($.yydebug)&&$.$racc_next_state($.racc_state["$[]"](-1),$.racc_state),r}),b(d,"$_racc_do_reduce",function(t,T){var i,ce,_e,q,re,R,Q,$=this,te=r,O=r,ue=r,$e=r,se=r,ae=r,ee=r,C=r,V=r,x=r,W=r,J=r,ne=r;return te=null==(i=A(t))[4]?r:i[4],O=null==i[5]?r:i[5],ue=null==i[6]?r:i[6],$e=null==i[7]?r:i[7],ce=null==i[8]?r:i[8],se=null==i[9]?r:i[9],_e=null==i[13]?r:i[13],ae=$.racc_state,ee=$.racc_vstack,C=$.racc_tstack,V=B(T,-3),x=se["$[]"](V),q=se["$[]"](Z(V,1)),re=se["$[]"](Z(V,2)),R=[],c($.yydebug)&&(W=C["$[]"](x["$-@"](),x)),J=ee["$[]"](x["$-@"](),x),c($.yydebug)&&C["$[]="](x["$-@"](),x,R),ee["$[]="](x["$-@"](),x,R),ae["$[]="](x["$-@"](),x,R),c(_e)?ee.$push($.$__send__(re,J,ee,J["$[]"](0))):ee.$push($.$__send__(re,J,ee)),C.$push(q),c($.yydebug)&&$.$racc_reduce(W,q,C,ee),Q=z(q,ce),c(V=$e["$[]"](Q))&&(V=Z(V,ae["$[]"](-1)),c(G(V,0))&&c(ne=te["$[]"](V))&&j(O["$[]"](V),Q))?ne:ue["$[]"](Q)}),b(d,"$on_error",function(t,T,i){var $,m=this;return m.$raise(S("ParseError"),m.$sprintf("\nparse error on value %s (%s)",T.$inspect(),c($=m.$token_to_str(t))?$:"?"))}),b(d,"$yyerror",function(){return this.$throw("racc_jump",1)}),b(d,"$yyaccept",function(){return this.$throw("racc_jump",2)}),b(d,"$yyerrok",l("racc_error_status",0)),b(d,"$racc_read_token",function(t,T,i){var m=this;return m.racc_debug_out.$print("read    "),m.racc_debug_out.$print(T.$inspect(),"(",m.$racc_token2str(t),") "),m.racc_debug_out.$puts(i.$inspect()),m.racc_debug_out.$puts()}),b(d,"$racc_shift",function(t,T,i){var m=this;return m.racc_debug_out.$puts("shift   "+m.$racc_token2str(t)),m.$racc_print_stacks(T,i),m.racc_debug_out.$puts()}),b(d,"$racc_reduce",function(t,T,i,m){var $=this,X=r;return(X=$.racc_debug_out).$print("reduce "),c(t["$empty?"]())?X.$print(" <none>"):F(t,"each",[],function te(O){return null==O&&(O=r),X.$print(" ",(null==te.$$s?this:te.$$s).$racc_token2str(O))},{$$s:$}),X.$puts(" --\x3e "+$.$racc_token2str(T)),$.$racc_print_stacks(i,m),$.racc_debug_out.$puts()}),b(d,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()}),b(d,"$racc_e_pop",function(t,T,i){var m=this;return m.racc_debug_out.$puts("error recovering mode: pop token"),m.$racc_print_states(t),m.$racc_print_stacks(T,i),m.racc_debug_out.$puts()}),b(d,"$racc_next_state",function(t,T){var i=this;return i.racc_debug_out.$puts("goto    "+t),i.$racc_print_states(T),i.racc_debug_out.$puts()}),b(d,"$racc_print_stacks",function(t,T){var m=r;return(m=this.racc_debug_out).$print("        ["),F(t,"each_index",[],function $(X){return null==X&&(X=r),m.$print(" (",(null==$.$$s?this:$.$$s).$racc_token2str(t["$[]"](X))," ",T["$[]"](X).$inspect(),")")},{$$s:this}),m.$puts(" ]")}),b(d,"$racc_print_states",function(t){var i=r;return(i=this.racc_debug_out).$print("        ["),F(t,"each",[],function($){return null==$&&($=r),i.$print(" ",$)}),i.$puts(" ]")}),b(d,"$racc_token2str",function(t){var i;return c(i=n(this.$class(),"Racc_token_to_s_table")["$[]"](t))?i:this.$raise("[Racc Bug] can't convert token "+t+" to string")}),b(d,"$token_to_str",function(t){return n(this.$class(),"Racc_token_to_s_table")["$[]"](t)})}(_[0],_)},Opal.modules["bcdice/arithmetic/node"]=function(e){var l,r,N,s,d,k,E,y,_,Y=e.module,H=e.klass,c=e.def,L=e.thrower,P=e.return_ivar,o=e.send2,K=e.find_super,b=e.eqeq,A=e.const_set,F=e.eqeqeq,D=e.rb_divide,Z=e.truthy,j=e.assign_ivar,G=e.alias,U=[],z=e.nil,a=e.$$$;return l=U,r=_=[Y(U[0],"BCDice")].concat(l),N=y=[Y(_[0],"Arithmetic")].concat(r),k=[Y(y[0],"Node")].concat(N),E=e.$r(k),(d=(s=H(k[0],null,"BinaryOp")).$$prototype).lhs=d.rhs=d.op=z,c(s,"$initialize",function(S,u,v){var t=this;return t.lhs=S,t.op=u,t.rhs=v}),c(s,"$eval",function(S){try{L("eval_return");var T,v=this,t=z;return t=v.lhs.$eval(S),T=v.rhs.$eval(S),t.$send(v.op,T)}catch(i){if(i===e.t_eval_return)return i.$v;throw i}}),c(s,"$output",function(){var S=this;return""+S.lhs.$output()+S.op+S.rhs.$output()}),c(s,"$s_exp",function(){var S=this;return"("+S.$op_for_s_exp()+" "+S.lhs.$s_exp()+" "+S.rhs.$s_exp()+")"}),c(s,"$op_for_s_exp",P("op")),function(h,g,s){var d=H(h,g,"DivideBase"),f=[d].concat(s),S=e.$r(f),u=d.$$prototype;u.lhs=u.rhs=u.op=z,c(d,"$initialize",function v(t,T){return v.$$p=null,o(this,K(this,"initialize",v,!1,!0),"initialize",[t,"/",T],null)}),c(d,"$eval",function(t){try{L("eval_return");var m,$,i=this;return m=i.lhs.$eval(t),$=i.rhs.$eval(t),b($,0)&&i.$raise(S("ZeroDivisionError")),i.$divide_and_round(m,$,t)}catch(X){if(X===e.t_eval_return)return X.$v;throw X}}),c(d,"$output",function v(){var t=v.$$p||z,T=this;return v.$$p=null,""+o(T,K(T,"output",v,!1,!0),"output",[],t)+T.$rounding_method()}),d.$private(),c(d,"$rounding_method",function(){return a(this.$class(),"ROUNDING_METHOD")}),c(d,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()}),c(d,"$divide_and_round",function(t,T,i){return this.$raise(S("NotImplementedError"))})}(k[0],E("BinaryOp"),k),function(h,g,s){var d=H(h,g,"DivideWithGameSystemDefault"),f=[d].concat(s),S=e.$r(f);A(f[0],"ROUNDING_METHOD",""),d.$private(),c(d,"$divide_and_round",function(v,t,T){var i,m=z;return F(a(S("RoundType"),"CEIL"),i=T)?D(v.$to_f(),t).$ceil():F(a(S("RoundType"),"ROUND"),i)?(m=D(v.$to_f(),t),Z(m["$negative?"]())?m.$abs().$round()["$-@"]():m.$round()):D(v,t).$floor()})}(k[0],E("DivideBase"),k),function(h,g,s){var d=H(h,g,"DivideWithCeil"),f=[d].concat(s);A(f[0],"ROUNDING_METHOD","C"),d.$private(),c(d,"$divide_and_round",function(u,v,t){return D(u.$to_f(),v).$ceil()})}(k[0],E("DivideBase"),k),function(h,g,s){var d=H(h,g,"DivideWithRound"),f=[d].concat(s);A(f[0],"ROUNDING_METHOD","R"),d.$private(),c(d,"$divide_and_round",function(u,v,t){var T=z;return T=D(u.$to_f(),v),Z(T["$negative?"]())?T.$abs().$round()["$-@"]():T.$round()})}(k[0],E("DivideBase"),k),function(h,g,s){var d=H(h,g,"DivideWithFloor"),f=[d].concat(s);A(f[0],"ROUNDING_METHOD","F"),d.$private(),c(d,"$divide_and_round",function(u,v,t){return D(u,v).$floor()})}(k[0],E("DivideBase"),k),function(h,g){var s=H(h,null,"Negative");s.$$prototype.body=z,c(s,"$initialize",j("body")),c(s,"$eval",function(S){try{return L("eval_return"),this.body.$eval(S)["$-@"]()}catch(t){if(t===e.t_eval_return)return t.$v;throw t}}),c(s,"$output",function(){return"-"+this.body.$output()}),c(s,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"})}(k[0]),function(h,g){var s=H(h,null,"Parenthesis");s.$$prototype.expr=z,c(s,"$initialize",j("expr")),c(s,"$eval",function(S){try{return L("eval_return"),this.expr.$eval(S)}catch(t){if(t===e.t_eval_return)return t.$v;throw t}}),c(s,"$output",function(){return"("+this.expr.$output()+")"}),c(s,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"})}(k[0]),function(h,g){var s=H(h,null,"Number");return s.$$prototype.value=z,c(s,"$initialize",j("value")),c(s,"$eval",P("value")),c(s,"$output",function(){return this.value.$to_s()}),G(s,"s_exp","output")}(k[0])},Opal.modules.strscan=function(e){var j,G,U,z,a,H=e.def,c=e.truthy,L=e.eqeqeq,P=e.Opal,o=e.return_ivar,K=e.send,b=e.alias,A=[],F=e.nil;return j=A,U=[G=(0,e.klass)(A[0],null,"StringScanner")].concat(j),z=e.$r(U),(a=G.$$prototype).pos=a.string=a.working=a.matched=a.prev_pos=a.match=F,G.$attr_reader("pos","matched"),H(G,"$initialize",function(l){var p=this;return p.string=l,p.pos=0,p.matched=F,p.working=l,p.match=[]}),G.$attr_reader("string"),H(G,"$beginning_of_line?",function(){var l=this;return 0===l.pos||"\n"===l.string.charAt(l.pos-1)}),H(G,"$scan",function(l){var p=this,_=(l=p.$anchor(l)).exec(p.working);return null==_?p.matched=F:(p.prev_pos=p.pos,p.pos+=_[0].length,p.working=p.working.substring(_[0].length),p.matched=_[0],p.match=_,_[0])}),H(G,"$scan_until",function(l){var p=this;l=p.$anchor(l);for(var _=p.working,I=0;_.length!=I;++I){var r=l.exec(_.substr(I));if(null!==r){var n=I+r[0].length,y=_.substr(0,n);return p.matched=r[0],p.match=r,p.prev_pos=p.pos+I,p.pos+=n,p.working=_.substr(n),y}}return p.matched=F}),H(G,"$[]",function(l){var _;if(c(this.match["$empty?"]()))return F;L(z("Symbol"),_=l)?l=l.$to_s():L(z("String"),_)||(l=P["$coerce_to!"](l,z("Integer"),"to_int"));var I=this.match;return l<0&&(l+=I.length),l<0||l>=I.length||null==I[l]?F:I[l]}),H(G,"$check",function(l){var p=this,_=(l=p.$anchor(l)).exec(p.working);return p.matched=null==_?F:_[0]}),H(G,"$check_until",function(l){var p=this,_=p.prev_pos,I=p.pos,r=p.working,n=p.$scan_until(l);return p.prev_pos=_,p.pos=I,p.working=r,n}),H(G,"$peek",function(l){return this.working.substring(0,l)}),H(G,"$eos?",function(){return 0===this.working.length}),H(G,"$exist?",function(l){var _=l.exec(this.working);return null==_?F:0==_.index?0:_.index+1}),H(G,"$skip",function(l){var p=this,_=(l=p.$anchor(l)).exec(p.working);if(null==_)return p.match=[],p.matched=F;var I=_[0],r=I.length;return p.matched=I,p.match=_,p.prev_pos=p.pos,p.pos+=r,p.working=p.working.substring(r),r}),H(G,"$skip_until",function(l){var _=this.$scan_until(l);return _===F?F:(this.matched=_.substr(-1),_.length)}),H(G,"$get_byte",function(){var l=this,p=F;return l.pos<l.string.length?(l.prev_pos=l.pos,l.pos+=1,p=l.matched=l.working.substring(0,1),l.working=l.working.substring(1)):l.matched=F,p}),H(G,"$match?",function(l){var p=this,_=(l=p.$anchor(l)).exec(p.working);return null==_?F:(p.prev_pos=p.pos,_[0].length)}),H(G,"$pos=",function(l){var p=this;return l<0&&(l+=p.string.$length()),p.pos=l,p.working=p.string.slice(l)}),H(G,"$matched_size",function(){return this.matched===F?F:this.matched.length}),H(G,"$post_match",function(){var l=this;return l.matched===F?F:l.string.substr(l.pos)}),H(G,"$pre_match",function(){var l=this;return l.matched===F?F:l.string.substr(0,l.prev_pos)}),H(G,"$reset",function(){var l=this;return l.working=l.string,l.matched=F,l.pos=0}),H(G,"$rest",o("working")),H(G,"$rest?",function(){return 0!==this.working.length}),H(G,"$rest_size",function(){return this.$rest().$size()}),H(G,"$terminate",function(){var l,p=this;return p.match=F,l=[p.string.$length()],K(p,"pos=",l),l[l.length-1]}),H(G,"$unscan",function(){var l=this;return l.pos=l.prev_pos,l.prev_pos=F,l.match=F,l}),b(G,"bol?","beginning_of_line?"),b(G,"getch","get_byte"),G.$private(),H(G,"$anchor",function(l){var p=l.toString().match(/\/([^\/]+)$/);return p=p?p[1]:void 0,new RegExp("^(?:"+l.source+")",p)})},Opal.modules["bcdice/normalize"]=function(e){var b,Z,F,Y=e.module,H=e.eqeqeq,c=e.def,L=e.eqeq,P=[],o=e.nil;return b=P,F=[Y(P[0],"BCDice")].concat(b),(Z=Y(F[0],"Normalize")).$module_function(),c(Z,"$comparison_operator",function(G){var U;return H(/<=|=</,U=G)?"<=":H(/>=|=>/,U)?">=":H(/<>|!=|=!/,U)?"!=":H(/</,U)?"<":H(/>/,U)?">":H(/=/,U)?"==":o}),c(Z,"$target_number",function(G){return L(G,"?")?G:G.$to_i()})},Opal.modules["bcdice/command/lexer"]=function(e){var j,a,I,r,n,y,M,l,U,Y=e.module,H=e.klass,c=e.const_set,L=e.hash2,P=e.truthy,o=e.send,K=e.def,b=e.thrower,A=e.top,F=[],D=e.nil;return A.$require("strscan"),A.$require("bcdice/normalize"),j=F,a=U=[Y(F[0],"BCDice")].concat(j),I=l=[Y(U[0],"Command")].concat(a),n=[r=H(l[0],null,"Lexer")].concat(I),y=e.$r(n),(M=r.$$prototype).scanner=M.notations=D,c(n[0],"SYMBOLS",L(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),K(r,"$initialize",function(w,k){var E,h,s;return w=P(s=(E=(h=w)===D||null==h?D:h.$split(" ",2))===D||null==E?D:E.$first())?s:"",this.scanner=y("StringScanner").$new(w),this.notations=o(k,"map",[],function(f){return null==f&&(f=D),P(f["$is_a?"](y("String")))?y("Regexp").$new(f):f})}),K(r,"$next_token",function(){try{var w=b("return"),k=this,E=D,h=D,s=D,d=D;return P(k.scanner["$eos?"]())?[!1,"$"]:(o(k.notations,"each",[],function f(S){var v,u=null==f.$$s?this:f.$$s;if(null==u.scanner&&(u.scanner=D),null==S&&(S=D),v=u.scanner.$scan(S),!P(v))return D;w.$throw(["NOTATION",v])},{$$s:k,$$ret:w}),P(E=k.scanner.$scan(/\d+/))?["NUMBER",E.$to_i()]:P(h=k.scanner.$scan(/[<>!=]+/))?(h=y("Normalize").$comparison_operator(h),[P(h)?"CMP_OP":"ILLEGAL",h]):(s=k.scanner.$getch().$upcase(),[P(d=y("SYMBOLS")["$[]"](s))?d:s.$to_sym(),s]))}catch(f){if(f===w)return f.$v;throw f}}),K(r,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/command/parsed"]=function(e){var A,j,B,l,p,_,I,U,D,Y=e.module,H=e.klass,c=e.def,L=e.return_ivar,P=e.truthy,o=[],K=e.nil;return A=o,j=D=[Y(o[0],"BCDice")].concat(A),B=U=[Y(D[0],"Command")].concat(j),p=[l=H(U[0],null,"Parsed")].concat(B),_=e.$r(p),(I=l.$$prototype).critical=I.fumble=I.dollar=I.modify_number=I.question_target=I.target_number=I.prefix_number=I.command=I.suffix_number=I.cmp_op=K,l.$attr_accessor("command"),l.$attr_accessor("prefix_number"),l.$attr_accessor("suffix_number"),l.$attr_accessor("critical"),l.$attr_accessor("fumble"),l.$attr_accessor("dollar"),l.$attr_accessor("modify_number"),l.$attr_accessor("cmp_op"),l.$attr_accessor("target_number"),l.$attr_writer("question_target"),c(l,"$initialize",function(){var n=this;return n.prefix_number=K,n.suffix_number=K,n.critical=K,n.fumble=K,n.dollar=K,n.cmp_op=K,n.target_number=K,n.question_target=!1}),c(l,"$question_target?",L("question_target")),c(l,"$to_s",function(n){var y=this,M=K,N=K,w=K,k=K,E=K;switch(null==n&&(n="after_command"),M=P(y.critical)?"@"+y.critical:K,N=P(y.fumble)?"#"+y.fumble:K,w=P(y.dollar)?"$"+y.dollar:K,k=_("Format").$modifier(y.modify_number),E=P(y.question_target)?"?":y.target_number,n){case"after_command":return[y.prefix_number,y.command,y.suffix_number,M,N,w,k,y.cmp_op,E].$join();case"after_modify_number":return[y.prefix_number,y.command,y.suffix_number,k,M,N,w,y.cmp_op,E].$join();case"after_target_number":return[y.prefix_number,y.command,y.suffix_number,k,y.cmp_op,E,M,N,w].$join();default:return K}},-1)},Opal.modules["bcdice/command/parser"]=function(e){var n,w,d,v,t,T,i,m,$,X,te,O,ce,f,S,u,ae,E,h,M,Y=e.klass,H=e.module,c=e.slice,L=e.extract_kwargs,P=e.ensure_kwargs,o=e.get_kwarg,K=e.send2,b=e.find_super,A=e.def,F=e.send,D=e.eqeq,Z=e.thrower,j=e.hash,G=e.const_set,U=e.truthy,z=e.to_ary,a=e.hash2,B=e.top,l=[],p=e.$r(l),_=e.nil,I=e.$$$;return B.$require("racc/parser.rb"),B.$require("bcdice/arithmetic/node"),B.$require("bcdice/command/lexer"),B.$require("bcdice/command/parsed"),Y(I(p("BCDice"),"Command"),I(p("Racc"),"Parser"),"Parser"),n=l,w=M=[H(l[0],"BCDice")].concat(n),E=[H(M[0],"Command")].concat(w),h=e.$r(E),d=E,S=[f=Y(E[0],I(h("Racc"),"Parser"),"Parser")].concat(d),u=e.$r(S),(ae=f.$$prototype).notations=ae.lexer=ae.modifier=ae.suffix_number=ae.prefix_number=ae.need_suffix_number=ae.need_prefix_number=ae.critical=ae.fumble=ae.dollar=ae.allowed_cmp_op=ae.question_target=_,A(f,"$initialize",function ee(C,V){var x,q,re,R,J=this;return ee.$$p=null,x=c(arguments),q=L(x),q=P(q),re=x,R=o(q,"round_type"),K(J,b(J,"initialize",ee,!1,!0),"initialize",[],null),J.notations=re,J.round_type=R,J.prefix_number=!1,J.suffix_number=!1,J.need_prefix_number=!1,J.need_suffix_number=!1,J.modifier=!0,J.critical=!1,J.fumble=!1,J.dollar=!1,J.allowed_cmp_op=[_,">=",">","<=","<","==","!="],J.question_target=!1},-2),A(f,"$disable_modifier",function(){return this.modifier=!1,this}),A(f,"$enable_prefix_number",function(){return this.prefix_number=!0,this}),A(f,"$enable_suffix_number",function(){return this.suffix_number=!0,this}),A(f,"$has_prefix_number",function(){var C=this;return C.prefix_number=!0,C.need_prefix_number=!0,C}),A(f,"$has_suffix_number",function(){var C=this;return C.suffix_number=!0,C.need_suffix_number=!0,C}),A(f,"$enable_critical",function(){return this.critical=!0,this}),A(f,"$enable_fumble",function(){return this.fumble=!0,this}),A(f,"$enable_dollar",function(){return this.dollar=!0,this}),A(f,"$restrict_cmp_op_to",function(C){var V,q=this;return V=c(arguments),q.allowed_cmp_op=V,q},-1),A(f,"$enable_question_target",function(){return this.question_target=!0,this}),A(f,"$parse",function(C){var V=this;try{return V.lexer=u("Lexer").$new(C,V.notations),V.$do_parse()}catch(x){if(!e.rescue(x,[u("ParseError"),u("ZeroDivisionError")]))throw x;try{return _}finally{e.pop_exception()}}}),f.$private(),A(f,"$parsed",function(C,V,x,q){try{return Z("eval_return"),F(u("Parsed").$new(),"tap",[],function W(J){var Q,ne,ie,le,fe,oe,de,me=null==W.$$s?this:W.$$s;return null==me.round_type&&(me.round_type=_),null==J&&(J=_),J["$command="](C["$[]"]("command")),J["$prefix_number="]((Q=C["$[]"]("prefix"))===_||null==Q?_:Q.$eval(me.round_type)),J["$suffix_number="]((ne=C["$[]"]("suffix"))===_||null==ne?_:ne.$eval(me.round_type)),J["$critical="]((ie=V["$[]"]("critical"))===_||null==ie?_:ie.$eval(me.round_type)),J["$fumble="]((le=V["$[]"]("fumble"))===_||null==le?_:le.$eval(me.round_type)),J["$dollar="]((fe=V["$[]"]("dollar"))===_||null==fe?_:fe.$eval(me.round_type)),J["$modify_number="](x.$eval(me.round_type)),J["$cmp_op="](q["$[]"]("cmp_op")),D(q["$[]"]("target"),"?")?(J["$question_target="](!0),F(J,"target_number=",oe=[0]),oe[oe.length-1]):(J["$question_target="](!1),oe=[(de=q["$[]"]("target"),de===_||null==de?_:de.$eval(me.round_type))],F(J,"target_number=",oe),oe[oe.length-1])},{$$s:this})}catch(W){if(W===e.t_eval_return)return W.$v;throw W}}),A(f,"$next_token",function(){return this.lexer.$next_token()}),v=e.large_array_unpack("6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,33,34,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,,,17,18,6,,5,,,17,18,,,5,23,24,25,26,56,54,55,57"),t=e.large_array_unpack("0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,,17,15,15,18,18,23,,18,30,30,23,23,24,,23,31,31,24,24,25,,24,44,44,25,25,28,,25,47,47,28,28,29,,28,48,48,29,29,33,,29,49,49,33,33,34,,33,50,50,34,34,36,,34,,,36,36,37,,36,,,37,37,,,37,27,27,27,27,52,52,52,52"),T=e.large_array_unpack("-2,4,16,-3,-1,11,,33,13,35,23,30,1,,28,40,,37,44,,,-2,,51,58,65,0,106,72,79,47,54,,86,93,,100,107,,,,,,,63,,,68,75,82,89,,120,,,,,"),i=e.large_array_unpack("-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29"),m=e.large_array_unpack("30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,,,21,47,48,40,51,52,49,50,44,46,3,,,,13,,,,,,,,32"),$=e.large_array_unpack("8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,,,4,8,8,5,7,7,8,8,9,5,6,,,,6,,,,,,,,6"),X=[_,6,13,3,9,-1,27,-15,-10,-1,-38],te=[_,_,_,_,_,_,19,16,15,_,_],O=e.large_array_unpack("0,0,racc_error,4,20,_reduce_1,4,20,_reduce_2,3,20,_reduce_3,3,21,_reduce_4,2,21,_reduce_5,2,21,_reduce_6,1,21,_reduce_7,0,22,_reduce_8,3,22,_reduce_9,3,22,_reduce_10,3,22,_reduce_11,2,23,_reduce_12,2,23,_reduce_13,3,23,_reduce_14,3,23,_reduce_15,0,24,_reduce_16,2,24,_reduce_17,2,24,_reduce_18,3,28,_reduce_19,3,28,_reduce_20,1,28,_reduce_none,3,27,_reduce_22,4,27,_reduce_23,1,27,_reduce_none,0,29,_reduce_25,1,29,_reduce_26,1,29,_reduce_27,1,29,_reduce_28,1,29,_reduce_29,2,26,_reduce_30,2,26,_reduce_31,1,26,_reduce_none,3,25,_reduce_33,1,25,_reduce_34"),ce=j(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),G(S[0],"Racc_arg",[v,t,i,T,m,$,te,X,19,O,ce,58,35,!0]),G(S[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),G(S[0],"Racc_debug_parser",!1),A(f,"$_reduce_1",function(C,V,x){var q,R=this;return U(R.modifier)||R.$raise(u("ParseError")),q=z(C),R.$parsed(null==q[0]?_:q[0],null==q[1]?_:q[1],null==q[2]?_:q[2],null==q[3]?_:q[3])}),A(f,"$_reduce_2",function(C,V,x){var q,R=this;return U(R.modifier)||R.$raise(u("ParseError")),q=z(C),R.$parsed(null==q[0]?_:q[0],null==q[2]?_:q[2],null==q[1]?_:q[1],null==q[3]?_:q[3])}),A(f,"$_reduce_3",function(C,V,x){var q,Q;return Q=null==(q=z(C))[2]?_:q[2],this.$parsed(null==q[0]?_:q[0],null==q[1]?_:q[1],I(I(u("Arithmetic"),"Node"),"Number").$new(0),Q)}),A(f,"$_reduce_4",function(C,V,x){var q=this;return U(q.prefix_number)&&U(q.suffix_number)||q.$raise(u("ParseError")),a(["command","prefix","suffix"],{command:C["$[]"](1),prefix:C["$[]"](0),suffix:C["$[]"](2)})}),A(f,"$_reduce_5",function(C,V,x){var q=this;return U(q.prefix_number)||q.$raise(u("ParseError")),U(q.need_suffix_number)&&q.$raise(u("ParseError")),a(["command","prefix"],{command:C["$[]"](1),prefix:C["$[]"](0)})}),A(f,"$_reduce_6",function(C,V,x){var q=this;return U(q.suffix_number)||q.$raise(u("ParseError")),U(q.need_prefix_number)&&q.$raise(u("ParseError")),a(["command","suffix"],{command:C["$[]"](0),suffix:C["$[]"](1)})}),A(f,"$_reduce_7",function(C,V,x){var q=this;return(U(q.need_prefix_number)||U(q.need_suffix_number))&&q.$raise(u("ParseError")),a(["command"],{command:C["$[]"](0)})}),A(f,"$_reduce_8",function(C,V,x){return a([],{})}),A(f,"$_reduce_9",function(C,V,x){var q,Q,W=_;return W=null==(q=z(C))[0]?_:q[0],Q=null==q[2]?_:q[2],U(this.critical)&&U(W["$[]"]("critical")["$nil?"]())||this.$raise(u("ParseError")),W["$[]="]("critical",Q),W}),A(f,"$_reduce_10",function(C,V,x){var q,Q,W=_;return W=null==(q=z(C))[0]?_:q[0],Q=null==q[2]?_:q[2],U(this.fumble)&&U(W["$[]"]("fumble")["$nil?"]())||this.$raise(u("ParseError")),W["$[]="]("fumble",Q),W}),A(f,"$_reduce_11",function(C,V,x){var q,Q,W=_;return W=null==(q=z(C))[0]?_:q[0],Q=null==q[2]?_:q[2],U(this.dollar)&&U(W["$[]"]("dollar")["$nil?"]())||this.$raise(u("ParseError")),W["$[]="]("dollar",Q),W}),A(f,"$_reduce_12",function(C,V,x){return C["$[]"](1)}),A(f,"$_reduce_13",function(C,V,x){return I(I(u("Arithmetic"),"Node"),"Negative").$new(C["$[]"](1))}),A(f,"$_reduce_14",function(C,V,x){return I(I(u("Arithmetic"),"Node"),"BinaryOp").$new(C["$[]"](0),"+",C["$[]"](2))}),A(f,"$_reduce_15",function(C,V,x){return I(I(u("Arithmetic"),"Node"),"BinaryOp").$new(C["$[]"](0),"-",C["$[]"](2))}),A(f,"$_reduce_16",function(C,V,x){return U(this.allowed_cmp_op["$include?"](_))||this.$raise(u("ParseError")),a([],{})}),A(f,"$_reduce_17",function(C,V,x){var q,W,J;return J=null==(q=z(C))[1]?_:q[1],U(this.allowed_cmp_op["$include?"](W=null==q[0]?_:q[0]))||this.$raise(u("ParseError")),a(["cmp_op","target"],{cmp_op:W,target:J})}),A(f,"$_reduce_18",function(C,V,x){var re,q=this;return re=C["$[]"](0),U(q.question_target)||q.$raise(u("ParseError")),U(q.allowed_cmp_op["$include?"](re))||q.$raise(u("ParseError")),a(["cmp_op","target"],{cmp_op:re,target:"?"})}),A(f,"$_reduce_19",function(C,V,x){return I(I(u("Arithmetic"),"Node"),"BinaryOp").$new(C["$[]"](0),"+",C["$[]"](2))}),A(f,"$_reduce_20",function(C,V,x){return I(I(u("Arithmetic"),"Node"),"BinaryOp").$new(C["$[]"](0),"-",C["$[]"](2))}),A(f,"$_reduce_22",function(C,V,x){return I(I(u("Arithmetic"),"Node"),"BinaryOp").$new(C["$[]"](0),"*",C["$[]"](2))}),A(f,"$_reduce_23",function(C,V,x){return C["$[]"](3).$new(C["$[]"](0),C["$[]"](2))}),A(f,"$_reduce_25",function(C,V,x){return I(I(u("Arithmetic"),"Node"),"DivideWithGameSystemDefault")}),A(f,"$_reduce_26",function(C,V,x){return I(I(u("Arithmetic"),"Node"),"DivideWithCeil")}),A(f,"$_reduce_27",function(C,V,x){return I(I(u("Arithmetic"),"Node"),"DivideWithCeil")}),A(f,"$_reduce_28",function(C,V,x){return I(I(u("Arithmetic"),"Node"),"DivideWithRound")}),A(f,"$_reduce_29",function(C,V,x){return I(I(u("Arithmetic"),"Node"),"DivideWithFloor")}),A(f,"$_reduce_30",function(C,V,x){return C["$[]"](1)}),A(f,"$_reduce_31",function(C,V,x){return I(I(u("Arithmetic"),"Node"),"Negative").$new(C["$[]"](1))}),A(f,"$_reduce_33",function(C,V,x){return C["$[]"](1)}),A(f,"$_reduce_34",function(C,V,x){return I(I(u("Arithmetic"),"Node"),"Number").$new(C["$[]"](0))}),A(f,"$_reduce_none",function(C,V,x){return C["$[]"](0)})},Opal.modules["bcdice/deprecated/checker"]=function(e){var F,G,B,l,p,_,z,Z,Y=e.module,H=e.send,c=e.eqeqeq,L=e.truthy,P=e.def,o=e.return_val,K=[],b=e.nil;return F=K,G=Z=[Y(K[0],"BCDice")].concat(F),B=z=[Y(Z[0],"Deprecated")].concat(G),p=[l=Y(z[0],"Checker")].concat(B),_=e.$r(p),l.$private(),P(l,"$check_result_legacy",function(r,n,y,M){var E,N=this,w=b,k=b,h=b,g=b;return w=H(n,"map",[],"sides".$to_proc()),E=(k=H(n,"map",[],"value".$to_proc())).$sum(),h=c([100],g=w)?N.$check_1D100(r,E,y,M):c([20],g)?N.$check_1D20(r,E,y,M):c([6,6],g)?N.$check_2D6(r,E,k,y,M):b,(L(h["$nil?"]())||L(h["$empty?"]()))&&(h=c([10],g=w.$uniq())?N.$check_nD10(r,E,k,y,M):c([6],g)?N.$check_nD6(r,E,k,y,M):b,L(h["$nil?"]())||L(h["$empty?"]()))?b:_("Result").$new(h.$delete_prefix(" \uff1e "))}),P(l,"$check_1D100",o(b)),P(l,"$check_1D20",o(b)),P(l,"$check_nD10",o(b)),P(l,"$check_2D6",o(b)),P(l,"$check_nD6",o(b))},Opal.modules["bcdice/base"]=function(e){var p,N,g,u,t,T,s,d,f,S,k,Y=e.module,H=e.klass,c=e.slice,L=e.rb_plus,P=e.truthy,o=e.def,K=e.regexp,b=e.send,A=e.thrower,F=e.return_ivar,D=e.assign_ivar_val,Z=e.eqeqeq,j=e.eqeq,G=e.return_val,U=e.range,z=e.rb_minus,a=e.rb_divide,B=e.rb_times,l=e.rb_ge,_=e.top,I=[],r=e.$r(I),n=e.nil,y=e.$$$;return _.$require("i18n"),_.$require("i18n/backend/fallbacks"),_.$require("bcdice/randomizer"),_.$require("bcdice/dice_table"),_.$require("bcdice/enum"),_.$require("bcdice/translate"),_.$require("bcdice/result"),_.$require("bcdice/command/parser"),_.$require("bcdice/deprecated/checker"),N=I,g=k=[Y(I[0],"BCDice")].concat(N),d=[s=H(k[0],null,"Base")].concat(g),f=e.$r(d),(S=s.$$prototype).raw_input=S.randomizer=S.enabled_upcase_input=S.debug=n,t=[u=e.get_singleton_class(s)].concat(d),T=e.$r(t),u.$attr_reader("prefixes"),o(u,"$register_prefix",function(m){var X,te=this,O=n;return null==te.prefixes&&(te.prefixes=n),X=c(arguments),te.prefixes=L(P(O=te.prefixes)?O:[],X.$flatten())},-1),o(u,"$register_prefix_from_super_class",function(){return this.$register_prefix(this.$superclass().$prefixes())}),o(u,"$prefixes_pattern",function(){var m=this,$=n;return null==m.prefixes_pattern&&(m.prefixes_pattern=n),null==m.prefixes&&(m.prefixes=n),m.prefixes_pattern=P($=m.prefixes_pattern)?$:n,P(m.prefixes_pattern)?m.prefixes_pattern:(m.prefixes=P($=m.prefixes)?$:[],m.prefixes.$freeze(),m.prefixes_pattern=(P(m.prefixes["$empty?"]())?/(?!)/:K(["^(S)?(",m.prefixes.$join("|"),")"],"i")).$freeze())}),o(u,"$command_pattern",function(){var m=this,$=n,X=n;return null==m.command_pattern&&(m.command_pattern=n),null==m.prefixes&&(m.prefixes=n),m.command_pattern=P($=m.command_pattern)?$:n,P(m.command_pattern)?m.command_pattern:(m.prefixes=P($=m.prefixes)?$:[],m.prefixes.$freeze(),X=L(b(y(T("CommonCommand"),"COMMANDS"),"map",[],function(O){return null==O&&(O=n),y(O,"PREFIX_PATTERN").$source()}),m.prefixes),m.command_pattern=K(["^S?(",X.$join("|"),")"],"i").$freeze())}),o(u,"$eval",function(m){try{return A("eval_return"),this.$new(m).$eval()}catch(te){if(te===e.t_eval_return)return te.$v;throw te}}),s.$include(f("Translate")),s.$include(y(f("Deprecated"),"Checker")),o(s,"$initialize",function(v){var t=this;return t.raw_input=v,t.sort_add_dice=!1,t.sort_barabara_dice=!1,t.d66_sort_type=y(f("D66SortType"),"NO_SORT"),t.enabled_d9=!1,t.round_type=y(f("RoundType"),"FLOOR"),t.sides_implicit_d=6,t.upper_dice_reroll_threshold=n,t.reroll_dice_reroll_threshold=n,t.default_cmp_op=n,t.default_target_number=n,t.enabled_upcase_input=!0,t.locale="ja_jp",t.randomizer=y(f("BCDice"),"Randomizer").$new(),t.debug=!1}),s.$attr_accessor("randomizer"),s.$attr_reader("d66_sort_type"),s.$attr_reader("round_type"),s.$attr_reader("sides_implicit_d"),s.$attr_reader("upper_dice_reroll_threshold"),s.$attr_reader("reroll_dice_reroll_threshold"),s.$attr_reader("default_cmp_op"),s.$attr_reader("default_target_number"),o(s,"$sort_add_dice?",F("sort_add_dice")),o(s,"$sort_barabara_dice?",F("sort_barabara_dice")),o(s,"$enabled_d9?",F("enabled_d9")),o(s,"$enable_debug",D("debug",!0)),o(s,"$eval",function(){var t,i,v=this,T=n;return t=y(f("BCDice"),"Preprocessor").$process(v.raw_input,v),T=P(i=v.$dice_command(t))?i:v.$eval_common_command(v.raw_input),P(T)?(T["$rands="](v.randomizer.$rand_results()),T["$detailed_rands="](v.randomizer.$detailed_rand_results()),T):n}),o(s,"$change_text",function(v){return v}),o(s,"$check_result",function(v,t,T,i){var m=this,$=n,X=n,te=n,O=n,ue=n;return $=m.$check_result_legacy(v,t,T,i),P($)?$:(X=b(t,"map",[],"sides".$to_proc()),O=(te=b(t,"map",[],"value".$to_proc())).$sum(),$=Z([100],ue=X)?m.$result_1d100(v,O,T,i):Z([20],ue)?m.$result_1d20(v,O,T,i):Z([6,6],ue)?m.$result_2d6(v,O,te,T,i):n,j($,f("Result").$nothing())?n:P($)?$:($=Z([10],ue=X.$uniq())?m.$result_nd10(v,O,te,T,i):Z([6],ue)?m.$result_nd6(v,O,te,T,i):n,j($,f("Result").$nothing())?n:P($)?$:m.$result_ndx(v,T,i)))}),o(s,"$grich_text",G(n)),s.$private(),o(s,"$eval_common_command",function(v){try{A("eval_return");var T=A("return");return v=this.$change_text(v),b(y(f("CommonCommand"),"COMMANDS"),"each",[],function m($){var te,X=null==m.$$s?this:m.$$s;if(null==X.randomizer&&(X.randomizer=n),null==$&&($=n),te=$.$eval(v,X,X.randomizer),!P(te))return n;T.$throw(te)},{$$s:this,$$ret:T}),n}catch(m){if(m===e.t_eval_return||m===T)return m.$v;throw m}}),o(s,"$dice_command",function(v){var t=this,T=n,i=n,m=n,$=n;return P(t.enabled_upcase_input)&&(v=v.$upcase()),T=t.$class().$prefixes_pattern().$match(v),P(T)?(i=T["$[]"](1)["$nil?"]()["$!"](),P(i)&&(v=v["$[]"](U(1,-1,!1))),m=t.$eval_game_system_specific_command(v),P(m["$is_a?"](f("Result")))?(m["$secret="](P($=m["$secret?"]())?$:i),m):P(m["$nil?"]())||P(m["$empty?"]())||j(m,"1")?n:b(f("Result").$new(),"tap",[],function(te){var O;return null==te&&(te=n),te["$text="](m.$to_s()),b(te,"secret=",O=[i]),O[O.length-1]})):n}),o(s,"$eval_game_system_specific_command",G(n)),o(s,"$result_ndx",function(v,t,T){return P(T["$is_a?"](f("String")))?n:P(v.$send(t,T))?f("Result").$success(this.$translate("success")):f("Result").$failure(this.$translate("failure"))}),o(s,"$result_1d100",G(n)),o(s,"$result_1d20",G(n)),o(s,"$result_nd10",G(n)),o(s,"$result_2d6",G(n)),o(s,"$result_nd6",G(n)),o(s,"$get_table_by_2d6",function(v){return this.$get_table_by_nD6(v,2)}),o(s,"$get_table_by_1d6",function(v){return this.$get_table_by_nD6(v,1)}),o(s,"$get_table_by_nD6",function(v,t){return this.$get_table_by_nDx(v,t,6)}),o(s,"$get_table_by_nDx",function(v,t,T){var m,$=n;return m=this.randomizer.$roll_sum(t,T),$=this.$get_table_value(v["$[]"](z(m,t))),P($["$nil?"]())?["1",0]:[$,m]}),o(s,"$get_table_by_1d3",function(v){var i,m,t=this,$=n;return t.$debug("get_table_by_1d3"),i=t.randomizer.$roll_sum(1,6),t.$debug("num",i),m=a(z(i,1),2).$to_i(),t.$debug("index",m),$=v["$[]"](m),P($["$nil?"]())?["1",0]:[$,i]}),o(s,"$get_table_by_d66_swap",function(v){var T;return T=this.randomizer.$roll_d66(y(f("D66SortType"),"ASC")),[this.$get_table_by_number(T,v),T]}),o(s,"$get_table_by_d66",function(v){var T,i,m,X,$=n;return T=this.randomizer.$roll_once(6),i=this.randomizer.$roll_once(6),m=L(B(z(T,1),6),z(i,1)),$=v["$[]"](m),X=""+T+i,P($["$nil?"]())?["1",X]:[$,X]}),o(s,"$get_table_by_number",function(v,t,T){try{var i=A("return");return null==T&&(T="1"),b(t,"each",[],function $(X){var O,te=null==$.$$s?this:$.$$s;if(null==X&&(X=n),O=X["$[]"](0),!P(l(O,v)))return n;i.$throw(te.$get_table_value(X["$[]"](1)))},{$$s:this,$$ret:i}),this.$get_table_value(T)}catch($){if($===i)return $.$v;throw $}},-3),o(s,"$get_table_value",function(v){return P(v["$is_a?"](f("Proc")))?v.$call():v}),o(s,"$roll_tables",function(v,t){var i=n;return i=t["$[]"](v),P(i)?i.$roll(this.randomizer).$to_s():n}),o(s,"$debug",function(v,t){var i,m=this,$=n,X=n;return i=c(arguments,1),P(m.debug)?($=P(v["$is_a?"](f("String")))?v:v.$inspect(),P(i["$empty?"]())?m.$warn($):(X=b(i,"map",[],function(O){return null==O&&(O=n),P(O["$is_a?"](f("String")))?'"'+O+'"':O.$inspect()}),m.$warn($+": "+X.$join(", ")))):n},-2),y(y(r("I18n"),"Backend"),"Simple").$include(y(y(r("I18n"),"Backend"),"Fallbacks")),r("I18n").$load_path()["$<<"](r("Dir")["$[]"](r("File").$join("bcdice","../../i18n/**/*.yml"))),r("I18n")["$default_locale="]("ja_jp"),p=[["ja_jp"]],b(r("I18n").$fallbacks(),"defaults=",p),p[p.length-1]},Opal.modules["bcdice/game_system/sword_world/rating_lexer"]=function(e){var D,U,_,M,N,w,k,r,a,B,j,Y=e.module,H=e.klass,c=e.const_set,L=e.hash2,P=e.truthy,o=e.def,b=[],A=e.nil;return e.top.$require("strscan"),D=b,U=j=[Y(b[0],"BCDice")].concat(D),a=[Y(j[0],"GameSystem")].concat(U),B=e.$r(a),_=a,M=r=[H(a[0],B("Base"),"SwordWorld")].concat(_),w=[N=H(r[0],null,"RatingLexer")].concat(M),k=e.$r(w),N.$$prototype.scanner=A,c(w[0],"SYMBOLS",L(["+","-","*","/","(",")","[","]","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","[":"BRACKETL","]":"BRACKETR","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),o(N,"$initialize",function(g){var s,d,S;return g=P(S=(s=(d=g)===A||null==d?A:d.$split(" ",2))===A||null==s?A:s.$first())?S:"",this.scanner=k("StringScanner").$new(g)}),o(N,"$next_token",function(){var g=this,s=A,d=A,S=A;return P(g.scanner["$eos?"]())?[!1,"$"]:P(s=g.scanner.$scan(/\d+/))?["NUMBER",s.$to_i()]:(d=g.scanner.$getch().$upcase(),[P(S=k("SYMBOLS")["$[]"](d))?S:d.$to_sym(),d])}),o(N,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/game_system/sword_world/rating_parsed"]=function(e){var Z,z,I,N,w,k,E,h,n,B,l,G,Y=e.module,H=e.klass,c=e.def,L=e.truthy,P=e.rb_le,o=e.rb_plus,K=e.rb_lt,b=e.neqeq,A=[],F=e.nil;return Z=A,z=G=[Y(A[0],"BCDice")].concat(Z),B=[Y(G[0],"GameSystem")].concat(z),l=e.$r(B),I=B,N=n=[H(B[0],l("Base"),"SwordWorld")].concat(I),k=[w=H(n[0],null,"RatingParsed")].concat(N),E=e.$r(k),(h=w.$$prototype).modifier_after_half=h.semi_fixed_val=h.kept_modify=h.rate=h.greatest_fortune=h.modifier=F,w.$attr_accessor("rate"),w.$attr_accessor("critical"),w.$attr_accessor("kept_modify"),w.$attr_accessor("first_to"),w.$attr_accessor("first_modify"),w.$attr_accessor("rateup"),w.$attr_accessor("greatest_fortune"),w.$attr_accessor("semi_fixed_val"),w.$attr_accessor("tmp_fixed_val"),w.$attr_accessor("modifier"),w.$attr_accessor("modifier_after_half"),c(w,"$initialize",function(s,d){var f=this;return f.rate=s,f.modifier=d,f.critical=13,f.kept_modify=0,f.first_to=0,f.first_modify=0,f.greatest_fortune=!1,f.rateup=0,f.semi_fixed_val=0,f.tmp_fixed_val=0,f.modifier_after_half=F}),c(w,"$half",function(){return this.modifier_after_half["$nil?"]()["$!"]()}),c(w,"$min_critical",function(){var s=this;return L(P(s.semi_fixed_val,1))?3:o(o(s.semi_fixed_val,s.kept_modify),2).$clamp(3,13)}),c(w,"$infinite_roll?",function(){return K(this.$critical(),this.$min_critical())}),c(w,"$to_s",function(){var s=this,d=F;return d="KeyNo."+s.rate,L(K(s.$critical(),13))&&(d=o(d,"c["+s.$critical()+"]")),b(s.$first_modify(),0)&&(d=o(d,"m["+E("Format").$modifier(s.$first_modify())+"]")),b(s.$first_to(),0)&&(d=o(d,"m["+s.$first_to()+"]")),b(s.$rateup(),0)&&(d=o(d,"r["+s.$rateup()+"]")),L(s.greatest_fortune)&&(d=o(d,"gf")),b(s.$semi_fixed_val(),0)&&(d=o(d,"sf["+s.$semi_fixed_val()+"]")),b(s.$tmp_fixed_val(),0)&&(d=o(d,"tf["+s.$tmp_fixed_val()+"]")),b(s.$kept_modify(),0)&&(d=o(d,"a["+E("Format").$modifier(s.$kept_modify())+"]")),b(s.modifier,0)&&(d=o(d,E("Format").$modifier(s.modifier))),d})},Opal.modules["bcdice/game_system/sword_world/rating_options"]=function(e){var b,Z,B,r,p,G,U,F,Y=e.module,H=e.klass,c=e.truthy,L=e.def,P=[];return b=P,Z=F=[Y(P[0],"BCDice")].concat(b),G=[Y(F[0],"GameSystem")].concat(Z),U=e.$r(G),B=G,p=[H(G[0],U("Base"),"SwordWorld")].concat(B),(r=H(p[0],null,"RatingOptions")).$attr_accessor("critical"),r.$attr_accessor("kept_modify"),r.$attr_accessor("first_to"),r.$attr_accessor("first_modify"),r.$attr_accessor("rateup"),r.$attr_accessor("greatest_fortune"),r.$attr_accessor("semi_fixed_val"),r.$attr_accessor("tmp_fixed_val"),r.$attr_accessor("modifier"),r.$attr_accessor("modifier_after_half"),L(r,"$settable_first_roll_adjust_option?",function(){var M;return c(M=this.$first_modify()["$nil?"]())?this.$first_to()["$nil?"]():M}),L(r,"$settable_non_2d_roll_option?",function(){var M,N,y=this;return c(M=c(N=y.$greatest_fortune()["$nil?"]())?y.$semi_fixed_val()["$nil?"]():N)?y.$tmp_fixed_val()["$nil?"]():M})},Opal.modules["bcdice/game_system/sword_world/rating_parser"]=function(e){var p,n,E,S,T,i,m,$,X,te,O,ue,$e,_e,u,v,t,C,g,s,M,N,I,Y=e.module,H=e.klass,c=e.ensure_kwargs,L=e.send2,P=e.find_super,o=e.def,K=e.send,b=e.truthy,A=e.not,F=e.thrower,D=e.hash,Z=e.const_set,j=e.to_ary,G=e.eqeq,U=e.top,z=[],a=e.nil,B=e.$$$;return U.$require("racc/parser.rb"),U.$require("bcdice/arithmetic/node"),U.$require("bcdice/enum"),U.$require("bcdice/game_system/sword_world/rating_lexer"),U.$require("bcdice/game_system/sword_world/rating_parsed"),U.$require("bcdice/game_system/sword_world/rating_options"),p=z,n=I=[Y(z[0],"BCDice")].concat(p),M=[Y(I[0],"GameSystem")].concat(n),N=e.$r(M),E=M,g=[H(M[0],N("Base"),"SwordWorld")].concat(E),s=e.$r(g),S=g,v=[u=H(g[0],B(s("Racc"),"Parser"),"RatingParser")].concat(S),t=e.$r(v),(C=u.$$prototype).lexer=C.round_type=C.version=a,o(u,"$initialize",function V(x){var q,re,W=this;return V.$$p=null,null==(q=(x=c(x)).$$smap.version)&&(q="v1_0"),null==(re=x.$$smap.round_type)&&(re=B(t("RoundType"),"CEIL")),L(W,P(W,"initialize",V,!1,!0),"initialize",[],null),W.version=q,W.round_type=re},-1),o(u,"$set_debug",function(){return this.yydebug=!0,this}),o(u,"$parse",function(x){try{return this.lexer=t("RatingLexer").$new(x),this.$do_parse()}catch(re){if(!e.rescue(re,[t("ParseError"),t("ZeroDivisionError")]))throw re;try{return a}finally{e.pop_exception()}}}),u.$private(),o(u,"$parsed",function(x,q,re){try{return F("eval_return"),K(t("RatingParsed").$new(x,q),"tap",[],function J(Q){var ne,ie,le,fe,oe,de,me,be,he=null==J.$$s?this:J.$$s,ve=a;return null==he.round_type&&(he.round_type=a),null==Q&&(Q=a),Q["$kept_modify="](b(ve=(ne=re.$kept_modify())===a||null==ne?a:ne.$eval(he.round_type))?ve:0),Q["$first_to="](b(ve=re.$first_to())?ve:0),Q["$first_modify="](b(ve=re.$first_modify())?ve:0),Q["$rateup="](b(ve=(ie=re.$rateup())===a||null==ie?a:ie.$eval(he.round_type))?ve:0),A(re.$greatest_fortune()["$nil?"]())&&Q["$greatest_fortune="](re.$greatest_fortune()),Q["$semi_fixed_val="](b(ve=(le=re.$semi_fixed_val())===a||null==le?a:le.$clamp(1,6))?ve:0),Q["$tmp_fixed_val="](b(ve=(fe=re.$tmp_fixed_val())===a||null==fe?a:fe.$clamp(1,6))?ve:0),Q["$modifier_after_half="]((oe=re.$modifier_after_half())===a||null==oe?a:oe.$eval(he.round_type)),de=[b((be=re.$critical(),me=be===a||null==be?a:be.$eval(he.round_type),ve=me===a||null==me?a:me.$clamp(0,13)))?ve:b(Q.$half())?13:10],K(Q,"critical=",de),de[de.length-1]},{$$s:this})}catch(J){if(J===e.t_eval_return)return J.$v;throw J}}),o(u,"$next_token",function(){return this.lexer.$next_token()}),T=e.large_array_unpack("15,14,16,5,17,18,20,21,57,58,23,24,11,59,12,19,13,15,14,16,4,17,18,20,21,4,30,3,30,11,8,12,19,13,26,27,26,27,29,30,29,30,55,56,55,56,30,26,27,26,27,29,30,29,26,27,9,30,29,30,26,27,55,56,29,26,27,26,27,29,30,29,30,55,56,55,56,30,26,27,26,27,29,30,29,26,27,37,30,29,30,26,27,55,56,29,26,27,26,27,29,30,29,30,55,56,38,39,32,26,27,26,27,29,46,29,33,34,51,52,53,54"),i=e.large_array_unpack("6,6,6,1,6,6,6,6,49,49,10,10,6,49,6,6,6,22,22,22,3,22,22,22,22,0,11,0,12,22,4,22,22,22,11,11,12,12,11,14,12,15,41,41,43,43,19,14,14,15,15,14,20,15,19,19,5,21,19,23,20,20,44,44,20,21,21,23,23,21,24,23,26,45,45,50,50,27,24,24,26,26,24,29,26,27,27,16,55,27,56,29,29,62,62,29,55,55,56,56,55,57,56,58,63,63,17,18,13,57,57,58,58,57,25,58,13,13,33,34,38,39"),m=e.large_array_unpack("22,3,,17,28,56,-4,,,,0,24,26,106,37,39,80,99,100,44,50,55,13,57,68,97,70,75,,81,,,,116,117,,,,118,119,,30,,32,50,61,,,,-2,63,,,,,86,88,99,101,,,,81,92"),$=e.large_array_unpack("-33,-33,-4,-33,-33,-33,-1,-4,-3,64,-5,-33,-33,-33,-11,-33,-33,-33,-33,-33,-33,-33,-2,-33,-33,-33,-33,-33,-30,-33,-32,-7,-8,-33,-33,-12,-13,-14,-33,-33,-17,-18,-27,-19,-20,-21,-6,-28,-29,-33,-24,-9,-10,-15,-16,-33,-33,-33,-33,-31,-25,-26,-22,-23"),X=e.large_array_unpack("25,31,6,35,36,1,49,22,40,41,43,2,44,45,7,47,48,,50,,,,,,,,,,,,,,,,,,,,,,,,,,60,61,62,63"),te=e.large_array_unpack("5,5,3,5,5,1,7,3,5,6,6,2,6,6,2,5,5,,6,,,,,,,,,,,,,,,,,,,,,,,,,,5,5,6,6"),O=[a,5,11,0,a,-11,-11,-23,a],ue=[a,a,a,a,10,42,a,a,28],$e=e.large_array_unpack("0,0,racc_error,2,22,_reduce_1,3,22,_reduce_2,2,23,_reduce_3,0,24,_reduce_4,2,24,_reduce_5,4,24,_reduce_6,3,24,_reduce_7,3,24,_reduce_8,4,24,_reduce_9,4,24,_reduce_10,2,24,_reduce_11,3,24,_reduce_12,3,24,_reduce_13,3,24,_reduce_14,4,24,_reduce_15,4,24,_reduce_16,3,24,_reduce_17,2,25,_reduce_18,2,25,_reduce_19,3,25,_reduce_20,3,25,_reduce_21,3,28,_reduce_22,3,28,_reduce_23,1,28,_reduce_none,3,27,_reduce_25,3,27,_reduce_26,1,27,_reduce_none,2,26,_reduce_28,2,26,_reduce_29,1,26,_reduce_none,3,29,_reduce_31,1,29,_reduce_32"),_e=D(!1,0,"error",1,"NUMBER",2,"K",3,"R",4,"H",5,"G",6,"F",7,"S",8,"T",9,"PLUS",10,"MINUS",11,"ASTERISK",12,"SLASH",13,"PARENL",14,"PARENR",15,"BRACKETL",16,"BRACKETR",17,"AT",18,"SHARP",19,"DOLLAR",20),Z(v[0],"Racc_arg",[T,i,$,m,X,te,ue,O,21,$e,_e,64,33,!0]),Z(v[0],"Racc_token_to_s_table",["$end","error","NUMBER","K","R","H","G","F","S","T","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","BRACKETL","BRACKETR","AT","SHARP","DOLLAR","$start","expr","rate","option","modifier","unary","mul","add","term"]),Z(v[0],"Racc_debug_parser",!1),o(u,"$_reduce_1",function(x,q,re){try{F("eval_return");var W,ne,fe,ie=a,le=a;return ne=null==(W=j(x))[0]?a:W[0],le=b(fe=(ie=null==W[1]?a:W[1]).$modifier())?fe:B(B(t("Arithmetic"),"Node"),"Number").$new(0),this.$parsed(ne,le.$eval(this.round_type),ie)}catch(oe){if(oe===e.t_eval_return)return oe.$v;throw oe}}),o(u,"$_reduce_2",function(x,q,re){try{F("eval_return");var W,ie,fe,le=a,oe=a;return ie=null==(W=j(x))[1]?a:W[1],b((le=null==W[2]?a:W[2]).$modifier_after_half())||le["$modifier_after_half="](B(B(t("Arithmetic"),"Node"),"Number").$new(0)),oe=b(fe=le.$modifier())?fe:B(B(t("Arithmetic"),"Node"),"Number").$new(0),this.$parsed(ie,oe.$eval(this.round_type),le)}catch(de){if(de===e.t_eval_return)return de.$v;throw de}}),o(u,"$_reduce_3",function(x,q,re){return x["$[]"](1).$to_i()}),o(u,"$_reduce_4",function(x,q,re){return t("RatingOptions").$new()}),o(u,"$_reduce_5",function(x,q,re){var R,ne,Q=a;return ne=null==(R=j(x))[1]?a:R[1],b((Q=null==R[0]?a:R[0]).$modifier()["$nil?"]())||this.$raise(t("ParseError")),Q["$modifier="](ne),Q}),o(u,"$_reduce_6",function(x,q,re){var R,ie,Q=a;return ie=null==(R=j(x))[2]?a:R[2],b((Q=null==R[0]?a:R[0]).$critical()["$nil?"]())||this.$raise(t("ParseError")),Q["$critical="](ie),Q}),o(u,"$_reduce_7",function(x,q,re){var R,ie,Q=a;return ie=null==(R=j(x))[2]?a:R[2],b((Q=null==R[0]?a:R[0]).$critical()["$nil?"]())||this.$raise(t("ParseError")),Q["$critical="](ie),Q}),o(u,"$_reduce_8",function(x,q,re){var R,Q=a,ie=a;return ie=null==(R=j(x))[2]?a:R[2],b((Q=null==R[0]?a:R[0])["$settable_first_roll_adjust_option?"]())||this.$raise(t("ParseError")),Q["$first_to="](ie.$to_i()),Q}),o(u,"$_reduce_9",function(x,q,re){var R,Q=a,ie=a;return ie=null==(R=j(x))[3]?a:R[3],b((Q=null==R[0]?a:R[0])["$settable_first_roll_adjust_option?"]())||this.$raise(t("ParseError")),Q["$first_modify="](ie.$to_i()),Q}),o(u,"$_reduce_10",function(x,q,re){var R,Q=a,ie=a;return ie=null==(R=j(x))[3]?a:R[3],b((Q=null==R[0]?a:R[0])["$settable_first_roll_adjust_option?"]())||this.$raise(t("ParseError")),Q["$first_modify="](ie.$to_i()["$-@"]()),Q}),o(u,"$_reduce_11",function(x,q,re){var R,Q=a;return R=j(x),b((Q=null==R[0]?a:R[0]).$modifier_after_half()["$nil?"]())||this.$raise(t("ParseError")),Q["$modifier_after_half="](B(B(t("Arithmetic"),"Node"),"Number").$new(0)),Q}),o(u,"$_reduce_12",function(x,q,re){var R,ie,Q=a;return ie=null==(R=j(x))[2]?a:R[2],b((Q=null==R[0]?a:R[0]).$modifier_after_half()["$nil?"]())||this.$raise(t("ParseError")),Q["$modifier_after_half="](ie),Q}),o(u,"$_reduce_13",function(x,q,re){var R,ie,Q=a;return Q=null==(R=j(x))[0]?a:R[0],ie=null==R[2]?a:R[2],b(["v2_5","v2_0"]["$include?"](this.version))&&b(Q.$rateup()["$nil?"]())||this.$raise(t("ParseError")),Q["$rateup="](ie),Q}),o(u,"$_reduce_14",function(x,q,re){var R,Q=a;return Q=null==(R=j(x))[0]?a:R[0],b(["v2_5","v2_0"]["$include?"](this.version))&&b(Q["$settable_non_2d_roll_option?"]())||this.$raise(t("ParseError")),Q["$greatest_fortune="](!0),Q}),o(u,"$_reduce_15",function(x,q,re){var R,Q=a,ie=a;return Q=null==(R=j(x))[0]?a:R[0],ie=null==R[3]?a:R[3],b(["v2_5","v2_0"]["$include?"](this.version))&&b(Q["$settable_non_2d_roll_option?"]())||this.$raise(t("ParseError")),Q["$semi_fixed_val="](ie.$to_i()),Q}),o(u,"$_reduce_16",function(x,q,re){var R,Q=a,ie=a;return Q=null==(R=j(x))[0]?a:R[0],ie=null==R[3]?a:R[3],b(["v2_5","v2_0"]["$include?"](this.version))&&b(Q["$settable_non_2d_roll_option?"]())||this.$raise(t("ParseError")),Q["$tmp_fixed_val="](ie.$to_i()),Q}),o(u,"$_reduce_17",function(x,q,re){var R,ie,Q=a;return Q=null==(R=j(x))[0]?a:R[0],ie=null==R[2]?a:R[2],G(this.version,"v2_5")&&b(Q.$kept_modify()["$nil?"]())||this.$raise(t("ParseError")),Q["$kept_modify="](ie),Q}),o(u,"$_reduce_18",function(x,q,re){return x["$[]"](1)}),o(u,"$_reduce_19",function(x,q,re){return B(B(t("Arithmetic"),"Node"),"Negative").$new(x["$[]"](1))}),o(u,"$_reduce_20",function(x,q,re){return B(B(t("Arithmetic"),"Node"),"BinaryOp").$new(x["$[]"](0),"+",x["$[]"](2))}),o(u,"$_reduce_21",function(x,q,re){return B(B(t("Arithmetic"),"Node"),"BinaryOp").$new(x["$[]"](0),"-",x["$[]"](2))}),o(u,"$_reduce_22",function(x,q,re){return B(B(t("Arithmetic"),"Node"),"BinaryOp").$new(x["$[]"](0),"+",x["$[]"](2))}),o(u,"$_reduce_23",function(x,q,re){return B(B(t("Arithmetic"),"Node"),"BinaryOp").$new(x["$[]"](0),"-",x["$[]"](2))}),o(u,"$_reduce_25",function(x,q,re){return B(B(t("Arithmetic"),"Node"),"BinaryOp").$new(x["$[]"](0),"*",x["$[]"](2))}),o(u,"$_reduce_26",function(x,q,re){return B(B(t("Arithmetic"),"Node"),"DivideWithGameSystemDefault").$new(x["$[]"](0),x["$[]"](2))}),o(u,"$_reduce_28",function(x,q,re){return x["$[]"](1)}),o(u,"$_reduce_29",function(x,q,re){return B(B(t("Arithmetic"),"Node"),"Negative").$new(x["$[]"](1))}),o(u,"$_reduce_31",function(x,q,re){return x["$[]"](1)}),o(u,"$_reduce_32",function(x,q,re){return B(B(t("Arithmetic"),"Node"),"Number").$new(x["$[]"](0))}),o(u,"$_reduce_none",function(x,q,re){return x["$[]"](0)})},Opal.modules["bcdice/game_system/SwordWorld"]=function(e){var M,E,S,u,v,t,T,g,s,w,Y=e.module,H=e.klass,c=e.const_set,L=e.send2,P=e.find_super,o=e.def,K=e.truthy,b=e.rb_ge,A=e.rb_le,F=e.eqeq,D=e.neqeq,Z=e.rb_minus,j=e.rb_gt,G=e.hash2,U=e.send,z=e.to_ary,a=e.rb_plus,B=e.rb_lt,l=e.rb_times,p=e.thrower,_=e.rb_divide,I=e.top,r=[],n=e.nil;return I.$require("bcdice/base"),I.$require("bcdice/game_system/sword_world/rating_parser"),M=r,E=w=[Y(r[0],"BCDice")].concat(M),g=[Y(w[0],"GameSystem")].concat(E),s=e.$r(g),S=g,v=[u=H(g[0],s("Base"),"SwordWorld")].concat(S),t=e.$r(v),(T=u.$$prototype).rating_table=T.randomizer=n,c(v[0],"ID","SwordWorld"),c(v[0],"NAME","\u30bd\u30fc\u30c9\u30fb\u30ef\u30fc\u30eb\u30c9RPG"),c(v[0],"SORT_KEY","\u305d\u304a\u3068\u308f\u3042\u308b\u3068"),c(v[0],"HELP_MESSAGE","\u30fbSW\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3000(Kx[c]+m$f) (x:\u30ad\u30fc, c:\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024, m:\u30dc\u30fc\u30ca\u30b9, f:\u51fa\u76ee\u4fee\u6b63)\n"),u.$register_prefix("H?K"),o(u,"$initialize",function i(m){var X=this;return i.$$p=null,L(X,P(X,"initialize",i,!1,!0),"initialize",[m],null),X.rating_table=0}),o(u,"$result_2d6",function(m,$,X,te,O){return K(b($,12))?t("Result").$critical(this.$translate("SwordWorld.critical")):K(A($,2))?t("Result").$fumble(this.$translate("SwordWorld.fumble")):D(te,">=")||F(O,"?")?n:K(b(m,O))?t("Result").$success(this.$translate("success")):t("Result").$failure(this.$translate("failure"))}),o(u,"$eval_game_system_specific_command",function(m){return this.$rating(m)}),u.$private(),o(u,"$rating_parser",function(){return t("RatingParser").$new()}),o(u,"$rating",function(m){var $,X,te=this,O=n,ue=n,$e=n,ce=n,se=n,_e=n,ae=n,ee=n,C=n,V=n,x=n,q=n,re=n,R=n,J=n,Q=n;return te.$debug("rating string",m),O=te.$rating_parser().$parse(m),K(O)?(ue=te.$getSW2_0_RatingTable(),$e=Z(ue.$length(),1),te.$debug("keyMax",$e),K(j(O.$rate(),$e))?t("Result").$new(te.$translate("SwordWorld.keynumber_exceeds",G(["keyMax"],{keyMax:$e}))):K(O["$infinite_roll?"]())?t("Result").$new(te.$translate("SwordWorld.infinite_critical",G(["min_critical"],{min_critical:O.$min_critical()}))):(ce=te.$getNewRates(ue),se=O+" \uff1e ",_e=[],ae=[],ee=[],C=0,V=0,x=0,q=0,re=O.$first_to(),R=O.$first_modify(),function(){try{var ne=p("break");U(te,"loop",[],function ie(){var le,fe,be,he,oe=null==ie.$$s?this:ie.$$s,de=n,me=n;if(fe=oe.$rollDice(O,q),me=null==(le=z(fe))[1]?n:le[1],C=de=null==le[0]?n:le[0],D(re,0)?(C=de=re,re=0):D(R,0)&&(C=a(C,R),R=0),K(A(de,2))&&(_e["$<<"](de.$to_s()),ae["$<<"](me.$to_s()),ee["$<<"]("**"),q=a(q,1),ne.$throw()),D(O.$kept_modify(),0)&&D(C,2)&&(C=a(C,O.$kept_modify())),K(B(C,2))&&(C=2),K(j(C,12))&&(C=12),be=[a(O.$rate(),l(q,O.$rateup())),$e].$min(),oe.$debug("currentKey",be),he=ce["$[]"](C)["$[]"](be),oe.$debug("rateValue",he),x=a(x,he),V=a(V,C),_e["$<<"](C.$to_s()),ae["$<<"](me.$to_s()),ee["$<<"](K(j(C,2))?he:"**"),q=a(q,1),K(b(C,O.$critical())))return n;ne.$throw()},{$$s:te})}catch(ie){if(ie===ne)return ie.$v;throw ie}}(),X=te.$getResultText(x,O,ae,_e,ee,V,q),$=z(X),J=null==$[1]?n:$[1],Q=null==$[2]?n:$[2],se=a(se,null==$[0]?n:$[0]),U(t("Result").$new(),"tap",[],function(ie){var le;return null==ie&&(ie=n),ie["$text="](se),ie["$critical="](J),U(ie,"fumble=",le=[Q]),le[le.length-1]}))):(te.$debug("not matched"),"1")}),o(u,"$getSW2_0_RatingTable",function(){return["*,0,0,0,1,2,2,3,3,4,4","*,0,0,0,1,2,3,3,3,4,4","*,0,0,0,1,2,3,4,4,4,4","*,0,0,1,1,2,3,4,4,4,5","*,0,0,1,2,2,3,4,4,5,5","*,0,1,1,2,2,3,4,5,5,5","*,0,1,1,2,3,3,4,5,5,5","*,0,1,1,2,3,4,4,5,5,6","*,0,1,2,2,3,4,4,5,6,6","*,0,1,2,3,3,4,4,5,6,7","*,1,1,2,3,3,4,5,5,6,7","*,1,2,2,3,3,4,5,6,6,7","*,1,2,2,3,4,4,5,6,6,7","*,1,2,3,3,4,4,5,6,7,7","*,1,2,3,4,4,4,5,6,7,8","*,1,2,3,4,4,5,5,6,7,8","*,1,2,3,4,4,5,6,7,7,8","*,1,2,3,4,5,5,6,7,7,8","*,1,2,3,4,5,6,6,7,7,8","*,1,2,3,4,5,6,7,7,8,9","*,1,2,3,4,5,6,7,8,9,10","*,1,2,3,4,6,6,7,8,9,10","*,1,2,3,5,6,6,7,8,9,10","*,2,2,3,5,6,7,7,8,9,10","*,2,3,4,5,6,7,7,8,9,10","*,2,3,4,5,6,7,8,8,9,10","*,2,3,4,5,6,8,8,9,9,10","*,2,3,4,6,6,8,8,9,9,10","*,2,3,4,6,6,8,9,9,10,10","*,2,3,4,6,7,8,9,9,10,10","*,2,4,4,6,7,8,9,10,10,10","*,2,4,5,6,7,8,9,10,10,11","*,3,4,5,6,7,8,10,10,10,11","*,3,4,5,6,8,8,10,10,10,11","*,3,4,5,6,8,9,10,10,11,11","*,3,4,5,7,8,9,10,10,11,12","*,3,5,5,7,8,9,10,11,11,12","*,3,5,6,7,8,9,10,11,12,12","*,3,5,6,7,8,10,10,11,12,13","*,4,5,6,7,8,10,11,11,12,13","*,4,5,6,7,9,10,11,11,12,13","*,4,6,6,7,9,10,11,12,12,13","*,4,6,7,7,9,10,11,12,13,13","*,4,6,7,8,9,10,11,12,13,14","*,4,6,7,8,10,10,11,12,13,14","*,4,6,7,9,10,10,11,12,13,14","*,4,6,7,9,10,10,12,13,13,14","*,4,6,7,9,10,11,12,13,13,15","*,4,6,7,9,10,12,12,13,13,15","*,4,6,7,10,10,12,12,13,14,15","*,4,6,8,10,10,12,12,13,15,15","*,5,7,8,10,10,12,12,13,15,15","*,5,7,8,10,11,12,12,13,15,15","*,5,7,9,10,11,12,12,14,15,15","*,5,7,9,10,11,12,13,14,15,16","*,5,7,10,10,11,12,13,14,16,16","*,5,8,10,10,11,12,13,15,16,16","*,5,8,10,11,11,12,13,15,16,17","*,5,8,10,11,12,12,13,15,16,17","*,5,9,10,11,12,12,14,15,16,17","*,5,9,10,11,12,13,14,15,16,18","*,5,9,10,11,12,13,14,16,17,18","*,5,9,10,11,13,13,14,16,17,18","*,5,9,10,11,13,13,15,17,17,18","*,5,9,10,11,13,14,15,17,17,18","*,5,9,10,12,13,14,15,17,18,18","*,5,9,10,12,13,15,15,17,18,19","*,5,9,10,12,13,15,16,17,19,19","*,5,9,10,12,14,15,16,17,19,19","*,5,9,10,12,14,16,16,17,19,19","*,5,9,10,12,14,16,17,18,19,19","*,5,9,10,13,14,16,17,18,19,20","*,5,9,10,13,15,16,17,18,19,20","*,5,9,10,13,15,16,17,19,20,21","*,6,9,10,13,15,16,18,19,20,21","*,6,9,10,13,16,16,18,19,20,21","*,6,9,10,13,16,17,18,19,20,21","*,6,9,10,13,16,17,18,20,21,22","*,6,9,10,13,16,17,19,20,22,23","*,6,9,10,13,16,18,19,20,22,23","*,6,9,10,13,16,18,20,21,22,23","*,6,9,10,13,17,18,20,21,22,23","*,6,9,10,14,17,18,20,21,22,24","*,6,9,11,14,17,18,20,21,23,24","*,6,9,11,14,17,19,20,21,23,24","*,6,9,11,14,17,19,21,22,23,24","*,7,10,11,14,17,19,21,22,23,25","*,7,10,12,14,17,19,21,22,24,25","*,7,10,12,14,18,19,21,22,24,25","*,7,10,12,15,18,19,21,22,24,26","*,7,10,12,15,18,19,21,23,25,26","*,7,11,13,15,18,19,21,23,25,26","*,7,11,13,15,18,20,21,23,25,27","*,8,11,13,15,18,20,22,23,25,27","*,8,11,13,16,18,20,22,23,25,28","*,8,11,14,16,18,20,22,23,26,28","*,8,11,14,16,19,20,22,23,26,28","*,8,12,14,16,19,20,22,24,26,28","*,8,12,15,16,19,20,22,24,27,28","*,8,12,15,17,19,20,22,24,27,29","*,8,12,15,18,19,20,22,24,27,30"]}),o(u,"$getNewRates",function(m){var $,X,O=n,ue=n,$e=n,ce=n,se=n,_e=n,ae=n,ee=n,C=n,V=n,x=n;return O=[],ue=[],$e=[],ce=[],se=[],_e=[],ae=[],ee=[],C=[],V=[],x=[],U(m,"each",[],function(R){var W=n;return null==R&&(R=n),W=R.$split(/,/),x.$push(0),O.$push(W["$[]"](1).$to_i()),ue.$push(W["$[]"](2).$to_i()),$e.$push(W["$[]"](3).$to_i()),ce.$push(W["$[]"](4).$to_i()),se.$push(W["$[]"](5).$to_i()),_e.$push(W["$[]"](6).$to_i()),ae.$push(W["$[]"](7).$to_i()),ee.$push(W["$[]"](8).$to_i()),C.$push(W["$[]"](9).$to_i()),V.$push(W["$[]"](10).$to_i())}),F(this.rating_table,1)&&V["$[]="](31,($=[32,(X=[33,10],U(V,"[]=",X),X[X.length-1])],U(V,"[]=",$),$[$.length-1])),[x,x,x,O,ue,$e,ce,se,_e,ae,ee,C,V]}),o(u,"$rollDice",function(m,$){var te=n;return[(te=this.randomizer.$roll_barabara(2,6)).$sum(),te.$join(",")]}),o(u,"$getResultText",function(m,$,X,te,O,ue,$e){var se=n,_e=n,ae=n,ee=n,C=n;return(se=[]).$push("2D:["+X.$join(" ")+"]="+te.$join(",")),K(A(ue,2))?(se.$push(O.$join(",")),se.$push(this.$translate("SwordWorld.fumble")),[se.$join(" \uff1e "),!1,!0]):(K(j(O.$size(),1))||D($.$modifier(),0)?(_e=a(O.$join(","),t("Format").$modifier($.$modifier())),K($.$half())&&(_e="("+_e+")/2",D($.$modifier_after_half(),0)&&(_e=a(_e,t("Format").$modifier($.$modifier_after_half())))),se.$push(_e)):K($.$half())&&(_e=O.$first()+"/2",D($.$modifier_after_half(),0)&&(_e=a(_e,t("Format").$modifier($.$modifier_after_half()))),se.$push(_e)),K(j($e,1))&&(ae=this.$translate("SwordWorld.round_text",G(["reroll_count"],{reroll_count:Z($e,1)})),se.$push(ae)),ee=a(m,$.$modifier()),K($.$half())&&(ee=_(ee,2).$ceil(),D($.$modifier_after_half(),0)&&(ee=a(ee,$.$modifier_after_half()))),C=ee.$to_s(),se.$push(C),[se.$join(" \uff1e "),j($e,1),!1])})},Opal.modules["bcdice/game_system/sword_world/transcendent_test"]=function(e){var U,l,y,E,h,g,s,d,N,_,I,a,Y=e.module,H=e.klass,c=e.def,L=e.truthy,P=e.rb_lt,o=e.hash2,K=e.not,b=e.rb_ge,A=e.rb_plus,F=e.send,D=e.top,Z=[],j=e.nil;return D.$require("bcdice/result"),D.$require("bcdice/translate"),U=Z,l=a=[Y(Z[0],"BCDice")].concat(U),_=[Y(a[0],"GameSystem")].concat(l),I=e.$r(_),y=_,E=N=[H(_[0],I("SwordWorld"),"SwordWorld2_0")].concat(y),g=[h=H(N[0],null,"TranscendentTest")].concat(E),s=e.$r(g),(d=h.$$prototype).modifier=d.critical_value=d.expression=d.modifier_str=d.target=d.cmp_op=j,h.$include(s("Translate")),c(h,"$initialize",function(S,u,v,t,T){var i=this;return i.critical_value=S,i.modifier=u,i.cmp_op=v,i.target=t,i.locale=T,i.modifier_str=s("Format").$modifier(i.modifier),i.expression=i.$node_expression()}),c(h,"$execute",function(S){var T,i,m,u=this,v=j,t=j,$=j,X=j,te=j,O=j;if(L(P(u.critical_value,3)))return u.$translate("SwordWorld2_0.transcendent_critical_too_small",o(["expression"],{expression:u.expression}));if(t=[v=S.$roll_barabara(2,6)],T=v["$=="]([1,1]),i=v["$=="]([6,6]),K(T)&&K(i))for(;L(b(u.$sum_of_dice(t.$last()),u.critical_value));)t.$push(S.$roll_barabara(2,6));return m=u.$sum_of_dice(t),$=A(m,u.modifier),X=u.$result_status($,t.$length(),T,i),te=o(["success","failure","super_success","critical","fumble"],{success:u.$translate("success"),failure:u.$translate("failure"),super_success:u.$translate("SwordWorld2_0.super_success"),critical:u.$translate("SwordWorld.critical"),fumble:u.$translate("SwordWorld.fumble")}).$freeze()["$[]"](X),O=["("+u.expression+")",""+u.$dice_str(t,m)+u.modifier_str,$,te].$compact(),F(s("Result").$new(),"tap",[],function($e){var ce;return null==$e&&($e=j),$e["$text="](O.$join(" \uff1e ")),$e["$fumble="](X["$=="]("fumble")),$e["$critical="](X["$=="]("critical")),$e["$success="](["success","super_success","critical"]["$include?"](X)),ce=[["failure","fumble"]["$include?"](X)],F($e,"failure=",ce),ce[ce.length-1]})}),h.$private(),c(h,"$node_expression",function(){var u,S=this;return u="2D6@"+S.critical_value+S.modifier_str,L(S.target)?""+u+S.cmp_op+S.target:u}),c(h,"$sum_of_dice",function(S){return S.$flatten().$sum()}),c(h,"$dice_str",function(S,u){return""+u+F(S,"map",[],function(T){return null==T&&(T=j),"["+T.$join(",")+"]"}).$join()}),c(h,"$result_status",function(S,u,v,t){var T=this;return L(T.target)?L(v)?"fumble":L(t)?"critical":L(S.$send(T.cmp_op,T.target))?L(b(u,2))&&L(b(S,41))?"super_success":"success":"failure":"no_target"})},Opal.queue(function(e){var _,y,h,g,s,d,f,N,w,r,Y=e.module,H=e.klass,c=e.const_set,L=e.send2,P=e.find_super,o=e.def,K=e.eqeqeq,b=e.truthy,A=e.hash2,F=e.rb_gt,D=e.rb_plus,Z=e.eqeq,j=e.rb_times,G=e.send,U=e.neqeq,z=e.top,a=[],B=e.nil,l=e.$$$;return z.$require("bcdice/arithmetic_evaluator"),z.$require("bcdice/game_system/SwordWorld"),z.$require("bcdice/game_system/sword_world/transcendent_test"),_=a,y=r=[Y(a[0],"BCDice")].concat(_),N=[Y(r[0],"GameSystem")].concat(y),w=e.$r(N),h=N,s=[g=H(N[0],w("SwordWorld"),"SwordWorld2_0")].concat(h),d=e.$r(s),(f=g.$$prototype).locale=f.randomizer=B,c(s[0],"ID","SwordWorld2.0"),c(s[0],"NAME","\u30bd\u30fc\u30c9\u30fb\u30ef\u30fc\u30eb\u30c92.0"),c(s[0],"SORT_KEY","\u305d\u304a\u3068\u308f\u3042\u308b\u30682.0"),c(s[0],"HELP_MESSAGE",'\u81ea\u52d5\u7684\u6210\u529f\u3001\u6210\u529f\u3001\u5931\u6557\u3001\u81ea\u52d5\u7684\u5931\u6557\u306e\u81ea\u52d5\u5224\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u30fb\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3000(Kx)\n\u3000"K\u30ad\u30fc\u30ca\u30f3\u30d0\u30fc+\u30dc\u30fc\u30ca\u30b9"\u306e\u5f62\u3067\u8a18\u5165\u3057\u307e\u3059\u3002\n\u3000\u30dc\u30fc\u30ca\u30b9\u306e\u90e8\u5206\u306b\u300cK20+K30\u300d\u306e\u3088\u3046\u306b\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u53d6\u308b\u3053\u3068\u306f\u51fa\u6765\u307e\u305b\u3093\u3002\n\u3000\u307e\u305f\u3001\u30dc\u30fc\u30ca\u30b9\u306f\u8907\u6570\u53d6\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3082\u30c0\u30a4\u30b9\u30ed\u30fc\u30eb\u3068\u540c\u69d8\u306b\u3001\u4ed6\u306e\u30d7\u30ec\u30a4\u30e4\u30fc\u306b\u96a0\u308c\u3066\u30ed\u30fc\u30eb\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n\u3000\u4f8b\uff09K20\u3000\u3000\u3000K10+5\u3000\u3000\u3000k30\u3000\u3000\u3000k10+10\u3000\u3000\u3000Sk10-1\u3000\u3000\u3000k10+5+2\n\n\u30fb\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u306e\u8a2d\u5b9a\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u306f"[\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024]"\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u3000\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306f\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u502410\u3068\u3057\u307e\u3059\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u51e6\u7406\u304c\u5fc5\u8981\u306a\u3044\u3068\u304d\u306f13\u306a\u3069\u3068\u3057\u3066\u304f\u3060\u3055\u3044\u3002(\u9632\u5fa1\u6642\u306a\u3069\u306e\u5bfe\u5fdc)\n\u3000\u307e\u305f\u30bf\u30a4\u30d7\u306e\u8efd\u6e1b\u5316\u306e\u305f\u3081\u306b\u672b\u5c3e\u306b\u300c@\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u300d\u3067\u3082\u51e6\u7406\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\u3000\u4f8b\uff09K20[10]\u3000\u3000\u3000K10+5[9]\u3000\u3000\u3000k30[10]\u3000\u3000\u3000k10[9]+10\u3000\u3000\u3000k10-5@9\n\n\u30fb\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u306e\u534a\u6e1b (HKx, KxH+N)\n\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u306e\u5148\u982d\u307e\u305f\u306f\u672b\u5c3e\u306b"H"\u3092\u3064\u3051\u308b\u3068\u3001\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3092\u632f\u3063\u3066\u6700\u7d42\u7d50\u679c\u3092\u534a\u6e1b\u3055\u305b\u307e\u3059\u3002\n\u3000\u672b\u5c3e\u306b\u3064\u3051\u305f\u5834\u5408\u3001\u76f4\u5f8c\u306b\u4fee\u6b63\u3092\u3092\u3064\u3051\u308b\u3053\u3068\u3067\u3001\u534a\u6e1b\u5f8c\u306e\u52a0\u6e1b\u7b97\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u3000\u3053\u306e\u969b\u3001\u8907\u6570\u306e\u9805\u306b\u3088\u308b\u4fee\u6b63\u306b\u306f\u30ab\u30c3\u30b3\u3067\u56f2\u3046\u3053\u3068\u304c\u5fc5\u8981\u3067\u3059\uff08\u30ab\u30c3\u30b3\u304c\u306a\u3044\u3068\u30d1\u30fc\u30b9\u306b\u5931\u6557\u3057\u307e\u3059\uff09\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u3092\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u306a\u3057\u3068\u6271\u308f\u308c\u307e\u3059\u3002\n\u3000\u4f8b\uff09HK20\u3000\u3000K20h\u3000\u3000HK10-5@9\u3000\u3000K10-5@9H\u3000\u3000K20gfH\u3000\u3000K20+8H+2\u3000\u3000K20+8H(1+1)\n\n\u30fb\u30c0\u30a4\u30b9\u76ee\u306e\u4fee\u6b63\uff08\u904b\u547d\u5909\u8ee2\u3084\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u30ec\u30a4\u7528\uff09\n\u3000\u672b\u5c3e\u306b\u300c$\u4fee\u6b63\u5024\u300d\u3067\u30c0\u30a4\u30b9\u76ee\u306b\u4fee\u6b63\u304c\u304b\u304b\u308a\u307e\u3059\u3002\n\u3000$\uff0b\uff11\u3068\u4fee\u6b63\u8868\u8a18\u306a\u3089\u30c0\u30a4\u30b9\u76ee\u306b\uff0b\u4fee\u6b63\u3001\uff04\uff19\u306e\u3088\u3046\u306b\u56fa\u5b9a\u5024\u306a\u3089\u30c0\u30a4\u30b9\u76ee\u3092\u305d\u306e\u51fa\u76ee\u306b\u5dee\u3057\u66ff\u3048\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u3057\u305f\u5834\u5408\u3067\u3082\u56fa\u5b9a\u5024\u3084\u4fee\u6b63\u5024\u306e\u9069\u7528\u306f\u6700\u521d\u306e\u4e00\u56de\u3060\u3051\u3067\u3059\u3002\n\u3000\u4f8b\uff09K20$+1\u3000\u3000\u3000K10+5$9\u3000\u3000\u3000k10-5@9$+2\u3000\u3000\u3000k10[9]+10$9\n\n\u30fb\u9996\u5207\u308a\u5200\u7528\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u4e0a\u6607 r10\n\u3000\u4f8b\uff09K20r10\u3000K30+24@8R10\u3000K40+24@8$12r10\n\n\u30fb\u30b0\u30ec\u30a4\u30c6\u30b9\u30c8\u30d5\u30a9\u30fc\u30c1\u30e5\u30f3\u306f\u672b\u5c3e\u306b gf\n\u3000\u4f8b\uff09K20gf\u3000K30+24@8GF\u3000K40+24@8$12r10gf\n\n\u30fb\u5a01\u529b\u8868\u30921d+sf\u3067\u53c2\u7167 \u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5f8c\u3082\u7d99\u7d9a sf4\n\u3000\u4f8b\uff09k10sf4\u3000k0+5SF4@13\u3000k70+26sf3@9\n\n\u30fb\u5a01\u529b\u8868\u30921d+tf\u3067\u53c2\u7167 \u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5f8c\u306f2d\u3067\u53c2\u7167 tf3\n\u3000\u4f8b\uff09k10tf3\u3000k0+5TF4@13\u3000k70+26tf3@9\n\n\u30fb\u8d85\u8d8a\u5224\u5b9a\u7528\u306b2d6\u30ed\u30fc\u30eb\u306b 2D6@10 \u66f8\u5f0f\u3067\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u4ed8\u4e0e\u304c\u53ef\u80fd\u306b\u3002\n\u3000\u4f8b\uff092D6@10\u30002D6@10+11>=30\n\n\u30fb\u6210\u9577\u3000(Gr)\n\u3000\u672b\u5c3e\u306b\u6570\u5b57\u3092\u4ed8\u52a0\u3059\u308b\u3053\u3068\u3067\u3001\u8907\u6570\u56de\u306e\u6210\u9577\u3092\u307e\u3068\u3081\u3066\u884c\u3048\u307e\u3059\u3002\n\u3000\u4f8b\uff09Gr3\n\n\u30fb\u9632\u5fa1\u30d5\u30a1\u30f3\u30d6\u30eb\u8868\u3000(FT)\n\u3000\u9632\u5fa1\u30d5\u30a1\u30f3\u30d6\u30eb\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30fb\u7d61\u307f\u52b9\u679c\u8868\u3000(TT)\n\u3000\u7d61\u307f\u52b9\u679c\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n'),g.$register_prefix("H?K","Gr","2D6?@\\d+","FT","TT"),o(g,"$initialize",function S(u){var t=this;return S.$$p=null,L(t,P(t,"initialize",S,!1,!0),"initialize",[u],null),t.rating_table=2}),o(g,"$eval_game_system_specific_command",function S(u){var T,t=this,m=B;return S.$$p=null,K(/^Gr(\d+)?/i,T=u)?b(u["$=~"](/^Gr(\d+)/i))?t.$growth(d("Regexp").$last_match(1).$to_i()):t.$growth():K(/^2D6?@\d+/i,T)?(m=l(d("Command"),"Parser").$new(/2D6?/i,A(["round_type"],{round_type:l(l(d("BCDice"),"RoundType"),"CEIL")})).$enable_critical().$restrict_cmp_op_to(B,">=",">").$parse(u),b(m)?d("TranscendentTest").$new(m.$critical(),m.$modify_number(),m.$cmp_op(),m.$target_number(),t.locale).$execute(t.randomizer):B):K("FT",T)?t.$get_fumble_table():K("TT",T)?t.$get_tangle_table():L(t,P(t,"eval_game_system_specific_command",S,!1,!0),"eval_game_system_specific_command",[u],null)}),o(g,"$rating_parser",function(){return d("RatingParser").$new(A(["version"],{version:"v2_0"}))}),o(g,"$rollDice",function S(u,v){var T=this,i=B;return S.$$p=null,b(F(u.$semi_fixed_val(),0))?(i=T.randomizer.$roll_once(6),[D(i,u.$semi_fixed_val()),i+","+u.$semi_fixed_val()]):Z(v,0)&&b(F(u.$tmp_fixed_val(),0))?(i=T.randomizer.$roll_once(6),[D(i,u.$tmp_fixed_val()),i+","+u.$tmp_fixed_val()]):b(u.$greatest_fortune())?(i=T.randomizer.$roll_once(6),[j(i,2),i+","+i]):L(T,P(T,"rollDice",S,!1,!0),"rollDice",[u,v],null)}),o(g,"$growth",function(u){return null==u&&(u=1),G(e.Range.$new(1,u,!1),"map",[],function t(){return(null==t.$$s?this:t.$$s).$growth_step()},{$$s:this}).$join(" | ")},-1),o(g,"$growth_step",function(){var u=this,v=B,t=B,T=B;return t=(v=l(d("DiceTable"),"Table").$from_i18n("SwordWorld2_0.GrowthTable",u.locale)).$roll(u.randomizer),T=v.$roll(u.randomizer),U(t.$value(),T.$value())?"["+t.$value()+","+T.$value()+"]->("+t.$body()+" or "+T.$body()+")":"["+t.$value()+","+T.$value()+"]->("+t.$body()+")"}),o(g,"$get_fumble_table",function(){return l(d("DiceTable"),"Table").$from_i18n("SwordWorld2_0.FumbleTable",this.locale).$roll(this.randomizer)}),o(g,"$get_tangle_table",function(){return l(d("DiceTable"),"Table").$from_i18n("SwordWorld2_0.TangleTable",this.locale).$roll(this.randomizer)})})}}]);