(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[4810],{8991:(be,he,me)=>{me(9993),Opal.modules["i18n/backend/fallbacks"]=function(e){var J,i,t,r,a,v,K=e.module,G=e.class_variable_set,l=e.truthy,M=e.class_variable_get,A=e.def,g=e.send,h=e.send2,C=e.find_super,S=e.hash2,B=e.find_block_super,z=e.neqeq,W=e.thrower,ee=e.return_val,j=[],P=e.nil,w=e.$$$;return J=j,v=[a=K(j[0],"I18n")].concat(J),G(v[0],"@@fallbacks",P),i=e.get_singleton_class(a),t=[i].concat(v),r=e.$r(t),A(i,"$fallbacks",function(){var L=P;return G(t[1],"@@fallbacks",l(null!=t[1].$$cvars["@@fallbacks"]?"class variable":P)&&l(L=M(t[1],"@@fallbacks",!1))?L:w(w(r("I18n"),"Locale"),"Fallbacks").$new()),l(L=r("Thread").$current()["$[]"]("i18n_fallbacks"))?L:M(t[1],"@@fallbacks",!1)}),A(i,"$fallbacks=",function(N){var L;return G(t[1],"@@fallbacks",l(N["$is_a?"](r("Array")))?w(w(r("I18n"),"Locale"),"Fallbacks").$new(N):N),L=["i18n_fallbacks",M(t[1],"@@fallbacks",!1)],g(r("Thread").$current(),"[]=",L),L[L.length-1]}),function(i,q){var N,L,k,d,r=[K(i,"Backend")].concat(q);return N=r,k=[L=K(r[0],"Fallbacks")].concat(N),d=e.$r(k),A(L,"$translate",function D(m,y,c){try{var T=W("return"),_=D.$$p||P,U=this,I=P,o=P;return D.$$p=null,null==c&&(c=d("EMPTY_HASH")),l(c.$fetch("fallback",!0))?l(c["$[]"]("fallback_in_progress"))?h(U,C(U,"translate",D,!1,!0),"translate",[m,y,c],_):(l(c["$[]"]("default"))&&(I=U["$extract_non_symbol_default!"](c)),o=c.$merge(S(["fallback_in_progress"],{fallback_in_progress:!0})),g(d("I18n").$fallbacks()["$[]"](m),"each",[],function s(b){var $=null==s.$$s?this:s.$$s;null==b&&(b=P);try{return g($,"catch",["exception"],function u(){var n=null==u.$$s?this:u.$$s,p=P;if(p=h(n,B(n,"translate",u.$$def||s.$$def||D,!1,!1),"translate",[b,y,o],null),l(p["$nil?"]()))return P;z(m.$to_s(),b.$to_s())&&n.$on_fallback(m,b,y,c),T.$throw(p)},{$$s:$,$$ret:T})}catch(u){if(!e.rescue(u,[w(d("I18n"),"InvalidLocale")]))throw u;try{return P}finally{e.pop_exception()}}},{$$s:U}),l(c["$key?"]("default"))&&l(c["$[]"]("default")["$nil?"]())?P:l(I)?h(U,C(U,"translate",D,!1,!0),"translate",[m,P,c.$merge(S(["default"],{default:I}))],null):U.$throw("exception",w(d("I18n"),"MissingTranslation").$new(m,y,c))):h(U,C(U,"translate",D,!1,!0),"translate",[m,y,c],_)}catch(s){if(s===T)return s.$v;throw s}},-3),A(L,"$extract_non_symbol_default!",function(m){var c,y=P;return y=[m["$[]"]("default")].$flatten(),c=g(y,"detect",[],function(_){return null==_&&(_=P),_["$is_a?"](d("Symbol"))["$!"]()}),l(c)&&m["$[]="]("default",y["$[]"](0,y.$index(c))),c}),A(L,"$exists?",function D(m,y,c){try{var T=W("return"),_=D.$$p||P,U=this;return D.$$p=null,null==c&&(c=d("EMPTY_HASH")),l(c.$fetch("fallback",!0))?(g(d("I18n").$fallbacks()["$[]"](m),"each",[],function I(o){var s=null==I.$$s?this:I.$$s;null==o&&(o=P);try{if(!l(h(s,B(s,"exists?",I.$$def||D,!1,!1),"exists?",[o,y],null)))return P;T.$throw(!0)}catch(b){if(!e.rescue(b,[w(d("I18n"),"InvalidLocale")]))throw b;try{return P}finally{e.pop_exception()}}},{$$s:U,$$ret:T}),!1):h(U,C(U,"exists?",D,!1,!0),"exists?",[m,y,c],_)}catch(I){if(I===T)return I.$v;throw I}},-3),L.$private(),A(L,"$on_fallback",ee(P))}(v[0],v)},Opal.modules["bcdice/randomizer"]=function(e){var a,f,N,L,k,d,i,q,G=e.klass,l=e.const_set,M=e.def,A=e.truthy,g=e.rb_gt,h=e.rb_plus,C=e.rb_le,S=e.send,B=e.rb_minus,z=e.eqeq,W=e.rb_times,ee=e.eqeqeq,j=e.rb_ge,P=[],w=e.nil,O=e.$$$;return a=P,i=[(0,e.module)(P[0],"BCDice")].concat(a),q=e.$r(i),f=i,L=[N=G(i[0],null,"Randomizer")].concat(f),k=e.$r(L),(d=N.$$prototype).rand_results=d.detailed_rand_results=w,l(L[0],"UPPER_LIMIT_DICE_TIMES",200),l(L[0],"UPPER_LIMIT_DICE_SIDES",1e4),l(L[0],"UPPER_LIMIT_RANDS",1e4),M(N,"$initialize",function(){return this.rand_results=[],this.detailed_rand_results=[]}),N.$attr_reader("rand_results"),N.$attr_reader("detailed_rand_results"),l(L[0],"DetailedRandResult",k("Struct").$new("kind","sides","value")),M(N,"$roll_barabara",function(m,y){var c=this;return A(g(h(c.rand_results.$size(),m),k("UPPER_LIMIT_RANDS")))&&c.$raise(k("TooManyRandsError")),A(C(m,0))||A(g(m,k("UPPER_LIMIT_DICE_TIMES")))?[]:S(k("Array"),"new",[m],function T(){return(null==T.$$s?this:T.$$s).$roll_once(y)},{$$s:c})}),M(N,"$roll_sum",function(m,y){return this.$roll_barabara(m,y).$sum()}),M(N,"$roll_once",function(m){var c=w;return A(C(m,0))||A(g(m,k("UPPER_LIMIT_DICE_SIDES")))?0:(c=this.$rand_inner(m),this.$push_to_detail("normal",m,c),c)}),M(N,"$roll_index",function(m){return B(this.$roll_once(m),1)}),M(N,"$roll_tens_d10",function(){var c,y=w;return y=this.$rand_inner(10),z(y,10)&&(y=0),c=W(y,10),this.$push_to_detail("tens_d10",10,c),c}),M(N,"$roll_d9",function(){var y;return y=B(this.$rand_inner(10),1),this.$push_to_detail("d9",10,y),y}),M(N,"$roll_d66",function(m){var T,c=w;return c=S(k("Array"),"new",[2],function _(){return(null==_.$$s?this:_.$$s).$roll_once(6)},{$$s:this}),ee(O(k("D66SortType"),"ASC"),T=m)?c["$sort!"]():ee(O(k("D66SortType"),"DESC"),T)&&c["$sort!"]()["$reverse!"](),h(W(c["$[]"](0),10),c["$[]"](1))}),N.$private(),M(N,"$rand_inner",function(m){var c,y=this;return A(j(y.rand_results.$size(),k("UPPER_LIMIT_RANDS")))&&y.$raise(k("TooManyRandsError")),c=y.$random(m),y.rand_results["$<<"]([c,m]),c}),M(N,"$random",function(m){return h(k("Kernel").$rand(m),1)}),M(N,"$push_to_detail",function(m,y,c){var _;return _=k("DetailedRandResult").$new(m,y,c),this.detailed_rand_results.$push(_)}),G(i[0],q("StandardError"),"TooManyRandsError"),w},Opal.modules["bcdice/dice_table/roll_result"]=function(e){var S,ee,J,a,v,i,q,P,z,K=e.module,G=e.klass,l=e.def,M=e.truthy,A=e.return_val,g=[],h=e.nil;return S=g,ee=z=[K(g[0],"BCDice")].concat(S),J=P=[K(z[0],"DiceTable")].concat(ee),v=[a=G(P[0],null,"RollResult")].concat(J),i=e.$r(v),(q=a.$$prototype).table_name=q.value=q.body=h,l(a,"$initialize",function(r,f,N){var L=this;return L.table_name=r,L.value=f,L.body=N}),a.$attr_reader("table_name"),a.$attr_reader("value"),a.$attr_reader("body"),l(a,"$to_s",function(){var r=this;return r.table_name+"("+r.value+") \uff1e "+r.body}),l(a,"$last_body",function(){var r=this;return M(r.body["$is_a?"](i("RollResult")))?r.body.$last_body():r.body}),l(a,"$empty?",A(!1))},Opal.modules["bcdice/dice_table/chain_table"]=function(e){var S,ee,J,a,v,i,q,P,z,K=e.module,G=e.klass,l=e.truthy,M=e.def,A=e.rb_minus,g=[],h=e.nil;return S=g,ee=z=[K(g[0],"BCDice")].concat(S),J=P=[K(z[0],"DiceTable")].concat(ee),v=[a=G(P[0],null,"ChainTable")].concat(J),i=e.$r(v),(q=a.$$prototype).times=q.sides=q.items=q.name=h,M(a,"$initialize",function(r,f,N){var L=this,k=h;return L.name=r,L.items=N.$freeze(),k=/(\d+)D(\d+)/i.$match(f),l(k)||L.$raise(i("ArgumentError"),"Unexpected table type: "+f),L.times=k["$[]"](1).$to_i(),L.sides=k["$[]"](2).$to_i()}),M(a,"$roll",function(r){var N,L,f=this,k=h;return N=r.$roll_sum(f.times,f.sides),L=A(N,f.times),k=f.items["$[]"](L),l(k["$respond_to?"]("roll"))&&(k=k.$roll(r)),i("RollResult").$new(f.name,N,k)})},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(e){var W,w,i,q,t,r,f,J,j,K=e.module,G=e.klass,l=e.hash2,M=e.defs,A=e.def,g=e.rb_plus,h=e.rb_times,C=e.rb_minus,S=[],B=e.nil;return W=S,w=j=[K(S[0],"BCDice")].concat(W),i=J=[K(j[0],"DiceTable")].concat(w),t=[q=G(J[0],null,"D66GridTable")].concat(i),r=e.$r(t),(f=q.$$prototype).name=f.items=B,M(q,"$from_i18n",function(L,k){var D=B;return D=r("I18n").$t(L,l(["locale","raise"],{locale:k,raise:!0})),this.$new(D["$[]"]("name"),D["$[]"]("items"))}),A(q,"$initialize",function(L,k){return this.name=L,this.items=k.$freeze()}),A(q,"$roll",function(L){var d,D,m,y,c;return d=L.$roll_once(6),D=L.$roll_once(6),m=g(h(d,10),D),y=C(d,1),c=C(D,1),r("RollResult").$new(this.name,m,this.items["$[]"](y)["$[]"](c))})},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(e){var B,j,v,i,q,t,w,O,W,K=e.module,G=e.klass,l=e.hash2,M=e.defs,A=e.def,h=[],C=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),B=h,j=W=[K(h[0],"BCDice")].concat(B),w=[K(W[0],"DiceTable")].concat(j),O=e.$r(w),v=w,q=[i=G(w[0],O("D66GridTable"),"D66HalfGridTable")].concat(v),t=e.$r(q),M(i,"$from_i18n",function(f,N){var k=C;return k=t("I18n").$t(f,l(["locale","raise"],{locale:N,raise:!0})),this.$new(k["$[]"]("name"),k["$[]"]("items_1_2_3"),k["$[]"]("items_4_5_6"))}),A(i,"$initialize",function(f,N,L){return this.name=f,this.items=[N,N,N,L,L,L].$freeze()})},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(e){var B,j,v,i,q,t,w,O,W,K=e.module,G=e.klass,l=e.hash2,M=e.defs,A=e.def,h=[],C=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),B=h,j=W=[K(h[0],"BCDice")].concat(B),w=[K(W[0],"DiceTable")].concat(j),O=e.$r(w),v=w,q=[i=G(w[0],O("D66GridTable"),"D66OneThirdTable")].concat(v),t=e.$r(q),M(i,"$from_i18n",function(f,N){var k=C;return k=t("I18n").$t(f,l(["locale","raise"],{locale:N,raise:!0})),this.$new(k["$[]"]("name"),k["$[]"]("items_1_2"),k["$[]"]("items_3_4"),k["$[]"]("items_5_6"))}),A(i,"$initialize",function(f,N,L,k){return this.name=f,this.items=[N,N,L,L,k,k].$freeze()})},Opal.modules["bcdice/dice_table/d66_table"]=function(e){var j,J,t,r,f,N,L,v,w,K=e.module,G=e.klass,l=e.hash2,M=e.defs,A=e.def,g=e.eqeqeq,h=e.rb_plus,C=e.rb_times,S=e.truthy,B=[],z=e.nil,W=e.$$$;return j=B,J=w=[K(B[0],"BCDice")].concat(j),t=v=[K(w[0],"DiceTable")].concat(J),f=[r=G(v[0],null,"D66Table")].concat(t),N=e.$r(f),(L=r.$$prototype).sort_type=L.items=L.name=z,M(r,"$from_i18n",function(d,D){var c,y=z;return y=N("I18n").$t(d,l(["locale"],{locale:D})),c=N("D66SortType").$const_get(y["$[]"]("d66_sort_type")),this.$new(y["$[]"]("name"),c,y["$[]"]("items"))}),A(r,"$initialize",function(d,D,m){var y=this;return y.name=d,y.sort_type=D,y.items=m.$freeze()}),A(r,"$roll",function(d){var D=this,m=z,y=z,c=z,T=z;return m=d.$roll_barabara(2,6),g(W(N("D66SortType"),"ASC"),y=D.sort_type)?m["$sort!"]():g(W(N("D66SortType"),"DESC"),y)&&m["$sort!"]()["$reverse!"](),c=h(C(m["$[]"](0),10),m["$[]"](1)),T=S(y=D.items["$[]"](c))?y:D.items["$[]"](c.$to_s()),S(T["$respond_to?"]("roll"))&&(T=T.$roll(d)),N("RollResult").$new(D.name,c,T)}),A(r,"$choice",function(d){return N("RollResult").$new(this.name,d,this.items["$[]"](d))})},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(e){var P,a,i,q,O,K=e.module,G=e.klass,l=e.hash2,M=e.send,A=e.to_ary,g=e.rb_plus,h=e.rb_times,C=e.send2,S=e.find_super,B=e.def,W=[],ee=e.nil;return e.top.$require("bcdice/dice_table/d66_table"),P=W,a=O=[K(W[0],"BCDice")].concat(P),i=[K(O[0],"DiceTable")].concat(a),q=e.$r(i),B(G(i[0],q("D66Table"),"D66LeftRangeTable"),"$initialize",function N(L,k,d){var y;return N.$$p=null,y=l([],{}),M(d,"each",[],function(T){var _,o;return null==T&&(T=ee),_=A(T),o=null==_[1]?ee:_[1],M(null==_[0]?ee:_[0],"each",[],function(b){return null==b&&(b=ee),M(o,"each_with_index",[],function(u,n){var p,E;return null==u&&(u=ee),null==n&&(n=ee),E=g(h(b,10),g(n,1)),M(y,"[]=",p=[E,u]),p[p.length-1]})})}),C(this,S(this,"initialize",N,!1,!0),"initialize",[L,k,y],null)})},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(e){var ee,O,q,t,r,f,N,a,P,K=e.module,G=e.klass,l=e.hash2,M=e.defs,A=e.def,g=e.truthy,h=e.rb_minus,C=e.rb_plus,S=e.rb_times,B=[],z=e.nil;return ee=B,O=P=[K(B[0],"BCDice")].concat(ee),q=a=[K(P[0],"DiceTable")].concat(O),r=[t=G(a[0],null,"D66ParityTable")].concat(q),f=e.$r(r),(N=t.$$prototype).odd=N.even=N.name=z,M(t,"$from_i18n",function(k,d){var m=z;return m=f("I18n").$t(k,l(["locale","raise"],{locale:d,raise:!0})),this.$new(m["$[]"]("name"),m["$[]"]("odd"),m["$[]"]("even"))}),A(t,"$initialize",function(k,d,D){var m=this;return m.name=k,m.odd=d.$freeze(),m.even=D.$freeze()}),A(t,"$roll",function(k){var m,c,T,d=this,D=z;return D=k.$roll_once(6),m=k.$roll_once(6),c=(g(D["$odd?"]())?d.odd:d.even)["$[]"](h(m,1)),T=C(S(D,10),m),f("RollResult").$new(d.name,T,c)})},Opal.modules["bcdice/dice_table/d66_range_table"]=function(e){var B,j,a,v,i,q,t,w,W,K=e.module,G=e.klass,l=e.def,M=e.rb_plus,A=e.rb_times,g=e.send,h=[],C=e.nil;return B=h,j=W=[K(h[0],"BCDice")].concat(B),a=w=[K(W[0],"DiceTable")].concat(j),i=[v=G(w[0],null,"D66RangeTable")].concat(a),q=e.$r(i),(t=v.$$prototype).items=t.name=C,l(v,"$initialize",function(f,N){return this.name=f,this.items=N.$freeze()}),l(v,"$roll",function(f){var L,k,d,D=C;return L=f.$roll_once(6),k=f.$roll_once(6),d=M(A(L,10),k),D=g(this.items,"find",[],function(y){return null==y&&(y=C),y["$[]"](0)["$include?"](d)}),q("RollResult").$new(this.name,d,D["$[]"](1))})},Opal.modules["bcdice/dice_table/range_table"]=function(e){var ee,O,q,t,r,f,N,a,P,K=e.module,G=e.klass,l=e.const_set,M=e.send,A=e.truthy,g=e.def,h=e.eqeqeq,C=e.rb_times,S=e.rb_plus,B=[],z=e.nil;return ee=B,O=P=[K(B[0],"BCDice")].concat(ee),q=a=[K(P[0],"DiceTable")].concat(O),r=[t=G(a[0],null,"RangeTable")].concat(q),f=e.$r(r),(N=t.$$prototype).name=N.items=N.num_of_dice=N.num_of_sides=N.formatter=z,l(r[0],"RollResult",M(f("Struct"),"new",["sum","values","content","formatted"],function L(){return(null==L.$$s?this:L.$$s).$alias_method("to_s","formatted")},{$$s:t})),l(r[0],"Item",f("Struct").$new("range","content")),l(r[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),l(r[0],"DEFAULT_FORMATTER",M(t,"lambda",[],function(k,d){return null==k&&(k=z),null==d&&(d=z),k.$name()+"("+d.$sum()+") \uff1e "+d.$content()})),t.$attr_reader("name"),t.$attr_reader("num_of_dice"),t.$attr_reader("num_of_sides"),g(t,"$initialize",function L(k,d,D){var c,m=L.$$p||z,y=this,T=z;return L.$$p=null,y.name=k.$freeze(),y.formatter=A(c=m)?c:f("DEFAULT_FORMATTER"),T=f("DICE_ROLL_METHOD_RE").$match(d),A(T)||y.$raise(f("ArgumentError"),y.name+": invalid dice roll method: "+d),y.num_of_dice=T["$[]"](1).$to_i(),y.num_of_sides=T["$[]"](2).$to_i(),y.$store(D)}),g(t,"$fetch",function(k){var D,d=this;return D=M(d.items,"find",[],function(y){return null==y&&(y=z),y.$range()["$include?"](k)}),A(D)||d.$raise(f("RangeError"),d.name+": value is out of range: "+k),D}),g(t,"$roll",function(k){var m,d=this,D=z,y=z;return m=(D=k.$roll_barabara(d.num_of_dice,d.num_of_sides)).$sum(),(y=f("RollResult").$new(m,D,d.$fetch(m).$content()))["$formatted="](d.formatter["$[]"](d,y)),y}),t.$private(),g(t,"$store",function(k){var D,m,d=this;return D=M(k,"map",[],function y(c,T){return null==c&&(c=z),null==T&&(T=z),[(null==y.$$s?this:y.$$s).$coerce_to_int_range(c),T]},{$$s:d}),m=M(D,"sort_by",[],function(c,T){return null==c&&(c=z),null==T&&(T=z),c.$min()}),d.$assert_min_sum_is_covered(m),d.$assert_max_sum_is_covered(m),d.$assert_no_gap_or_overlap_in_ranges(m),d.items=M(m,"map",[],function(c,T){return null==c&&(c=z),null==T&&(T=z),f("Item").$new(c,T.$freeze()).$freeze()}).$freeze(),d}),g(t,"$coerce_to_int_range",function(k){var D;return h(f("Integer"),D=k)?f("Range").$new(k,k):h(f("Range"),D)&&A(k.$begin()["$is_a?"](f("Integer")))&&A(k.$end()["$is_a?"](f("Integer")))?k:this.$raise(f("TypeError"),this.name+": "+k+" ("+k.$class()+") must be an Integer or a Range with Integers ")}),g(t,"$assert_min_sum_is_covered",function(k){var D,d=this,m=z;return D=d.num_of_dice,m=k.$first()["$[]"](0),A(m["$include?"](D))||d.$raise(f("RangeError"),d.name+": min value ("+D+") is not covered: "+m),d}),g(t,"$assert_max_sum_is_covered",function(k){var D,d=this,m=z;return D=C(d.num_of_dice,d.num_of_sides),m=k.$last()["$[]"](0),A(m["$include?"](D))||d.$raise(f("RangeError"),d.name+": max value ("+D+") is not covered: "+m),d}),g(t,"$assert_no_gap_or_overlap_in_ranges",function(k){return M(k,"each_cons",[2],function D(m,y){var U,I,c=null==D.$$s?this:D.$$s,T=z,_=z;return null==c.name&&(c.name=z),null==m&&(m=z),null==y&&(y=z),T=m["$[]"](0),_=y["$[]"](0),U=T.$max(),I=S(U,1),A(_["$include?"](U))&&c.$raise(f("RangeError"),c.name+": Range overlap: "+T+" and "+_),A(_["$include?"](I))?z:c.$raise(f("RangeError"),c.name+": Range gap: "+T+" and "+_)},{$$s:this}),this})},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(e){var z,P,v,f,N,L,k,q,O,ee,K=e.module,G=e.klass,l=e.send,M=e.def,A=e.rb_minus,g=e.return_ivar,h=[],C=e.nil,S=e.$$$;return z=h,P=ee=[K(h[0],"BCDice")].concat(z),v=O=[K(ee[0],"DiceTable")].concat(P),f=q=[G(O[0],null,"SaiFicSkillTable")].concat(v),L=[N=G(q[0],null,"Category")].concat(f),k=e.$r(L),M(N,"$initialize",function(D,m,y,c){var T=this;return T.name=D,T.skills=l(m.$map(),"with_index",[2],function(U,I){return null==U&&(U=C),null==I&&(I=C),S(k("SaiFicSkillTable"),"Skill").$new(D,U,y,I,c)}),T.dice=y}),M(N,"$roll",function(D){return this.$skills()["$[]"](A(D.$roll_sum(2,6),2))}),M(N,"$to_s",g("name")),N.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(e){var C,W,O,q,t,a,j,B,K=e.module,G=e.klass,l=e.def,M=e.hash2,A=[],g=e.nil;return C=A,W=B=[K(A[0],"BCDice")].concat(C),O=j=[K(B[0],"DiceTable")].concat(W),a=[G(j[0],null,"SaiFicSkillTable")].concat(O),(t=(q=G(a[0],null,"Skill")).$$prototype).s_format=t.category_dice=t.row_dice=t.category_name=t.name=g,l(q,"$initialize",function(f,N,L,k,d){var D=this;return D.category_name=f,D.name=N,D.category_dice=L,D.row_dice=k,D.s_format=d}),l(q,"$to_s",function(){var f=this;return f.$format(f.s_format,M(["category_dice","row_dice","category_name","skill_name"],{category_dice:f.category_dice,row_dice:f.row_dice,category_name:f.category_name,skill_name:f.name}))}),q.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(e){var a,t,k,d,D,m,y,f,i,K=e.module,G=e.klass,l=e.ensure_kwargs,M=e.hash2,A=e.send,h=e.defs,C=e.const_set,S=e.to_ary,B=e.def,z=e.truthy,W=e.rb_minus,ee=e.rb_plus,j=e.top,P=[],w=e.nil,O=e.$$$;return j.$require("bcdice/dice_table/sai_fic_skill_table/category"),j.$require("bcdice/dice_table/sai_fic_skill_table/skill"),a=P,t=i=[K(P[0],"BCDice")].concat(a),k=f=[K(i[0],"DiceTable")].concat(t),D=[d=G(f[0],null,"SaiFicSkillTable")].concat(k),m=e.$r(D),(y=d.$$prototype).rtt=y.rtt_format=y.rct=y.rct_format=y.rttn=y.rttn_format=y.categories=w,h(d,"$from_i18n",function(T,_,U){var I,o,s,n,u=w;return null==(I=(U=l(U)).$$smap.rtt)&&(I=w),null==(o=U.$$smap.rct)&&(o=w),null==(s=U.$$smap.rttn)&&(s=w),n=(u=m("I18n").$t("RTT",M(["locale","raise","default"],{locale:_,raise:!1,default:M([],{})})).$merge(m("I18n").$t(T,M(["locale","raise"],{locale:_,raise:!0}))))["$[]"]("items"),u=A(u,"select",[],function(E,x){return null==E&&(E=w),null==x&&(x=w),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](E)}),this.$new(n,e.to_hash(u).$merge(M(["rtt","rct","rttn"],{rtt:I,rct:o,rttn:s})))},-3),C(D[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),C(D[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),C(D[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),C(D[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),B(d,"$initialize",function(T,_){var U,I,o,s,b,$,u,n=this;return null==(U=(_=l(_)).$$smap.rtt)&&(U=w),null==(I=_.$$smap.rct)&&(I=w),null==(o=_.$$smap.rttn)&&(o=w),null==(s=_.$$smap.rtt_format)&&(s=m("DEFAULT_RTT")),null==(b=_.$$smap.rct_format)&&(b=m("DEFAULT_RCT")),null==($=_.$$smap.rttn_format)&&($=m("DEFAULT_RTTN")),null==(u=_.$$smap.s_format)&&(u=m("DEFAULT_S")),n.categories=A(T.$map(),"with_index",[1],function(E,x){var F,ne,V;return null==E&&(E=w),null==x&&(x=w),ne=null==(F=S(E))[0]?w:F[0],V=null==F[1]?w:F[1],O(m("SaiFicSkillTable"),"Category").$new(ne,V,x,u)},{$$has_top_level_mlhs_arg:!0}),n.rtt=U,n.rct=I,n.rttn=o.$to_a(),n.rtt_format=s,n.rct_format=b,n.rttn_format=$},-2),C(D[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),d.$attr_reader("categories"),B(d,"$roll_command",function(T,_){var I,U=this,o=w,s=w;return z(["RTT",U.rtt]["$include?"](I=_))?U.$format_skill(U.rtt_format,U.$roll_skill(T)):z(["RCT",U.rct]["$include?"](I))?(o=U.$roll_category(T),U.$format(U.rct_format,M(["category_dice","category_name"],{category_dice:o.$dice(),category_name:o.$name()}))):z(s=m("RTTN").$index(I))||z(s=U.rttn.$index(I))?U.$format_skill(U.rttn_format,U.categories["$[]"](s).$roll(T)):w}),B(d,"$roll_category",function(T){return this.categories["$[]"](W(T.$roll_once(6),1))}),B(d,"$roll_skill",function(T){return this.$roll_category(T).$roll(T)}),B(d,"$prefixes",function(){var T=this;return ee(["RTT[1-6]?","RCT",T.rtt,T.rct],T.rttn).$compact()}),d.$private(),B(d,"$format_skill",function(T,_){return this.$format(T,M(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:_.$category_dice(),row_dice:_.$row_dice(),category_name:_.$category_name(),skill_name:_.$name(),text:_.$to_s()}))})},Opal.modules["bcdice/dice_table/table"]=function(e){var z,P,v,i,q,t,r,O,ee,K=e.module,G=e.klass,l=e.hash2,M=e.defs,A=e.truthy,g=e.def,h=e.rb_minus,C=[],S=e.nil;return z=C,P=ee=[K(C[0],"BCDice")].concat(z),v=O=[K(ee[0],"DiceTable")].concat(P),q=[i=G(O[0],null,"Table")].concat(v),t=e.$r(q),(r=i.$$prototype).times=r.sides=r.name=r.items=S,M(i,"$from_i18n",function(N,L){var d=S;return d=t("I18n").$t(N,l(["locale"],{locale:L})),this.$new(d["$[]"]("name"),d["$[]"]("type"),d["$[]"]("items"))}),g(i,"$initialize",function(N,L,k){var d=this,D=S;return d.name=N,d.items=k.$freeze(),D=/(\d+)D(\d+)/i.$match(L),A(D)||d.$raise(t("ArgumentError"),"Unexpected table type: "+L),d.times=D["$[]"](1).$to_i(),d.sides=D["$[]"](2).$to_i()}),g(i,"$roll",function(N){var k,L=this;return k=N.$roll_sum(L.times,L.sides),L.$choice(k)}),g(i,"$choice",function(N){var k,L=this;return k=h(N,L.times),t("RollResult").$new(L.name,N,L.items["$[]"](k))})},Opal.modules["bcdice/dice_table"]=function(e){var K=e.top;return K.$require("bcdice/dice_table/roll_result"),K.$require("bcdice/dice_table/chain_table"),K.$require("bcdice/dice_table/d66_grid_table"),K.$require("bcdice/dice_table/d66_half_grid_table"),K.$require("bcdice/dice_table/d66_one_third_table"),K.$require("bcdice/dice_table/d66_left_range_table"),K.$require("bcdice/dice_table/d66_parity_table"),K.$require("bcdice/dice_table/d66_range_table"),K.$require("bcdice/dice_table/d66_table"),K.$require("bcdice/dice_table/range_table"),K.$require("bcdice/dice_table/sai_fic_skill_table"),K.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(e){var g,B,W,C,K=e.module,G=e.const_set,l=[];return g=l,B=C=[K(l[0],"BCDice")].concat(g),W=[K(C[0],"D66SortType")].concat(B),G(W[0],"NO_SORT","no_sort"),G(W[0],"ASC","asc"),G(W[0],"DESC","desc"),function(S,B){var W=[K(S,"RoundType")].concat(B);return G(W[0],"CEIL","ceil"),G(W[0],"FLOOR","floor"),G(W[0],"ROUND","round")}(C[0],C)},Opal.modules["bcdice/translate"]=function(e){var B,j,P,w,O,W,K=e.module,G=e.ensure_kwargs,l=e.kwrestargs,A=e.hash2,g=e.def,h=[],C=e.nil;return B=h,j=W=[K(h[0],"BCDice")].concat(B),w=[P=K(W[0],"Translate")].concat(j),O=e.$r(w),g(P,"$translate",function(a,v){var i,q=this;return null==q.locale&&(q.locale=C),v=G(v),i=l(v,{}),O("I18n").$translate(a,A(["locale","raise"],{locale:q.locale,raise:!0}).$merge(e.to_hash(i)))},-2)},Opal.modules["bcdice/result"]=function(e){var P,J,w,B,W,G=e.klass,l=e.send,M=e.def,A=e.return_val,g=e.return_ivar,h=[],C=e.nil;return B=h,P=W=[(0,e.module)(h[0],"BCDice")].concat(B),[w=G(W[0],null,"Result")].concat(P),M(J=e.get_singleton_class(w),"$success",function(i){return l(this.$new(),"tap",[],function(r){var f;return null==r&&(r=C),r["$text="](i),l(r,"success=",f=[!0]),f[f.length-1]})}),M(J,"$failure",function(i){return l(this.$new(),"tap",[],function(r){var f;return null==r&&(r=C),r["$text="](i),l(r,"failure=",f=[!0]),f[f.length-1]})}),M(J,"$critical",function(i){return l(this.$new(),"tap",[],function(r){var f;return null==r&&(r=C),r["$text="](i),r["$critical="](!0),l(r,"success=",f=[!0]),f[f.length-1]})}),M(J,"$fumble",function(i){return l(this.$new(),"tap",[],function(r){var f;return null==r&&(r=C),r["$text="](i),r["$fumble="](!0),l(r,"failure=",f=[!0]),f[f.length-1]})}),M(J,"$nothing",A("nothing")),M(w,"$initialize",function(a){var v=this;return null==a&&(a=C),v.text=a,v.rands=C,v.detailed_rands=C,v.secret=!1,v.success=!1,v.failure=!1,v.critical=!1,v.fumble=!1},-1),w.$attr_accessor("text","rands","detailed_rands"),w.$attr_writer("secret","success","failure","critical","fumble"),M(w,"$secret?",g("secret")),M(w,"$success?",g("success")),M(w,"$failure?",g("failure")),M(w,"$critical?",g("critical")),M(w,"$fumble?",g("fumble")),M(w,"$condition=",function(a){return this.success=a,this.failure=a["$!"]()})},Opal.modules["racc/parser"]=function(e){var N,k,d,K=e.module,G=e.klass,l=e.truthy,M=e.const_set,A=e.defs,g=e.gvars,h=e.rb_lt,C=e.def,S=e.to_ary,B=e.send,z=e.neqeq,W=e.rb_plus,ee=e.eqeq,j=e.rb_ge,P=e.rb_gt,w=e.rb_minus,O=e.rb_le,J=e.rb_times,a=e.assign_ivar_val,i=[],q=e.$r(i),t=e.nil,r=e.$$$;return N=i,k=[K(i[0],"Racc")].concat(N),d=e.$r(k),G(k[0],d("StandardError"),"ParseError"),l(r("::","ParseError","skip_raise")?"constant":t)||M(i[0],"ParseError",r(q("Racc"),"ParseError")),function(f,N){var c,T,_,U,I,d=[K(f,"Racc")].concat(N),D=e.$r(d);return l(D("Racc_No_Extensions","skip_raise")?"constant":t)||M(d[0],"Racc_No_Extensions",!1),c=d,_=[T=G(d[0],null,"Parser")].concat(c),U=e.$r(_),(I=T.$$prototype).yydebug=I.racc_debug_out=I.racc_error_status=I.racc_t=I.racc_vstack=I.racc_val=I.racc_state=I.racc_tstack=t,M(_[0],"Racc_Runtime_Version","1.4.6"),M(_[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),M(_[0],"Racc_Runtime_Core_Version_R","1.4.6"),M(_[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),M(_[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),M(_[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),M(_[0],"Racc_Runtime_Core_Version",U("Racc_Runtime_Core_Version_R")),M(_[0],"Racc_Runtime_Core_Revision",U("Racc_Runtime_Core_Revision_R")),M(_[0],"Racc_Runtime_Type","ruby"),A(U("Parser"),"$racc_runtime_type",function(){return U("Racc_Runtime_Type")}),C(T,"$_racc_setup",function(){var s,b,$=this,u=t,n=t;return null==g.stderr&&(g.stderr=t),l(r($.$class(),"Racc_debug_parser"))||($.yydebug=!1),l(null!=(s=$.yydebug)&&s!==t?"instance-variable":t)||($.yydebug=!1),l($.yydebug)&&(l(null!=(b=$.racc_debug_out)&&b!==t?"instance-variable":t)||($.racc_debug_out=g.stderr),$.racc_debug_out=l(u=$.racc_debug_out)?u:g.stderr),n=r($.$class(),"Racc_arg"),l(h(n.$size(),14))&&n["$[]="](13,!0),n}),C(T,"$_racc_init_sysvars",function(){var s=this;return s.racc_state=[0],s.racc_tstack=[],s.racc_vstack=[],s.racc_t=t,s.racc_val=t,s.racc_read_next=!0,s.racc_user_yyerror=!1,s.racc_error_status=0}),C(T,"$do_parse",function(){return this.$__send__(U("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)}),C(T,"$next_token",function(){return this.$raise(U("NotImplementedError"),this.$class()+"#next_token is not defined")}),C(T,"$_racc_do_parse_rb",function(s,b){var $,n=this,p=t,E=t,x=t,F=t,ne=t,V=t,re=t,te=t;return $=S(s),p=null==$[0]?t:$[0],E=null==$[1]?t:$[1],x=null==$[2]?t:$[2],F=null==$[3]?t:$[3],ne=null==$[10]?t:$[10],n.$_racc_init_sysvars(),V=re=te=t,B(n,"catch",["racc_end_parse"],function Y(){var R,X,Z=null==Y.$$s?this:Y.$$s,H=t;for(null==Z.racc_state&&(Z.racc_state=t),null==Z.racc_read_next&&(Z.racc_read_next=t),null==Z.racc_t&&(Z.racc_t=t),null==Z.yydebug&&(Z.yydebug=t),null==Z.racc_val&&(Z.racc_val=t);l(!0);)for(l(te=F["$[]"](Z.racc_state["$[]"](-1)))?(l(Z.racc_read_next)&&z(Z.racc_t,0)&&(X=Z.$next_token(),R=S(X),V=null==R[0]?t:R[0],Z.racc_val=null==R[1]?t:R[1],Z.racc_t=l(V)?l(H=ne["$[]"](V))?H:1:0,l(Z.yydebug)&&Z.$racc_read_token(Z.racc_t,V,Z.racc_val),Z.racc_read_next=!1),te=W(te,Z.racc_t),l(j(te,0))&&l(re=p["$[]"](te))&&ee(E["$[]"](te),Z.racc_state["$[]"](-1))||(re=x["$[]"](Z.racc_state["$[]"](-1)))):re=x["$[]"](Z.racc_state["$[]"](-1));l(re=Z.$_racc_evalact(re,s)););},{$$s:n})}),C(T,"$yyparse",function(s,b){return this.$__send__(U("Racc_YY_Parse_Method"),s,b,this.$_racc_setup(),!0)}),C(T,"$_racc_yyparse_rb",function(s,b,$,u){var n,E=this,x=t,F=t,Q=t,ne=t,re=t,te=t,Y=t;return n=S($),x=null==n[0]?t:n[0],F=null==n[1]?t:n[1],Q=null==n[2]?t:n[2],ne=null==n[3]?t:n[3],re=null==n[10]?t:n[10],E.$_racc_init_sysvars(),te=t,Y=t,B(E,"catch",["racc_end_parse"],function R(){var X=null==R.$$s?this:R.$$s;for(null==X.racc_state&&(X.racc_state=t);!l(Y=ne["$[]"](X.racc_state["$[]"](-1)));)for(;l(te=X.$_racc_evalact(Q["$[]"](X.racc_state["$[]"](-1)),$)););return B(s,"__send__",[b],function Z(H,ae){var ie=null==Z.$$s?this:Z.$$s,se=t,$e=t;for(null==ie.racc_t&&(ie.racc_t=t),null==ie.racc_state&&(ie.racc_state=t),null==ie.racc_read_next&&(ie.racc_read_next=t),null==H&&(H=t),null==ae&&(ae=t),ie.racc_t=l(H)?l(se=re["$[]"](H))?se:1:0,ie.racc_val=ae,ie.racc_read_next=!1,Y=W(Y,ie.racc_t),l(j(Y,0))&&l(te=x["$[]"](Y))&&ee(F["$[]"](Y),ie.racc_state["$[]"](-1))||(te=Q["$[]"](ie.racc_state["$[]"](-1)));l(te=ie.$_racc_evalact(te,$)););for(;l(l(se=l($e=(Y=ne["$[]"](ie.racc_state["$[]"](-1)))["$!"]())?$e:ie.racc_read_next["$!"]())?se:ie.racc_t["$=="](0));)for(l(Y)&&l(Y=W(Y,ie.racc_t))&&l(j(Y,0))&&l(te=x["$[]"](Y))&&ee(F["$[]"](Y),ie.racc_state["$[]"](-1))||(te=Q["$[]"](ie.racc_state["$[]"](-1)));l(te=ie.$_racc_evalact(te,$)););},{$$s:X})},{$$s:E})}),C(T,"$_racc_evalact",function(s,b){var $,Q,n=this,p=t,E=t,F=t,ne=t,V=t,re=t;if(p=null==($=S(b))[0]?t:$[0],E=null==$[1]?t:$[1],F=null==$[3]?t:$[3],Q=null==$[11]?t:$[11],ne=null==$[12]?t:$[12],l(P(s,0))&&l(h(s,Q)))l(P(n.racc_error_status,0))&&(ee(n.racc_t,1)||(n.racc_error_status=w(n.racc_error_status,1))),n.racc_vstack.$push(n.racc_val),n.racc_state.$push(s),n.racc_read_next=!0,l(n.yydebug)&&(n.racc_tstack.$push(n.racc_t),n.$racc_shift(n.racc_t,n.racc_tstack,n.racc_vstack));else if(l(h(s,0))&&l(P(s,ne["$-@"]()))){if(V=B(n,"catch",["racc_jump"],function te(){var Y=null==te.$$s?this:te.$$s;return null==Y.racc_state&&(Y.racc_state=t),Y.racc_state.$push(Y.$_racc_do_reduce(b,s)),!1},{$$s:n}),l(V))switch(V){case 1:return n.racc_user_yyerror=!0,ne["$-@"]();case 2:return Q;default:n.$raise("[Racc Bug] unknown jump code")}}else if(ee(s,Q))l(n.yydebug)&&n.$racc_accept(),n.$throw("racc_end_parse",n.racc_vstack["$[]"](0));else{if(ee(s,ne["$-@"]())){switch(n.racc_error_status){case 0:l(b["$[]"](21))||n.$on_error(n.racc_t,n.racc_val,n.racc_vstack);break;case 3:ee(n.racc_t,0)&&n.$throw("racc_end_parse",t),n.racc_read_next=!0}for(n.racc_user_yyerror=!1,n.racc_error_status=3;l(!0)&&!(l(re=F["$[]"](n.racc_state["$[]"](-1)))&&(re=W(re,1),l(j(re,0))&&l(s=p["$[]"](re))&&ee(E["$[]"](re),n.racc_state["$[]"](-1))));)l(O(n.racc_state.$size(),1))&&n.$throw("racc_end_parse",t),n.racc_state.$pop(),n.racc_vstack.$pop(),l(n.yydebug)&&(n.racc_tstack.$pop(),n.$racc_e_pop(n.racc_state,n.racc_tstack,n.racc_vstack));return s}n.$raise("[Racc Bug] unknown action "+s.$inspect())}return l(n.yydebug)&&n.$racc_next_state(n.racc_state["$[]"](-1),n.racc_state),t}),C(T,"$_racc_do_reduce",function(s,b){var $,ne,re,H,ae,ie,ue,n=this,E=t,x=t,F=t,Q=t,V=t,te=t,Y=t,R=t,X=t,Z=t,se=t,$e=t,ce=t;return E=null==($=S(s))[4]?t:$[4],x=null==$[5]?t:$[5],F=null==$[6]?t:$[6],Q=null==$[7]?t:$[7],ne=null==$[8]?t:$[8],V=null==$[9]?t:$[9],re=null==$[13]?t:$[13],te=n.racc_state,Y=n.racc_vstack,R=n.racc_tstack,X=J(b,-3),Z=V["$[]"](X),H=V["$[]"](W(X,1)),ae=V["$[]"](W(X,2)),ie=[],l(n.yydebug)&&(se=R["$[]"](Z["$-@"](),Z)),$e=Y["$[]"](Z["$-@"](),Z),l(n.yydebug)&&R["$[]="](Z["$-@"](),Z,ie),Y["$[]="](Z["$-@"](),Z,ie),te["$[]="](Z["$-@"](),Z,ie),l(re)?Y.$push(n.$__send__(ae,$e,Y,$e["$[]"](0))):Y.$push(n.$__send__(ae,$e,Y)),R.$push(H),l(n.yydebug)&&n.$racc_reduce(se,H,R,Y),ue=w(H,ne),l(X=Q["$[]"](ue))&&(X=W(X,te["$[]"](-1)),l(j(X,0))&&l(ce=E["$[]"](X))&&ee(x["$[]"](X),ue))?ce:F["$[]"](ue)}),C(T,"$on_error",function(s,b,$){var n,u=this;return u.$raise(U("ParseError"),u.$sprintf("\nparse error on value %s (%s)",b.$inspect(),l(n=u.$token_to_str(s))?n:"?"))}),C(T,"$yyerror",function(){return this.$throw("racc_jump",1)}),C(T,"$yyaccept",function(){return this.$throw("racc_jump",2)}),C(T,"$yyerrok",a("racc_error_status",0)),C(T,"$racc_read_token",function(s,b,$){var u=this;return u.racc_debug_out.$print("read    "),u.racc_debug_out.$print(b.$inspect(),"(",u.$racc_token2str(s),") "),u.racc_debug_out.$puts($.$inspect()),u.racc_debug_out.$puts()}),C(T,"$racc_shift",function(s,b,$){var u=this;return u.racc_debug_out.$puts("shift   "+u.$racc_token2str(s)),u.$racc_print_stacks(b,$),u.racc_debug_out.$puts()}),C(T,"$racc_reduce",function(s,b,$,u){var n=this,p=t;return(p=n.racc_debug_out).$print("reduce "),l(s["$empty?"]())?p.$print(" <none>"):B(s,"each",[],function E(x){return null==x&&(x=t),p.$print(" ",(null==E.$$s?this:E.$$s).$racc_token2str(x))},{$$s:n}),p.$puts(" --\x3e "+n.$racc_token2str(b)),n.$racc_print_stacks($,u),n.racc_debug_out.$puts()}),C(T,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()}),C(T,"$racc_e_pop",function(s,b,$){var u=this;return u.racc_debug_out.$puts("error recovering mode: pop token"),u.$racc_print_states(s),u.$racc_print_stacks(b,$),u.racc_debug_out.$puts()}),C(T,"$racc_next_state",function(s,b){var $=this;return $.racc_debug_out.$puts("goto    "+s),$.$racc_print_states(b),$.racc_debug_out.$puts()}),C(T,"$racc_print_stacks",function(s,b){var u=t;return(u=this.racc_debug_out).$print("        ["),B(s,"each_index",[],function n(p){return null==p&&(p=t),u.$print(" (",(null==n.$$s?this:n.$$s).$racc_token2str(s["$[]"](p))," ",b["$[]"](p).$inspect(),")")},{$$s:this}),u.$puts(" ]")}),C(T,"$racc_print_states",function(s){var $=t;return($=this.racc_debug_out).$print("        ["),B(s,"each",[],function(n){return null==n&&(n=t),$.$print(" ",n)}),$.$puts(" ]")}),C(T,"$racc_token2str",function(s){var $;return l($=r(this.$class(),"Racc_token_to_s_table")["$[]"](s))?$:this.$raise("[Racc Bug] can't convert token "+s+" to string")}),C(T,"$token_to_str",function(s){return r(this.$class(),"Racc_token_to_s_table")["$[]"](s)})}(i[0],i)},Opal.modules["bcdice/arithmetic/node"]=function(e){var a,t,L,c,T,d,D,f,i,K=e.module,G=e.klass,l=e.def,M=e.thrower,A=e.return_ivar,g=e.send2,h=e.find_super,C=e.eqeq,S=e.const_set,B=e.eqeqeq,z=e.rb_divide,W=e.truthy,ee=e.assign_ivar,j=e.alias,P=[],w=e.nil,O=e.$$$;return a=P,t=i=[K(P[0],"BCDice")].concat(a),L=f=[K(i[0],"Arithmetic")].concat(t),d=[K(f[0],"Node")].concat(L),D=e.$r(d),(T=(c=G(d[0],null,"BinaryOp")).$$prototype).lhs=T.rhs=T.op=w,l(c,"$initialize",function(U,I,o){var s=this;return s.lhs=U,s.op=I,s.rhs=o}),l(c,"$eval",function(U){try{M("eval_return");var b,o=this,s=w;return s=o.lhs.$eval(U),b=o.rhs.$eval(U),s.$send(o.op,b)}catch($){if($===e.t_eval_return)return $.$v;throw $}}),l(c,"$output",function(){var U=this;return""+U.lhs.$output()+U.op+U.rhs.$output()}),l(c,"$s_exp",function(){var U=this;return"("+U.$op_for_s_exp()+" "+U.lhs.$s_exp()+" "+U.rhs.$s_exp()+")"}),l(c,"$op_for_s_exp",A("op")),function(m,y,c){var T=G(m,y,"DivideBase"),_=[T].concat(c),U=e.$r(_),I=T.$$prototype;I.lhs=I.rhs=I.op=w,l(T,"$initialize",function o(s,b){return o.$$p=null,g(this,h(this,"initialize",o,!1,!0),"initialize",[s,"/",b],null)}),l(T,"$eval",function(s){try{M("eval_return");var u,n,$=this;return u=$.lhs.$eval(s),n=$.rhs.$eval(s),C(n,0)&&$.$raise(U("ZeroDivisionError")),$.$divide_and_round(u,n,s)}catch(p){if(p===e.t_eval_return)return p.$v;throw p}}),l(T,"$output",function o(){var s=o.$$p||w,b=this;return o.$$p=null,""+g(b,h(b,"output",o,!1,!0),"output",[],s)+b.$rounding_method()}),T.$private(),l(T,"$rounding_method",function(){return O(this.$class(),"ROUNDING_METHOD")}),l(T,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()}),l(T,"$divide_and_round",function(s,b,$){return this.$raise(U("NotImplementedError"))})}(d[0],D("BinaryOp"),d),function(m,y,c){var T=G(m,y,"DivideWithGameSystemDefault"),_=[T].concat(c),U=e.$r(_);S(_[0],"ROUNDING_METHOD",""),T.$private(),l(T,"$divide_and_round",function(o,s,b){var $,u=w;return B(O(U("RoundType"),"CEIL"),$=b)?z(o.$to_f(),s).$ceil():B(O(U("RoundType"),"ROUND"),$)?(u=z(o.$to_f(),s),W(u["$negative?"]())?u.$abs().$round()["$-@"]():u.$round()):z(o,s).$floor()})}(d[0],D("DivideBase"),d),function(m,y,c){var T=G(m,y,"DivideWithCeil"),_=[T].concat(c);S(_[0],"ROUNDING_METHOD","C"),T.$private(),l(T,"$divide_and_round",function(I,o,s){return z(I.$to_f(),o).$ceil()})}(d[0],D("DivideBase"),d),function(m,y,c){var T=G(m,y,"DivideWithRound"),_=[T].concat(c);S(_[0],"ROUNDING_METHOD","R"),T.$private(),l(T,"$divide_and_round",function(I,o,s){var b=w;return b=z(I.$to_f(),o),W(b["$negative?"]())?b.$abs().$round()["$-@"]():b.$round()})}(d[0],D("DivideBase"),d),function(m,y,c){var T=G(m,y,"DivideWithFloor"),_=[T].concat(c);S(_[0],"ROUNDING_METHOD","F"),T.$private(),l(T,"$divide_and_round",function(I,o,s){return z(I,o).$floor()})}(d[0],D("DivideBase"),d),function(m,y){var c=G(m,null,"Negative");c.$$prototype.body=w,l(c,"$initialize",ee("body")),l(c,"$eval",function(U){try{return M("eval_return"),this.body.$eval(U)["$-@"]()}catch(s){if(s===e.t_eval_return)return s.$v;throw s}}),l(c,"$output",function(){return"-"+this.body.$output()}),l(c,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"})}(d[0]),function(m,y){var c=G(m,null,"Parenthesis");c.$$prototype.expr=w,l(c,"$initialize",ee("expr")),l(c,"$eval",function(U){try{return M("eval_return"),this.expr.$eval(U)}catch(s){if(s===e.t_eval_return)return s.$v;throw s}}),l(c,"$output",function(){return"("+this.expr.$output()+")"}),l(c,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"})}(d[0]),function(m,y){var c=G(m,null,"Number");return c.$$prototype.value=w,l(c,"$initialize",ee("value")),l(c,"$eval",A("value")),l(c,"$output",function(){return this.value.$to_s()}),j(c,"s_exp","output")}(d[0])},Opal.modules.strscan=function(e){var ee,j,P,w,O,G=e.def,l=e.truthy,M=e.eqeqeq,A=e.Opal,g=e.return_ivar,h=e.send,C=e.alias,S=[],B=e.nil;return ee=S,P=[j=(0,e.klass)(S[0],null,"StringScanner")].concat(ee),w=e.$r(P),(O=j.$$prototype).pos=O.string=O.working=O.matched=O.prev_pos=O.match=B,j.$attr_reader("pos","matched"),G(j,"$initialize",function(a){var v=this;return v.string=a,v.pos=0,v.matched=B,v.working=a,v.match=[]}),j.$attr_reader("string"),G(j,"$beginning_of_line?",function(){var a=this;return 0===a.pos||"\n"===a.string.charAt(a.pos-1)}),G(j,"$scan",function(a){var v=this,i=(a=v.$anchor(a)).exec(v.working);return null==i?v.matched=B:(v.prev_pos=v.pos,v.pos+=i[0].length,v.working=v.working.substring(i[0].length),v.matched=i[0],v.match=i,i[0])}),G(j,"$scan_until",function(a){var v=this;a=v.$anchor(a);for(var i=v.working,q=0;i.length!=q;++q){var t=a.exec(i.substr(q));if(null!==t){var r=q+t[0].length,f=i.substr(0,r);return v.matched=t[0],v.match=t,v.prev_pos=v.pos+q,v.pos+=r,v.working=i.substr(r),f}}return v.matched=B}),G(j,"$[]",function(a){var i;if(l(this.match["$empty?"]()))return B;M(w("Symbol"),i=a)?a=a.$to_s():M(w("String"),i)||(a=A["$coerce_to!"](a,w("Integer"),"to_int"));var q=this.match;return a<0&&(a+=q.length),a<0||a>=q.length||null==q[a]?B:q[a]}),G(j,"$check",function(a){var v=this,i=(a=v.$anchor(a)).exec(v.working);return v.matched=null==i?B:i[0]}),G(j,"$check_until",function(a){var v=this,i=v.prev_pos,q=v.pos,t=v.working,r=v.$scan_until(a);return v.prev_pos=i,v.pos=q,v.working=t,r}),G(j,"$peek",function(a){return this.working.substring(0,a)}),G(j,"$eos?",function(){return 0===this.working.length}),G(j,"$exist?",function(a){var i=a.exec(this.working);return null==i?B:0==i.index?0:i.index+1}),G(j,"$skip",function(a){var v=this,i=(a=v.$anchor(a)).exec(v.working);if(null==i)return v.match=[],v.matched=B;var q=i[0],t=q.length;return v.matched=q,v.match=i,v.prev_pos=v.pos,v.pos+=t,v.working=v.working.substring(t),t}),G(j,"$skip_until",function(a){var i=this.$scan_until(a);return i===B?B:(this.matched=i.substr(-1),i.length)}),G(j,"$get_byte",function(){var a=this,v=B;return a.pos<a.string.length?(a.prev_pos=a.pos,a.pos+=1,v=a.matched=a.working.substring(0,1),a.working=a.working.substring(1)):a.matched=B,v}),G(j,"$match?",function(a){var v=this,i=(a=v.$anchor(a)).exec(v.working);return null==i?B:(v.prev_pos=v.pos,i[0].length)}),G(j,"$pos=",function(a){var v=this;return a<0&&(a+=v.string.$length()),v.pos=a,v.working=v.string.slice(a)}),G(j,"$matched_size",function(){return this.matched===B?B:this.matched.length}),G(j,"$post_match",function(){var a=this;return a.matched===B?B:a.string.substr(a.pos)}),G(j,"$pre_match",function(){var a=this;return a.matched===B?B:a.string.substr(0,a.prev_pos)}),G(j,"$reset",function(){var a=this;return a.working=a.string,a.matched=B,a.pos=0}),G(j,"$rest",g("working")),G(j,"$rest?",function(){return 0!==this.working.length}),G(j,"$rest_size",function(){return this.$rest().$size()}),G(j,"$terminate",function(){var a,v=this;return v.match=B,a=[v.string.$length()],h(v,"pos=",a),a[a.length-1]}),G(j,"$unscan",function(){var a=this;return a.pos=a.prev_pos,a.prev_pos=B,a.match=B,a}),C(j,"bol?","beginning_of_line?"),C(j,"getch","get_byte"),j.$private(),G(j,"$anchor",function(a){var v=a.toString().match(/\/([^\/]+)$/);return v=v?v[1]:void 0,new RegExp("^(?:"+a.source+")",v)})},Opal.modules["bcdice/normalize"]=function(e){var C,W,B,K=e.module,G=e.eqeqeq,l=e.def,M=e.eqeq,A=[],g=e.nil;return C=A,B=[K(A[0],"BCDice")].concat(C),(W=K(B[0],"Normalize")).$module_function(),l(W,"$comparison_operator",function(j){var P;return G(/<=|=</,P=j)?"<=":G(/>=|=>/,P)?">=":G(/<>|!=|=!/,P)?"!=":G(/</,P)?"<":G(/>/,P)?">":G(/=/,P)?"==":g}),l(W,"$target_number",function(j){return M(j,"?")?j:j.$to_i()})},Opal.modules["bcdice/command/lexer"]=function(e){var ee,O,q,t,r,f,N,a,P,K=e.module,G=e.klass,l=e.const_set,M=e.hash2,A=e.truthy,g=e.send,h=e.def,C=e.thrower,S=e.top,B=[],z=e.nil;return S.$require("strscan"),S.$require("bcdice/normalize"),ee=B,O=P=[K(B[0],"BCDice")].concat(ee),q=a=[K(P[0],"Command")].concat(O),r=[t=G(a[0],null,"Lexer")].concat(q),f=e.$r(r),(N=t.$$prototype).scanner=N.notations=z,l(r[0],"SYMBOLS",M(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),h(t,"$initialize",function(k,d){var D,m,c;return k=A(c=(D=(m=k)===z||null==m?z:m.$split(" ",2))===z||null==D?z:D.$first())?c:"",this.scanner=f("StringScanner").$new(k),this.notations=g(d,"map",[],function(_){return null==_&&(_=z),A(_["$is_a?"](f("String")))?f("Regexp").$new(_):_})}),h(t,"$next_token",function(){try{var k=C("return"),d=this,D=z,m=z,c=z,T=z;return A(d.scanner["$eos?"]())?[!1,"$"]:(g(d.notations,"each",[],function _(U){var o,I=null==_.$$s?this:_.$$s;if(null==I.scanner&&(I.scanner=z),null==U&&(U=z),o=I.scanner.$scan(U),!A(o))return z;k.$throw(["NOTATION",o])},{$$s:d,$$ret:k}),A(D=d.scanner.$scan(/\d+/))?["NUMBER",D.$to_i()]:A(m=d.scanner.$scan(/[<>!=]+/))?(m=f("Normalize").$comparison_operator(m),[A(m)?"CMP_OP":"ILLEGAL",m]):(c=d.scanner.$getch().$upcase(),[A(T=f("SYMBOLS")["$[]"](c))?T:c.$to_sym(),c]))}catch(_){if(_===k)return _.$v;throw _}}),h(t,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/command/parsed"]=function(e){var S,ee,J,a,v,i,q,P,z,K=e.module,G=e.klass,l=e.def,M=e.return_ivar,A=e.truthy,g=[],h=e.nil;return S=g,ee=z=[K(g[0],"BCDice")].concat(S),J=P=[K(z[0],"Command")].concat(ee),v=[a=G(P[0],null,"Parsed")].concat(J),i=e.$r(v),(q=a.$$prototype).critical=q.fumble=q.dollar=q.modify_number=q.question_target=q.target_number=q.prefix_number=q.command=q.suffix_number=q.cmp_op=h,a.$attr_accessor("command"),a.$attr_accessor("prefix_number"),a.$attr_accessor("suffix_number"),a.$attr_accessor("critical"),a.$attr_accessor("fumble"),a.$attr_accessor("dollar"),a.$attr_accessor("modify_number"),a.$attr_accessor("cmp_op"),a.$attr_accessor("target_number"),a.$attr_writer("question_target"),l(a,"$initialize",function(){var r=this;return r.prefix_number=h,r.suffix_number=h,r.critical=h,r.fumble=h,r.dollar=h,r.cmp_op=h,r.target_number=h,r.question_target=!1}),l(a,"$question_target?",M("question_target")),l(a,"$to_s",function(r){var f=this,N=h,L=h,k=h,d=h,D=h;switch(null==r&&(r="after_command"),N=A(f.critical)?"@"+f.critical:h,L=A(f.fumble)?"#"+f.fumble:h,k=A(f.dollar)?"$"+f.dollar:h,d=i("Format").$modifier(f.modify_number),D=A(f.question_target)?"?":f.target_number,r){case"after_command":return[f.prefix_number,f.command,f.suffix_number,N,L,k,d,f.cmp_op,D].$join();case"after_modify_number":return[f.prefix_number,f.command,f.suffix_number,d,N,L,k,f.cmp_op,D].$join();case"after_target_number":return[f.prefix_number,f.command,f.suffix_number,d,f.cmp_op,D,N,L,k].$join();default:return h}},-1)},Opal.modules["bcdice/command/parser"]=function(e){var r,k,T,o,s,b,$,u,n,p,E,x,ne,_,U,I,te,D,m,N,K=e.klass,G=e.module,l=e.slice,M=e.extract_kwargs,A=e.ensure_kwargs,g=e.get_kwarg,h=e.send2,C=e.find_super,S=e.def,B=e.send,z=e.eqeq,W=e.thrower,ee=e.hash,j=e.const_set,P=e.truthy,w=e.to_ary,O=e.hash2,J=e.top,a=[],v=e.$r(a),i=e.nil,q=e.$$$;return J.$require("racc/parser.rb"),J.$require("bcdice/arithmetic/node"),J.$require("bcdice/command/lexer"),J.$require("bcdice/command/parsed"),K(q(v("BCDice"),"Command"),q(v("Racc"),"Parser"),"Parser"),r=a,k=N=[G(a[0],"BCDice")].concat(r),D=[G(N[0],"Command")].concat(k),m=e.$r(D),T=D,U=[_=K(D[0],q(m("Racc"),"Parser"),"Parser")].concat(T),I=e.$r(U),(te=_.$$prototype).notations=te.lexer=te.modifier=te.suffix_number=te.prefix_number=te.need_suffix_number=te.need_prefix_number=te.critical=te.fumble=te.dollar=te.allowed_cmp_op=te.question_target=i,S(_,"$initialize",function Y(R,X){var Z,H,ae,ie,$e=this;return Y.$$p=null,Z=l(arguments),H=M(Z),H=A(H),ae=Z,ie=g(H,"round_type"),h($e,C($e,"initialize",Y,!1,!0),"initialize",[],null),$e.notations=ae,$e.round_type=ie,$e.prefix_number=!1,$e.suffix_number=!1,$e.need_prefix_number=!1,$e.need_suffix_number=!1,$e.modifier=!0,$e.critical=!1,$e.fumble=!1,$e.dollar=!1,$e.allowed_cmp_op=[i,">=",">","<=","<","==","!="],$e.question_target=!1},-2),S(_,"$disable_modifier",function(){return this.modifier=!1,this}),S(_,"$enable_prefix_number",function(){return this.prefix_number=!0,this}),S(_,"$enable_suffix_number",function(){return this.suffix_number=!0,this}),S(_,"$has_prefix_number",function(){var R=this;return R.prefix_number=!0,R.need_prefix_number=!0,R}),S(_,"$has_suffix_number",function(){var R=this;return R.suffix_number=!0,R.need_suffix_number=!0,R}),S(_,"$enable_critical",function(){return this.critical=!0,this}),S(_,"$enable_fumble",function(){return this.fumble=!0,this}),S(_,"$enable_dollar",function(){return this.dollar=!0,this}),S(_,"$restrict_cmp_op_to",function(R){var X,H=this;return X=l(arguments),H.allowed_cmp_op=X,H},-1),S(_,"$enable_question_target",function(){return this.question_target=!0,this}),S(_,"$parse",function(R){var X=this;try{return X.lexer=I("Lexer").$new(R,X.notations),X.$do_parse()}catch(Z){if(!e.rescue(Z,[I("ParseError"),I("ZeroDivisionError")]))throw Z;try{return i}finally{e.pop_exception()}}}),_.$private(),S(_,"$parsed",function(R,X,Z,H){try{return W("eval_return"),B(I("Parsed").$new(),"tap",[],function se($e){var ue,ce,oe,fe,de,_e,ve,le=null==se.$$s?this:se.$$s;return null==le.round_type&&(le.round_type=i),null==$e&&($e=i),$e["$command="](R["$[]"]("command")),$e["$prefix_number="]((ue=R["$[]"]("prefix"))===i||null==ue?i:ue.$eval(le.round_type)),$e["$suffix_number="]((ce=R["$[]"]("suffix"))===i||null==ce?i:ce.$eval(le.round_type)),$e["$critical="]((oe=X["$[]"]("critical"))===i||null==oe?i:oe.$eval(le.round_type)),$e["$fumble="]((fe=X["$[]"]("fumble"))===i||null==fe?i:fe.$eval(le.round_type)),$e["$dollar="]((de=X["$[]"]("dollar"))===i||null==de?i:de.$eval(le.round_type)),$e["$modify_number="](Z.$eval(le.round_type)),$e["$cmp_op="](H["$[]"]("cmp_op")),z(H["$[]"]("target"),"?")?($e["$question_target="](!0),B($e,"target_number=",_e=[0]),_e[_e.length-1]):($e["$question_target="](!1),_e=[(ve=H["$[]"]("target"),ve===i||null==ve?i:ve.$eval(le.round_type))],B($e,"target_number=",_e),_e[_e.length-1])},{$$s:this})}catch(se){if(se===e.t_eval_return)return se.$v;throw se}}),S(_,"$next_token",function(){return this.lexer.$next_token()}),o=e.large_array_unpack("6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,33,34,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,,,17,18,6,,5,,,17,18,,,5,23,24,25,26,56,54,55,57"),s=e.large_array_unpack("0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,,17,15,15,18,18,23,,18,30,30,23,23,24,,23,31,31,24,24,25,,24,44,44,25,25,28,,25,47,47,28,28,29,,28,48,48,29,29,33,,29,49,49,33,33,34,,33,50,50,34,34,36,,34,,,36,36,37,,36,,,37,37,,,37,27,27,27,27,52,52,52,52"),b=e.large_array_unpack("-2,4,16,-3,-1,11,,33,13,35,23,30,1,,28,40,,37,44,,,-2,,51,58,65,0,106,72,79,47,54,,86,93,,100,107,,,,,,,63,,,68,75,82,89,,120,,,,,"),$=e.large_array_unpack("-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29"),u=e.large_array_unpack("30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,,,21,47,48,40,51,52,49,50,44,46,3,,,,13,,,,,,,,32"),n=e.large_array_unpack("8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,,,4,8,8,5,7,7,8,8,9,5,6,,,,6,,,,,,,,6"),p=[i,6,13,3,9,-1,27,-15,-10,-1,-38],E=[i,i,i,i,i,i,19,16,15,i,i],x=e.large_array_unpack("0,0,racc_error,4,20,_reduce_1,4,20,_reduce_2,3,20,_reduce_3,3,21,_reduce_4,2,21,_reduce_5,2,21,_reduce_6,1,21,_reduce_7,0,22,_reduce_8,3,22,_reduce_9,3,22,_reduce_10,3,22,_reduce_11,2,23,_reduce_12,2,23,_reduce_13,3,23,_reduce_14,3,23,_reduce_15,0,24,_reduce_16,2,24,_reduce_17,2,24,_reduce_18,3,28,_reduce_19,3,28,_reduce_20,1,28,_reduce_none,3,27,_reduce_22,4,27,_reduce_23,1,27,_reduce_none,0,29,_reduce_25,1,29,_reduce_26,1,29,_reduce_27,1,29,_reduce_28,1,29,_reduce_29,2,26,_reduce_30,2,26,_reduce_31,1,26,_reduce_none,3,25,_reduce_33,1,25,_reduce_34"),ne=ee(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),j(U[0],"Racc_arg",[o,s,$,b,u,n,E,p,19,x,ne,58,35,!0]),j(U[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),j(U[0],"Racc_debug_parser",!1),S(_,"$_reduce_1",function(R,X,Z){var H;return P(this.modifier)||this.$raise(I("ParseError")),H=w(R),this.$parsed(null==H[0]?i:H[0],null==H[1]?i:H[1],null==H[2]?i:H[2],null==H[3]?i:H[3])}),S(_,"$_reduce_2",function(R,X,Z){var H;return P(this.modifier)||this.$raise(I("ParseError")),H=w(R),this.$parsed(null==H[0]?i:H[0],null==H[2]?i:H[2],null==H[1]?i:H[1],null==H[3]?i:H[3])}),S(_,"$_reduce_3",function(R,X,Z){var H,ue;return ue=null==(H=w(R))[2]?i:H[2],this.$parsed(null==H[0]?i:H[0],null==H[1]?i:H[1],q(q(I("Arithmetic"),"Node"),"Number").$new(0),ue)}),S(_,"$_reduce_4",function(R,X,Z){var H=this;return P(H.prefix_number)&&P(H.suffix_number)||H.$raise(I("ParseError")),O(["command","prefix","suffix"],{command:R["$[]"](1),prefix:R["$[]"](0),suffix:R["$[]"](2)})}),S(_,"$_reduce_5",function(R,X,Z){var H=this;return P(H.prefix_number)||H.$raise(I("ParseError")),P(H.need_suffix_number)&&H.$raise(I("ParseError")),O(["command","prefix"],{command:R["$[]"](1),prefix:R["$[]"](0)})}),S(_,"$_reduce_6",function(R,X,Z){var H=this;return P(H.suffix_number)||H.$raise(I("ParseError")),P(H.need_prefix_number)&&H.$raise(I("ParseError")),O(["command","suffix"],{command:R["$[]"](0),suffix:R["$[]"](1)})}),S(_,"$_reduce_7",function(R,X,Z){var H=this;return(P(H.need_prefix_number)||P(H.need_suffix_number))&&H.$raise(I("ParseError")),O(["command"],{command:R["$[]"](0)})}),S(_,"$_reduce_8",function(R,X,Z){return O([],{})}),S(_,"$_reduce_9",function(R,X,Z){var H,ue,se=i;return se=null==(H=w(R))[0]?i:H[0],ue=null==H[2]?i:H[2],P(this.critical)&&P(se["$[]"]("critical")["$nil?"]())||this.$raise(I("ParseError")),se["$[]="]("critical",ue),se}),S(_,"$_reduce_10",function(R,X,Z){var H,ue,se=i;return se=null==(H=w(R))[0]?i:H[0],ue=null==H[2]?i:H[2],P(this.fumble)&&P(se["$[]"]("fumble")["$nil?"]())||this.$raise(I("ParseError")),se["$[]="]("fumble",ue),se}),S(_,"$_reduce_11",function(R,X,Z){var H,ue,se=i;return se=null==(H=w(R))[0]?i:H[0],ue=null==H[2]?i:H[2],P(this.dollar)&&P(se["$[]"]("dollar")["$nil?"]())||this.$raise(I("ParseError")),se["$[]="]("dollar",ue),se}),S(_,"$_reduce_12",function(R,X,Z){return R["$[]"](1)}),S(_,"$_reduce_13",function(R,X,Z){return q(q(I("Arithmetic"),"Node"),"Negative").$new(R["$[]"](1))}),S(_,"$_reduce_14",function(R,X,Z){return q(q(I("Arithmetic"),"Node"),"BinaryOp").$new(R["$[]"](0),"+",R["$[]"](2))}),S(_,"$_reduce_15",function(R,X,Z){return q(q(I("Arithmetic"),"Node"),"BinaryOp").$new(R["$[]"](0),"-",R["$[]"](2))}),S(_,"$_reduce_16",function(R,X,Z){return P(this.allowed_cmp_op["$include?"](i))||this.$raise(I("ParseError")),O([],{})}),S(_,"$_reduce_17",function(R,X,Z){var H,se,$e;return $e=null==(H=w(R))[1]?i:H[1],P(this.allowed_cmp_op["$include?"](se=null==H[0]?i:H[0]))||this.$raise(I("ParseError")),O(["cmp_op","target"],{cmp_op:se,target:$e})}),S(_,"$_reduce_18",function(R,X,Z){var ae,H=this;return ae=R["$[]"](0),P(H.question_target)||H.$raise(I("ParseError")),P(H.allowed_cmp_op["$include?"](ae))||H.$raise(I("ParseError")),O(["cmp_op","target"],{cmp_op:ae,target:"?"})}),S(_,"$_reduce_19",function(R,X,Z){return q(q(I("Arithmetic"),"Node"),"BinaryOp").$new(R["$[]"](0),"+",R["$[]"](2))}),S(_,"$_reduce_20",function(R,X,Z){return q(q(I("Arithmetic"),"Node"),"BinaryOp").$new(R["$[]"](0),"-",R["$[]"](2))}),S(_,"$_reduce_22",function(R,X,Z){return q(q(I("Arithmetic"),"Node"),"BinaryOp").$new(R["$[]"](0),"*",R["$[]"](2))}),S(_,"$_reduce_23",function(R,X,Z){return R["$[]"](3).$new(R["$[]"](0),R["$[]"](2))}),S(_,"$_reduce_25",function(R,X,Z){return q(q(I("Arithmetic"),"Node"),"DivideWithGameSystemDefault")}),S(_,"$_reduce_26",function(R,X,Z){return q(q(I("Arithmetic"),"Node"),"DivideWithCeil")}),S(_,"$_reduce_27",function(R,X,Z){return q(q(I("Arithmetic"),"Node"),"DivideWithCeil")}),S(_,"$_reduce_28",function(R,X,Z){return q(q(I("Arithmetic"),"Node"),"DivideWithRound")}),S(_,"$_reduce_29",function(R,X,Z){return q(q(I("Arithmetic"),"Node"),"DivideWithFloor")}),S(_,"$_reduce_30",function(R,X,Z){return R["$[]"](1)}),S(_,"$_reduce_31",function(R,X,Z){return q(q(I("Arithmetic"),"Node"),"Negative").$new(R["$[]"](1))}),S(_,"$_reduce_33",function(R,X,Z){return R["$[]"](1)}),S(_,"$_reduce_34",function(R,X,Z){return q(q(I("Arithmetic"),"Node"),"Number").$new(R["$[]"](0))}),S(_,"$_reduce_none",function(R,X,Z){return R["$[]"](0)})},Opal.modules["bcdice/deprecated/checker"]=function(e){var B,j,J,a,v,i,w,W,K=e.module,G=e.send,l=e.eqeqeq,M=e.truthy,A=e.def,g=e.return_val,h=[],C=e.nil;return B=h,j=W=[K(h[0],"BCDice")].concat(B),J=w=[K(W[0],"Deprecated")].concat(j),v=[a=K(w[0],"Checker")].concat(J),i=e.$r(v),a.$private(),A(a,"$check_result_legacy",function(t,r,f,N){var D,L=this,k=C,d=C,m=C,y=C;return k=G(r,"map",[],"sides".$to_proc()),D=(d=G(r,"map",[],"value".$to_proc())).$sum(),m=l([100],y=k)?L.$check_1D100(t,D,f,N):l([20],y)?L.$check_1D20(t,D,f,N):l([6,6],y)?L.$check_2D6(t,D,d,f,N):C,(M(m["$nil?"]())||M(m["$empty?"]()))&&(m=l([10],y=k.$uniq())?L.$check_nD10(t,D,d,f,N):l([6],y)?L.$check_nD6(t,D,d,f,N):C,M(m["$nil?"]())||M(m["$empty?"]()))?C:i("Result").$new(m.$delete_prefix(" \uff1e "))}),A(a,"$check_1D100",g(C)),A(a,"$check_1D20",g(C)),A(a,"$check_nD10",g(C)),A(a,"$check_2D6",g(C)),A(a,"$check_nD6",g(C))},Opal.modules["bcdice/base"]=function(e){var v,L,y,I,s,b,c,T,_,U,d,K=e.module,G=e.klass,l=e.slice,M=e.rb_plus,A=e.truthy,g=e.def,h=e.regexp,C=e.send,S=e.thrower,B=e.return_ivar,z=e.assign_ivar_val,W=e.eqeqeq,ee=e.eqeq,j=e.return_val,P=e.range,w=e.rb_minus,O=e.rb_divide,J=e.rb_times,a=e.rb_ge,i=e.top,q=[],t=e.$r(q),r=e.nil,f=e.$$$;return i.$require("i18n"),i.$require("i18n/backend/fallbacks"),i.$require("bcdice/randomizer"),i.$require("bcdice/dice_table"),i.$require("bcdice/enum"),i.$require("bcdice/translate"),i.$require("bcdice/result"),i.$require("bcdice/command/parser"),i.$require("bcdice/deprecated/checker"),L=q,y=d=[K(q[0],"BCDice")].concat(L),T=[c=G(d[0],null,"Base")].concat(y),_=e.$r(T),(U=c.$$prototype).raw_input=U.randomizer=U.enabled_upcase_input=U.debug=r,s=[I=e.get_singleton_class(c)].concat(T),b=e.$r(s),I.$attr_reader("prefixes"),g(I,"$register_prefix",function(u){var p,E=this,x=r;return null==E.prefixes&&(E.prefixes=r),p=l(arguments),E.prefixes=M(A(x=E.prefixes)?x:[],p.$flatten())},-1),g(I,"$register_prefix_from_super_class",function(){return this.$register_prefix(this.$superclass().$prefixes())}),g(I,"$prefixes_pattern",function(){var u=this,n=r;return null==u.prefixes_pattern&&(u.prefixes_pattern=r),null==u.prefixes&&(u.prefixes=r),u.prefixes_pattern=A(n=u.prefixes_pattern)?n:r,A(u.prefixes_pattern)?u.prefixes_pattern:(u.prefixes=A(n=u.prefixes)?n:[],u.prefixes.$freeze(),u.prefixes_pattern=(A(u.prefixes["$empty?"]())?/(?!)/:h(["^(S)?(",u.prefixes.$join("|"),")"],"i")).$freeze())}),g(I,"$command_pattern",function(){var u=this,n=r,p=r;return null==u.command_pattern&&(u.command_pattern=r),null==u.prefixes&&(u.prefixes=r),u.command_pattern=A(n=u.command_pattern)?n:r,A(u.command_pattern)?u.command_pattern:(u.prefixes=A(n=u.prefixes)?n:[],u.prefixes.$freeze(),p=M(C(f(b("CommonCommand"),"COMMANDS"),"map",[],function(x){return null==x&&(x=r),f(x,"PREFIX_PATTERN").$source()}),u.prefixes),u.command_pattern=h(["^S?(",p.$join("|"),")"],"i").$freeze())}),g(I,"$eval",function(u){try{return S("eval_return"),this.$new(u).$eval()}catch(E){if(E===e.t_eval_return)return E.$v;throw E}}),c.$include(_("Translate")),c.$include(f(_("Deprecated"),"Checker")),g(c,"$initialize",function(o){var s=this;return s.raw_input=o,s.sort_add_dice=!1,s.sort_barabara_dice=!1,s.d66_sort_type=f(_("D66SortType"),"NO_SORT"),s.enabled_d9=!1,s.round_type=f(_("RoundType"),"FLOOR"),s.sides_implicit_d=6,s.upper_dice_reroll_threshold=r,s.reroll_dice_reroll_threshold=r,s.default_cmp_op=r,s.default_target_number=r,s.enabled_upcase_input=!0,s.locale="ja_jp",s.randomizer=f(_("BCDice"),"Randomizer").$new(),s.debug=!1}),c.$attr_accessor("randomizer"),c.$attr_reader("d66_sort_type"),c.$attr_reader("round_type"),c.$attr_reader("sides_implicit_d"),c.$attr_reader("upper_dice_reroll_threshold"),c.$attr_reader("reroll_dice_reroll_threshold"),c.$attr_reader("default_cmp_op"),c.$attr_reader("default_target_number"),g(c,"$sort_add_dice?",B("sort_add_dice")),g(c,"$sort_barabara_dice?",B("sort_barabara_dice")),g(c,"$enabled_d9?",B("enabled_d9")),g(c,"$enable_debug",z("debug",!0)),g(c,"$eval",function(){var s,$,o=this,b=r;return s=f(_("BCDice"),"Preprocessor").$process(o.raw_input,o),b=A($=o.$dice_command(s))?$:o.$eval_common_command(o.raw_input),A(b)?(b["$rands="](o.randomizer.$rand_results()),b["$detailed_rands="](o.randomizer.$detailed_rand_results()),b):r}),g(c,"$change_text",function(o){return o}),g(c,"$check_result",function(o,s,b,$){var u=this,n=r,p=r,E=r,x=r,F=r;return n=u.$check_result_legacy(o,s,b,$),A(n)?n:(p=C(s,"map",[],"sides".$to_proc()),x=(E=C(s,"map",[],"value".$to_proc())).$sum(),n=W([100],F=p)?u.$result_1d100(o,x,b,$):W([20],F)?u.$result_1d20(o,x,b,$):W([6,6],F)?u.$result_2d6(o,x,E,b,$):r,ee(n,_("Result").$nothing())?r:A(n)?n:(n=W([10],F=p.$uniq())?u.$result_nd10(o,x,E,b,$):W([6],F)?u.$result_nd6(o,x,E,b,$):r,ee(n,_("Result").$nothing())?r:A(n)?n:u.$result_ndx(o,b,$)))}),g(c,"$grich_text",j(r)),c.$private(),g(c,"$eval_common_command",function(o){try{S("eval_return");var b=S("return");return o=this.$change_text(o),C(f(_("CommonCommand"),"COMMANDS"),"each",[],function u(n){var E,p=null==u.$$s?this:u.$$s;if(null==p.randomizer&&(p.randomizer=r),null==n&&(n=r),E=n.$eval(o,p,p.randomizer),!A(E))return r;b.$throw(E)},{$$s:this,$$ret:b}),r}catch(u){if(u===e.t_eval_return||u===b)return u.$v;throw u}}),g(c,"$dice_command",function(o){var s=this,b=r,$=r,u=r,n=r;return A(s.enabled_upcase_input)&&(o=o.$upcase()),b=s.$class().$prefixes_pattern().$match(o),A(b)?($=b["$[]"](1)["$nil?"]()["$!"](),A($)&&(o=o["$[]"](P(1,-1,!1))),u=s.$eval_game_system_specific_command(o),A(u["$is_a?"](_("Result")))?(u["$secret="](A(n=u["$secret?"]())?n:$),u):A(u["$nil?"]())||A(u["$empty?"]())||ee(u,"1")?r:C(_("Result").$new(),"tap",[],function(E){var x;return null==E&&(E=r),E["$text="](u.$to_s()),C(E,"secret=",x=[$]),x[x.length-1]})):r}),g(c,"$eval_game_system_specific_command",j(r)),g(c,"$result_ndx",function(o,s,b){return A(b["$is_a?"](_("String")))?r:A(o.$send(s,b))?_("Result").$success(this.$translate("success")):_("Result").$failure(this.$translate("failure"))}),g(c,"$result_1d100",j(r)),g(c,"$result_1d20",j(r)),g(c,"$result_nd10",j(r)),g(c,"$result_2d6",j(r)),g(c,"$result_nd6",j(r)),g(c,"$get_table_by_2d6",function(o){return this.$get_table_by_nD6(o,2)}),g(c,"$get_table_by_1d6",function(o){return this.$get_table_by_nD6(o,1)}),g(c,"$get_table_by_nD6",function(o,s){return this.$get_table_by_nDx(o,s,6)}),g(c,"$get_table_by_nDx",function(o,s,b){var u,n=r;return u=this.randomizer.$roll_sum(s,b),n=this.$get_table_value(o["$[]"](w(u,s))),A(n["$nil?"]())?["1",0]:[n,u]}),g(c,"$get_table_by_1d3",function(o){var $,u,s=this,n=r;return s.$debug("get_table_by_1d3"),$=s.randomizer.$roll_sum(1,6),s.$debug("num",$),u=O(w($,1),2).$to_i(),s.$debug("index",u),n=o["$[]"](u),A(n["$nil?"]())?["1",0]:[n,$]}),g(c,"$get_table_by_d66_swap",function(o){var b;return b=this.randomizer.$roll_d66(f(_("D66SortType"),"ASC")),[this.$get_table_by_number(b,o),b]}),g(c,"$get_table_by_d66",function(o){var b,$,u,p,n=r;return b=this.randomizer.$roll_once(6),$=this.randomizer.$roll_once(6),u=M(J(w(b,1),6),w($,1)),n=o["$[]"](u),p=""+b+$,A(n["$nil?"]())?["1",p]:[n,p]}),g(c,"$get_table_by_number",function(o,s,b){try{var $=S("return");return null==b&&(b="1"),C(s,"each",[],function n(p){var x,E=null==n.$$s?this:n.$$s;if(null==p&&(p=r),x=p["$[]"](0),!A(a(x,o)))return r;$.$throw(E.$get_table_value(p["$[]"](1)))},{$$s:this,$$ret:$}),this.$get_table_value(b)}catch(n){if(n===$)return n.$v;throw n}},-3),g(c,"$get_table_value",function(o){return A(o["$is_a?"](_("Proc")))?o.$call():o}),g(c,"$roll_tables",function(o,s){var $=r;return $=s["$[]"](o),A($)?$.$roll(this.randomizer).$to_s():r}),g(c,"$debug",function(o,s){var $,u=this,n=r,p=r;return $=l(arguments,1),A(u.debug)?(n=A(o["$is_a?"](_("String")))?o:o.$inspect(),A($["$empty?"]())?u.$warn(n):(p=C($,"map",[],function(x){return null==x&&(x=r),A(x["$is_a?"](_("String")))?'"'+x+'"':x.$inspect()}),u.$warn(n+": "+p.$join(", ")))):r},-2),f(f(t("I18n"),"Backend"),"Simple").$include(f(f(t("I18n"),"Backend"),"Fallbacks")),t("I18n").$load_path()["$<<"](t("Dir")["$[]"](t("File").$join("bcdice","../../i18n/**/*.yml"))),t("I18n")["$default_locale="]("ja_jp"),v=[["ja_jp"]],C(t("I18n").$fallbacks(),"defaults=",v),v[v.length-1]},Opal.modules["bcdice/arithmetic_evaluator"]=function(e){var B,j,O,a,v,P,w,W,K=e.module,G=e.ensure_kwargs,l=e.truthy,M=e.thrower,A=e.def,g=[],h=e.nil,C=e.$$$;return B=g,j=W=[K(g[0],"BCDice")].concat(B),w=[P=K(W[0],"ArithmeticEvaluator")].concat(j),a=[O=e.get_singleton_class(P)].concat(w),v=e.$r(a),A(O,"$eval",function(q,t){try{M("eval_return");var f,N=h;return null==(f=(t=G(t)).$$smap.round_type)&&(f=C(v("RoundType"),"FLOOR")),l(q)&&l(N=v("Arithmetic").$eval(q,f))?N:0}catch(L){if(L===e.t_eval_return)return L.$v;throw L}},-2)},Opal.queue(function(e){var L,m,_,U,I,p,E,o,s,b,$,c,T,d,K=e.module,G=e.klass,l=e.const_set,M=e.send2,A=e.find_super,g=e.def,h=e.truthy,C=e.hash2,S=e.rb_plus,B=e.rb_ge,z=e.thrower,W=e.eqeqeq,ee=e.assign_ivar,j=e.rb_divide,P=e.rb_minus,w=e.rb_times,O=e.eqeq,J=e.neqeq,a=e.rb_le,v=e.send,i=e.rb_lt,q=e.top,t=[],r=e.nil,f=e.$$$;return q.$require("bcdice/base"),q.$require("bcdice/arithmetic_evaluator"),L=t,m=d=[K(t[0],"BCDice")].concat(L),c=[K(d[0],"GameSystem")].concat(m),T=e.$r(c),_=c[0],U=T("Base"),I=c,s=[o=G(_,U,"LogHorizon")].concat(I),b=e.$r(s),($=o.$$prototype).randomizer=$.locale=r,l(s[0],"ID","LogHorizon"),l(s[0],"NAME","\u30ed\u30b0\u30fb\u30db\u30e9\u30a4\u30ba\u30f3TRPG"),l(s[0],"SORT_KEY","\u308d\u304f\u307b\u3089\u3044\u3059\u3093TRPG"),l(s[0],"HELP_MESSAGE","\u25a0 \u5224\u5b9a (xLH\xb1y>=z)\n\u3000xD6\u306e\u5224\u5b9a\u3002\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u306e\u81ea\u52d5\u5224\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\u3000x\uff1ax\u306b\u632f\u308b\u30c0\u30a4\u30b9\u6570\u3092\u5165\u529b\u3002\n\u3000\xb1y\uff1ay\u306b\u4fee\u6b63\u5024\u3092\u5165\u529b\u3002\xb1\u306e\u8a08\u7b97\u306b\u5bfe\u5fdc\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000>=z\uff1az\u306b\u76ee\u6a19\u5024\u3092\u5165\u529b\u3002\xb1\u306e\u8a08\u7b97\u306b\u5bfe\u5fdc\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000\u4f8b\uff09 3LH\u30002LH>=8\u30003LH+1>=10\n\n\u25a0 \u6d88\u8017\u8868 (tCTx\xb1y$z)\n\u3000PCT \u4f53\u529b\uff0fECT \u6c17\u529b\uff0fGCT \u7269\u54c1\uff0fCCT \u91d1\u92ad\n\u3000x:CR\u3092\u6307\u5b9a\u3002\n\u3000\xb1y:\u4fee\u6b63\u5024\u3002\uff0b\u3068\uff0d\u306e\u8a08\u7b97\u306b\u5bfe\u5fdc\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000$z\uff1a\uff04\u3092\u4ed8\u3051\u308b\u3068\u30c0\u30a4\u30b9\u76ee\u3092 z \u56fa\u5b9a\u3002\u8868\u306e\u7279\u5b9a\u306e\u5024\u53c2\u7167\u7528\u306b\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000\u4f8b\uff09 PCT1\u3000ECT2+1\u3000GCT3-1\u3000CCT3$5\n\n\u25a0 \u6d88\u8017\u8868\u30ed\u30fc\u30eb (CTx\xb1y)\n\u3000\u6d88\u8017\u8868\u30ed\u30fc\u30eb\u3092\u884c\u3044\u3001\u51fa\u76ee\u3092\u6c7a\u5b9a\u3059\u308b\u3002\n\u3000x\uff1aCR\u3092\u6307\u5b9a\u3002\u6307\u5b9a\u3067\u304d\u307e\u3059\u304c\u3001\u7121\u8996\u3055\u308c\u307e\u3059\u3002\u7701\u7565\u53ef\u80fd\n\u3000\xb1y\uff1a\u4fee\u6b63\u5024\u3002\uff0b\u3068\uff0d\u306e\u8a08\u7b97\u306b\u5bfe\u5fdc\u3002\u7701\u7565\u53ef\u80fd\u3002\n\n\u25a0 \u8ca1\u5b9d\u8868 (tTRSx\xb1y$)\n\u3000LHZB1\u8a18\u8f09\u306e\u8ca1\u5b9d\u8868\n\u3000CTRS \u91d1\u92ad\uff0fMTRS \u9b54\u6cd5\u7d20\u6750\uff0fITRS \u63db\u91d1\u30a2\u30a4\u30c6\u30e0\uff0f\u203bHTRS \u30d2\u30ed\u30a4\u30f3\uff0fGTRS \u30b4\u30d6\u30ea\u30f3\u8ca1\u5b9d\u8868\n\u3000x\uff1aCR\u3092\u6307\u5b9a\u3002\u7701\u7565\u6642\u306f\u30c0\u30a4\u30b9\u5024 0 \u56fa\u5b9a\u3067\u4fee\u6b63\u5024\u306e\u8868\u53c2\u7167\u3002\u300a\u30b4\u30fc\u30eb\u30c9\u30d5\u30a3\u30f3\u30ac\u30fc\u300b\u4f7f\u7528\u6642\u306a\u3069\u3002\n\u3000\xb1y\uff1a\u4fee\u6b63\u5024\u3002\uff0b\u3068\uff0d\u306e\u8a08\u7b97\u306b\u5bfe\u5fdc\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000$\uff1a\uff04\u3092\u4ed8\u3051\u308b\u3068\u8ca1\u5b9d\u8868\u306e\u30c0\u30a4\u30b9\u76ee\u30927\u56fa\u5b9a\uff081\u56de\u5206\u306e\u30d7\u30e9\u30a4\u30ba\u7528\uff09\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000\u4f8b\uff09 CTRS1\u3000MTRS2+1\u3000ITRS3-1\u3000ITRS+27\u3000CTRS3$\n\n\u25a0 \u8ca1\u5b9d\u8868\uff08\u62e1\u5f35\u30eb\u30fc\u30eb\u30d6\u30c3\u30af\uff09 (tTRSEx\xb1y$)\n\u3000LHZB2\u8a18\u8f09\u306e\u8ca1\u5b9d\u8868\n\u3000CTRSE \u91d1\u92ad\uff0fMTRSE \u9b54\u6cd5\u7d20\u6750\uff0fITRSE \u63db\u91d1\u30a2\u30a4\u30c6\u30e0\uff0fOTRSE \u305d\u306e\u307b\u304b\n\u3000\u8a18\u6cd5\u306f\u8ca1\u5b9d\u8868\u3068\u540c\u69d8\n\n\u25a0 \u8ca1\u5b9d\u8868\u30ed\u30fc\u30eb (TRSx\xb1y)\n\u3000\u8ca1\u5b9d\u8868\u30ed\u30fc\u30eb\u3092\u884c\u3044\u3001\u51fa\u76ee\u3092\u6c7a\u5b9a\u3059\u308b\u3002\n\u3000x\uff1aCR\u3092\u6307\u5b9a\u3002\u7701\u7565\u6642\u306fCR 0\u3068\u3057\u3066\u6271\u3046\n\u3000\xb1y\uff1a\u4fee\u6b63\u5024\u3002\uff0b\u3068\uff0d\u306e\u8a08\u7b97\u306b\u5bfe\u5fdc\u3002\u7701\u7565\u53ef\u80fd\u3002\n\n\u25a0 \u30a4\u30fc\u30b9\u30bf\u30eb\u63a2\u7d22\u8868 (ESTLx\xb1y$z)\n\u3000x\uff1aCR\u3092\u6307\u5b9a\u3002\u7701\u7565\u6642\u306f\u30c0\u30a4\u30b9\u5024 0 \u56fa\u5b9a\u3067\u4fee\u6b63\u5024\u306e\u8868\u53c2\u7167\u3002\n\u3000\xb1y\uff1a\u4fee\u6b63\u5024\u3002\uff0b\u3068\uff0d\u306e\u8a08\u7b97\u306b\u5bfe\u5fdc\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000$z\uff1a\uff04\u3092\u4ed8\u3051\u308b\u3068\u30c0\u30a4\u30b9\u76ee\u3092 z \u56fa\u5b9a\u3002\u7279\u5b9aCR\u306e\u8868\u53c2\u7167\u7528\u306b\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000\u4f8b\uff09 ESTL1\u3000ESTL+15\u3000ESTL2+1$5\u3000ESTL2-1$5\n\n\u25a0 \u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u30c9\u30de\u30b8\u30c3\u30af\u30a2\u30a4\u30c6\u30e0\u52b9\u679c\u8868 (MGRx)\n\u3000x\u306fMG\u3092\u6307\u5b9a\u3002(LHZB1\u7528)\n\n\u25a0 \u697d\u5668\u7a2e\u5225\u8868\u2020 (MIIx)\n\u3000x\u306f\u697d\u5668\u306e\u7a2e\u985e(1\uff5e6\u3092\u6307\u5b9a)\u3001\u7701\u7565\u53ef\u80fd\n\u30001 \u6253\u697d\u5668\uff11\uff0f2 \u9375\u76e4\u697d\u5668\uff0f3 \u5f26\u697d\u5668\uff11\uff0f4 \u5f26\u697d\u5668\uff12\uff0f5 \u7ba1\u697d\u5668\uff11\uff0f6 \u7ba1\u697d\u5668\uff12\n\n\u25a0 \u7279\u6b8a\u6d88\u8017\u8868\u2606 (tSCTx\xb1y$z)\n\u3000\u6d88\u8017\u8868\u3068\u540c\u69d8\u3001\u305f\u3060\u3057CR\u306f\u7701\u7565\u53ef\u80fd\u3002\n\u3000ESCT \u30ed\u30c7\u7814\u306f\u7206\u767a\u3060\uff01\uff0fCSCT \u30a2\u30eb\u30f4\u306e\u546a\u3044\u3058\u3083\uff01\n\n\u25a0 \u30ed\u30c7\u7814\u306e\u65b0\u767a\u660e\u30e9\u30f3\u30c0\u30e0\u6c7a\u5b9a\u8868\u203b (IATt)\n\u3000IATA \u7279\u5fb4A(\u30e1\u30ea\u30c3\u30c8)\uff0fIATB \u7279\u5fb4B(\u30c7\u30e1\u30ea\u30c3\u30c8)\uff0fIATL \u898b\u305f\u76ee\uff0fIATT \u7a2e\u985e\n\u3000t\u3092\u7701\u7565\u3059\u308b\u3068\u5168\u3066\u8868\u793a\u3002t\u306bA/B/L/T\u3092\u4efb\u610f\u306e\u9806\u3067\u9023\u7d50\u53ef\u80fd\n\u3000\u4f8b\uff09IAT\u3000IATALT  IATABBLT  IATABL\n\n\u25a0 \u8868\n\u3000\u30fb\u30d1\u30fc\u30bd\u30ca\u30ea\u30c6\u30a3\u30bf\u30b0\u8868 (PTAG)\n\u3000\u30fb\u4ea4\u53cb\u8868 (KOYU)\n\u3000\u30fb\u653b\u6483\u547d\u4e2d\u7b87\u6240\u30e9\u30f3\u30c0\u30e0\u6c7a\u5b9a\u8868\u203b (HLOC)\n\u3000\u30fbPC\u540d\u30e9\u30f3\u30c0\u30e0\u6c7a\u5b9a\u8868\u203b (PCNM)\n\u3000\u30fb\u30a2\u30ad\u30d0\u306e\u8857\u3067\u906d\u9047\u3059\u308b\u30c8\u30e9\u30d6\u30eb\u30e9\u30f3\u30c0\u30e0\u6c7a\u5b9a\u8868\u203b (TIAS)\n\u3000\u30fb\u5ec3\u68c4\u5150\u30e9\u30f3\u30c0\u30e0\u6c7a\u5b9a\u8868\u203b (ABDC)\n\n\u2020\u5370\u306f\u2606\u5370\u306f\u300c\u30a4\u30f3\u30c8\u30a5\u30fb\u30b6\u30fb\u30bb\u30eb\u30c7\u30b7\u30a2 \u3055\u3089\u306a\u308b\u30d3\u30eb\u30c9\u306e\u7fbd\u3070\u305f\u304d\uff08\uff11\uff09\u300d\u3088\u308a\u3001\n\u2606\u5370\u306f\u30bb\u30eb\u30c7\u30b7\u30a2\u30fb\u30ac\u30bc\u30c3\u30c8\u300c\u3067\u304d\u308b\u304b\u306a66\u300dVol.1\u3088\u308a\u3001\n\u203b\u5370\u306f\u300c\u5b9f\u9332\u30fb\u4e03\u9762\u4f53\u5de5\u623f\u30b9\u30bf\u30c3\u30d5\u5ea7\u8ac7\u4f1a(\u590f\u306e\u9663)\u300d\u3088\u308a\u3002\u5229\u7528\u6cd5\u306a\u3069\u306f\u305d\u3061\u3089\u53c2\u7167\u3002\n\u30fbD66\u30c0\u30a4\u30b9\u3042\u308a\n"),o.$register_prefix("\\d+LH","\\w+CT","CT","\\w+TRS","TRS","IAT","TIAS","ABDC","MII","ESTL"),g(o,"$initialize",function u(n){var E=this;return u.$$p=null,M(E,A(E,"initialize",u,!1,!0),"initialize",[n],null),E.d66_sort_type=f(b("D66SortType"),"NO_SORT")}),g(o,"$eval_game_system_specific_command",function(n){var E,x,F,Q,ne,V,re,te,Y,R,X,p=this;return h(E=h(x=h(F=h(Q=h(ne=h(V=h(re=h(te=h(Y=h(R=h(X=p.$getCheckRollDiceCommandResult(n))?X:p.$roll_consumption(n))?R:p.$roll_consumption_table(n))?Y:p.$roll_treasure(n))?te:p.$roll_treasure_table(n))?re:p.$roll_treasure_table_b2(n))?V:p.$getInventionAttributeTextDiceCommandResult(n))?ne:p.$getTroubleInAkibaStreetDiceCommandResult(n))?Q:p.$getAbandonedChildDiceCommandResult(n))?F:p.$getMusicalInstrumentTypeDiceCommandResult(n))?x:p.$roll_eastal_exploration_table(n))?E:p.$roll_tables(n,f(p.$class(),"TABLES"))}),o.$private(),g(o,"$getCheckRollDiceCommandResult",function(n){var p=this,x=r,F=r,Q=r,ne=r,V=r,re=r,te=r;return x=f(b("Command"),"Parser").$new(/\d+LH/,C(["round_type"],{round_type:p.$round_type()})).$restrict_cmp_op_to(r,">=").$parse(n),h(x)?(F=x.$command().$to_i(),ne=(Q=p.randomizer.$roll_barabara(F,6)).$sum(),V=S(ne,x.$modify_number()),re=p.$result_text(F,Q,V,x),te=["("+x+")",ne+"["+Q.$join(",")+"]"+b("Format").$modifier(x.$modify_number()),V,re.$text()].$compact(),re["$text="](te.$join(" \uff1e ")),re):r}),g(o,"$result_text",function(n,p,E,x){var F=this;return h(B(p.$count(6),2))?b("Result").$critical(F.$translate("LogHorizon.LH.critical")):h(B(p.$count(1),n))?b("Result").$fumble(F.$translate("LogHorizon.LH.fumble")):h(x.$cmp_op()["$nil?"]())?b("Result").$new():h(B(E,x.$target_number()))?b("Result").$success(F.$translate("success")):b("Result").$failure(F.$translate("failure"))}),g(o,"$getValue",function(n,p){try{return z("eval_return"),h(n["$nil?"]())||h(n["$empty?"]())?p:b("ArithmeticEvaluator").$eval(n)}catch(x){if(x===e.t_eval_return)return x.$v;throw x}}),g(o,"$roll_consumption",function(n){try{z("eval_return");var x=r,F=r,Q=r,ne=r,V=r;return x=/^CT\d*([+\-\d]+)?$/.$match(n),h(x)?(F=b("ArithmeticEvaluator").$eval(x["$[]"](1)),Q=b("Format").$modifier(F),ne=this.randomizer.$roll_once(6),h(Q["$empty?"]())||(V=S(ne.$to_s(),Q)),["(1D6"+Q+")",V,S(ne,F)].$compact().$join(" \uff1e ")):r}catch(te){if(te===e.t_eval_return)return te.$v;throw te}}),g(o,"$roll_consumption_table",function(n){try{z("eval_return");var x=r,F=r,Q=r,ne=r;return x=/(P|E|G|C|ES|CS)CT(\d+)?([+\-\d]+)?(?:\$(\d+))?/.$match(n),h(x)?(F=this.$construct_consumption_table(x["$[]"](1)),Q=x["$[]"](2).$to_i(),ne=b("ArithmeticEvaluator").$eval(x["$[]"](3)),h(x["$[]"](4))&&F.$fix_dice_value(x["$[]"](4).$to_i()),F.$roll(Q,ne,this.randomizer)):r}catch(V){if(V===e.t_eval_return)return V.$v;throw V}}),g(o,"$construct_consumption_table",function(n){var x,p=this,E=r;return E=W("P",x=n)?p.$translate("LogHorizon.CT.PCT"):W("E",x)?p.$translate("LogHorizon.CT.ECT"):W("G",x)?p.$translate("LogHorizon.CT.GCT"):W("C",x)?p.$translate("LogHorizon.CT.CCT"):W("ES",x)?p.$translate("LogHorizon.CT.ESCT"):W("CS",x)?p.$translate("LogHorizon.CT.CSCT"):r,b("ConsumptionTable").$new(E["$[]"]("name"),E["$[]"]("items"))}),(E=(p=G(s[0],null,"ConsumptionTable")).$$prototype).tables=E.dice_value=E.name=r,g(p,"$initialize",function(F,Q){return this.name=F,this.tables=Q,this.dice_value=r}),g(p,"$fix_dice_value",ee("dice_value")),g(p,"$roll",function(F,Q,ne){var re,Y,X,V=this,te=r,R=r;return re=j(P(F,1),5).$clamp(0,P(V.tables.$size(),1)),te=V.tables["$[]"](re),V.dice_value=h(Y=V.dice_value)?Y:ne.$roll_once(6),R=S(V.dice_value,Q),X=te["$[]"](R.$clamp(0,7)),V.name+"("+R+"["+V.dice_value+"]) \uff1e "+X}),g(o,"$roll_treasure",function(n){try{z("eval_return");var x=r,F=r,Q=r,ne=r,V=r,re=r;return x=/^TRS(\d+)?([+\-\d]+)?$/.$match(n),h(x)?(F=x["$[]"](1).$to_i(),Q=b("ArithmeticEvaluator").$eval(x["$[]"](2)),V=(ne=this.randomizer.$roll_barabara(2,6)).$sum(),re=S(S(V,w(F,5)),Q),"(2D6+"+F+"*5"+b("Format").$modifier(Q)+") \uff1e "+V+"["+ne.$join(",")+"]"+b("Format").$modifier(S(w(F,5),Q))+" \uff1e "+re):r}catch(te){if(te===e.t_eval_return)return te.$v;throw te}}),g(o,"$roll_treasure_table",function(n){try{z("eval_return");var E=this,x=r,F=r,Q=r,ne=r,V=r;return x=/^([CMIHG]TRS)(\d+)?([+\-\d]+)?(\$)?$/.$match(n),h(x)?(F=x["$[]"](1),Q=E.$construct_treasure_table(F),ne=x["$[]"](2).$to_i(),V=b("ArithmeticEvaluator").$eval(x["$[]"](3)),O(ne,0)&&O(V,0)?E.$translate("LogHorizon.TRS.need_cr",C(["command"],{command:n})):(h(x["$[]"](4))&&Q.$fix_dice_value(7),Q.$roll(ne,V,E.randomizer))):r}catch(re){if(re===e.t_eval_return)return re.$v;throw re}}),g(o,"$construct_treasure_table",function(n){return O(n,"HTRS")?b("HeroineTreasureTable").$from_i18n("LogHorizon.TRS.HTRS",this.locale):b("TreasureTable").$from_i18n("LogHorizon.TRS."+n,this.locale)}),g(o,"$roll_treasure_table_b2",function(n){try{z("eval_return");var E=this,x=r,F=r,Q=r,ne=r,V=r;return x=/^([CMIO]TRSE)(\d+)?([+\-\d]+)?(\$)?$/.$match(n),h(x)?(F=x["$[]"](1),Q=b("ExpansionTreasureTable").$from_i18n("LogHorizon.TRSE."+F,E.locale),ne=x["$[]"](2).$to_i(),V=b("ArithmeticEvaluator").$eval(x["$[]"](3)),O(ne,0)&&O(V,0)?E.$translate("LogHorizon.TRS.need_cr",C(["command"],{command:n})):(h(x["$[]"](4))&&Q.$fix_dice_value(7),Q.$roll(ne,V,E.randomizer))):r}catch(re){if(re===e.t_eval_return)return re.$v;throw re}}),function(u,n,p){var ne,re,te,E=G(u,null,"TreasureTable"),x=[E].concat(p),F=e.$r(x),Q=E.$$prototype;Q.dice_list=Q.name=Q.items=r,E.$include(F("Translate")),re=[ne=e.get_singleton_class(E)].concat(x),te=e.$r(re),g(ne,"$from_i18n",function(R,X){var H=r;return H=te("I18n").$translate(R,C(["raise","locale"],{raise:!0,locale:X})),this.$new(H["$[]"]("name"),H["$[]"]("items"),X)}),g(E,"$initialize",function(V,re,te){var Y=this;return Y.name=V,Y.items=re,Y.locale=te,Y.dice_list=r}),g(E,"$fix_dice_value",function(V){return this.dice_list=[V]}),g(E,"$roll",function(V,re,te){var Y,R=this,X=r,Z=r,H=r,ae=r;return O(V,0)&&O(re,0)?r:(X=O(V,0)&&J(re,0)?re:(R.dice_list=h(Z=R.dice_list)?Z:te.$roll_barabara(2,6),S(S(R.dice_list.$sum(),w(5,V)),re)),H=R.$pick_item(X),h(R.dice_list)&&(ae="["+((Y=R.dice_list)===r||null==Y?r:Y.$join(","))+"]"),R.name+"("+X+ae+") \uff1e "+H)}),E.$private(),g(E,"$pick_item",function(V){var re=this;return h(a(V,6))?re.$translate("LogHorizon.TRS.below_lower_limit",C(["value"],{value:6})):h(a(V,62))?re.items["$[]"](V.$to_s()):h(a(V,72))?re.items["$[]"](P(V,10).$to_s())+"&80G":h(a(V,82))?re.items["$[]"](P(V,20).$to_s())+"&160G":h(a(V,87))?re.items["$[]"](P(V,30).$to_s())+"&260G":re.$translate("LogHorizon.TRS.exceed_upper_limit",C(["value"],{value:88}))})}(s[0],0,s),function(u,n){var p=G(u,n,"HeroineTreasureTable");p.$$prototype.items=r,g(p,"$pick_item",function(F){var Q=this;return h(a(F,6))?Q.$translate("LogHorizon.TRS.below_lower_limit",C(["value"],{value:6})):h(a(F,53))?Q.items["$[]"](F.$to_s()):Q.$translate("LogHorizon.TRS.exceed_upper_limit",C(["value"],{value:54}))})}(s[0],b("TreasureTable")),function(u,n){var p=G(u,n,"ExpansionTreasureTable");p.$$prototype.items=r,g(p,"$pick_item",function(F){var Q=this;return h(a(F,6))?Q.$translate("LogHorizon.TRS.below_lower_limit",C(["value"],{value:6})):h(a(F,162))?Q.items["$[]"](F.$to_s()):h(a(F,172))?Q.items["$[]"](P(F,10).$to_s())+"&200G":h(a(F,182))?Q.items["$[]"](P(F,20).$to_s())+"&400G":h(a(F,187))?Q.items["$[]"](P(F,30).$to_s())+"&600G":Q.$translate("LogHorizon.TRS.exceed_upper_limit",C(["value"],{value:188}))})}(s[0],b("TreasureTable")),g(o,"$getInventionAttributeTextDiceCommandResult",function(n){var E=r,x=r,F=r,Q=r,ne=r;return h(n["$=~"](/IAT([ABMDLT]*)/))?(E=this.$translate("LogHorizon.IAT.name"),x=h(b("Regexp").$last_match(1))&&J(b("Regexp").$last_match(1),"")?b("Regexp").$last_match(1):"MDLT",F=x.$length()["$=="](1),Q=[],ne=[],v(x.$split(/(?:)/),"each",[],function V(re){var X,te=null==V.$$s?this:V.$$s,Y=r,R=r,Z=r;return null==te.randomizer&&(te.randomizer=r),null==re&&(re=r),Y=te.randomizer.$roll_once(6),ne["$<<"](Y.$to_s()),Z=(R=W("A",X=re)||W("M",X)?te.$translate("LogHorizon.IAT.A"):W("B",X)||W("D",X)?te.$translate("LogHorizon.IAT.B"):W("L",X)?te.$translate("LogHorizon.IAT.L"):W("T",X)?te.$translate("LogHorizon.IAT.T"):r)["$[]"]("items")["$[]"](P(Y,1)),h(F)&&(Z=R["$[]"]("name")+"\uff1a"+Z),Q.$push(Z)},{$$s:this}),E+"(["+ne.$join(",")+"]) \uff1e "+Q.$join(" ")):r}),g(o,"$getTroubleInAkibaStreetDiceCommandResult",function(n){return O(n,"TIAS")?this.$roll_random_table("LogHorizon.TIAS"):r}),g(o,"$getAbandonedChildDiceCommandResult",function(n){return O(n,"ABDC")?this.$roll_random_table("LogHorizon.ABDC"):r}),g(o,"$roll_random_table",function(n){var E=r,x=r,F=r,Q=r;return E=this.$translate(n),x=E["$[]"]("tables"),F=this.randomizer.$roll_barabara(x.$size(),6),Q=v(F.$map(),"with_index",[],function(V,re){return null==V&&(V=r),null==re&&(re=r),x["$[]"](re)["$[]"](P(V,1))}),E["$[]"]("name")+"(["+F.$join(",")+"]) \uff1e "+Q.$join(" ")}),g(o,"$getMusicalInstrumentTypeDiceCommandResult",function(n){var p=this,E=r,x=r,F=r,Q=r,ne=r,V=r,re=r;return!h(n["$=~"](/MII(\d?)/))||(E=(h(x=b("Regexp").$last_match(1))?b("Regexp").$last_match(1)["$!="](""):x)["$!"](),F=h(E)?p.randomizer.$roll_once(6):b("Regexp").$last_match(1).$to_i(),h(i(F,1))||i(6,F))?r:(Q=p.$translate("LogHorizon.MII.name"),ne=p.$translate("LogHorizon.MII.type_list")["$[]"](P(F,1)),V=p.randomizer.$roll_once(6),re=p.$translate("LogHorizon.MII.items")["$[]"](P(F,1))["$[]"](P(V,1)),S(S(Q.$to_s(),h(E)?"("+F+")":"")," \uff1e "+ne+"("+V+") \uff1e "+re))}),g(o,"$roll_eastal_exploration_table",function(n){try{z("eval_return");var E,x=this,F=r,Q=r,ne=r,V=r,re=r,te=r,Y=r,R=r,Z=r;return F=/ESTL(\d+)?([+\-\d]+)?(?:\$(\d+))?/.$match(n),!h(F)||h(F["$[]"](1)["$nil?"]())&&h(F["$[]"](2)["$nil?"]())&&h(F["$[]"](3)["$nil?"]())?r:(Q=F["$[]"](1).$to_i(),ne=b("ArithmeticEvaluator").$eval(F["$[]"](2)),V=(E=F["$[]"](3))===r||null==E?r:E.$to_i(),re=h(V)?[V]:O(Q,0)?[]:x.randomizer.$roll_barabara(2,6),h(re["$empty?"]())||(te="["+re.$join(",")+"]"),Y=S(S(re.$sum(),w(Q,5)),ne).$clamp(7,162),R=x.$translate("LogHorizon.ESTL.name"),Z=x.$translate("LogHorizon.ESTL.items")["$[]"](Y.$to_s()).$chomp(),R+"("+Y+te+")\n"+Z)}catch(H){if(H===e.t_eval_return)return H.$v;throw H}}),function(u,n){var p=[u].concat(n),E=e.$r(p);u.$private(),g(u,"$translate_tables",function(F){return C(["PTAG","KOYU","MGR1","MGR2","MGR3","HLOC","PCNM"],{PTAG:f(E("DiceTable"),"D66Table").$from_i18n("LogHorizon.table.PTAG",F),KOYU:f(E("DiceTable"),"D66Table").$from_i18n("LogHorizon.table.KOYU",F),MGR1:f(E("DiceTable"),"D66Table").$from_i18n("LogHorizon.table.MGR1",F),MGR2:f(E("DiceTable"),"D66Table").$from_i18n("LogHorizon.table.MGR2",F),MGR3:f(E("DiceTable"),"D66Table").$from_i18n("LogHorizon.table.MGR3",F),HLOC:f(E("DiceTable"),"D66Table").$from_i18n("LogHorizon.table.HLOC",F),PCNM:f(E("DiceTable"),"D66Table").$from_i18n("LogHorizon.table.PCNM",F)})})}(e.get_singleton_class(o),s),l(s[0],"TABLES",o.$translate_tables("ja_jp")),o.$register_prefix(b("TABLES").$keys())})}}]);