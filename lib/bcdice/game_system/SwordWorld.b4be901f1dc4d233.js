(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[3210],{8250:(ye,pe,ge)=>{ge(9993),Opal.modules["i18n/backend/fallbacks"]=function(e){var H,u,r,t,_,y,V=e.module,W=e.class_variable_set,c=e.truthy,U=e.class_variable_get,z=e.def,o=e.send,F=e.send2,k=e.find_super,E=e.hash2,M=e.find_block_super,D=e.neqeq,O=e.thrower,Q=e.return_val,G=[],L=e.nil,A=e.$$$;return H=G,y=[_=V(G[0],"I18n")].concat(H),W(y[0],"@@fallbacks",L),u=e.get_singleton_class(_),r=[u].concat(y),t=e.$r(r),z(u,"$fallbacks",function(){var P=L;return W(r[1],"@@fallbacks",c(null!=r[1].$$cvars["@@fallbacks"]?"class variable":L)&&c(P=U(r[1],"@@fallbacks",!1))?P:A(A(t("I18n"),"Locale"),"Fallbacks").$new()),c(P=t("Thread").$current()["$[]"]("i18n_fallbacks"))?P:U(r[1],"@@fallbacks",!1)}),z(u,"$fallbacks=",function(C){var P;return W(r[1],"@@fallbacks",c(C["$is_a?"](t("Array")))?A(A(t("I18n"),"Locale"),"Fallbacks").$new(C):C),P=["i18n_fallbacks",U(r[1],"@@fallbacks",!1)],o(t("Thread").$current(),"[]=",P),P[P.length-1]}),function(u,N){var C,P,x,b,t=[V(u,"Backend")].concat(N);return C=t,x=[P=V(t[0],"Fallbacks")].concat(C),b=e.$r(x),z(P,"$translate",function S(g,R,$){try{var f=O("return"),l=S.$$p||L,j=this,v=L,q=L;return S.$$p=null,null==$&&($=b("EMPTY_HASH")),c($.$fetch("fallback",!0))?c($["$[]"]("fallback_in_progress"))?F(j,k(j,"translate",S,!1,!0),"translate",[g,R,$],l):(c($["$[]"]("default"))&&(v=j["$extract_non_symbol_default!"]($)),q=$.$merge(E(["fallback_in_progress"],{fallback_in_progress:!0})),o(b("I18n").$fallbacks()["$[]"](g),"each",[],function n(I){var a=null==n.$$s?this:n.$$s;null==I&&(I=L);try{return o(a,"catch",["exception"],function d(){var i=null==d.$$s?this:d.$$s,ee=L;if(ee=F(i,M(i,"translate",d.$$def||n.$$def||S,!1,!1),"translate",[I,R,q],null),c(ee["$nil?"]()))return L;D(g.$to_s(),I.$to_s())&&i.$on_fallback(g,I,R,$),f.$throw(ee)},{$$s:a,$$ret:f})}catch(d){if(!e.rescue(d,[A(b("I18n"),"InvalidLocale")]))throw d;try{return L}finally{e.pop_exception()}}},{$$s:j}),c($["$key?"]("default"))&&c($["$[]"]("default")["$nil?"]())?L:c(v)?F(j,k(j,"translate",S,!1,!0),"translate",[g,L,$.$merge(E(["default"],{default:v}))],null):j.$throw("exception",A(b("I18n"),"MissingTranslation").$new(g,R,$))):F(j,k(j,"translate",S,!1,!0),"translate",[g,R,$],l)}catch(n){if(n===f)return n.$v;throw n}},-3),z(P,"$extract_non_symbol_default!",function(g){var $,R=L;return R=[g["$[]"]("default")].$flatten(),$=o(R,"detect",[],function(l){return null==l&&(l=L),l["$is_a?"](b("Symbol"))["$!"]()}),c($)&&g["$[]="]("default",R["$[]"](0,R.$index($))),$}),z(P,"$exists?",function S(g,R,$){try{var f=O("return"),l=S.$$p||L,j=this;return S.$$p=null,null==$&&($=b("EMPTY_HASH")),c($.$fetch("fallback",!0))?(o(b("I18n").$fallbacks()["$[]"](g),"each",[],function v(q){var n=null==v.$$s?this:v.$$s;null==q&&(q=L);try{if(!c(F(n,M(n,"exists?",v.$$def||S,!1,!1),"exists?",[q,R],null)))return L;f.$throw(!0)}catch(I){if(!e.rescue(I,[A(b("I18n"),"InvalidLocale")]))throw I;try{return L}finally{e.pop_exception()}}},{$$s:j,$$ret:f}),!1):F(j,k(j,"exists?",S,!1,!0),"exists?",[g,R,$],l)}catch(v){if(v===f)return v.$v;throw v}},-3),P.$private(),z(P,"$on_fallback",Q(L))}(y[0],y)},Opal.modules["bcdice/randomizer"]=function(e){var _,p,C,P,x,b,u,N,W=e.klass,c=e.const_set,U=e.def,z=e.truthy,o=e.rb_gt,F=e.rb_plus,k=e.rb_le,E=e.send,M=e.rb_minus,D=e.eqeq,O=e.rb_times,Q=e.eqeqeq,G=e.rb_ge,L=[],A=e.nil,s=e.$$$;return _=L,u=[(0,e.module)(L[0],"BCDice")].concat(_),N=e.$r(u),p=u,P=[C=W(u[0],null,"Randomizer")].concat(p),x=e.$r(P),(b=C.$$prototype).rand_results=b.detailed_rand_results=A,c(P[0],"UPPER_LIMIT_DICE_TIMES",200),c(P[0],"UPPER_LIMIT_DICE_SIDES",1e4),c(P[0],"UPPER_LIMIT_RANDS",1e4),U(C,"$initialize",function(){return this.rand_results=[],this.detailed_rand_results=[]}),C.$attr_reader("rand_results"),C.$attr_reader("detailed_rand_results"),c(P[0],"DetailedRandResult",x("Struct").$new("kind","sides","value")),U(C,"$roll_barabara",function(g,R){var $=this;return z(o(F($.rand_results.$size(),g),x("UPPER_LIMIT_RANDS")))&&$.$raise(x("TooManyRandsError")),z(k(g,0))||z(o(g,x("UPPER_LIMIT_DICE_TIMES")))?[]:E(x("Array"),"new",[g],function f(){return(null==f.$$s?this:f.$$s).$roll_once(R)},{$$s:$})}),U(C,"$roll_sum",function(g,R){return this.$roll_barabara(g,R).$sum()}),U(C,"$roll_once",function(g){var $=A;return z(k(g,0))||z(o(g,x("UPPER_LIMIT_DICE_SIDES")))?0:($=this.$rand_inner(g),this.$push_to_detail("normal",g,$),$)}),U(C,"$roll_index",function(g){return M(this.$roll_once(g),1)}),U(C,"$roll_tens_d10",function(){var $,R=A;return R=this.$rand_inner(10),D(R,10)&&(R=0),$=O(R,10),this.$push_to_detail("tens_d10",10,$),$}),U(C,"$roll_d9",function(){var R;return R=M(this.$rand_inner(10),1),this.$push_to_detail("d9",10,R),R}),U(C,"$roll_d66",function(g){var f,$=A;return $=E(x("Array"),"new",[2],function l(){return(null==l.$$s?this:l.$$s).$roll_once(6)},{$$s:this}),Q(s(x("D66SortType"),"ASC"),f=g)?$["$sort!"]():Q(s(x("D66SortType"),"DESC"),f)&&$["$sort!"]()["$reverse!"](),F(O($["$[]"](0),10),$["$[]"](1))}),C.$private(),U(C,"$rand_inner",function(g){var $,R=this;return z(G(R.rand_results.$size(),x("UPPER_LIMIT_RANDS")))&&R.$raise(x("TooManyRandsError")),$=R.$random(g),R.rand_results["$<<"]([$,g]),$}),U(C,"$random",function(g){return F(x("Kernel").$rand(g),1)}),U(C,"$push_to_detail",function(g,R,$){var l;return l=x("DetailedRandResult").$new(g,R,$),this.detailed_rand_results.$push(l)}),W(u[0],N("StandardError"),"TooManyRandsError"),A},Opal.modules["bcdice/dice_table/roll_result"]=function(e){var E,Q,H,_,y,u,N,L,D,V=e.module,W=e.klass,c=e.def,U=e.truthy,z=e.return_val,o=[],F=e.nil;return E=o,Q=D=[V(o[0],"BCDice")].concat(E),H=L=[V(D[0],"DiceTable")].concat(Q),y=[_=W(L[0],null,"RollResult")].concat(H),u=e.$r(y),(N=_.$$prototype).table_name=N.value=N.body=F,c(_,"$initialize",function(t,p,C){var P=this;return P.table_name=t,P.value=p,P.body=C}),_.$attr_reader("table_name"),_.$attr_reader("value"),_.$attr_reader("body"),c(_,"$to_s",function(){var t=this;return t.table_name+"("+t.value+") \uff1e "+t.body}),c(_,"$last_body",function(){var t=this;return U(t.body["$is_a?"](u("RollResult")))?t.body.$last_body():t.body}),c(_,"$empty?",z(!1))},Opal.modules["bcdice/dice_table/chain_table"]=function(e){var E,Q,H,_,y,u,N,L,D,V=e.module,W=e.klass,c=e.truthy,U=e.def,z=e.rb_minus,o=[],F=e.nil;return E=o,Q=D=[V(o[0],"BCDice")].concat(E),H=L=[V(D[0],"DiceTable")].concat(Q),y=[_=W(L[0],null,"ChainTable")].concat(H),u=e.$r(y),(N=_.$$prototype).times=N.sides=N.items=N.name=F,U(_,"$initialize",function(t,p,C){var P=this,x=F;return P.name=t,P.items=C.$freeze(),x=/(\d+)D(\d+)/i.$match(p),c(x)||P.$raise(u("ArgumentError"),"Unexpected table type: "+p),P.times=x["$[]"](1).$to_i(),P.sides=x["$[]"](2).$to_i()}),U(_,"$roll",function(t){var C,P,p=this,x=F;return C=t.$roll_sum(p.times,p.sides),P=z(C,p.times),x=p.items["$[]"](P),c(x["$respond_to?"]("roll"))&&(x=x.$roll(t)),u("RollResult").$new(p.name,C,x)})},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(e){var O,A,u,N,r,t,p,H,G,V=e.module,W=e.klass,c=e.hash2,U=e.defs,z=e.def,o=e.rb_plus,F=e.rb_times,k=e.rb_minus,E=[],M=e.nil;return O=E,A=G=[V(E[0],"BCDice")].concat(O),u=H=[V(G[0],"DiceTable")].concat(A),r=[N=W(H[0],null,"D66GridTable")].concat(u),t=e.$r(r),(p=N.$$prototype).name=p.items=M,U(N,"$from_i18n",function(P,x){var S=M;return S=t("I18n").$t(P,c(["locale","raise"],{locale:x,raise:!0})),this.$new(S["$[]"]("name"),S["$[]"]("items"))}),z(N,"$initialize",function(P,x){return this.name=P,this.items=x.$freeze()}),z(N,"$roll",function(P){var b,S,g,R,$;return b=P.$roll_once(6),S=P.$roll_once(6),g=o(F(b,10),S),R=k(b,1),$=k(S,1),t("RollResult").$new(this.name,g,this.items["$[]"](R)["$[]"]($))})},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(e){var M,G,y,u,N,r,A,s,O,V=e.module,W=e.klass,c=e.hash2,U=e.defs,z=e.def,F=[],k=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),M=F,G=O=[V(F[0],"BCDice")].concat(M),A=[V(O[0],"DiceTable")].concat(G),s=e.$r(A),y=A,N=[u=W(A[0],s("D66GridTable"),"D66HalfGridTable")].concat(y),r=e.$r(N),U(u,"$from_i18n",function(p,C){var x=k;return x=r("I18n").$t(p,c(["locale","raise"],{locale:C,raise:!0})),this.$new(x["$[]"]("name"),x["$[]"]("items_1_2_3"),x["$[]"]("items_4_5_6"))}),z(u,"$initialize",function(p,C,P){return this.name=p,this.items=[C,C,C,P,P,P].$freeze()})},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(e){var M,G,y,u,N,r,A,s,O,V=e.module,W=e.klass,c=e.hash2,U=e.defs,z=e.def,F=[],k=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),M=F,G=O=[V(F[0],"BCDice")].concat(M),A=[V(O[0],"DiceTable")].concat(G),s=e.$r(A),y=A,N=[u=W(A[0],s("D66GridTable"),"D66OneThirdTable")].concat(y),r=e.$r(N),U(u,"$from_i18n",function(p,C){var x=k;return x=r("I18n").$t(p,c(["locale","raise"],{locale:C,raise:!0})),this.$new(x["$[]"]("name"),x["$[]"]("items_1_2"),x["$[]"]("items_3_4"),x["$[]"]("items_5_6"))}),z(u,"$initialize",function(p,C,P,x){return this.name=p,this.items=[C,C,P,P,x,x].$freeze()})},Opal.modules["bcdice/dice_table/d66_table"]=function(e){var G,H,r,t,p,C,P,y,A,V=e.module,W=e.klass,c=e.hash2,U=e.defs,z=e.def,o=e.eqeqeq,F=e.rb_plus,k=e.rb_times,E=e.truthy,M=[],D=e.nil,O=e.$$$;return G=M,H=A=[V(M[0],"BCDice")].concat(G),r=y=[V(A[0],"DiceTable")].concat(H),p=[t=W(y[0],null,"D66Table")].concat(r),C=e.$r(p),(P=t.$$prototype).sort_type=P.items=P.name=D,U(t,"$from_i18n",function(b,S){var $,R=D;return R=C("I18n").$t(b,c(["locale"],{locale:S})),$=C("D66SortType").$const_get(R["$[]"]("d66_sort_type")),this.$new(R["$[]"]("name"),$,R["$[]"]("items"))}),z(t,"$initialize",function(b,S,g){var R=this;return R.name=b,R.sort_type=S,R.items=g.$freeze()}),z(t,"$roll",function(b){var S=this,g=D,R=D,$=D,f=D;return g=b.$roll_barabara(2,6),o(O(C("D66SortType"),"ASC"),R=S.sort_type)?g["$sort!"]():o(O(C("D66SortType"),"DESC"),R)&&g["$sort!"]()["$reverse!"](),$=F(k(g["$[]"](0),10),g["$[]"](1)),f=E(R=S.items["$[]"]($))?R:S.items["$[]"]($.$to_s()),E(f["$respond_to?"]("roll"))&&(f=f.$roll(b)),C("RollResult").$new(S.name,$,f)}),z(t,"$choice",function(b){return C("RollResult").$new(this.name,b,this.items["$[]"](b))})},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(e){var L,_,u,N,s,V=e.module,W=e.klass,c=e.hash2,U=e.send,z=e.to_ary,o=e.rb_plus,F=e.rb_times,k=e.send2,E=e.find_super,M=e.def,O=[],Q=e.nil;return e.top.$require("bcdice/dice_table/d66_table"),L=O,_=s=[V(O[0],"BCDice")].concat(L),u=[V(s[0],"DiceTable")].concat(_),N=e.$r(u),M(W(u[0],N("D66Table"),"D66LeftRangeTable"),"$initialize",function C(P,x,b){var R;return C.$$p=null,R=c([],{}),U(b,"each",[],function(f){var l,q;return null==f&&(f=Q),l=z(f),q=null==l[1]?Q:l[1],U(null==l[0]?Q:l[0],"each",[],function(I){return null==I&&(I=Q),U(q,"each_with_index",[],function(d,i){var ee,te;return null==d&&(d=Q),null==i&&(i=Q),te=o(F(I,10),o(i,1)),U(R,"[]=",ee=[te,d]),ee[ee.length-1]})})}),k(this,E(this,"initialize",C,!1,!0),"initialize",[P,x,R],null)})},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(e){var Q,s,N,r,t,p,C,_,L,V=e.module,W=e.klass,c=e.hash2,U=e.defs,z=e.def,o=e.truthy,F=e.rb_minus,k=e.rb_plus,E=e.rb_times,M=[],D=e.nil;return Q=M,s=L=[V(M[0],"BCDice")].concat(Q),N=_=[V(L[0],"DiceTable")].concat(s),t=[r=W(_[0],null,"D66ParityTable")].concat(N),p=e.$r(t),(C=r.$$prototype).odd=C.even=C.name=D,U(r,"$from_i18n",function(x,b){var g=D;return g=p("I18n").$t(x,c(["locale","raise"],{locale:b,raise:!0})),this.$new(g["$[]"]("name"),g["$[]"]("odd"),g["$[]"]("even"))}),z(r,"$initialize",function(x,b,S){var g=this;return g.name=x,g.odd=b.$freeze(),g.even=S.$freeze()}),z(r,"$roll",function(x){var g,$,f,b=this,S=D;return S=x.$roll_once(6),g=x.$roll_once(6),$=(o(S["$odd?"]())?b.odd:b.even)["$[]"](F(g,1)),f=k(E(S,10),g),p("RollResult").$new(b.name,f,$)})},Opal.modules["bcdice/dice_table/d66_range_table"]=function(e){var M,G,_,y,u,N,r,A,O,V=e.module,W=e.klass,c=e.def,U=e.rb_plus,z=e.rb_times,o=e.send,F=[],k=e.nil;return M=F,G=O=[V(F[0],"BCDice")].concat(M),_=A=[V(O[0],"DiceTable")].concat(G),u=[y=W(A[0],null,"D66RangeTable")].concat(_),N=e.$r(u),(r=y.$$prototype).items=r.name=k,c(y,"$initialize",function(p,C){return this.name=p,this.items=C.$freeze()}),c(y,"$roll",function(p){var P,x,b,S=k;return P=p.$roll_once(6),x=p.$roll_once(6),b=U(z(P,10),x),S=o(this.items,"find",[],function(R){return null==R&&(R=k),R["$[]"](0)["$include?"](b)}),N("RollResult").$new(this.name,b,S["$[]"](1))})},Opal.modules["bcdice/dice_table/range_table"]=function(e){var Q,s,N,r,t,p,C,_,L,V=e.module,W=e.klass,c=e.const_set,U=e.send,z=e.truthy,o=e.def,F=e.eqeqeq,k=e.rb_times,E=e.rb_plus,M=[],D=e.nil;return Q=M,s=L=[V(M[0],"BCDice")].concat(Q),N=_=[V(L[0],"DiceTable")].concat(s),t=[r=W(_[0],null,"RangeTable")].concat(N),p=e.$r(t),(C=r.$$prototype).name=C.items=C.num_of_dice=C.num_of_sides=C.formatter=D,c(t[0],"RollResult",U(p("Struct"),"new",["sum","values","content","formatted"],function P(){return(null==P.$$s?this:P.$$s).$alias_method("to_s","formatted")},{$$s:r})),c(t[0],"Item",p("Struct").$new("range","content")),c(t[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),c(t[0],"DEFAULT_FORMATTER",U(r,"lambda",[],function(x,b){return null==x&&(x=D),null==b&&(b=D),x.$name()+"("+b.$sum()+") \uff1e "+b.$content()})),r.$attr_reader("name"),r.$attr_reader("num_of_dice"),r.$attr_reader("num_of_sides"),o(r,"$initialize",function P(x,b,S){var $,g=P.$$p||D,R=this,f=D;return P.$$p=null,R.name=x.$freeze(),R.formatter=z($=g)?$:p("DEFAULT_FORMATTER"),f=p("DICE_ROLL_METHOD_RE").$match(b),z(f)||R.$raise(p("ArgumentError"),R.name+": invalid dice roll method: "+b),R.num_of_dice=f["$[]"](1).$to_i(),R.num_of_sides=f["$[]"](2).$to_i(),R.$store(S)}),o(r,"$fetch",function(x){var S,b=this;return S=U(b.items,"find",[],function(R){return null==R&&(R=D),R.$range()["$include?"](x)}),z(S)||b.$raise(p("RangeError"),b.name+": value is out of range: "+x),S}),o(r,"$roll",function(x){var g,b=this,S=D,R=D;return g=(S=x.$roll_barabara(b.num_of_dice,b.num_of_sides)).$sum(),(R=p("RollResult").$new(g,S,b.$fetch(g).$content()))["$formatted="](b.formatter["$[]"](b,R)),R}),r.$private(),o(r,"$store",function(x){var S,g,b=this;return S=U(x,"map",[],function R($,f){return null==$&&($=D),null==f&&(f=D),[(null==R.$$s?this:R.$$s).$coerce_to_int_range($),f]},{$$s:b}),g=U(S,"sort_by",[],function($,f){return null==$&&($=D),null==f&&(f=D),$.$min()}),b.$assert_min_sum_is_covered(g),b.$assert_max_sum_is_covered(g),b.$assert_no_gap_or_overlap_in_ranges(g),b.items=U(g,"map",[],function($,f){return null==$&&($=D),null==f&&(f=D),p("Item").$new($,f.$freeze()).$freeze()}).$freeze(),b}),o(r,"$coerce_to_int_range",function(x){var S;return F(p("Integer"),S=x)?p("Range").$new(x,x):F(p("Range"),S)&&z(x.$begin()["$is_a?"](p("Integer")))&&z(x.$end()["$is_a?"](p("Integer")))?x:this.$raise(p("TypeError"),this.name+": "+x+" ("+x.$class()+") must be an Integer or a Range with Integers ")}),o(r,"$assert_min_sum_is_covered",function(x){var S,b=this,g=D;return S=b.num_of_dice,g=x.$first()["$[]"](0),z(g["$include?"](S))||b.$raise(p("RangeError"),b.name+": min value ("+S+") is not covered: "+g),b}),o(r,"$assert_max_sum_is_covered",function(x){var S,b=this,g=D;return S=k(b.num_of_dice,b.num_of_sides),g=x.$last()["$[]"](0),z(g["$include?"](S))||b.$raise(p("RangeError"),b.name+": max value ("+S+") is not covered: "+g),b}),o(r,"$assert_no_gap_or_overlap_in_ranges",function(x){return U(x,"each_cons",[2],function S(g,R){var j,v,$=null==S.$$s?this:S.$$s,f=D,l=D;return null==$.name&&($.name=D),null==g&&(g=D),null==R&&(R=D),f=g["$[]"](0),l=R["$[]"](0),j=f.$max(),v=E(j,1),z(l["$include?"](j))&&$.$raise(p("RangeError"),$.name+": Range overlap: "+f+" and "+l),z(l["$include?"](v))?D:$.$raise(p("RangeError"),$.name+": Range gap: "+f+" and "+l)},{$$s:this}),this})},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(e){var D,L,y,p,C,P,x,N,s,Q,V=e.module,W=e.klass,c=e.send,U=e.def,z=e.rb_minus,o=e.return_ivar,F=[],k=e.nil,E=e.$$$;return D=F,L=Q=[V(F[0],"BCDice")].concat(D),y=s=[V(Q[0],"DiceTable")].concat(L),p=N=[W(s[0],null,"SaiFicSkillTable")].concat(y),P=[C=W(N[0],null,"Category")].concat(p),x=e.$r(P),U(C,"$initialize",function(S,g,R,$){var f=this;return f.name=S,f.skills=c(g.$map(),"with_index",[2],function(j,v){return null==j&&(j=k),null==v&&(v=k),E(x("SaiFicSkillTable"),"Skill").$new(S,j,R,v,$)}),f.dice=R}),U(C,"$roll",function(S){return this.$skills()["$[]"](z(S.$roll_sum(2,6),2))}),U(C,"$to_s",o("name")),C.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(e){var k,O,s,N,r,_,G,M,V=e.module,W=e.klass,c=e.def,U=e.hash2,z=[],o=e.nil;return k=z,O=M=[V(z[0],"BCDice")].concat(k),s=G=[V(M[0],"DiceTable")].concat(O),_=[W(G[0],null,"SaiFicSkillTable")].concat(s),(r=(N=W(_[0],null,"Skill")).$$prototype).s_format=r.category_dice=r.row_dice=r.category_name=r.name=o,c(N,"$initialize",function(p,C,P,x,b){var S=this;return S.category_name=p,S.name=C,S.category_dice=P,S.row_dice=x,S.s_format=b}),c(N,"$to_s",function(){var p=this;return p.$format(p.s_format,U(["category_dice","row_dice","category_name","skill_name"],{category_dice:p.category_dice,row_dice:p.row_dice,category_name:p.category_name,skill_name:p.name}))}),N.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(e){var _,r,x,b,S,g,R,p,u,V=e.module,W=e.klass,c=e.ensure_kwargs,U=e.hash2,z=e.send,F=e.defs,k=e.const_set,E=e.to_ary,M=e.def,D=e.truthy,O=e.rb_minus,Q=e.rb_plus,G=e.top,L=[],A=e.nil,s=e.$$$;return G.$require("bcdice/dice_table/sai_fic_skill_table/category"),G.$require("bcdice/dice_table/sai_fic_skill_table/skill"),_=L,r=u=[V(L[0],"BCDice")].concat(_),x=p=[V(u[0],"DiceTable")].concat(r),S=[b=W(p[0],null,"SaiFicSkillTable")].concat(x),g=e.$r(S),(R=b.$$prototype).rtt=R.rtt_format=R.rct=R.rct_format=R.rttn=R.rttn_format=R.categories=A,F(b,"$from_i18n",function(f,l,j){var v,q,n,i,d=A;return null==(v=(j=c(j)).$$smap.rtt)&&(v=A),null==(q=j.$$smap.rct)&&(q=A),null==(n=j.$$smap.rttn)&&(n=A),i=(d=g("I18n").$t("RTT",U(["locale","raise","default"],{locale:l,raise:!1,default:U([],{})})).$merge(g("I18n").$t(f,U(["locale","raise"],{locale:l,raise:!0}))))["$[]"]("items"),d=z(d,"select",[],function(te,re){return null==te&&(te=A),null==re&&(re=A),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](te)}),this.$new(i,e.to_hash(d).$merge(U(["rtt","rct","rttn"],{rtt:v,rct:q,rttn:n})))},-3),k(S[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),k(S[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),k(S[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),k(S[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),M(b,"$initialize",function(f,l){var j,v,q,n,I,a,d,i=this;return null==(j=(l=c(l)).$$smap.rtt)&&(j=A),null==(v=l.$$smap.rct)&&(v=A),null==(q=l.$$smap.rttn)&&(q=A),null==(n=l.$$smap.rtt_format)&&(n=g("DEFAULT_RTT")),null==(I=l.$$smap.rct_format)&&(I=g("DEFAULT_RCT")),null==(a=l.$$smap.rttn_format)&&(a=g("DEFAULT_RTTN")),null==(d=l.$$smap.s_format)&&(d=g("DEFAULT_S")),i.categories=z(f.$map(),"with_index",[1],function(te,re){var se,ce,$e;return null==te&&(te=A),null==re&&(re=A),ce=null==(se=E(te))[0]?A:se[0],$e=null==se[1]?A:se[1],s(g("SaiFicSkillTable"),"Category").$new(ce,$e,re,d)},{$$has_top_level_mlhs_arg:!0}),i.rtt=j,i.rct=v,i.rttn=q.$to_a(),i.rtt_format=n,i.rct_format=I,i.rttn_format=a},-2),k(S[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),b.$attr_reader("categories"),M(b,"$roll_command",function(f,l){var v,j=this,q=A,n=A;return D(["RTT",j.rtt]["$include?"](v=l))?j.$format_skill(j.rtt_format,j.$roll_skill(f)):D(["RCT",j.rct]["$include?"](v))?(q=j.$roll_category(f),j.$format(j.rct_format,U(["category_dice","category_name"],{category_dice:q.$dice(),category_name:q.$name()}))):D(n=g("RTTN").$index(v))||D(n=j.rttn.$index(v))?j.$format_skill(j.rttn_format,j.categories["$[]"](n).$roll(f)):A}),M(b,"$roll_category",function(f){return this.categories["$[]"](O(f.$roll_once(6),1))}),M(b,"$roll_skill",function(f){return this.$roll_category(f).$roll(f)}),M(b,"$prefixes",function(){var f=this;return Q(["RTT[1-6]?","RCT",f.rtt,f.rct],f.rttn).$compact()}),b.$private(),M(b,"$format_skill",function(f,l){return this.$format(f,U(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:l.$category_dice(),row_dice:l.$row_dice(),category_name:l.$category_name(),skill_name:l.$name(),text:l.$to_s()}))})},Opal.modules["bcdice/dice_table/table"]=function(e){var D,L,y,u,N,r,t,s,Q,V=e.module,W=e.klass,c=e.hash2,U=e.defs,z=e.truthy,o=e.def,F=e.rb_minus,k=[],E=e.nil;return D=k,L=Q=[V(k[0],"BCDice")].concat(D),y=s=[V(Q[0],"DiceTable")].concat(L),N=[u=W(s[0],null,"Table")].concat(y),r=e.$r(N),(t=u.$$prototype).times=t.sides=t.name=t.items=E,U(u,"$from_i18n",function(C,P){var b=E;return b=r("I18n").$t(C,c(["locale"],{locale:P})),this.$new(b["$[]"]("name"),b["$[]"]("type"),b["$[]"]("items"))}),o(u,"$initialize",function(C,P,x){var b=this,S=E;return b.name=C,b.items=x.$freeze(),S=/(\d+)D(\d+)/i.$match(P),z(S)||b.$raise(r("ArgumentError"),"Unexpected table type: "+P),b.times=S["$[]"](1).$to_i(),b.sides=S["$[]"](2).$to_i()}),o(u,"$roll",function(C){var x,P=this;return x=C.$roll_sum(P.times,P.sides),P.$choice(x)}),o(u,"$choice",function(C){var x,P=this;return x=F(C,P.times),r("RollResult").$new(P.name,C,P.items["$[]"](x))})},Opal.modules["bcdice/dice_table"]=function(e){var V=e.top;return V.$require("bcdice/dice_table/roll_result"),V.$require("bcdice/dice_table/chain_table"),V.$require("bcdice/dice_table/d66_grid_table"),V.$require("bcdice/dice_table/d66_half_grid_table"),V.$require("bcdice/dice_table/d66_one_third_table"),V.$require("bcdice/dice_table/d66_left_range_table"),V.$require("bcdice/dice_table/d66_parity_table"),V.$require("bcdice/dice_table/d66_range_table"),V.$require("bcdice/dice_table/d66_table"),V.$require("bcdice/dice_table/range_table"),V.$require("bcdice/dice_table/sai_fic_skill_table"),V.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(e){var o,M,O,k,V=e.module,W=e.const_set,c=[];return o=c,M=k=[V(c[0],"BCDice")].concat(o),O=[V(k[0],"D66SortType")].concat(M),W(O[0],"NO_SORT","no_sort"),W(O[0],"ASC","asc"),W(O[0],"DESC","desc"),function(E,M){var O=[V(E,"RoundType")].concat(M);return W(O[0],"CEIL","ceil"),W(O[0],"FLOOR","floor"),W(O[0],"ROUND","round")}(k[0],k)},Opal.modules["bcdice/translate"]=function(e){var M,G,L,A,s,O,V=e.module,W=e.ensure_kwargs,c=e.kwrestargs,z=e.hash2,o=e.def,F=[],k=e.nil;return M=F,G=O=[V(F[0],"BCDice")].concat(M),A=[L=V(O[0],"Translate")].concat(G),s=e.$r(A),o(L,"$translate",function(_,y){var u,N=this;return null==N.locale&&(N.locale=k),y=W(y),u=c(y,{}),s("I18n").$translate(_,z(["locale","raise"],{locale:N.locale,raise:!0}).$merge(e.to_hash(u)))},-2)},Opal.modules["bcdice/result"]=function(e){var L,H,A,M,O,W=e.klass,c=e.send,U=e.def,z=e.return_val,o=e.return_ivar,F=[],k=e.nil;return M=F,L=O=[(0,e.module)(F[0],"BCDice")].concat(M),[A=W(O[0],null,"Result")].concat(L),U(H=e.get_singleton_class(A),"$success",function(u){return c(this.$new(),"tap",[],function(t){var p;return null==t&&(t=k),t["$text="](u),c(t,"success=",p=[!0]),p[p.length-1]})}),U(H,"$failure",function(u){return c(this.$new(),"tap",[],function(t){var p;return null==t&&(t=k),t["$text="](u),c(t,"failure=",p=[!0]),p[p.length-1]})}),U(H,"$critical",function(u){return c(this.$new(),"tap",[],function(t){var p;return null==t&&(t=k),t["$text="](u),t["$critical="](!0),c(t,"success=",p=[!0]),p[p.length-1]})}),U(H,"$fumble",function(u){return c(this.$new(),"tap",[],function(t){var p;return null==t&&(t=k),t["$text="](u),t["$fumble="](!0),c(t,"failure=",p=[!0]),p[p.length-1]})}),U(H,"$nothing",z("nothing")),U(A,"$initialize",function(_){var y=this;return null==_&&(_=k),y.text=_,y.rands=k,y.detailed_rands=k,y.secret=!1,y.success=!1,y.failure=!1,y.critical=!1,y.fumble=!1},-1),A.$attr_accessor("text","rands","detailed_rands"),A.$attr_writer("secret","success","failure","critical","fumble"),U(A,"$secret?",o("secret")),U(A,"$success?",o("success")),U(A,"$failure?",o("failure")),U(A,"$critical?",o("critical")),U(A,"$fumble?",o("fumble")),U(A,"$condition=",function(_){return this.success=_,this.failure=_["$!"]()})},Opal.modules["racc/parser"]=function(e){var C,x,b,V=e.module,W=e.klass,c=e.truthy,U=e.const_set,z=e.defs,o=e.gvars,F=e.rb_lt,k=e.def,E=e.to_ary,M=e.send,D=e.neqeq,O=e.rb_plus,Q=e.eqeq,G=e.rb_ge,L=e.rb_gt,A=e.rb_minus,s=e.rb_le,H=e.rb_times,_=e.assign_ivar_val,u=[],N=e.$r(u),r=e.nil,t=e.$$$;return C=u,x=[V(u[0],"Racc")].concat(C),b=e.$r(x),W(x[0],b("StandardError"),"ParseError"),c(t("::","ParseError","skip_raise")?"constant":r)||U(u[0],"ParseError",t(N("Racc"),"ParseError")),function(p,C){var $,f,l,j,v,b=[V(p,"Racc")].concat(C),S=e.$r(b);return c(S("Racc_No_Extensions","skip_raise")?"constant":r)||U(b[0],"Racc_No_Extensions",!1),$=b,l=[f=W(b[0],null,"Parser")].concat($),j=e.$r(l),(v=f.$$prototype).yydebug=v.racc_debug_out=v.racc_error_status=v.racc_t=v.racc_vstack=v.racc_val=v.racc_state=v.racc_tstack=r,U(l[0],"Racc_Runtime_Version","1.4.6"),U(l[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),U(l[0],"Racc_Runtime_Core_Version_R","1.4.6"),U(l[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),U(l[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),U(l[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),U(l[0],"Racc_Runtime_Core_Version",j("Racc_Runtime_Core_Version_R")),U(l[0],"Racc_Runtime_Core_Revision",j("Racc_Runtime_Core_Revision_R")),U(l[0],"Racc_Runtime_Type","ruby"),z(j("Parser"),"$racc_runtime_type",function(){return j("Racc_Runtime_Type")}),k(f,"$_racc_setup",function(){var n,I,a=this,d=r,i=r;return null==o.stderr&&(o.stderr=r),c(t(a.$class(),"Racc_debug_parser"))||(a.yydebug=!1),c(null!=(n=a.yydebug)&&n!==r?"instance-variable":r)||(a.yydebug=!1),c(a.yydebug)&&(c(null!=(I=a.racc_debug_out)&&I!==r?"instance-variable":r)||(a.racc_debug_out=o.stderr),a.racc_debug_out=c(d=a.racc_debug_out)?d:o.stderr),i=t(a.$class(),"Racc_arg"),c(F(i.$size(),14))&&i["$[]="](13,!0),i}),k(f,"$_racc_init_sysvars",function(){var n=this;return n.racc_state=[0],n.racc_tstack=[],n.racc_vstack=[],n.racc_t=r,n.racc_val=r,n.racc_read_next=!0,n.racc_user_yyerror=!1,n.racc_error_status=0}),k(f,"$do_parse",function(){return this.$__send__(j("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)}),k(f,"$next_token",function(){return this.$raise(j("NotImplementedError"),this.$class()+"#next_token is not defined")}),k(f,"$_racc_do_parse_rb",function(n,I){var a,i=this,ee=r,te=r,re=r,se=r,ce=r,$e=r,_e=r,ae=r;return a=E(n),ee=null==a[0]?r:a[0],te=null==a[1]?r:a[1],re=null==a[2]?r:a[2],se=null==a[3]?r:a[3],ce=null==a[10]?r:a[10],i.$_racc_init_sysvars(),$e=_e=ae=r,M(i,"catch",["racc_end_parse"],function X(){var T,K,m=null==X.$$s?this:X.$$s,w=r;for(null==m.racc_state&&(m.racc_state=r),null==m.racc_read_next&&(m.racc_read_next=r),null==m.racc_t&&(m.racc_t=r),null==m.yydebug&&(m.yydebug=r),null==m.racc_val&&(m.racc_val=r);c(!0);)for(c(ae=se["$[]"](m.racc_state["$[]"](-1)))?(c(m.racc_read_next)&&D(m.racc_t,0)&&(K=m.$next_token(),T=E(K),$e=null==T[0]?r:T[0],m.racc_val=null==T[1]?r:T[1],m.racc_t=c($e)?c(w=ce["$[]"]($e))?w:1:0,c(m.yydebug)&&m.$racc_read_token(m.racc_t,$e,m.racc_val),m.racc_read_next=!1),ae=O(ae,m.racc_t),c(G(ae,0))&&c(_e=ee["$[]"](ae))&&Q(te["$[]"](ae),m.racc_state["$[]"](-1))||(_e=re["$[]"](m.racc_state["$[]"](-1)))):_e=re["$[]"](m.racc_state["$[]"](-1));c(_e=m.$_racc_evalact(_e,n)););},{$$s:i})}),k(f,"$yyparse",function(n,I){return this.$__send__(j("Racc_YY_Parse_Method"),n,I,this.$_racc_setup(),!0)}),k(f,"$_racc_yyparse_rb",function(n,I,a,d){var i,re=r,se=r,ue=r,ce=r,_e=r,ae=r,X=r;return i=E(a),re=null==i[0]?r:i[0],se=null==i[1]?r:i[1],ue=null==i[2]?r:i[2],ce=null==i[3]?r:i[3],_e=null==i[10]?r:i[10],this.$_racc_init_sysvars(),ae=r,X=r,M(this,"catch",["racc_end_parse"],function T(){var K=null==T.$$s?this:T.$$s;for(null==K.racc_state&&(K.racc_state=r);!c(X=ce["$[]"](K.racc_state["$[]"](-1)));)for(;c(ae=K.$_racc_evalact(ue["$[]"](K.racc_state["$[]"](-1)),a)););return M(n,"__send__",[I],function m(w,J){var h=null==m.$$s?this:m.$$s,B=r,Z=r;for(null==h.racc_t&&(h.racc_t=r),null==h.racc_state&&(h.racc_state=r),null==h.racc_read_next&&(h.racc_read_next=r),null==w&&(w=r),null==J&&(J=r),h.racc_t=c(w)?c(B=_e["$[]"](w))?B:1:0,h.racc_val=J,h.racc_read_next=!1,X=O(X,h.racc_t),c(G(X,0))&&c(ae=re["$[]"](X))&&Q(se["$[]"](X),h.racc_state["$[]"](-1))||(ae=ue["$[]"](h.racc_state["$[]"](-1)));c(ae=h.$_racc_evalact(ae,a)););for(;c(c(B=c(Z=(X=ce["$[]"](h.racc_state["$[]"](-1)))["$!"]())?Z:h.racc_read_next["$!"]())?B:h.racc_t["$=="](0));)for(c(X)&&c(X=O(X,h.racc_t))&&c(G(X,0))&&c(ae=re["$[]"](X))&&Q(se["$[]"](X),h.racc_state["$[]"](-1))||(ae=ue["$[]"](h.racc_state["$[]"](-1)));c(ae=h.$_racc_evalact(ae,a)););},{$$s:K})},{$$s:this})}),k(f,"$_racc_evalact",function(n,I){var a,ue,i=this,ee=r,te=r,se=r,ce=r,$e=r,_e=r;if(ee=null==(a=E(I))[0]?r:a[0],te=null==a[1]?r:a[1],se=null==a[3]?r:a[3],ue=null==a[11]?r:a[11],ce=null==a[12]?r:a[12],c(L(n,0))&&c(F(n,ue)))c(L(i.racc_error_status,0))&&(Q(i.racc_t,1)||(i.racc_error_status=A(i.racc_error_status,1))),i.racc_vstack.$push(i.racc_val),i.racc_state.$push(n),i.racc_read_next=!0,c(i.yydebug)&&(i.racc_tstack.$push(i.racc_t),i.$racc_shift(i.racc_t,i.racc_tstack,i.racc_vstack));else if(c(F(n,0))&&c(L(n,ce["$-@"]()))){if($e=M(i,"catch",["racc_jump"],function ae(){var X=null==ae.$$s?this:ae.$$s;return null==X.racc_state&&(X.racc_state=r),X.racc_state.$push(X.$_racc_do_reduce(I,n)),!1},{$$s:i}),c($e))switch($e){case 1:return i.racc_user_yyerror=!0,ce["$-@"]();case 2:return ue;default:i.$raise("[Racc Bug] unknown jump code")}}else if(Q(n,ue))c(i.yydebug)&&i.$racc_accept(),i.$throw("racc_end_parse",i.racc_vstack["$[]"](0));else{if(Q(n,ce["$-@"]())){switch(i.racc_error_status){case 0:c(I["$[]"](21))||i.$on_error(i.racc_t,i.racc_val,i.racc_vstack);break;case 3:Q(i.racc_t,0)&&i.$throw("racc_end_parse",r),i.racc_read_next=!0}for(i.racc_user_yyerror=!1,i.racc_error_status=3;c(!0)&&!(c(_e=se["$[]"](i.racc_state["$[]"](-1)))&&(_e=O(_e,1),c(G(_e,0))&&c(n=ee["$[]"](_e))&&Q(te["$[]"](_e),i.racc_state["$[]"](-1))));)c(s(i.racc_state.$size(),1))&&i.$throw("racc_end_parse",r),i.racc_state.$pop(),i.racc_vstack.$pop(),c(i.yydebug)&&(i.racc_tstack.$pop(),i.$racc_e_pop(i.racc_state,i.racc_tstack,i.racc_vstack));return n}i.$raise("[Racc Bug] unknown action "+n.$inspect())}return c(i.yydebug)&&i.$racc_next_state(i.racc_state["$[]"](-1),i.racc_state),r}),k(f,"$_racc_do_reduce",function(n,I){var a,ce,_e,w,J,h,Y,i=this,te=r,re=r,se=r,ue=r,$e=r,ae=r,X=r,T=r,K=r,m=r,B=r,Z=r,ne=r;return te=null==(a=E(n))[4]?r:a[4],re=null==a[5]?r:a[5],se=null==a[6]?r:a[6],ue=null==a[7]?r:a[7],ce=null==a[8]?r:a[8],$e=null==a[9]?r:a[9],_e=null==a[13]?r:a[13],ae=i.racc_state,X=i.racc_vstack,T=i.racc_tstack,K=H(I,-3),m=$e["$[]"](K),w=$e["$[]"](O(K,1)),J=$e["$[]"](O(K,2)),h=[],c(i.yydebug)&&(B=T["$[]"](m["$-@"](),m)),Z=X["$[]"](m["$-@"](),m),c(i.yydebug)&&T["$[]="](m["$-@"](),m,h),X["$[]="](m["$-@"](),m,h),ae["$[]="](m["$-@"](),m,h),c(_e)?X.$push(i.$__send__(J,Z,X,Z["$[]"](0))):X.$push(i.$__send__(J,Z,X)),T.$push(w),c(i.yydebug)&&i.$racc_reduce(B,w,T,X),Y=A(w,ce),c(K=ue["$[]"](Y))&&(K=O(K,ae["$[]"](-1)),c(G(K,0))&&c(ne=te["$[]"](K))&&Q(re["$[]"](K),Y))?ne:se["$[]"](Y)}),k(f,"$on_error",function(n,I,a){var i,d=this;return d.$raise(j("ParseError"),d.$sprintf("\nparse error on value %s (%s)",I.$inspect(),c(i=d.$token_to_str(n))?i:"?"))}),k(f,"$yyerror",function(){return this.$throw("racc_jump",1)}),k(f,"$yyaccept",function(){return this.$throw("racc_jump",2)}),k(f,"$yyerrok",_("racc_error_status",0)),k(f,"$racc_read_token",function(n,I,a){var d=this;return d.racc_debug_out.$print("read    "),d.racc_debug_out.$print(I.$inspect(),"(",d.$racc_token2str(n),") "),d.racc_debug_out.$puts(a.$inspect()),d.racc_debug_out.$puts()}),k(f,"$racc_shift",function(n,I,a){var d=this;return d.racc_debug_out.$puts("shift   "+d.$racc_token2str(n)),d.$racc_print_stacks(I,a),d.racc_debug_out.$puts()}),k(f,"$racc_reduce",function(n,I,a,d){var i=this,ee=r;return(ee=i.racc_debug_out).$print("reduce "),c(n["$empty?"]())?ee.$print(" <none>"):M(n,"each",[],function te(re){return null==re&&(re=r),ee.$print(" ",(null==te.$$s?this:te.$$s).$racc_token2str(re))},{$$s:i}),ee.$puts(" --\x3e "+i.$racc_token2str(I)),i.$racc_print_stacks(a,d),i.racc_debug_out.$puts()}),k(f,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()}),k(f,"$racc_e_pop",function(n,I,a){var d=this;return d.racc_debug_out.$puts("error recovering mode: pop token"),d.$racc_print_states(n),d.$racc_print_stacks(I,a),d.racc_debug_out.$puts()}),k(f,"$racc_next_state",function(n,I){var a=this;return a.racc_debug_out.$puts("goto    "+n),a.$racc_print_states(I),a.racc_debug_out.$puts()}),k(f,"$racc_print_stacks",function(n,I){var d=r;return(d=this.racc_debug_out).$print("        ["),M(n,"each_index",[],function i(ee){return null==ee&&(ee=r),d.$print(" (",(null==i.$$s?this:i.$$s).$racc_token2str(n["$[]"](ee))," ",I["$[]"](ee).$inspect(),")")},{$$s:this}),d.$puts(" ]")}),k(f,"$racc_print_states",function(n){var a=r;return(a=this.racc_debug_out).$print("        ["),M(n,"each",[],function(i){return null==i&&(i=r),a.$print(" ",i)}),a.$puts(" ]")}),k(f,"$racc_token2str",function(n){var a;return c(a=t(this.$class(),"Racc_token_to_s_table")["$[]"](n))?a:this.$raise("[Racc Bug] can't convert token "+n+" to string")}),k(f,"$token_to_str",function(n){return t(this.$class(),"Racc_token_to_s_table")["$[]"](n)})}(u[0],u)},Opal.modules["bcdice/arithmetic/node"]=function(e){var _,r,P,$,f,b,S,p,u,V=e.module,W=e.klass,c=e.def,U=e.thrower,z=e.return_ivar,o=e.send2,F=e.find_super,k=e.eqeq,E=e.const_set,M=e.eqeqeq,D=e.rb_divide,O=e.truthy,Q=e.assign_ivar,G=e.alias,L=[],A=e.nil,s=e.$$$;return _=L,r=u=[V(L[0],"BCDice")].concat(_),P=p=[V(u[0],"Arithmetic")].concat(r),b=[V(p[0],"Node")].concat(P),S=e.$r(b),(f=($=W(b[0],null,"BinaryOp")).$$prototype).lhs=f.rhs=f.op=A,c($,"$initialize",function(j,v,q){var n=this;return n.lhs=j,n.op=v,n.rhs=q}),c($,"$eval",function(j){try{U("eval_return");var I,q=this,n=A;return n=q.lhs.$eval(j),I=q.rhs.$eval(j),n.$send(q.op,I)}catch(a){if(a===e.t_eval_return)return a.$v;throw a}}),c($,"$output",function(){var j=this;return""+j.lhs.$output()+j.op+j.rhs.$output()}),c($,"$s_exp",function(){var j=this;return"("+j.$op_for_s_exp()+" "+j.lhs.$s_exp()+" "+j.rhs.$s_exp()+")"}),c($,"$op_for_s_exp",z("op")),function(g,R,$){var f=W(g,R,"DivideBase"),l=[f].concat($),j=e.$r(l),v=f.$$prototype;v.lhs=v.rhs=v.op=A,c(f,"$initialize",function q(n,I){return q.$$p=null,o(this,F(this,"initialize",q,!1,!0),"initialize",[n,"/",I],null)}),c(f,"$eval",function(n){try{U("eval_return");var d,i,a=this;return d=a.lhs.$eval(n),i=a.rhs.$eval(n),k(i,0)&&a.$raise(j("ZeroDivisionError")),a.$divide_and_round(d,i,n)}catch(ee){if(ee===e.t_eval_return)return ee.$v;throw ee}}),c(f,"$output",function q(){var n=q.$$p||A,I=this;return q.$$p=null,""+o(I,F(I,"output",q,!1,!0),"output",[],n)+I.$rounding_method()}),f.$private(),c(f,"$rounding_method",function(){return s(this.$class(),"ROUNDING_METHOD")}),c(f,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()}),c(f,"$divide_and_round",function(n,I,a){return this.$raise(j("NotImplementedError"))})}(b[0],S("BinaryOp"),b),function(g,R,$){var f=W(g,R,"DivideWithGameSystemDefault"),l=[f].concat($),j=e.$r(l);E(l[0],"ROUNDING_METHOD",""),f.$private(),c(f,"$divide_and_round",function(q,n,I){var a,d=A;return M(s(j("RoundType"),"CEIL"),a=I)?D(q.$to_f(),n).$ceil():M(s(j("RoundType"),"ROUND"),a)?(d=D(q.$to_f(),n),O(d["$negative?"]())?d.$abs().$round()["$-@"]():d.$round()):D(q,n).$floor()})}(b[0],S("DivideBase"),b),function(g,R,$){var f=W(g,R,"DivideWithCeil"),l=[f].concat($);E(l[0],"ROUNDING_METHOD","C"),f.$private(),c(f,"$divide_and_round",function(v,q,n){return D(v.$to_f(),q).$ceil()})}(b[0],S("DivideBase"),b),function(g,R,$){var f=W(g,R,"DivideWithRound"),l=[f].concat($);E(l[0],"ROUNDING_METHOD","R"),f.$private(),c(f,"$divide_and_round",function(v,q,n){var I=A;return I=D(v.$to_f(),q),O(I["$negative?"]())?I.$abs().$round()["$-@"]():I.$round()})}(b[0],S("DivideBase"),b),function(g,R,$){var f=W(g,R,"DivideWithFloor"),l=[f].concat($);E(l[0],"ROUNDING_METHOD","F"),f.$private(),c(f,"$divide_and_round",function(v,q,n){return D(v,q).$floor()})}(b[0],S("DivideBase"),b),function(g,R){var $=W(g,null,"Negative");$.$$prototype.body=A,c($,"$initialize",Q("body")),c($,"$eval",function(j){try{return U("eval_return"),this.body.$eval(j)["$-@"]()}catch(n){if(n===e.t_eval_return)return n.$v;throw n}}),c($,"$output",function(){return"-"+this.body.$output()}),c($,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"})}(b[0]),function(g,R){var $=W(g,null,"Parenthesis");$.$$prototype.expr=A,c($,"$initialize",Q("expr")),c($,"$eval",function(j){try{return U("eval_return"),this.expr.$eval(j)}catch(n){if(n===e.t_eval_return)return n.$v;throw n}}),c($,"$output",function(){return"("+this.expr.$output()+")"}),c($,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"})}(b[0]),function(g,R){var $=W(g,null,"Number");return $.$$prototype.value=A,c($,"$initialize",Q("value")),c($,"$eval",z("value")),c($,"$output",function(){return this.value.$to_s()}),G($,"s_exp","output")}(b[0])},Opal.modules.strscan=function(e){var Q,G,L,A,s,W=e.def,c=e.truthy,U=e.eqeqeq,z=e.Opal,o=e.return_ivar,F=e.send,k=e.alias,E=[],M=e.nil;return Q=E,L=[G=(0,e.klass)(E[0],null,"StringScanner")].concat(Q),A=e.$r(L),(s=G.$$prototype).pos=s.string=s.working=s.matched=s.prev_pos=s.match=M,G.$attr_reader("pos","matched"),W(G,"$initialize",function(_){var y=this;return y.string=_,y.pos=0,y.matched=M,y.working=_,y.match=[]}),G.$attr_reader("string"),W(G,"$beginning_of_line?",function(){var _=this;return 0===_.pos||"\n"===_.string.charAt(_.pos-1)}),W(G,"$scan",function(_){var y=this,u=(_=y.$anchor(_)).exec(y.working);return null==u?y.matched=M:(y.prev_pos=y.pos,y.pos+=u[0].length,y.working=y.working.substring(u[0].length),y.matched=u[0],y.match=u,u[0])}),W(G,"$scan_until",function(_){var y=this;_=y.$anchor(_);for(var u=y.working,N=0;u.length!=N;++N){var r=_.exec(u.substr(N));if(null!==r){var t=N+r[0].length,p=u.substr(0,t);return y.matched=r[0],y.match=r,y.prev_pos=y.pos+N,y.pos+=t,y.working=u.substr(t),p}}return y.matched=M}),W(G,"$[]",function(_){var u;if(c(this.match["$empty?"]()))return M;U(A("Symbol"),u=_)?_=_.$to_s():U(A("String"),u)||(_=z["$coerce_to!"](_,A("Integer"),"to_int"));var N=this.match;return _<0&&(_+=N.length),_<0||_>=N.length||null==N[_]?M:N[_]}),W(G,"$check",function(_){var y=this,u=(_=y.$anchor(_)).exec(y.working);return y.matched=null==u?M:u[0]}),W(G,"$check_until",function(_){var y=this,u=y.prev_pos,N=y.pos,r=y.working,t=y.$scan_until(_);return y.prev_pos=u,y.pos=N,y.working=r,t}),W(G,"$peek",function(_){return this.working.substring(0,_)}),W(G,"$eos?",function(){return 0===this.working.length}),W(G,"$exist?",function(_){var u=_.exec(this.working);return null==u?M:0==u.index?0:u.index+1}),W(G,"$skip",function(_){var y=this,u=(_=y.$anchor(_)).exec(y.working);if(null==u)return y.match=[],y.matched=M;var N=u[0],r=N.length;return y.matched=N,y.match=u,y.prev_pos=y.pos,y.pos+=r,y.working=y.working.substring(r),r}),W(G,"$skip_until",function(_){var u=this.$scan_until(_);return u===M?M:(this.matched=u.substr(-1),u.length)}),W(G,"$get_byte",function(){var _=this,y=M;return _.pos<_.string.length?(_.prev_pos=_.pos,_.pos+=1,y=_.matched=_.working.substring(0,1),_.working=_.working.substring(1)):_.matched=M,y}),W(G,"$match?",function(_){var y=this,u=(_=y.$anchor(_)).exec(y.working);return null==u?M:(y.prev_pos=y.pos,u[0].length)}),W(G,"$pos=",function(_){var y=this;return _<0&&(_+=y.string.$length()),y.pos=_,y.working=y.string.slice(_)}),W(G,"$matched_size",function(){return this.matched===M?M:this.matched.length}),W(G,"$post_match",function(){var _=this;return _.matched===M?M:_.string.substr(_.pos)}),W(G,"$pre_match",function(){var _=this;return _.matched===M?M:_.string.substr(0,_.prev_pos)}),W(G,"$reset",function(){var _=this;return _.working=_.string,_.matched=M,_.pos=0}),W(G,"$rest",o("working")),W(G,"$rest?",function(){return 0!==this.working.length}),W(G,"$rest_size",function(){return this.$rest().$size()}),W(G,"$terminate",function(){var _,y=this;return y.match=M,_=[y.string.$length()],F(y,"pos=",_),_[_.length-1]}),W(G,"$unscan",function(){var _=this;return _.pos=_.prev_pos,_.prev_pos=M,_.match=M,_}),k(G,"bol?","beginning_of_line?"),k(G,"getch","get_byte"),G.$private(),W(G,"$anchor",function(_){var y=_.toString().match(/\/([^\/]+)$/);return y=y?y[1]:void 0,new RegExp("^(?:"+_.source+")",y)})},Opal.modules["bcdice/normalize"]=function(e){var k,O,M,V=e.module,W=e.eqeqeq,c=e.def,U=e.eqeq,z=[],o=e.nil;return k=z,M=[V(z[0],"BCDice")].concat(k),(O=V(M[0],"Normalize")).$module_function(),c(O,"$comparison_operator",function(G){var L;return W(/<=|=</,L=G)?"<=":W(/>=|=>/,L)?">=":W(/<>|!=|=!/,L)?"!=":W(/</,L)?"<":W(/>/,L)?">":W(/=/,L)?"==":o}),c(O,"$target_number",function(G){return U(G,"?")?G:G.$to_i()})},Opal.modules["bcdice/command/lexer"]=function(e){var Q,s,N,r,t,p,C,_,L,V=e.module,W=e.klass,c=e.const_set,U=e.hash2,z=e.truthy,o=e.send,F=e.def,k=e.thrower,E=e.top,M=[],D=e.nil;return E.$require("strscan"),E.$require("bcdice/normalize"),Q=M,s=L=[V(M[0],"BCDice")].concat(Q),N=_=[V(L[0],"Command")].concat(s),t=[r=W(_[0],null,"Lexer")].concat(N),p=e.$r(t),(C=r.$$prototype).scanner=C.notations=D,c(t[0],"SYMBOLS",U(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),F(r,"$initialize",function(x,b){var S,g,$;return x=z($=(S=(g=x)===D||null==g?D:g.$split(" ",2))===D||null==S?D:S.$first())?$:"",this.scanner=p("StringScanner").$new(x),this.notations=o(b,"map",[],function(l){return null==l&&(l=D),z(l["$is_a?"](p("String")))?p("Regexp").$new(l):l})}),F(r,"$next_token",function(){try{var x=k("return"),b=this,S=D,g=D,$=D,f=D;return z(b.scanner["$eos?"]())?[!1,"$"]:(o(b.notations,"each",[],function l(j){var q,v=null==l.$$s?this:l.$$s;if(null==v.scanner&&(v.scanner=D),null==j&&(j=D),q=v.scanner.$scan(j),!z(q))return D;x.$throw(["NOTATION",q])},{$$s:b,$$ret:x}),z(S=b.scanner.$scan(/\d+/))?["NUMBER",S.$to_i()]:z(g=b.scanner.$scan(/[<>!=]+/))?(g=p("Normalize").$comparison_operator(g),[z(g)?"CMP_OP":"ILLEGAL",g]):($=b.scanner.$getch().$upcase(),[z(f=p("SYMBOLS")["$[]"]($))?f:$.$to_sym(),$]))}catch(l){if(l===x)return l.$v;throw l}}),F(r,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/command/parsed"]=function(e){var E,Q,H,_,y,u,N,L,D,V=e.module,W=e.klass,c=e.def,U=e.return_ivar,z=e.truthy,o=[],F=e.nil;return E=o,Q=D=[V(o[0],"BCDice")].concat(E),H=L=[V(D[0],"Command")].concat(Q),y=[_=W(L[0],null,"Parsed")].concat(H),u=e.$r(y),(N=_.$$prototype).critical=N.fumble=N.dollar=N.modify_number=N.question_target=N.target_number=N.prefix_number=N.command=N.suffix_number=N.cmp_op=F,_.$attr_accessor("command"),_.$attr_accessor("prefix_number"),_.$attr_accessor("suffix_number"),_.$attr_accessor("critical"),_.$attr_accessor("fumble"),_.$attr_accessor("dollar"),_.$attr_accessor("modify_number"),_.$attr_accessor("cmp_op"),_.$attr_accessor("target_number"),_.$attr_writer("question_target"),c(_,"$initialize",function(){var t=this;return t.prefix_number=F,t.suffix_number=F,t.critical=F,t.fumble=F,t.dollar=F,t.cmp_op=F,t.target_number=F,t.question_target=!1}),c(_,"$question_target?",U("question_target")),c(_,"$to_s",function(t){var p=this,C=F,P=F,x=F,b=F,S=F;switch(null==t&&(t="after_command"),C=z(p.critical)?"@"+p.critical:F,P=z(p.fumble)?"#"+p.fumble:F,x=z(p.dollar)?"$"+p.dollar:F,b=u("Format").$modifier(p.modify_number),S=z(p.question_target)?"?":p.target_number,t){case"after_command":return[p.prefix_number,p.command,p.suffix_number,C,P,x,b,p.cmp_op,S].$join();case"after_modify_number":return[p.prefix_number,p.command,p.suffix_number,b,C,P,x,p.cmp_op,S].$join();case"after_target_number":return[p.prefix_number,p.command,p.suffix_number,b,p.cmp_op,S,C,P,x].$join();default:return F}},-1)},Opal.modules["bcdice/command/parser"]=function(e){var t,x,f,q,n,I,a,d,i,ee,te,re,ce,l,j,v,ae,S,g,C,V=e.klass,W=e.module,c=e.slice,U=e.extract_kwargs,z=e.ensure_kwargs,o=e.get_kwarg,F=e.send2,k=e.find_super,E=e.def,M=e.send,D=e.eqeq,O=e.thrower,Q=e.hash,G=e.const_set,L=e.truthy,A=e.to_ary,s=e.hash2,H=e.top,_=[],y=e.$r(_),u=e.nil,N=e.$$$;return H.$require("racc/parser.rb"),H.$require("bcdice/arithmetic/node"),H.$require("bcdice/command/lexer"),H.$require("bcdice/command/parsed"),V(N(y("BCDice"),"Command"),N(y("Racc"),"Parser"),"Parser"),t=_,x=C=[W(_[0],"BCDice")].concat(t),S=[W(C[0],"Command")].concat(x),g=e.$r(S),f=S,j=[l=V(S[0],N(g("Racc"),"Parser"),"Parser")].concat(f),v=e.$r(j),(ae=l.$$prototype).notations=ae.lexer=ae.modifier=ae.suffix_number=ae.prefix_number=ae.need_suffix_number=ae.need_prefix_number=ae.critical=ae.fumble=ae.dollar=ae.allowed_cmp_op=ae.question_target=u,E(l,"$initialize",function X(T,K){var m,w,J,h,Z=this;return X.$$p=null,m=c(arguments),w=U(m),w=z(w),J=m,h=o(w,"round_type"),F(Z,k(Z,"initialize",X,!1,!0),"initialize",[],null),Z.notations=J,Z.round_type=h,Z.prefix_number=!1,Z.suffix_number=!1,Z.need_prefix_number=!1,Z.need_suffix_number=!1,Z.modifier=!0,Z.critical=!1,Z.fumble=!1,Z.dollar=!1,Z.allowed_cmp_op=[u,">=",">","<=","<","==","!="],Z.question_target=!1},-2),E(l,"$disable_modifier",function(){return this.modifier=!1,this}),E(l,"$enable_prefix_number",function(){return this.prefix_number=!0,this}),E(l,"$enable_suffix_number",function(){return this.suffix_number=!0,this}),E(l,"$has_prefix_number",function(){var T=this;return T.prefix_number=!0,T.need_prefix_number=!0,T}),E(l,"$has_suffix_number",function(){var T=this;return T.suffix_number=!0,T.need_suffix_number=!0,T}),E(l,"$enable_critical",function(){return this.critical=!0,this}),E(l,"$enable_fumble",function(){return this.fumble=!0,this}),E(l,"$enable_dollar",function(){return this.dollar=!0,this}),E(l,"$restrict_cmp_op_to",function(T){var K,w=this;return K=c(arguments),w.allowed_cmp_op=K,w},-1),E(l,"$enable_question_target",function(){return this.question_target=!0,this}),E(l,"$parse",function(T){var K=this;try{return K.lexer=v("Lexer").$new(T,K.notations),K.$do_parse()}catch(m){if(!e.rescue(m,[v("ParseError"),v("ZeroDivisionError")]))throw m;try{return u}finally{e.pop_exception()}}}),l.$private(),E(l,"$parsed",function(T,K,m,w){try{return O("eval_return"),M(v("Parsed").$new(),"tap",[],function B(Z){var Y,ne,ie,le,fe,oe,de,ve=null==B.$$s?this:B.$$s;return null==ve.round_type&&(ve.round_type=u),null==Z&&(Z=u),Z["$command="](T["$[]"]("command")),Z["$prefix_number="]((Y=T["$[]"]("prefix"))===u||null==Y?u:Y.$eval(ve.round_type)),Z["$suffix_number="]((ne=T["$[]"]("suffix"))===u||null==ne?u:ne.$eval(ve.round_type)),Z["$critical="]((ie=K["$[]"]("critical"))===u||null==ie?u:ie.$eval(ve.round_type)),Z["$fumble="]((le=K["$[]"]("fumble"))===u||null==le?u:le.$eval(ve.round_type)),Z["$dollar="]((fe=K["$[]"]("dollar"))===u||null==fe?u:fe.$eval(ve.round_type)),Z["$modify_number="](m.$eval(ve.round_type)),Z["$cmp_op="](w["$[]"]("cmp_op")),D(w["$[]"]("target"),"?")?(Z["$question_target="](!0),M(Z,"target_number=",oe=[0]),oe[oe.length-1]):(Z["$question_target="](!1),oe=[(de=w["$[]"]("target"),de===u||null==de?u:de.$eval(ve.round_type))],M(Z,"target_number=",oe),oe[oe.length-1])},{$$s:this})}catch(B){if(B===e.t_eval_return)return B.$v;throw B}}),E(l,"$next_token",function(){return this.lexer.$next_token()}),q=e.large_array_unpack("6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,33,34,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,,,17,18,6,,5,,,17,18,,,5,23,24,25,26,56,54,55,57"),n=e.large_array_unpack("0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,,17,15,15,18,18,23,,18,30,30,23,23,24,,23,31,31,24,24,25,,24,44,44,25,25,28,,25,47,47,28,28,29,,28,48,48,29,29,33,,29,49,49,33,33,34,,33,50,50,34,34,36,,34,,,36,36,37,,36,,,37,37,,,37,27,27,27,27,52,52,52,52"),I=e.large_array_unpack("-2,4,16,-3,-1,11,,33,13,35,23,30,1,,28,40,,37,44,,,-2,,51,58,65,0,106,72,79,47,54,,86,93,,100,107,,,,,,,63,,,68,75,82,89,,120,,,,,"),a=e.large_array_unpack("-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29"),d=e.large_array_unpack("30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,,,21,47,48,40,51,52,49,50,44,46,3,,,,13,,,,,,,,32"),i=e.large_array_unpack("8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,,,4,8,8,5,7,7,8,8,9,5,6,,,,6,,,,,,,,6"),ee=[u,6,13,3,9,-1,27,-15,-10,-1,-38],te=[u,u,u,u,u,u,19,16,15,u,u],re=e.large_array_unpack("0,0,racc_error,4,20,_reduce_1,4,20,_reduce_2,3,20,_reduce_3,3,21,_reduce_4,2,21,_reduce_5,2,21,_reduce_6,1,21,_reduce_7,0,22,_reduce_8,3,22,_reduce_9,3,22,_reduce_10,3,22,_reduce_11,2,23,_reduce_12,2,23,_reduce_13,3,23,_reduce_14,3,23,_reduce_15,0,24,_reduce_16,2,24,_reduce_17,2,24,_reduce_18,3,28,_reduce_19,3,28,_reduce_20,1,28,_reduce_none,3,27,_reduce_22,4,27,_reduce_23,1,27,_reduce_none,0,29,_reduce_25,1,29,_reduce_26,1,29,_reduce_27,1,29,_reduce_28,1,29,_reduce_29,2,26,_reduce_30,2,26,_reduce_31,1,26,_reduce_none,3,25,_reduce_33,1,25,_reduce_34"),ce=Q(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),G(j[0],"Racc_arg",[q,n,a,I,d,i,te,ee,19,re,ce,58,35,!0]),G(j[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),G(j[0],"Racc_debug_parser",!1),E(l,"$_reduce_1",function(T,K,m){var w,h=this;return L(h.modifier)||h.$raise(v("ParseError")),w=A(T),h.$parsed(null==w[0]?u:w[0],null==w[1]?u:w[1],null==w[2]?u:w[2],null==w[3]?u:w[3])}),E(l,"$_reduce_2",function(T,K,m){var w,h=this;return L(h.modifier)||h.$raise(v("ParseError")),w=A(T),h.$parsed(null==w[0]?u:w[0],null==w[2]?u:w[2],null==w[1]?u:w[1],null==w[3]?u:w[3])}),E(l,"$_reduce_3",function(T,K,m){var w,Y;return Y=null==(w=A(T))[2]?u:w[2],this.$parsed(null==w[0]?u:w[0],null==w[1]?u:w[1],N(N(v("Arithmetic"),"Node"),"Number").$new(0),Y)}),E(l,"$_reduce_4",function(T,K,m){var w=this;return L(w.prefix_number)&&L(w.suffix_number)||w.$raise(v("ParseError")),s(["command","prefix","suffix"],{command:T["$[]"](1),prefix:T["$[]"](0),suffix:T["$[]"](2)})}),E(l,"$_reduce_5",function(T,K,m){var w=this;return L(w.prefix_number)||w.$raise(v("ParseError")),L(w.need_suffix_number)&&w.$raise(v("ParseError")),s(["command","prefix"],{command:T["$[]"](1),prefix:T["$[]"](0)})}),E(l,"$_reduce_6",function(T,K,m){var w=this;return L(w.suffix_number)||w.$raise(v("ParseError")),L(w.need_prefix_number)&&w.$raise(v("ParseError")),s(["command","suffix"],{command:T["$[]"](0),suffix:T["$[]"](1)})}),E(l,"$_reduce_7",function(T,K,m){var w=this;return(L(w.need_prefix_number)||L(w.need_suffix_number))&&w.$raise(v("ParseError")),s(["command"],{command:T["$[]"](0)})}),E(l,"$_reduce_8",function(T,K,m){return s([],{})}),E(l,"$_reduce_9",function(T,K,m){var w,Y,B=u;return B=null==(w=A(T))[0]?u:w[0],Y=null==w[2]?u:w[2],L(this.critical)&&L(B["$[]"]("critical")["$nil?"]())||this.$raise(v("ParseError")),B["$[]="]("critical",Y),B}),E(l,"$_reduce_10",function(T,K,m){var w,Y,B=u;return B=null==(w=A(T))[0]?u:w[0],Y=null==w[2]?u:w[2],L(this.fumble)&&L(B["$[]"]("fumble")["$nil?"]())||this.$raise(v("ParseError")),B["$[]="]("fumble",Y),B}),E(l,"$_reduce_11",function(T,K,m){var w,Y,B=u;return B=null==(w=A(T))[0]?u:w[0],Y=null==w[2]?u:w[2],L(this.dollar)&&L(B["$[]"]("dollar")["$nil?"]())||this.$raise(v("ParseError")),B["$[]="]("dollar",Y),B}),E(l,"$_reduce_12",function(T,K,m){return T["$[]"](1)}),E(l,"$_reduce_13",function(T,K,m){return N(N(v("Arithmetic"),"Node"),"Negative").$new(T["$[]"](1))}),E(l,"$_reduce_14",function(T,K,m){return N(N(v("Arithmetic"),"Node"),"BinaryOp").$new(T["$[]"](0),"+",T["$[]"](2))}),E(l,"$_reduce_15",function(T,K,m){return N(N(v("Arithmetic"),"Node"),"BinaryOp").$new(T["$[]"](0),"-",T["$[]"](2))}),E(l,"$_reduce_16",function(T,K,m){return L(this.allowed_cmp_op["$include?"](u))||this.$raise(v("ParseError")),s([],{})}),E(l,"$_reduce_17",function(T,K,m){var w,B,Z;return Z=null==(w=A(T))[1]?u:w[1],L(this.allowed_cmp_op["$include?"](B=null==w[0]?u:w[0]))||this.$raise(v("ParseError")),s(["cmp_op","target"],{cmp_op:B,target:Z})}),E(l,"$_reduce_18",function(T,K,m){var J,w=this;return J=T["$[]"](0),L(w.question_target)||w.$raise(v("ParseError")),L(w.allowed_cmp_op["$include?"](J))||w.$raise(v("ParseError")),s(["cmp_op","target"],{cmp_op:J,target:"?"})}),E(l,"$_reduce_19",function(T,K,m){return N(N(v("Arithmetic"),"Node"),"BinaryOp").$new(T["$[]"](0),"+",T["$[]"](2))}),E(l,"$_reduce_20",function(T,K,m){return N(N(v("Arithmetic"),"Node"),"BinaryOp").$new(T["$[]"](0),"-",T["$[]"](2))}),E(l,"$_reduce_22",function(T,K,m){return N(N(v("Arithmetic"),"Node"),"BinaryOp").$new(T["$[]"](0),"*",T["$[]"](2))}),E(l,"$_reduce_23",function(T,K,m){return T["$[]"](3).$new(T["$[]"](0),T["$[]"](2))}),E(l,"$_reduce_25",function(T,K,m){return N(N(v("Arithmetic"),"Node"),"DivideWithGameSystemDefault")}),E(l,"$_reduce_26",function(T,K,m){return N(N(v("Arithmetic"),"Node"),"DivideWithCeil")}),E(l,"$_reduce_27",function(T,K,m){return N(N(v("Arithmetic"),"Node"),"DivideWithCeil")}),E(l,"$_reduce_28",function(T,K,m){return N(N(v("Arithmetic"),"Node"),"DivideWithRound")}),E(l,"$_reduce_29",function(T,K,m){return N(N(v("Arithmetic"),"Node"),"DivideWithFloor")}),E(l,"$_reduce_30",function(T,K,m){return T["$[]"](1)}),E(l,"$_reduce_31",function(T,K,m){return N(N(v("Arithmetic"),"Node"),"Negative").$new(T["$[]"](1))}),E(l,"$_reduce_33",function(T,K,m){return T["$[]"](1)}),E(l,"$_reduce_34",function(T,K,m){return N(N(v("Arithmetic"),"Node"),"Number").$new(T["$[]"](0))}),E(l,"$_reduce_none",function(T,K,m){return T["$[]"](0)})},Opal.modules["bcdice/deprecated/checker"]=function(e){var M,G,H,_,y,u,A,O,V=e.module,W=e.send,c=e.eqeqeq,U=e.truthy,z=e.def,o=e.return_val,F=[],k=e.nil;return M=F,G=O=[V(F[0],"BCDice")].concat(M),H=A=[V(O[0],"Deprecated")].concat(G),y=[_=V(A[0],"Checker")].concat(H),u=e.$r(y),_.$private(),z(_,"$check_result_legacy",function(r,t,p,C){var S,P=this,x=k,b=k,g=k,R=k;return x=W(t,"map",[],"sides".$to_proc()),S=(b=W(t,"map",[],"value".$to_proc())).$sum(),g=c([100],R=x)?P.$check_1D100(r,S,p,C):c([20],R)?P.$check_1D20(r,S,p,C):c([6,6],R)?P.$check_2D6(r,S,b,p,C):k,(U(g["$nil?"]())||U(g["$empty?"]()))&&(g=c([10],R=x.$uniq())?P.$check_nD10(r,S,b,p,C):c([6],R)?P.$check_nD6(r,S,b,p,C):k,U(g["$nil?"]())||U(g["$empty?"]()))?k:u("Result").$new(g.$delete_prefix(" \uff1e "))}),z(_,"$check_1D100",o(k)),z(_,"$check_1D20",o(k)),z(_,"$check_nD10",o(k)),z(_,"$check_2D6",o(k)),z(_,"$check_nD6",o(k))},Opal.modules["bcdice/base"]=function(e){var y,P,R,v,n,I,$,f,l,j,b,V=e.module,W=e.klass,c=e.slice,U=e.rb_plus,z=e.truthy,o=e.def,F=e.regexp,k=e.send,E=e.thrower,M=e.return_ivar,D=e.assign_ivar_val,O=e.eqeqeq,Q=e.eqeq,G=e.return_val,L=e.range,A=e.rb_minus,s=e.rb_divide,H=e.rb_times,_=e.rb_ge,u=e.top,N=[],r=e.$r(N),t=e.nil,p=e.$$$;return u.$require("i18n"),u.$require("i18n/backend/fallbacks"),u.$require("bcdice/randomizer"),u.$require("bcdice/dice_table"),u.$require("bcdice/enum"),u.$require("bcdice/translate"),u.$require("bcdice/result"),u.$require("bcdice/command/parser"),u.$require("bcdice/deprecated/checker"),P=N,R=b=[V(N[0],"BCDice")].concat(P),f=[$=W(b[0],null,"Base")].concat(R),l=e.$r(f),(j=$.$$prototype).raw_input=j.randomizer=j.enabled_upcase_input=j.debug=t,n=[v=e.get_singleton_class($)].concat(f),I=e.$r(n),v.$attr_reader("prefixes"),o(v,"$register_prefix",function(d){var ee,te=this,re=t;return null==te.prefixes&&(te.prefixes=t),ee=c(arguments),te.prefixes=U(z(re=te.prefixes)?re:[],ee.$flatten())},-1),o(v,"$register_prefix_from_super_class",function(){return this.$register_prefix(this.$superclass().$prefixes())}),o(v,"$prefixes_pattern",function(){var d=this,i=t;return null==d.prefixes_pattern&&(d.prefixes_pattern=t),null==d.prefixes&&(d.prefixes=t),d.prefixes_pattern=z(i=d.prefixes_pattern)?i:t,z(d.prefixes_pattern)?d.prefixes_pattern:(d.prefixes=z(i=d.prefixes)?i:[],d.prefixes.$freeze(),d.prefixes_pattern=(z(d.prefixes["$empty?"]())?/(?!)/:F(["^(S)?(",d.prefixes.$join("|"),")"],"i")).$freeze())}),o(v,"$command_pattern",function(){var d=this,i=t,ee=t;return null==d.command_pattern&&(d.command_pattern=t),null==d.prefixes&&(d.prefixes=t),d.command_pattern=z(i=d.command_pattern)?i:t,z(d.command_pattern)?d.command_pattern:(d.prefixes=z(i=d.prefixes)?i:[],d.prefixes.$freeze(),ee=U(k(p(I("CommonCommand"),"COMMANDS"),"map",[],function(re){return null==re&&(re=t),p(re,"PREFIX_PATTERN").$source()}),d.prefixes),d.command_pattern=F(["^S?(",ee.$join("|"),")"],"i").$freeze())}),o(v,"$eval",function(d){try{return E("eval_return"),this.$new(d).$eval()}catch(te){if(te===e.t_eval_return)return te.$v;throw te}}),$.$include(l("Translate")),$.$include(p(l("Deprecated"),"Checker")),o($,"$initialize",function(q){var n=this;return n.raw_input=q,n.sort_add_dice=!1,n.sort_barabara_dice=!1,n.d66_sort_type=p(l("D66SortType"),"NO_SORT"),n.enabled_d9=!1,n.round_type=p(l("RoundType"),"FLOOR"),n.sides_implicit_d=6,n.upper_dice_reroll_threshold=t,n.reroll_dice_reroll_threshold=t,n.default_cmp_op=t,n.default_target_number=t,n.enabled_upcase_input=!0,n.locale="ja_jp",n.randomizer=p(l("BCDice"),"Randomizer").$new(),n.debug=!1}),$.$attr_accessor("randomizer"),$.$attr_reader("d66_sort_type"),$.$attr_reader("round_type"),$.$attr_reader("sides_implicit_d"),$.$attr_reader("upper_dice_reroll_threshold"),$.$attr_reader("reroll_dice_reroll_threshold"),$.$attr_reader("default_cmp_op"),$.$attr_reader("default_target_number"),o($,"$sort_add_dice?",M("sort_add_dice")),o($,"$sort_barabara_dice?",M("sort_barabara_dice")),o($,"$enabled_d9?",M("enabled_d9")),o($,"$enable_debug",D("debug",!0)),o($,"$eval",function(){var n,a,q=this,I=t;return n=p(l("BCDice"),"Preprocessor").$process(q.raw_input,q),I=z(a=q.$dice_command(n))?a:q.$eval_common_command(q.raw_input),z(I)?(I["$rands="](q.randomizer.$rand_results()),I["$detailed_rands="](q.randomizer.$detailed_rand_results()),I):t}),o($,"$change_text",function(q){return q}),o($,"$check_result",function(q,n,I,a){var d=this,i=t,ee=t,te=t,re=t,se=t;return i=d.$check_result_legacy(q,n,I,a),z(i)?i:(ee=k(n,"map",[],"sides".$to_proc()),re=(te=k(n,"map",[],"value".$to_proc())).$sum(),i=O([100],se=ee)?d.$result_1d100(q,re,I,a):O([20],se)?d.$result_1d20(q,re,I,a):O([6,6],se)?d.$result_2d6(q,re,te,I,a):t,Q(i,l("Result").$nothing())?t:z(i)?i:(i=O([10],se=ee.$uniq())?d.$result_nd10(q,re,te,I,a):O([6],se)?d.$result_nd6(q,re,te,I,a):t,Q(i,l("Result").$nothing())?t:z(i)?i:d.$result_ndx(q,I,a)))}),o($,"$grich_text",G(t)),$.$private(),o($,"$eval_common_command",function(q){try{E("eval_return");var I=E("return");return q=this.$change_text(q),k(p(l("CommonCommand"),"COMMANDS"),"each",[],function d(i){var te,ee=null==d.$$s?this:d.$$s;if(null==ee.randomizer&&(ee.randomizer=t),null==i&&(i=t),te=i.$eval(q,ee,ee.randomizer),!z(te))return t;I.$throw(te)},{$$s:this,$$ret:I}),t}catch(d){if(d===e.t_eval_return||d===I)return d.$v;throw d}}),o($,"$dice_command",function(q){var n=this,I=t,a=t,d=t,i=t;return z(n.enabled_upcase_input)&&(q=q.$upcase()),I=n.$class().$prefixes_pattern().$match(q),z(I)?(a=I["$[]"](1)["$nil?"]()["$!"](),z(a)&&(q=q["$[]"](L(1,-1,!1))),d=n.$eval_game_system_specific_command(q),z(d["$is_a?"](l("Result")))?(d["$secret="](z(i=d["$secret?"]())?i:a),d):z(d["$nil?"]())||z(d["$empty?"]())||Q(d,"1")?t:k(l("Result").$new(),"tap",[],function(te){var re;return null==te&&(te=t),te["$text="](d.$to_s()),k(te,"secret=",re=[a]),re[re.length-1]})):t}),o($,"$eval_game_system_specific_command",G(t)),o($,"$result_ndx",function(q,n,I){return z(I["$is_a?"](l("String")))?t:z(q.$send(n,I))?l("Result").$success(this.$translate("success")):l("Result").$failure(this.$translate("failure"))}),o($,"$result_1d100",G(t)),o($,"$result_1d20",G(t)),o($,"$result_nd10",G(t)),o($,"$result_2d6",G(t)),o($,"$result_nd6",G(t)),o($,"$get_table_by_2d6",function(q){return this.$get_table_by_nD6(q,2)}),o($,"$get_table_by_1d6",function(q){return this.$get_table_by_nD6(q,1)}),o($,"$get_table_by_nD6",function(q,n){return this.$get_table_by_nDx(q,n,6)}),o($,"$get_table_by_nDx",function(q,n,I){var d,i=t;return d=this.randomizer.$roll_sum(n,I),i=this.$get_table_value(q["$[]"](A(d,n))),z(i["$nil?"]())?["1",0]:[i,d]}),o($,"$get_table_by_1d3",function(q){var a,d,n=this,i=t;return n.$debug("get_table_by_1d3"),a=n.randomizer.$roll_sum(1,6),n.$debug("num",a),d=s(A(a,1),2).$to_i(),n.$debug("index",d),i=q["$[]"](d),z(i["$nil?"]())?["1",0]:[i,a]}),o($,"$get_table_by_d66_swap",function(q){var I;return I=this.randomizer.$roll_d66(p(l("D66SortType"),"ASC")),[this.$get_table_by_number(I,q),I]}),o($,"$get_table_by_d66",function(q){var I,a,d,ee,i=t;return I=this.randomizer.$roll_once(6),a=this.randomizer.$roll_once(6),d=U(H(A(I,1),6),A(a,1)),i=q["$[]"](d),ee=""+I+a,z(i["$nil?"]())?["1",ee]:[i,ee]}),o($,"$get_table_by_number",function(q,n,I){try{var a=E("return");return null==I&&(I="1"),k(n,"each",[],function i(ee){var re,te=null==i.$$s?this:i.$$s;if(null==ee&&(ee=t),re=ee["$[]"](0),!z(_(re,q)))return t;a.$throw(te.$get_table_value(ee["$[]"](1)))},{$$s:this,$$ret:a}),this.$get_table_value(I)}catch(i){if(i===a)return i.$v;throw i}},-3),o($,"$get_table_value",function(q){return z(q["$is_a?"](l("Proc")))?q.$call():q}),o($,"$roll_tables",function(q,n){var a=t;return a=n["$[]"](q),z(a)?a.$roll(this.randomizer).$to_s():t}),o($,"$debug",function(q,n){var a,d=this,i=t,ee=t;return a=c(arguments,1),z(d.debug)?(i=z(q["$is_a?"](l("String")))?q:q.$inspect(),z(a["$empty?"]())?d.$warn(i):(ee=k(a,"map",[],function(re){return null==re&&(re=t),z(re["$is_a?"](l("String")))?'"'+re+'"':re.$inspect()}),d.$warn(i+": "+ee.$join(", ")))):t},-2),p(p(r("I18n"),"Backend"),"Simple").$include(p(p(r("I18n"),"Backend"),"Fallbacks")),r("I18n").$load_path()["$<<"](r("Dir")["$[]"](r("File").$join("bcdice","../../i18n/**/*.yml"))),r("I18n")["$default_locale="]("ja_jp"),y=[["ja_jp"]],k(r("I18n").$fallbacks(),"defaults=",y),y[y.length-1]},Opal.modules["bcdice/game_system/sword_world/rating_lexer"]=function(e){var D,L,u,C,P,x,b,r,s,H,Q,V=e.module,W=e.klass,c=e.const_set,U=e.hash2,z=e.truthy,o=e.def,k=[],E=e.nil;return e.top.$require("strscan"),D=k,L=Q=[V(k[0],"BCDice")].concat(D),s=[V(Q[0],"GameSystem")].concat(L),H=e.$r(s),u=s,C=r=[W(s[0],H("Base"),"SwordWorld")].concat(u),x=[P=W(r[0],null,"RatingLexer")].concat(C),b=e.$r(x),P.$$prototype.scanner=E,c(x[0],"SYMBOLS",U(["+","-","*","/","(",")","[","]","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","[":"BRACKETL","]":"BRACKETR","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),o(P,"$initialize",function(R){var $,f,j;return R=z(j=($=(f=R)===E||null==f?E:f.$split(" ",2))===E||null==$?E:$.$first())?j:"",this.scanner=b("StringScanner").$new(R)}),o(P,"$next_token",function(){var R=this,$=E,f=E,j=E;return z(R.scanner["$eos?"]())?[!1,"$"]:z($=R.scanner.$scan(/\d+/))?["NUMBER",$.$to_i()]:(f=R.scanner.$getch().$upcase(),[z(j=b("SYMBOLS")["$[]"](f))?j:f.$to_sym(),f])}),o(P,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/game_system/sword_world/rating_parsed"]=function(e){var O,A,N,P,x,b,S,g,t,H,_,G,V=e.module,W=e.klass,c=e.def,U=e.truthy,z=e.rb_le,o=e.rb_plus,F=e.rb_lt,k=e.neqeq,E=[],M=e.nil;return O=E,A=G=[V(E[0],"BCDice")].concat(O),H=[V(G[0],"GameSystem")].concat(A),_=e.$r(H),N=H,P=t=[W(H[0],_("Base"),"SwordWorld")].concat(N),b=[x=W(t[0],null,"RatingParsed")].concat(P),S=e.$r(b),(g=x.$$prototype).modifier_after_half=g.semi_fixed_val=g.kept_modify=g.rate=g.greatest_fortune=g.modifier=M,x.$attr_accessor("rate"),x.$attr_accessor("critical"),x.$attr_accessor("kept_modify"),x.$attr_accessor("first_to"),x.$attr_accessor("first_modify"),x.$attr_accessor("rateup"),x.$attr_accessor("greatest_fortune"),x.$attr_accessor("semi_fixed_val"),x.$attr_accessor("tmp_fixed_val"),x.$attr_accessor("modifier"),x.$attr_accessor("modifier_after_half"),c(x,"$initialize",function($,f){var l=this;return l.rate=$,l.modifier=f,l.critical=13,l.kept_modify=0,l.first_to=0,l.first_modify=0,l.greatest_fortune=!1,l.rateup=0,l.semi_fixed_val=0,l.tmp_fixed_val=0,l.modifier_after_half=M}),c(x,"$half",function(){return this.modifier_after_half["$nil?"]()["$!"]()}),c(x,"$min_critical",function(){var $=this;return U(z($.semi_fixed_val,1))?3:o(o($.semi_fixed_val,$.kept_modify),2).$clamp(3,13)}),c(x,"$infinite_roll?",function(){return F(this.$critical(),this.$min_critical())}),c(x,"$to_s",function(){var $=this,f=M;return f="KeyNo."+$.rate,U(F($.$critical(),13))&&(f=o(f,"c["+$.$critical()+"]")),k($.$first_modify(),0)&&(f=o(f,"m["+S("Format").$modifier($.$first_modify())+"]")),k($.$first_to(),0)&&(f=o(f,"m["+$.$first_to()+"]")),k($.$rateup(),0)&&(f=o(f,"r["+$.$rateup()+"]")),U($.greatest_fortune)&&(f=o(f,"gf")),k($.$semi_fixed_val(),0)&&(f=o(f,"sf["+$.$semi_fixed_val()+"]")),k($.$tmp_fixed_val(),0)&&(f=o(f,"tf["+$.$tmp_fixed_val()+"]")),k($.$kept_modify(),0)&&(f=o(f,"a["+S("Format").$modifier($.$kept_modify())+"]")),k($.modifier,0)&&(f=o(f,S("Format").$modifier($.modifier))),f})},Opal.modules["bcdice/game_system/sword_world/rating_options"]=function(e){var k,O,H,r,y,G,L,M,V=e.module,W=e.klass,c=e.truthy,U=e.def,z=[];return k=z,O=M=[V(z[0],"BCDice")].concat(k),G=[V(M[0],"GameSystem")].concat(O),L=e.$r(G),H=G,y=[W(G[0],L("Base"),"SwordWorld")].concat(H),(r=W(y[0],null,"RatingOptions")).$attr_accessor("critical"),r.$attr_accessor("kept_modify"),r.$attr_accessor("first_to"),r.$attr_accessor("first_modify"),r.$attr_accessor("rateup"),r.$attr_accessor("greatest_fortune"),r.$attr_accessor("semi_fixed_val"),r.$attr_accessor("tmp_fixed_val"),r.$attr_accessor("modifier"),r.$attr_accessor("modifier_after_half"),U(r,"$settable_first_roll_adjust_option?",function(){var C;return c(C=this.$first_modify()["$nil?"]())?this.$first_to()["$nil?"]():C}),U(r,"$settable_non_2d_roll_option?",function(){var C,P,p=this;return c(C=c(P=p.$greatest_fortune()["$nil?"]())?p.$semi_fixed_val()["$nil?"]():P)?p.$tmp_fixed_val()["$nil?"]():C})},Opal.modules["bcdice/game_system/sword_world/rating_parser"]=function(e){var y,t,S,j,I,a,d,i,ee,te,re,se,ue,_e,v,q,n,T,R,$,C,P,N,V=e.module,W=e.klass,c=e.ensure_kwargs,U=e.send2,z=e.find_super,o=e.def,F=e.send,k=e.truthy,E=e.not,M=e.thrower,D=e.hash,O=e.const_set,Q=e.to_ary,G=e.eqeq,L=e.top,A=[],s=e.nil,H=e.$$$;return L.$require("racc/parser.rb"),L.$require("bcdice/arithmetic/node"),L.$require("bcdice/enum"),L.$require("bcdice/game_system/sword_world/rating_lexer"),L.$require("bcdice/game_system/sword_world/rating_parsed"),L.$require("bcdice/game_system/sword_world/rating_options"),y=A,t=N=[V(A[0],"BCDice")].concat(y),C=[V(N[0],"GameSystem")].concat(t),P=e.$r(C),S=C,R=[W(C[0],P("Base"),"SwordWorld")].concat(S),$=e.$r(R),j=R,q=[v=W(R[0],H($("Racc"),"Parser"),"RatingParser")].concat(j),n=e.$r(q),(T=v.$$prototype).lexer=T.round_type=T.version=s,o(v,"$initialize",function K(m){var w,J,B=this;return K.$$p=null,null==(w=(m=c(m)).$$smap.version)&&(w="v1_0"),null==(J=m.$$smap.round_type)&&(J=H(n("RoundType"),"CEIL")),U(B,z(B,"initialize",K,!1,!0),"initialize",[],null),B.version=w,B.round_type=J},-1),o(v,"$set_debug",function(){return this.yydebug=!0,this}),o(v,"$parse",function(m){try{return this.lexer=n("RatingLexer").$new(m),this.$do_parse()}catch(J){if(!e.rescue(J,[n("ParseError"),n("ZeroDivisionError")]))throw J;try{return s}finally{e.pop_exception()}}}),v.$private(),o(v,"$parsed",function(m,w,J){try{return M("eval_return"),F(n("RatingParsed").$new(m,w),"tap",[],function Z(Y){var ne,ie,le,fe,oe,de,ve,be,he=null==Z.$$s?this:Z.$$s,me=s;return null==he.round_type&&(he.round_type=s),null==Y&&(Y=s),Y["$kept_modify="](k(me=(ne=J.$kept_modify())===s||null==ne?s:ne.$eval(he.round_type))?me:0),Y["$first_to="](k(me=J.$first_to())?me:0),Y["$first_modify="](k(me=J.$first_modify())?me:0),Y["$rateup="](k(me=(ie=J.$rateup())===s||null==ie?s:ie.$eval(he.round_type))?me:0),E(J.$greatest_fortune()["$nil?"]())&&Y["$greatest_fortune="](J.$greatest_fortune()),Y["$semi_fixed_val="](k(me=(le=J.$semi_fixed_val())===s||null==le?s:le.$clamp(1,6))?me:0),Y["$tmp_fixed_val="](k(me=(fe=J.$tmp_fixed_val())===s||null==fe?s:fe.$clamp(1,6))?me:0),Y["$modifier_after_half="]((oe=J.$modifier_after_half())===s||null==oe?s:oe.$eval(he.round_type)),de=[k((be=J.$critical(),ve=be===s||null==be?s:be.$eval(he.round_type),me=ve===s||null==ve?s:ve.$clamp(0,13)))?me:k(Y.$half())?13:10],F(Y,"critical=",de),de[de.length-1]},{$$s:this})}catch(Z){if(Z===e.t_eval_return)return Z.$v;throw Z}}),o(v,"$next_token",function(){return this.lexer.$next_token()}),I=e.large_array_unpack("15,14,16,5,17,18,20,21,57,58,23,24,11,59,12,19,13,15,14,16,4,17,18,20,21,4,30,3,30,11,8,12,19,13,26,27,26,27,29,30,29,30,55,56,55,56,30,26,27,26,27,29,30,29,26,27,9,30,29,30,26,27,55,56,29,26,27,26,27,29,30,29,30,55,56,55,56,30,26,27,26,27,29,30,29,26,27,37,30,29,30,26,27,55,56,29,26,27,26,27,29,30,29,30,55,56,38,39,32,26,27,26,27,29,46,29,33,34,51,52,53,54"),a=e.large_array_unpack("6,6,6,1,6,6,6,6,49,49,10,10,6,49,6,6,6,22,22,22,3,22,22,22,22,0,11,0,12,22,4,22,22,22,11,11,12,12,11,14,12,15,41,41,43,43,19,14,14,15,15,14,20,15,19,19,5,21,19,23,20,20,44,44,20,21,21,23,23,21,24,23,26,45,45,50,50,27,24,24,26,26,24,29,26,27,27,16,55,27,56,29,29,62,62,29,55,55,56,56,55,57,56,58,63,63,17,18,13,57,57,58,58,57,25,58,13,13,33,34,38,39"),d=e.large_array_unpack("22,3,,17,28,56,-4,,,,0,24,26,106,37,39,80,99,100,44,50,55,13,57,68,97,70,75,,81,,,,116,117,,,,118,119,,30,,32,50,61,,,,-2,63,,,,,86,88,99,101,,,,81,92"),i=e.large_array_unpack("-33,-33,-4,-33,-33,-33,-1,-4,-3,64,-5,-33,-33,-33,-11,-33,-33,-33,-33,-33,-33,-33,-2,-33,-33,-33,-33,-33,-30,-33,-32,-7,-8,-33,-33,-12,-13,-14,-33,-33,-17,-18,-27,-19,-20,-21,-6,-28,-29,-33,-24,-9,-10,-15,-16,-33,-33,-33,-33,-31,-25,-26,-22,-23"),ee=e.large_array_unpack("25,31,6,35,36,1,49,22,40,41,43,2,44,45,7,47,48,,50,,,,,,,,,,,,,,,,,,,,,,,,,,60,61,62,63"),te=e.large_array_unpack("5,5,3,5,5,1,7,3,5,6,6,2,6,6,2,5,5,,6,,,,,,,,,,,,,,,,,,,,,,,,,,5,5,6,6"),re=[s,5,11,0,s,-11,-11,-23,s],se=[s,s,s,s,10,42,s,s,28],ue=e.large_array_unpack("0,0,racc_error,2,22,_reduce_1,3,22,_reduce_2,2,23,_reduce_3,0,24,_reduce_4,2,24,_reduce_5,4,24,_reduce_6,3,24,_reduce_7,3,24,_reduce_8,4,24,_reduce_9,4,24,_reduce_10,2,24,_reduce_11,3,24,_reduce_12,3,24,_reduce_13,3,24,_reduce_14,4,24,_reduce_15,4,24,_reduce_16,3,24,_reduce_17,2,25,_reduce_18,2,25,_reduce_19,3,25,_reduce_20,3,25,_reduce_21,3,28,_reduce_22,3,28,_reduce_23,1,28,_reduce_none,3,27,_reduce_25,3,27,_reduce_26,1,27,_reduce_none,2,26,_reduce_28,2,26,_reduce_29,1,26,_reduce_none,3,29,_reduce_31,1,29,_reduce_32"),_e=D(!1,0,"error",1,"NUMBER",2,"K",3,"R",4,"H",5,"G",6,"F",7,"S",8,"T",9,"PLUS",10,"MINUS",11,"ASTERISK",12,"SLASH",13,"PARENL",14,"PARENR",15,"BRACKETL",16,"BRACKETR",17,"AT",18,"SHARP",19,"DOLLAR",20),O(q[0],"Racc_arg",[I,a,i,d,ee,te,se,re,21,ue,_e,64,33,!0]),O(q[0],"Racc_token_to_s_table",["$end","error","NUMBER","K","R","H","G","F","S","T","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","BRACKETL","BRACKETR","AT","SHARP","DOLLAR","$start","expr","rate","option","modifier","unary","mul","add","term"]),O(q[0],"Racc_debug_parser",!1),o(v,"$_reduce_1",function(m,w,J){try{M("eval_return");var B,ne,fe,ie=s,le=s;return ne=null==(B=Q(m))[0]?s:B[0],le=k(fe=(ie=null==B[1]?s:B[1]).$modifier())?fe:H(H(n("Arithmetic"),"Node"),"Number").$new(0),this.$parsed(ne,le.$eval(this.round_type),ie)}catch(oe){if(oe===e.t_eval_return)return oe.$v;throw oe}}),o(v,"$_reduce_2",function(m,w,J){try{M("eval_return");var B,ie,fe,le=s,oe=s;return ie=null==(B=Q(m))[1]?s:B[1],k((le=null==B[2]?s:B[2]).$modifier_after_half())||le["$modifier_after_half="](H(H(n("Arithmetic"),"Node"),"Number").$new(0)),oe=k(fe=le.$modifier())?fe:H(H(n("Arithmetic"),"Node"),"Number").$new(0),this.$parsed(ie,oe.$eval(this.round_type),le)}catch(de){if(de===e.t_eval_return)return de.$v;throw de}}),o(v,"$_reduce_3",function(m,w,J){return m["$[]"](1).$to_i()}),o(v,"$_reduce_4",function(m,w,J){return n("RatingOptions").$new()}),o(v,"$_reduce_5",function(m,w,J){var h,ne,Y=s;return ne=null==(h=Q(m))[1]?s:h[1],k((Y=null==h[0]?s:h[0]).$modifier()["$nil?"]())||this.$raise(n("ParseError")),Y["$modifier="](ne),Y}),o(v,"$_reduce_6",function(m,w,J){var h,ie,Y=s;return ie=null==(h=Q(m))[2]?s:h[2],k((Y=null==h[0]?s:h[0]).$critical()["$nil?"]())||this.$raise(n("ParseError")),Y["$critical="](ie),Y}),o(v,"$_reduce_7",function(m,w,J){var h,ie,Y=s;return ie=null==(h=Q(m))[2]?s:h[2],k((Y=null==h[0]?s:h[0]).$critical()["$nil?"]())||this.$raise(n("ParseError")),Y["$critical="](ie),Y}),o(v,"$_reduce_8",function(m,w,J){var h,Y=s,ie=s;return ie=null==(h=Q(m))[2]?s:h[2],k((Y=null==h[0]?s:h[0])["$settable_first_roll_adjust_option?"]())||this.$raise(n("ParseError")),Y["$first_to="](ie.$to_i()),Y}),o(v,"$_reduce_9",function(m,w,J){var h,Y=s,ie=s;return ie=null==(h=Q(m))[3]?s:h[3],k((Y=null==h[0]?s:h[0])["$settable_first_roll_adjust_option?"]())||this.$raise(n("ParseError")),Y["$first_modify="](ie.$to_i()),Y}),o(v,"$_reduce_10",function(m,w,J){var h,Y=s,ie=s;return ie=null==(h=Q(m))[3]?s:h[3],k((Y=null==h[0]?s:h[0])["$settable_first_roll_adjust_option?"]())||this.$raise(n("ParseError")),Y["$first_modify="](ie.$to_i()["$-@"]()),Y}),o(v,"$_reduce_11",function(m,w,J){var h,Y=s;return h=Q(m),k((Y=null==h[0]?s:h[0]).$modifier_after_half()["$nil?"]())||this.$raise(n("ParseError")),Y["$modifier_after_half="](H(H(n("Arithmetic"),"Node"),"Number").$new(0)),Y}),o(v,"$_reduce_12",function(m,w,J){var h,ie,Y=s;return ie=null==(h=Q(m))[2]?s:h[2],k((Y=null==h[0]?s:h[0]).$modifier_after_half()["$nil?"]())||this.$raise(n("ParseError")),Y["$modifier_after_half="](ie),Y}),o(v,"$_reduce_13",function(m,w,J){var h,ie,Y=s;return Y=null==(h=Q(m))[0]?s:h[0],ie=null==h[2]?s:h[2],k(["v2_5","v2_0"]["$include?"](this.version))&&k(Y.$rateup()["$nil?"]())||this.$raise(n("ParseError")),Y["$rateup="](ie),Y}),o(v,"$_reduce_14",function(m,w,J){var h,Y=s;return Y=null==(h=Q(m))[0]?s:h[0],k(["v2_5","v2_0"]["$include?"](this.version))&&k(Y["$settable_non_2d_roll_option?"]())||this.$raise(n("ParseError")),Y["$greatest_fortune="](!0),Y}),o(v,"$_reduce_15",function(m,w,J){var h,Y=s,ie=s;return Y=null==(h=Q(m))[0]?s:h[0],ie=null==h[3]?s:h[3],k(["v2_5","v2_0"]["$include?"](this.version))&&k(Y["$settable_non_2d_roll_option?"]())||this.$raise(n("ParseError")),Y["$semi_fixed_val="](ie.$to_i()),Y}),o(v,"$_reduce_16",function(m,w,J){var h,Y=s,ie=s;return Y=null==(h=Q(m))[0]?s:h[0],ie=null==h[3]?s:h[3],k(["v2_5","v2_0"]["$include?"](this.version))&&k(Y["$settable_non_2d_roll_option?"]())||this.$raise(n("ParseError")),Y["$tmp_fixed_val="](ie.$to_i()),Y}),o(v,"$_reduce_17",function(m,w,J){var h,ie,Y=s;return Y=null==(h=Q(m))[0]?s:h[0],ie=null==h[2]?s:h[2],G(this.version,"v2_5")&&k(Y.$kept_modify()["$nil?"]())||this.$raise(n("ParseError")),Y["$kept_modify="](ie),Y}),o(v,"$_reduce_18",function(m,w,J){return m["$[]"](1)}),o(v,"$_reduce_19",function(m,w,J){return H(H(n("Arithmetic"),"Node"),"Negative").$new(m["$[]"](1))}),o(v,"$_reduce_20",function(m,w,J){return H(H(n("Arithmetic"),"Node"),"BinaryOp").$new(m["$[]"](0),"+",m["$[]"](2))}),o(v,"$_reduce_21",function(m,w,J){return H(H(n("Arithmetic"),"Node"),"BinaryOp").$new(m["$[]"](0),"-",m["$[]"](2))}),o(v,"$_reduce_22",function(m,w,J){return H(H(n("Arithmetic"),"Node"),"BinaryOp").$new(m["$[]"](0),"+",m["$[]"](2))}),o(v,"$_reduce_23",function(m,w,J){return H(H(n("Arithmetic"),"Node"),"BinaryOp").$new(m["$[]"](0),"-",m["$[]"](2))}),o(v,"$_reduce_25",function(m,w,J){return H(H(n("Arithmetic"),"Node"),"BinaryOp").$new(m["$[]"](0),"*",m["$[]"](2))}),o(v,"$_reduce_26",function(m,w,J){return H(H(n("Arithmetic"),"Node"),"DivideWithGameSystemDefault").$new(m["$[]"](0),m["$[]"](2))}),o(v,"$_reduce_28",function(m,w,J){return m["$[]"](1)}),o(v,"$_reduce_29",function(m,w,J){return H(H(n("Arithmetic"),"Node"),"Negative").$new(m["$[]"](1))}),o(v,"$_reduce_31",function(m,w,J){return m["$[]"](1)}),o(v,"$_reduce_32",function(m,w,J){return H(H(n("Arithmetic"),"Node"),"Number").$new(m["$[]"](0))}),o(v,"$_reduce_none",function(m,w,J){return m["$[]"](0)})},Opal.queue(function(e){var C,S,j,v,q,n,I,R,$,x,V=e.module,W=e.klass,c=e.const_set,U=e.send2,z=e.find_super,o=e.def,F=e.truthy,k=e.rb_ge,E=e.rb_le,M=e.eqeq,D=e.neqeq,O=e.rb_minus,Q=e.rb_gt,G=e.hash2,L=e.send,A=e.to_ary,s=e.rb_plus,H=e.rb_lt,_=e.rb_times,y=e.thrower,u=e.rb_divide,N=e.top,r=[],t=e.nil;return N.$require("bcdice/base"),N.$require("bcdice/game_system/sword_world/rating_parser"),C=r,S=x=[V(r[0],"BCDice")].concat(C),R=[V(x[0],"GameSystem")].concat(S),$=e.$r(R),j=R,q=[v=W(R[0],$("Base"),"SwordWorld")].concat(j),n=e.$r(q),(I=v.$$prototype).rating_table=I.randomizer=t,c(q[0],"ID","SwordWorld"),c(q[0],"NAME","\u30bd\u30fc\u30c9\u30fb\u30ef\u30fc\u30eb\u30c9RPG"),c(q[0],"SORT_KEY","\u305d\u304a\u3068\u308f\u3042\u308b\u3068"),c(q[0],"HELP_MESSAGE","\u30fbSW\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3000(Kx[c]+m$f) (x:\u30ad\u30fc, c:\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024, m:\u30dc\u30fc\u30ca\u30b9, f:\u51fa\u76ee\u4fee\u6b63)\n"),v.$register_prefix("H?K"),o(v,"$initialize",function a(d){return a.$$p=null,U(this,z(this,"initialize",a,!1,!0),"initialize",[d],null),this.rating_table=0}),o(v,"$result_2d6",function(d,i,ee,te,re){return F(k(i,12))?n("Result").$critical(this.$translate("SwordWorld.critical")):F(E(i,2))?n("Result").$fumble(this.$translate("SwordWorld.fumble")):D(te,">=")||M(re,"?")?t:F(k(d,re))?n("Result").$success(this.$translate("success")):n("Result").$failure(this.$translate("failure"))}),o(v,"$eval_game_system_specific_command",function(d){return this.$rating(d)}),v.$private(),o(v,"$rating_parser",function(){return n("RatingParser").$new()}),o(v,"$rating",function(d){var i,ee,te=this,re=t,se=t,ue=t,ce=t,$e=t,_e=t,ae=t,X=t,T=t,K=t,m=t,w=t,J=t,h=t,Z=t,Y=t;return te.$debug("rating string",d),re=te.$rating_parser().$parse(d),F(re)?(se=te.$getSW2_0_RatingTable(),ue=O(se.$length(),1),te.$debug("keyMax",ue),F(Q(re.$rate(),ue))?n("Result").$new(te.$translate("SwordWorld.keynumber_exceeds",G(["keyMax"],{keyMax:ue}))):F(re["$infinite_roll?"]())?n("Result").$new(te.$translate("SwordWorld.infinite_critical",G(["min_critical"],{min_critical:re.$min_critical()}))):(ce=te.$getNewRates(se),$e=re+" \uff1e ",_e=[],ae=[],X=[],T=0,K=0,m=0,w=0,J=re.$first_to(),h=re.$first_modify(),function(){try{var ne=y("break");L(te,"loop",[],function ie(){var le,fe,be,he,oe=null==ie.$$s?this:ie.$$s,de=t,ve=t;if(fe=oe.$rollDice(re,w),ve=null==(le=A(fe))[1]?t:le[1],T=de=null==le[0]?t:le[0],D(J,0)?(T=de=J,J=0):D(h,0)&&(T=s(T,h),h=0),F(E(de,2))&&(_e["$<<"](de.$to_s()),ae["$<<"](ve.$to_s()),X["$<<"]("**"),w=s(w,1),ne.$throw()),D(re.$kept_modify(),0)&&D(T,2)&&(T=s(T,re.$kept_modify())),F(H(T,2))&&(T=2),F(Q(T,12))&&(T=12),be=[s(re.$rate(),_(w,re.$rateup())),ue].$min(),oe.$debug("currentKey",be),he=ce["$[]"](T)["$[]"](be),oe.$debug("rateValue",he),m=s(m,he),K=s(K,T),_e["$<<"](T.$to_s()),ae["$<<"](ve.$to_s()),X["$<<"](F(Q(T,2))?he:"**"),w=s(w,1),F(k(T,re.$critical())))return t;ne.$throw()},{$$s:te})}catch(ie){if(ie===ne)return ie.$v;throw ie}}(),ee=te.$getResultText(m,re,ae,_e,X,K,w),i=A(ee),Z=null==i[1]?t:i[1],Y=null==i[2]?t:i[2],$e=s($e,null==i[0]?t:i[0]),L(n("Result").$new(),"tap",[],function(ie){var le;return null==ie&&(ie=t),ie["$text="]($e),ie["$critical="](Z),L(ie,"fumble=",le=[Y]),le[le.length-1]}))):(te.$debug("not matched"),"1")}),o(v,"$getSW2_0_RatingTable",function(){return["*,0,0,0,1,2,2,3,3,4,4","*,0,0,0,1,2,3,3,3,4,4","*,0,0,0,1,2,3,4,4,4,4","*,0,0,1,1,2,3,4,4,4,5","*,0,0,1,2,2,3,4,4,5,5","*,0,1,1,2,2,3,4,5,5,5","*,0,1,1,2,3,3,4,5,5,5","*,0,1,1,2,3,4,4,5,5,6","*,0,1,2,2,3,4,4,5,6,6","*,0,1,2,3,3,4,4,5,6,7","*,1,1,2,3,3,4,5,5,6,7","*,1,2,2,3,3,4,5,6,6,7","*,1,2,2,3,4,4,5,6,6,7","*,1,2,3,3,4,4,5,6,7,7","*,1,2,3,4,4,4,5,6,7,8","*,1,2,3,4,4,5,5,6,7,8","*,1,2,3,4,4,5,6,7,7,8","*,1,2,3,4,5,5,6,7,7,8","*,1,2,3,4,5,6,6,7,7,8","*,1,2,3,4,5,6,7,7,8,9","*,1,2,3,4,5,6,7,8,9,10","*,1,2,3,4,6,6,7,8,9,10","*,1,2,3,5,6,6,7,8,9,10","*,2,2,3,5,6,7,7,8,9,10","*,2,3,4,5,6,7,7,8,9,10","*,2,3,4,5,6,7,8,8,9,10","*,2,3,4,5,6,8,8,9,9,10","*,2,3,4,6,6,8,8,9,9,10","*,2,3,4,6,6,8,9,9,10,10","*,2,3,4,6,7,8,9,9,10,10","*,2,4,4,6,7,8,9,10,10,10","*,2,4,5,6,7,8,9,10,10,11","*,3,4,5,6,7,8,10,10,10,11","*,3,4,5,6,8,8,10,10,10,11","*,3,4,5,6,8,9,10,10,11,11","*,3,4,5,7,8,9,10,10,11,12","*,3,5,5,7,8,9,10,11,11,12","*,3,5,6,7,8,9,10,11,12,12","*,3,5,6,7,8,10,10,11,12,13","*,4,5,6,7,8,10,11,11,12,13","*,4,5,6,7,9,10,11,11,12,13","*,4,6,6,7,9,10,11,12,12,13","*,4,6,7,7,9,10,11,12,13,13","*,4,6,7,8,9,10,11,12,13,14","*,4,6,7,8,10,10,11,12,13,14","*,4,6,7,9,10,10,11,12,13,14","*,4,6,7,9,10,10,12,13,13,14","*,4,6,7,9,10,11,12,13,13,15","*,4,6,7,9,10,12,12,13,13,15","*,4,6,7,10,10,12,12,13,14,15","*,4,6,8,10,10,12,12,13,15,15","*,5,7,8,10,10,12,12,13,15,15","*,5,7,8,10,11,12,12,13,15,15","*,5,7,9,10,11,12,12,14,15,15","*,5,7,9,10,11,12,13,14,15,16","*,5,7,10,10,11,12,13,14,16,16","*,5,8,10,10,11,12,13,15,16,16","*,5,8,10,11,11,12,13,15,16,17","*,5,8,10,11,12,12,13,15,16,17","*,5,9,10,11,12,12,14,15,16,17","*,5,9,10,11,12,13,14,15,16,18","*,5,9,10,11,12,13,14,16,17,18","*,5,9,10,11,13,13,14,16,17,18","*,5,9,10,11,13,13,15,17,17,18","*,5,9,10,11,13,14,15,17,17,18","*,5,9,10,12,13,14,15,17,18,18","*,5,9,10,12,13,15,15,17,18,19","*,5,9,10,12,13,15,16,17,19,19","*,5,9,10,12,14,15,16,17,19,19","*,5,9,10,12,14,16,16,17,19,19","*,5,9,10,12,14,16,17,18,19,19","*,5,9,10,13,14,16,17,18,19,20","*,5,9,10,13,15,16,17,18,19,20","*,5,9,10,13,15,16,17,19,20,21","*,6,9,10,13,15,16,18,19,20,21","*,6,9,10,13,16,16,18,19,20,21","*,6,9,10,13,16,17,18,19,20,21","*,6,9,10,13,16,17,18,20,21,22","*,6,9,10,13,16,17,19,20,22,23","*,6,9,10,13,16,18,19,20,22,23","*,6,9,10,13,16,18,20,21,22,23","*,6,9,10,13,17,18,20,21,22,23","*,6,9,10,14,17,18,20,21,22,24","*,6,9,11,14,17,18,20,21,23,24","*,6,9,11,14,17,19,20,21,23,24","*,6,9,11,14,17,19,21,22,23,24","*,7,10,11,14,17,19,21,22,23,25","*,7,10,12,14,17,19,21,22,24,25","*,7,10,12,14,18,19,21,22,24,25","*,7,10,12,15,18,19,21,22,24,26","*,7,10,12,15,18,19,21,23,25,26","*,7,11,13,15,18,19,21,23,25,26","*,7,11,13,15,18,20,21,23,25,27","*,8,11,13,15,18,20,22,23,25,27","*,8,11,13,16,18,20,22,23,25,28","*,8,11,14,16,18,20,22,23,26,28","*,8,11,14,16,19,20,22,23,26,28","*,8,12,14,16,19,20,22,24,26,28","*,8,12,15,16,19,20,22,24,27,28","*,8,12,15,17,19,20,22,24,27,29","*,8,12,15,18,19,20,22,24,27,30"]}),o(v,"$getNewRates",function(d){var i,ee,re=t,se=t,ue=t,ce=t,$e=t,_e=t,ae=t,X=t,T=t,K=t,m=t;return re=[],se=[],ue=[],ce=[],$e=[],_e=[],ae=[],X=[],T=[],K=[],m=[],L(d,"each",[],function(h){var B=t;return null==h&&(h=t),B=h.$split(/,/),m.$push(0),re.$push(B["$[]"](1).$to_i()),se.$push(B["$[]"](2).$to_i()),ue.$push(B["$[]"](3).$to_i()),ce.$push(B["$[]"](4).$to_i()),$e.$push(B["$[]"](5).$to_i()),_e.$push(B["$[]"](6).$to_i()),ae.$push(B["$[]"](7).$to_i()),X.$push(B["$[]"](8).$to_i()),T.$push(B["$[]"](9).$to_i()),K.$push(B["$[]"](10).$to_i())}),M(this.rating_table,1)&&K["$[]="](31,(i=[32,(ee=[33,10],L(K,"[]=",ee),ee[ee.length-1])],L(K,"[]=",i),i[i.length-1])),[m,m,m,re,se,ue,ce,$e,_e,ae,X,T,K]}),o(v,"$rollDice",function(d,i){var te=t;return[(te=this.randomizer.$roll_barabara(2,6)).$sum(),te.$join(",")]}),o(v,"$getResultText",function(d,i,ee,te,re,se,ue){var $e=t,_e=t,ae=t,X=t,T=t;return($e=[]).$push("2D:["+ee.$join(" ")+"]="+te.$join(",")),F(E(se,2))?($e.$push(re.$join(",")),$e.$push(this.$translate("SwordWorld.fumble")),[$e.$join(" \uff1e "),!1,!0]):(F(Q(re.$size(),1))||D(i.$modifier(),0)?(_e=s(re.$join(","),n("Format").$modifier(i.$modifier())),F(i.$half())&&(_e="("+_e+")/2",D(i.$modifier_after_half(),0)&&(_e=s(_e,n("Format").$modifier(i.$modifier_after_half())))),$e.$push(_e)):F(i.$half())&&(_e=re.$first()+"/2",D(i.$modifier_after_half(),0)&&(_e=s(_e,n("Format").$modifier(i.$modifier_after_half()))),$e.$push(_e)),F(Q(ue,1))&&(ae=this.$translate("SwordWorld.round_text",G(["reroll_count"],{reroll_count:O(ue,1)})),$e.$push(ae)),X=s(d,i.$modifier()),F(i.$half())&&(X=u(X,2).$ceil(),D(i.$modifier_after_half(),0)&&(X=s(X,i.$modifier_after_half()))),T=X.$to_s(),$e.$push(T),[$e.$join(" \uff1e "),Q(ue,1),!1])})})}}]);