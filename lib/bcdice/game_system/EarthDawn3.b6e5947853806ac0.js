(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[9730],{4021:(ie,$e,se)=>{se(9993),Opal.modules["bcdice/game_system/EarthDawn"]=function(i){var Y,O,re,E,N,R,S,H,ee,C,G=i.module,Q=i.klass,w=i.const_set,U=i.send2,V=i.find_super,b=i.def,o=i.truthy,B=i.rb_gt,I=i.rb_lt,c=i.rb_minus,q=i.eqeqeq,l=i.rb_plus,K=i.neqeq,P=i.eqeq,A=i.rb_ge,W=i.send,M=[],u=i.nil;return Y=M,O=C=[G(M[0],"BCDice")].concat(Y),H=[G(C[0],"GameSystem")].concat(O),ee=i.$r(H),re=H,N=[E=Q(H[0],ee("Base"),"EarthDawn")].concat(re),R=i.$r(N),(S=E.$$prototype).string=S.isFailed=u,w(N[0],"ID","EarthDawn"),w(N[0],"NAME","\u30a2\u30fc\u30b9\u30c9\u30fc\u30f3"),w(N[0],"SORT_KEY","\u3042\u3042\u3059\u3068\u304a\u3093"),w(N[0],"HELP_MESSAGE","\u30b9\u30c6\u30c3\u30d7\u30c0\u30a4\u30b9\u3000(xEn+k)\n\u30b9\u30c6\u30c3\u30d7x\u3001\u76ee\u6a19\u5024n(\u7701\u7565\u53ef\u80fd\uff09\u3001\u30ab\u30eb\u30de\u30c0\u30a4\u30b9k(D2-D20)\u3067\u30b9\u30c6\u30c3\u30d7\u30c0\u30a4\u30b9\u3092\u30ed\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u632f\u308a\u8db3\u3057\u3082\u81ea\u52d5\u3002\n\u4f8b\uff099E\u300010E8\u300010E+D12\n"),E.$register_prefix("\\d+e"),b(E,"$initialize",function x(m){var r=this;return x.$$p=null,U(r,V(r,"initialize",x,!1,!0),"initialize",[m],null),r.sort_add_dice=!0}),b(E,"$eval_game_system_specific_command",function(m){return this.$ed_step(m)}),b(E,"$ed_step",function(m){return this.$getStepResult(m)}),b(E,"$getStepResult",function(m){var $=this,r=u,n=u,e=u,t=u,a=u,f=u,g=u,_=u,d=u,p=u,h=u,v=u,y=u,k=u,D=u,z=u,T=u,F=u,J=u,ne=u;return!o(/(\d+)E(\d+)?(\+)?(\d+)?(d\d+)?/i["$=~"](m))||(r=0,$.isFailed=!0,n=R("Regexp").$last_match(1).$to_i(),e=0,t=!1,a=0,f=0,o(B(n,40))&&(n=40),o(R("Regexp").$last_match(2))&&(e=R("Regexp").$last_match(2).$to_i(),o(B(e,43))&&(e=42)),o(R("Regexp").$last_match(3))&&(t=R("Regexp").$last_match(3).$to_i()),o(R("Regexp").$last_match(4))&&(a=R("Regexp").$last_match(4).$to_i()),o(R("Regexp").$last_match(5))&&(f=R("Regexp").$last_match(5)),o(I(e,0)))?u:(_=(g=$.$getStepTable())["$[]"](0)["$[]"](c(n,1)),d=g["$[]"](1)["$[]"](c(n,1)),p=g["$[]"](2)["$[]"](c(n,1)),h=g["$[]"](3)["$[]"](c(n,1)),v=g["$[]"](4)["$[]"](c(n,1)),y=g["$[]"](5)["$[]"](c(n,1)),k=g["$[]"](6)["$[]"](c(n,1)),o(t)&&(q(/d20/i,D=f)?d=l(d,a):q(/d12/i,D)?p=l(p,a):q(/d10/i,D)?h=l(h,a):q(/d8/i,D)?v=l(v,a):q(/d6/i,D)?y=l(y,a):q(/d4/i,D)?k=l(k,a):_=l(_,a)),$.string="",$.$debug("d20step, d12step, d10step, d8step, d6step, d4step",d,p,h,v,y,k),r=l(r,$.$rollStep(20,d)),r=l(r,$.$rollStep(12,p)),r=l(r,$.$rollStep(10,h)),r=l(r,$.$rollStep(8,v)),r=l(r,$.$rollStep(6,y)),r=l(r,$.$rollStep(4,k)),o(B(_,0))&&($.string=l($.string,"+")),K(_,0)&&($.string=l($.string,_.$to_s()),r=l(r,_)),$.string=l($.string," \uff1e "+r),z="\u30b9\u30c6\u30c3\u30d7"+n+" \uff1e "+$.string,P(e,0)||($.string=l($.string," \uff1e "),T=g["$[]"](7)["$[]"](c(e,1)),F=g["$[]"](8)["$[]"](c(e,1)),J=g["$[]"](9)["$[]"](c(e,1)),ne=g["$[]"](11)["$[]"](c(e,1)),$.string=o($.isFailed)?l($.string,"\u81ea\u52d5\u5931\u6557"):o(A(r,T))?l($.string,"\u6700\u826f\u6210\u529f"):o(A(r,F))?l($.string,"\u512a\u6210\u529f"):o(A(r,J))?l($.string,"\u826f\u6210\u529f"):o(A(r,e))?l($.string,"\u6210\u529f"):o(I(r,ne))?l($.string,"\u5927\u5931\u6557"):l($.string,"\u5931\u6557"),z="\u30b9\u30c6\u30c3\u30d7"+n+">="+e+" \uff1e "+$.string),z)}),b(E,"$getStepTable",function(){return[i.large_array_unpack("-2,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0"),i.large_array_unpack("0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,0,0,2,0,0,0,0,0,0,0,0,0,0,0"),i.large_array_unpack("0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1"),i.large_array_unpack("0,0,0,0,0,1,0,0,0,1,1,2,1,0,0,0,1,0,0,0,1,1,2,1,1,1,1,2,1,1,1,2,3,2,1,1,1,2,1,1,0,0,1,0,0,0,1,0,0,0,1,1,2,1"),i.large_array_unpack("0,0,0,0,1,0,0,0,1,0,1,0,0,0,0,1,0,0,0,1,0,1,0,0,1,1,2,1,1,1,2,2,1,1,1,1,2,1,1,1,0,0,1,0,0,1,0,0,0,1,0,1,0,0"),i.large_array_unpack("0,0,0,1,0,0,0,2,1,1,0,0,0,0,1,0,0,0,2,1,1,0,0,0,0,1,0,0,0,2,1,0,0,0,0,1,0,0,0,2,0,0,0,0,1,0,0,0,2,1,1,0,0,0"),i.large_array_unpack("1,1,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0"),i.large_array_unpack("6,8,10,12,14,17,19,20,22,24,25,27,29,32,33,35,37,38,39,41,42,44,45,47,48,49,51,52,54,55,56,58,59,60,62,64,65,67,68,70,71,72"),i.large_array_unpack("4,6,8,10,11,13,15,16,18,19,21,22,24,26,27,29,30,32,33,34,35,37,38,40,41,42,43,45,46,47,48,49,51,52,53,55,56,58,59,60,61,62"),i.large_array_unpack("2,4,6,7,9,10,12,13,14,15,17,18,20,21,22,24,25,26,27,28,29,31,32,33,34,35,36,38,39,40,41,42,43,45,46,47,48,50,51,52,53,54"),i.large_array_unpack("1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42"),i.large_array_unpack("0,1,1,1,1,2,2,3,4,5,5,6,6,7,8,8,9,10,11,12,13,13,14,15,16,17,18,18,18,20,21,22,23,23,24,25,26,26,27,28,29,30")]}),b(E,"$rollStep",function(m,$){var r=this,n=u;return r.$debug("rollStep diceType, diceCount, @string",m,$,r.string),n=0,o(B($,0))&&(o(r.string["$empty?"]())||(r.string=l(r.string,"+")),r.string=l(r.string,$+"d"+m+"["),r.$debug("rollStep @string",r.string),W($,"times",[],function e(t){var a=null==e.$$s?this:e.$$s,f=u,g=u;for(null==a.randomizer&&(a.randomizer=u),null==a.string&&(a.string=u),null==t&&(t=u),f=a.randomizer.$roll_once(m),K(f,1)&&(a.isFailed=!1),g=f;P(f,m);)f=a.randomizer.$roll_once(m),g=l(g,f);return n=l(n,g),K(t,0)&&(a.string=l(a.string,",")),a.string=l(a.string,g.$to_s())},{$$s:r}),r.string=l(r.string,"]")),n})},Opal.queue(function(i){var Z,ee,R,S,x,m,$,L,re,j,G=i.module,Q=i.klass,w=i.const_set,U=i.send2,V=i.find_super,b=i.def,o=i.truthy,B=i.rb_lt,I=i.send,c=i.rb_plus,q=i.eqeq,l=i.rb_gt,K=i.rb_le,P=i.rb_minus,A=i.rb_divide,W=i.to_ary,M=i.rb_ge,u=i.neqeq,Y=[],s=i.nil;return i.top.$require("bcdice/game_system/EarthDawn"),Z=Y,ee=j=[G(Y[0],"BCDice")].concat(Z),L=[G(j[0],"GameSystem")].concat(ee),re=i.$r(L),R=L,x=[S=Q(L[0],re("EarthDawn"),"EarthDawn3")].concat(R),m=i.$r(x),($=S.$$prototype).string=$.isFailed=s,w(x[0],"ID","EarthDawn3"),w(x[0],"NAME","\u30a2\u30fc\u30b9\u30c9\u30fc\u30f33\u7248"),w(x[0],"SORT_KEY","\u3042\u3042\u3059\u3068\u304a\u30933"),w(x[0],"HELP_MESSAGE","\u30b9\u30c6\u30c3\u30d7\u30c0\u30a4\u30b9\u3000(xEn+k)\n\u30b9\u30c6\u30c3\u30d7x\u3001\u76ee\u6a19\u5024n(\u7701\u7565\u53ef\u80fd\uff09\u3001\u30ab\u30eb\u30de\u30c0\u30a4\u30b9k(D2\uff5eD20)\u3067\u30b9\u30c6\u30c3\u30d7\u30c0\u30a4\u30b9\u3092\u30ed\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u632f\u308a\u8db3\u3057\u3082\u81ea\u52d5\u3002\n\u4f8b\uff09\u30b9\u30c6\u30c3\u30d710\uff1a10E\n\u3000\u3000\u30b9\u30c6\u30c3\u30d710\u3001\u76ee\u6a19\u50248\uff1a10E8\n\u3000\u3000\u30b9\u30c6\u30c3\u30d712\u3001\u76ee\u6a19\u50248\u3001\u30ab\u30eb\u30de\u30c0\u30a4\u30b9D12\uff1a10E8+1D6\n"),S.$register_prefix("\\d+e"),b(S,"$initialize",function r(n){var t=this;return r.$$p=null,U(t,V(t,"initialize",r,!1,!0),"initialize",[n],null),t.sort_add_dice=!0}),b(S,"$eval_game_system_specific_command",function(n){return this.$ed_step(n)}),b(S,"$ed_step",function(n){return this.$getStepResult(n)}),b(S,"$getStepResult",function(n){var e=this,t=s,a=s,f=s,g=s,_=s,d=s,p=s,h=s,v=s,k=s,D=s;return!o(/^(\d+)E(\d+)?(\+(\d*)D(\d+))?(\+\d)?/i["$=~"](n))||(t=0,e.isFailed=!0,a=m("Regexp").$last_match(1).$to_i(),f=[m("Regexp").$last_match(2).$to_i(),20].$min(),g=m("Regexp").$last_match(3)["$nil?"]()["$!"](),_=[1,m("Regexp").$last_match(4).$to_i()].$max(),d=m("Regexp").$last_match(5).$to_i(),p=m("Regexp").$last_match(6).$to_i(),h=m("Hash").$new(0),o(g)&&h["$[]="](d,_),o(B(f,0)))?s:(v=e.$getStepInfo(a),e.$debug("stepInfo",v),e.string="",I([20,12,10,8,6,4],"each",[],function z(T){return null==T&&(T=s),t=c(t,(null==z.$$s?this:z.$$s).$rollStep(T,v.$shift()))},{$$s:e}),k=v.$shift(),I(h,"each",[],function z(T,F){return null==T&&(T=s),null==F&&(F=s),t=c(t,(null==z.$$s?this:z.$$s).$rollStep(T,F))},{$$s:e}),e.string=c(e.string,c(e.$getModifyText(k),e.$getModifyText(p))),t=c(t,c(k,p)),e.string=c(e.string," \uff1e "+t),D="\u30b9\u30c6\u30c3\u30d7"+a+" \uff1e "+e.string,q(f,0)||(e.string=c(e.string,c(" \uff1e ",e.$getSuccess(f,t))),D="\u30b9\u30c6\u30c3\u30d7"+a+">="+f+" \uff1e "+e.string),D)}),b(S,"$getModifyText",function(n){var e=this;return e.string="",q(n,0)||(o(l(n,0))&&(e.string=c(e.string,"+")),e.string=c(e.string,n.$to_s())),e.string}),b(S,"$getBaseStepTable",function(){return[[1,[0,0,0,0,1,0,-3]],[2,[0,0,0,0,1,0,-2]],[3,[0,0,0,0,1,0,-1]],[4,[0,0,0,0,1,0,0]],[5,[0,0,0,1,0,0,0]],[6,[0,0,1,0,0,0,0]],[7,[0,1,0,0,0,0,0]]]}),b(S,"$getStepInfo",function(n){var a,e=this,t=s,f=s,g=s,_=s,d=s,p=s,h=s,v=s;return a=(t=e.$getBaseStepTable()).$last().$first(),o(K(n,a))?e.$get_table_by_number(n,t):(f=[0,1,0,0,0,0,0],g=P(P(n,a),1),d=[0,0,0,0,0,0,0],p=A(g,(_=[[0,0,0,0,2,0,0],[0,0,0,1,1,0,0],[0,0,0,2,0,0,0],[0,0,1,1,0,0,0],[0,0,2,0,0,0,0],[0,1,1,0,0,0,0],[0,2,0,0,0,0,0]]).$size()).$to_i(),I(p,"times",[],function y(){return(null==y.$$s?this:y.$$s).$addStepToResult(d,f)},{$$s:e}),h=g["$%"](_.$size()),v=_["$[]"](h),e.$addStepToResult(d,v),d)}),b(S,"$addStepToResult",function(n,e){return I(n.$size(),"times",[],function(a){var f;return null==a&&(a=s),f=[a,c(n["$[]"](a),e["$[]"](a))],I(n,"[]=",f),f[f.length-1]}),n}),b(S,"$getSuccess",function(n,e){var t,f=this,g=s,_=s,d=s,p=s,h=s,v=s,y=s;return o(f.isFailed)?"\u81ea\u52d5\u5931\u6557":(g=f.$getSuccessTable(),_=f.$get_table_by_number(n,g),d=null==(t=W(_))[0]?s:t[0],p=null==t[1]?s:t[1],h=null==t[2]?s:t[2],v=null==t[3]?s:t[3],y=null==t[4]?s:t[4],o(M(e,null==t[5]?s:t[5]))?"Extraordinary(\u6975\u4e0a)":o(M(e,y))?"Excelent(\u6700\u9ad8)":o(M(e,v))?"Good(\u4e0a\u51fa\u6765)":o(M(e,h))?"Average(\u305d\u3053\u305d\u3053)":o(M(e,p))?"Poor(\u304a\u7c97\u672b)":o(M(e,d))?"Pathetic(\u60e8\u3081)":s)}),b(S,"$getSuccessTable",function(){return[[2,[0,1,2,5,7,9]],[3,[0,1,3,6,8,10]],[4,[0,1,4,7,10,12]],[5,[1,2,5,8,11,14]],[6,[1,2,6,9,13,17]],[7,[1,3,7,11,15,19]],[8,[1,4,8,13,16,20]],[9,[1,5,9,15,18,22]],[10,[1,6,10,16,20,24]],[11,[1,6,11,17,21,25]],[12,[1,7,12,18,23,27]],[13,[1,7,13,20,25,29]],[14,[1,8,14,21,26,31]],[15,[1,9,15,23,27,31]],[16,[1,10,16,24,28,33]],[17,[1,11,17,25,30,34]],[18,[1,12,18,26,31,36]],[19,[1,12,19,28,33,37]],[20,[1,13,20,29,34,39]],[21,[1,14,21,30,36,41]],[22,[1,15,22,31,37,42]],[23,[1,16,23,33,38,43]],[24,[1,16,24,34,39,44]],[25,[1,17,25,35,41,46]],[26,[1,18,26,36,42,47]],[27,[1,19,27,37,43,49]],[28,[1,19,28,39,45,50]],[29,[1,21,29,40,46,51]],[30,[1,21,30,41,47,53]],[31,[1,22,31,42,48,54]],[32,[1,23,32,43,49,55]],[33,[1,24,33,45,51,57]],[34,[1,24,34,46,52,58]],[35,[1,25,35,47,53,60]],[36,[1,26,36,48,54,60]],[37,[1,27,37,49,56,62]],[38,[1,28,38,51,57,63]],[39,[1,29,39,52,58,64]],[40,[1,30,40,53,59,66]]]}),b(S,"$rollStep",function(n,e){var t=this,a=s;return t.$debug("rollStep diceType, diceCount, @string",n,e,t.string),a=0,o(l(e,0))&&(o(t.string["$empty?"]())||(t.string=c(t.string,"+")),t.string=c(t.string,e+"d"+n+"["),t.$debug("rollStep @string",t.string),I(e,"times",[],function f(g){var _=null==f.$$s?this:f.$$s,d=s,p=s;for(null==_.randomizer&&(_.randomizer=s),null==_.string&&(_.string=s),null==g&&(g=s),d=_.randomizer.$roll_once(n),u(d,1)&&(_.isFailed=!1),p=d;q(d,n);)d=_.randomizer.$roll_once(n),p=c(p,d);return a=c(a,p),u(g,0)&&(_.string=c(_.string,",")),_.string=c(_.string,p.$to_s())},{$$s:t}),t.string=c(t.string,"]")),a})})}}]);