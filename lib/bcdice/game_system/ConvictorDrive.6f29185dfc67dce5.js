(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[8138],{1011:(be,he,ve)=>{ve(9993),Opal.modules["i18n/backend/fallbacks"]=function(e){var G,n,r,$,s,d,F=e.module,L=e.class_variable_set,c=e.truthy,A=e.class_variable_get,x=e.def,z=e.send,U=e.send2,T=e.find_super,q=e.hash2,N=e.find_block_super,k=e.neqeq,H=e.thrower,W=e.return_val,M=[],S=e.nil,y=e.$$$;return G=M,d=[s=F(M[0],"I18n")].concat(G),L(d[0],"@@fallbacks",S),n=e.get_singleton_class(s),r=[n].concat(d),$=e.$r(r),x(n,"$fallbacks",function(){var E=S;return L(r[1],"@@fallbacks",c(null!=r[1].$$cvars["@@fallbacks"]?"class variable":S)&&c(E=A(r[1],"@@fallbacks",!1))?E:y(y($("I18n"),"Locale"),"Fallbacks").$new()),c(E=$("Thread").$current()["$[]"]("i18n_fallbacks"))?E:A(r[1],"@@fallbacks",!1)}),x(n,"$fallbacks=",function(I){var E;return L(r[1],"@@fallbacks",c(I["$is_a?"]($("Array")))?y(y($("I18n"),"Locale"),"Fallbacks").$new(I):I),E=["i18n_fallbacks",A(r[1],"@@fallbacks",!1)],z($("Thread").$current(),"[]=",E),E[E.length-1]}),function(n,R){var I,E,p,l,$=[F(n,"Backend")].concat(R);return I=$,p=[E=F($[0],"Fallbacks")].concat(I),l=e.$r(p),x(E,"$translate",function h(f,g,u){try{var b=H("return"),_=h.$$p||S,C=this,D=S,v=S;return h.$$p=null,null==u&&(u=l("EMPTY_HASH")),c(u.$fetch("fallback",!0))?c(u["$[]"]("fallback_in_progress"))?U(C,T(C,"translate",h,!1,!0),"translate",[f,g,u],_):(c(u["$[]"]("default"))&&(D=C["$extract_non_symbol_default!"](u)),v=u.$merge(q(["fallback_in_progress"],{fallback_in_progress:!0})),z(l("I18n").$fallbacks()["$[]"](f),"each",[],function a(w){var t=null==a.$$s?this:a.$$s;null==w&&(w=S);try{return z(t,"catch",["exception"],function o(){var i=null==o.$$s?this:o.$$s,K=S;if(K=U(i,N(i,"translate",o.$$def||a.$$def||h,!1,!1),"translate",[w,g,v],null),c(K["$nil?"]()))return S;k(f.$to_s(),w.$to_s())&&i.$on_fallback(f,w,g,u),b.$throw(K)},{$$s:t,$$ret:b})}catch(o){if(!e.rescue(o,[y(l("I18n"),"InvalidLocale")]))throw o;try{return S}finally{e.pop_exception()}}},{$$s:C}),c(u["$key?"]("default"))&&c(u["$[]"]("default")["$nil?"]())?S:c(D)?U(C,T(C,"translate",h,!1,!0),"translate",[f,S,u.$merge(q(["default"],{default:D}))],null):C.$throw("exception",y(l("I18n"),"MissingTranslation").$new(f,g,u))):U(C,T(C,"translate",h,!1,!0),"translate",[f,g,u],_)}catch(a){if(a===b)return a.$v;throw a}},-3),x(E,"$extract_non_symbol_default!",function(f){var u,g=S;return g=[f["$[]"]("default")].$flatten(),u=z(g,"detect",[],function(_){return null==_&&(_=S),_["$is_a?"](l("Symbol"))["$!"]()}),c(u)&&f["$[]="]("default",g["$[]"](0,g.$index(u))),u}),x(E,"$exists?",function h(f,g,u){try{var b=H("return"),_=h.$$p||S,C=this;return h.$$p=null,null==u&&(u=l("EMPTY_HASH")),c(u.$fetch("fallback",!0))?(z(l("I18n").$fallbacks()["$[]"](f),"each",[],function D(v){var a=null==D.$$s?this:D.$$s;null==v&&(v=S);try{if(!c(U(a,N(a,"exists?",D.$$def||h,!1,!1),"exists?",[v,g],null)))return S;b.$throw(!0)}catch(w){if(!e.rescue(w,[y(l("I18n"),"InvalidLocale")]))throw w;try{return S}finally{e.pop_exception()}}},{$$s:C,$$ret:b}),!1):U(C,T(C,"exists?",h,!1,!0),"exists?",[f,g,u],_)}catch(D){if(D===b)return D.$v;throw D}},-3),E.$private(),x(E,"$on_fallback",W(S))}(d[0],d)},Opal.modules["bcdice/randomizer"]=function(e){var s,m,I,E,p,l,n,R,L=e.klass,c=e.const_set,A=e.def,x=e.truthy,z=e.rb_gt,U=e.rb_plus,T=e.rb_le,q=e.send,N=e.rb_minus,k=e.eqeq,H=e.rb_times,W=e.eqeqeq,M=e.rb_ge,S=[],y=e.nil,Q=e.$$$;return s=S,n=[(0,e.module)(S[0],"BCDice")].concat(s),R=e.$r(n),m=n,E=[I=L(n[0],null,"Randomizer")].concat(m),p=e.$r(E),(l=I.$$prototype).rand_results=l.detailed_rand_results=y,c(E[0],"UPPER_LIMIT_DICE_TIMES",200),c(E[0],"UPPER_LIMIT_DICE_SIDES",1e4),c(E[0],"UPPER_LIMIT_RANDS",1e4),A(I,"$initialize",function(){return this.rand_results=[],this.detailed_rand_results=[]}),I.$attr_reader("rand_results"),I.$attr_reader("detailed_rand_results"),c(E[0],"DetailedRandResult",p("Struct").$new("kind","sides","value")),A(I,"$roll_barabara",function(f,g){var u=this;return x(z(U(u.rand_results.$size(),f),p("UPPER_LIMIT_RANDS")))&&u.$raise(p("TooManyRandsError")),x(T(f,0))||x(z(f,p("UPPER_LIMIT_DICE_TIMES")))?[]:q(p("Array"),"new",[f],function b(){return(null==b.$$s?this:b.$$s).$roll_once(g)},{$$s:u})}),A(I,"$roll_sum",function(f,g){return this.$roll_barabara(f,g).$sum()}),A(I,"$roll_once",function(f){var u=y;return x(T(f,0))||x(z(f,p("UPPER_LIMIT_DICE_SIDES")))?0:(u=this.$rand_inner(f),this.$push_to_detail("normal",f,u),u)}),A(I,"$roll_index",function(f){return N(this.$roll_once(f),1)}),A(I,"$roll_tens_d10",function(){var u,g=y;return g=this.$rand_inner(10),k(g,10)&&(g=0),u=H(g,10),this.$push_to_detail("tens_d10",10,u),u}),A(I,"$roll_d9",function(){var g;return g=N(this.$rand_inner(10),1),this.$push_to_detail("d9",10,g),g}),A(I,"$roll_d66",function(f){var b,u=y;return u=q(p("Array"),"new",[2],function _(){return(null==_.$$s?this:_.$$s).$roll_once(6)},{$$s:this}),W(Q(p("D66SortType"),"ASC"),b=f)?u["$sort!"]():W(Q(p("D66SortType"),"DESC"),b)&&u["$sort!"]()["$reverse!"](),U(H(u["$[]"](0),10),u["$[]"](1))}),I.$private(),A(I,"$rand_inner",function(f){var u,g=this;return x(M(g.rand_results.$size(),p("UPPER_LIMIT_RANDS")))&&g.$raise(p("TooManyRandsError")),u=g.$random(f),g.rand_results["$<<"]([u,f]),u}),A(I,"$random",function(f){return U(p("Kernel").$rand(f),1)}),A(I,"$push_to_detail",function(f,g,u){var _;return _=p("DetailedRandResult").$new(f,g,u),this.detailed_rand_results.$push(_)}),L(n[0],R("StandardError"),"TooManyRandsError"),y},Opal.modules["bcdice/dice_table/roll_result"]=function(e){var q,W,G,s,d,n,R,S,k,F=e.module,L=e.klass,c=e.def,A=e.truthy,x=e.return_val,z=[],U=e.nil;return q=z,W=k=[F(z[0],"BCDice")].concat(q),G=S=[F(k[0],"DiceTable")].concat(W),d=[s=L(S[0],null,"RollResult")].concat(G),n=e.$r(d),(R=s.$$prototype).table_name=R.value=R.body=U,c(s,"$initialize",function($,m,I){var E=this;return E.table_name=$,E.value=m,E.body=I}),s.$attr_reader("table_name"),s.$attr_reader("value"),s.$attr_reader("body"),c(s,"$to_s",function(){var $=this;return $.table_name+"("+$.value+") \uff1e "+$.body}),c(s,"$last_body",function(){var $=this;return A($.body["$is_a?"](n("RollResult")))?$.body.$last_body():$.body}),c(s,"$empty?",x(!1))},Opal.modules["bcdice/dice_table/chain_table"]=function(e){var q,W,G,s,d,n,R,S,k,F=e.module,L=e.klass,c=e.truthy,A=e.def,x=e.rb_minus,z=[],U=e.nil;return q=z,W=k=[F(z[0],"BCDice")].concat(q),G=S=[F(k[0],"DiceTable")].concat(W),d=[s=L(S[0],null,"ChainTable")].concat(G),n=e.$r(d),(R=s.$$prototype).times=R.sides=R.items=R.name=U,A(s,"$initialize",function($,m,I){var E=this,p=U;return E.name=$,E.items=I.$freeze(),p=/(\d+)D(\d+)/i.$match(m),c(p)||E.$raise(n("ArgumentError"),"Unexpected table type: "+m),E.times=p["$[]"](1).$to_i(),E.sides=p["$[]"](2).$to_i()}),A(s,"$roll",function($){var I,E,m=this,p=U;return I=$.$roll_sum(m.times,m.sides),E=x(I,m.times),p=m.items["$[]"](E),c(p["$respond_to?"]("roll"))&&(p=p.$roll($)),n("RollResult").$new(m.name,I,p)})},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(e){var H,y,n,R,r,$,m,G,M,F=e.module,L=e.klass,c=e.hash2,A=e.defs,x=e.def,z=e.rb_plus,U=e.rb_times,T=e.rb_minus,q=[],N=e.nil;return H=q,y=M=[F(q[0],"BCDice")].concat(H),n=G=[F(M[0],"DiceTable")].concat(y),r=[R=L(G[0],null,"D66GridTable")].concat(n),$=e.$r(r),(m=R.$$prototype).name=m.items=N,A(R,"$from_i18n",function(E,p){var h=N;return h=$("I18n").$t(E,c(["locale","raise"],{locale:p,raise:!0})),this.$new(h["$[]"]("name"),h["$[]"]("items"))}),x(R,"$initialize",function(E,p){return this.name=E,this.items=p.$freeze()}),x(R,"$roll",function(E){var l,h,f,g,u;return l=E.$roll_once(6),h=E.$roll_once(6),f=z(U(l,10),h),g=T(l,1),u=T(h,1),$("RollResult").$new(this.name,f,this.items["$[]"](g)["$[]"](u))})},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(e){var N,M,d,n,R,r,y,Q,H,F=e.module,L=e.klass,c=e.hash2,A=e.defs,x=e.def,U=[],T=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),N=U,M=H=[F(U[0],"BCDice")].concat(N),y=[F(H[0],"DiceTable")].concat(M),Q=e.$r(y),d=y,R=[n=L(y[0],Q("D66GridTable"),"D66HalfGridTable")].concat(d),r=e.$r(R),A(n,"$from_i18n",function(m,I){var p=T;return p=r("I18n").$t(m,c(["locale","raise"],{locale:I,raise:!0})),this.$new(p["$[]"]("name"),p["$[]"]("items_1_2_3"),p["$[]"]("items_4_5_6"))}),x(n,"$initialize",function(m,I,E){return this.name=m,this.items=[I,I,I,E,E,E].$freeze()})},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(e){var N,M,d,n,R,r,y,Q,H,F=e.module,L=e.klass,c=e.hash2,A=e.defs,x=e.def,U=[],T=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),N=U,M=H=[F(U[0],"BCDice")].concat(N),y=[F(H[0],"DiceTable")].concat(M),Q=e.$r(y),d=y,R=[n=L(y[0],Q("D66GridTable"),"D66OneThirdTable")].concat(d),r=e.$r(R),A(n,"$from_i18n",function(m,I){var p=T;return p=r("I18n").$t(m,c(["locale","raise"],{locale:I,raise:!0})),this.$new(p["$[]"]("name"),p["$[]"]("items_1_2"),p["$[]"]("items_3_4"),p["$[]"]("items_5_6"))}),x(n,"$initialize",function(m,I,E,p){return this.name=m,this.items=[I,I,E,E,p,p].$freeze()})},Opal.modules["bcdice/dice_table/d66_table"]=function(e){var M,G,r,$,m,I,E,d,y,F=e.module,L=e.klass,c=e.hash2,A=e.defs,x=e.def,z=e.eqeqeq,U=e.rb_plus,T=e.rb_times,q=e.truthy,N=[],k=e.nil,H=e.$$$;return M=N,G=y=[F(N[0],"BCDice")].concat(M),r=d=[F(y[0],"DiceTable")].concat(G),m=[$=L(d[0],null,"D66Table")].concat(r),I=e.$r(m),(E=$.$$prototype).sort_type=E.items=E.name=k,A($,"$from_i18n",function(l,h){var u,g=k;return g=I("I18n").$t(l,c(["locale"],{locale:h})),u=I("D66SortType").$const_get(g["$[]"]("d66_sort_type")),this.$new(g["$[]"]("name"),u,g["$[]"]("items"))}),x($,"$initialize",function(l,h,f){var g=this;return g.name=l,g.sort_type=h,g.items=f.$freeze()}),x($,"$roll",function(l){var h=this,f=k,g=k,u=k,b=k;return f=l.$roll_barabara(2,6),z(H(I("D66SortType"),"ASC"),g=h.sort_type)?f["$sort!"]():z(H(I("D66SortType"),"DESC"),g)&&f["$sort!"]()["$reverse!"](),u=U(T(f["$[]"](0),10),f["$[]"](1)),b=q(g=h.items["$[]"](u))?g:h.items["$[]"](u.$to_s()),q(b["$respond_to?"]("roll"))&&(b=b.$roll(l)),I("RollResult").$new(h.name,u,b)}),x($,"$choice",function(l){return I("RollResult").$new(this.name,l,this.items["$[]"](l))})},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(e){var S,s,n,R,Q,F=e.module,L=e.klass,c=e.hash2,A=e.send,x=e.to_ary,z=e.rb_plus,U=e.rb_times,T=e.send2,q=e.find_super,N=e.def,H=[],W=e.nil;return e.top.$require("bcdice/dice_table/d66_table"),S=H,s=Q=[F(H[0],"BCDice")].concat(S),n=[F(Q[0],"DiceTable")].concat(s),R=e.$r(n),N(L(n[0],R("D66Table"),"D66LeftRangeTable"),"$initialize",function I(E,p,l){var g;return I.$$p=null,g=c([],{}),A(l,"each",[],function(b){var _,v;return null==b&&(b=W),_=x(b),v=null==_[1]?W:_[1],A(null==_[0]?W:_[0],"each",[],function(w){return null==w&&(w=W),A(v,"each_with_index",[],function(o,i){var K,X;return null==o&&(o=W),null==i&&(i=W),X=z(U(w,10),z(i,1)),A(g,"[]=",K=[X,o]),K[K.length-1]})})}),T(this,q(this,"initialize",I,!1,!0),"initialize",[E,p,g],null)})},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(e){var W,Q,R,r,$,m,I,s,S,F=e.module,L=e.klass,c=e.hash2,A=e.defs,x=e.def,z=e.truthy,U=e.rb_minus,T=e.rb_plus,q=e.rb_times,N=[],k=e.nil;return W=N,Q=S=[F(N[0],"BCDice")].concat(W),R=s=[F(S[0],"DiceTable")].concat(Q),$=[r=L(s[0],null,"D66ParityTable")].concat(R),m=e.$r($),(I=r.$$prototype).odd=I.even=I.name=k,A(r,"$from_i18n",function(p,l){var f=k;return f=m("I18n").$t(p,c(["locale","raise"],{locale:l,raise:!0})),this.$new(f["$[]"]("name"),f["$[]"]("odd"),f["$[]"]("even"))}),x(r,"$initialize",function(p,l,h){var f=this;return f.name=p,f.odd=l.$freeze(),f.even=h.$freeze()}),x(r,"$roll",function(p){var f,u,b,l=this,h=k;return h=p.$roll_once(6),f=p.$roll_once(6),u=(z(h["$odd?"]())?l.odd:l.even)["$[]"](U(f,1)),b=T(q(h,10),f),m("RollResult").$new(l.name,b,u)})},Opal.modules["bcdice/dice_table/d66_range_table"]=function(e){var N,M,s,d,n,R,r,y,H,F=e.module,L=e.klass,c=e.def,A=e.rb_plus,x=e.rb_times,z=e.send,U=[],T=e.nil;return N=U,M=H=[F(U[0],"BCDice")].concat(N),s=y=[F(H[0],"DiceTable")].concat(M),n=[d=L(y[0],null,"D66RangeTable")].concat(s),R=e.$r(n),(r=d.$$prototype).items=r.name=T,c(d,"$initialize",function(m,I){return this.name=m,this.items=I.$freeze()}),c(d,"$roll",function(m){var E,p,l,h=T;return E=m.$roll_once(6),p=m.$roll_once(6),l=A(x(E,10),p),h=z(this.items,"find",[],function(g){return null==g&&(g=T),g["$[]"](0)["$include?"](l)}),R("RollResult").$new(this.name,l,h["$[]"](1))})},Opal.modules["bcdice/dice_table/range_table"]=function(e){var W,Q,R,r,$,m,I,s,S,F=e.module,L=e.klass,c=e.const_set,A=e.send,x=e.truthy,z=e.def,U=e.eqeqeq,T=e.rb_times,q=e.rb_plus,N=[],k=e.nil;return W=N,Q=S=[F(N[0],"BCDice")].concat(W),R=s=[F(S[0],"DiceTable")].concat(Q),$=[r=L(s[0],null,"RangeTable")].concat(R),m=e.$r($),(I=r.$$prototype).name=I.items=I.num_of_dice=I.num_of_sides=I.formatter=k,c($[0],"RollResult",A(m("Struct"),"new",["sum","values","content","formatted"],function E(){return(null==E.$$s?this:E.$$s).$alias_method("to_s","formatted")},{$$s:r})),c($[0],"Item",m("Struct").$new("range","content")),c($[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),c($[0],"DEFAULT_FORMATTER",A(r,"lambda",[],function(p,l){return null==p&&(p=k),null==l&&(l=k),p.$name()+"("+l.$sum()+") \uff1e "+l.$content()})),r.$attr_reader("name"),r.$attr_reader("num_of_dice"),r.$attr_reader("num_of_sides"),z(r,"$initialize",function E(p,l,h){var u,f=E.$$p||k,g=this,b=k;return E.$$p=null,g.name=p.$freeze(),g.formatter=x(u=f)?u:m("DEFAULT_FORMATTER"),b=m("DICE_ROLL_METHOD_RE").$match(l),x(b)||g.$raise(m("ArgumentError"),g.name+": invalid dice roll method: "+l),g.num_of_dice=b["$[]"](1).$to_i(),g.num_of_sides=b["$[]"](2).$to_i(),g.$store(h)}),z(r,"$fetch",function(p){var h,l=this;return h=A(l.items,"find",[],function(g){return null==g&&(g=k),g.$range()["$include?"](p)}),x(h)||l.$raise(m("RangeError"),l.name+": value is out of range: "+p),h}),z(r,"$roll",function(p){var f,l=this,h=k,g=k;return f=(h=p.$roll_barabara(l.num_of_dice,l.num_of_sides)).$sum(),(g=m("RollResult").$new(f,h,l.$fetch(f).$content()))["$formatted="](l.formatter["$[]"](l,g)),g}),r.$private(),z(r,"$store",function(p){var h,f,l=this;return h=A(p,"map",[],function g(u,b){return null==u&&(u=k),null==b&&(b=k),[(null==g.$$s?this:g.$$s).$coerce_to_int_range(u),b]},{$$s:l}),f=A(h,"sort_by",[],function(u,b){return null==u&&(u=k),null==b&&(b=k),u.$min()}),l.$assert_min_sum_is_covered(f),l.$assert_max_sum_is_covered(f),l.$assert_no_gap_or_overlap_in_ranges(f),l.items=A(f,"map",[],function(u,b){return null==u&&(u=k),null==b&&(b=k),m("Item").$new(u,b.$freeze()).$freeze()}).$freeze(),l}),z(r,"$coerce_to_int_range",function(p){var h;return U(m("Integer"),h=p)?m("Range").$new(p,p):U(m("Range"),h)&&x(p.$begin()["$is_a?"](m("Integer")))&&x(p.$end()["$is_a?"](m("Integer")))?p:this.$raise(m("TypeError"),this.name+": "+p+" ("+p.$class()+") must be an Integer or a Range with Integers ")}),z(r,"$assert_min_sum_is_covered",function(p){var h,l=this,f=k;return h=l.num_of_dice,f=p.$first()["$[]"](0),x(f["$include?"](h))||l.$raise(m("RangeError"),l.name+": min value ("+h+") is not covered: "+f),l}),z(r,"$assert_max_sum_is_covered",function(p){var h,l=this,f=k;return h=T(l.num_of_dice,l.num_of_sides),f=p.$last()["$[]"](0),x(f["$include?"](h))||l.$raise(m("RangeError"),l.name+": max value ("+h+") is not covered: "+f),l}),z(r,"$assert_no_gap_or_overlap_in_ranges",function(p){return A(p,"each_cons",[2],function h(f,g){var C,D,u=null==h.$$s?this:h.$$s,b=k,_=k;return null==u.name&&(u.name=k),null==f&&(f=k),null==g&&(g=k),b=f["$[]"](0),_=g["$[]"](0),C=b.$max(),D=q(C,1),x(_["$include?"](C))&&u.$raise(m("RangeError"),u.name+": Range overlap: "+b+" and "+_),x(_["$include?"](D))?k:u.$raise(m("RangeError"),u.name+": Range gap: "+b+" and "+_)},{$$s:this}),this})},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(e){var k,S,d,m,I,E,p,R,Q,W,F=e.module,L=e.klass,c=e.send,A=e.def,x=e.rb_minus,z=e.return_ivar,U=[],T=e.nil,q=e.$$$;return k=U,S=W=[F(U[0],"BCDice")].concat(k),d=Q=[F(W[0],"DiceTable")].concat(S),m=R=[L(Q[0],null,"SaiFicSkillTable")].concat(d),E=[I=L(R[0],null,"Category")].concat(m),p=e.$r(E),A(I,"$initialize",function(h,f,g,u){var b=this;return b.name=h,b.skills=c(f.$map(),"with_index",[2],function(C,D){return null==C&&(C=T),null==D&&(D=T),q(p("SaiFicSkillTable"),"Skill").$new(h,C,g,D,u)}),b.dice=g}),A(I,"$roll",function(h){return this.$skills()["$[]"](x(h.$roll_sum(2,6),2))}),A(I,"$to_s",z("name")),I.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(e){var T,H,Q,R,r,s,M,N,F=e.module,L=e.klass,c=e.def,A=e.hash2,x=[],z=e.nil;return T=x,H=N=[F(x[0],"BCDice")].concat(T),Q=M=[F(N[0],"DiceTable")].concat(H),s=[L(M[0],null,"SaiFicSkillTable")].concat(Q),(r=(R=L(s[0],null,"Skill")).$$prototype).s_format=r.category_dice=r.row_dice=r.category_name=r.name=z,c(R,"$initialize",function(m,I,E,p,l){var h=this;return h.category_name=m,h.name=I,h.category_dice=E,h.row_dice=p,h.s_format=l}),c(R,"$to_s",function(){var m=this;return m.$format(m.s_format,A(["category_dice","row_dice","category_name","skill_name"],{category_dice:m.category_dice,row_dice:m.row_dice,category_name:m.category_name,skill_name:m.name}))}),R.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(e){var s,r,p,l,h,f,g,m,n,F=e.module,L=e.klass,c=e.ensure_kwargs,A=e.hash2,x=e.send,U=e.defs,T=e.const_set,q=e.to_ary,N=e.def,k=e.truthy,H=e.rb_minus,W=e.rb_plus,M=e.top,S=[],y=e.nil,Q=e.$$$;return M.$require("bcdice/dice_table/sai_fic_skill_table/category"),M.$require("bcdice/dice_table/sai_fic_skill_table/skill"),s=S,r=n=[F(S[0],"BCDice")].concat(s),p=m=[F(n[0],"DiceTable")].concat(r),h=[l=L(m[0],null,"SaiFicSkillTable")].concat(p),f=e.$r(h),(g=l.$$prototype).rtt=g.rtt_format=g.rct=g.rct_format=g.rttn=g.rttn_format=g.categories=y,U(l,"$from_i18n",function(b,_,C){var D,v,a,i,o=y;return null==(D=(C=c(C)).$$smap.rtt)&&(D=y),null==(v=C.$$smap.rct)&&(v=y),null==(a=C.$$smap.rttn)&&(a=y),i=(o=f("I18n").$t("RTT",A(["locale","raise","default"],{locale:_,raise:!1,default:A([],{})})).$merge(f("I18n").$t(b,A(["locale","raise"],{locale:_,raise:!0}))))["$[]"]("items"),o=x(o,"select",[],function(X,V){return null==X&&(X=y),null==V&&(V=y),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](X)}),this.$new(i,e.to_hash(o).$merge(A(["rtt","rct","rttn"],{rtt:D,rct:v,rttn:a})))},-3),T(h[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),T(h[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),T(h[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),T(h[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),N(l,"$initialize",function(b,_){var C,D,v,a,w,t,o,i=this;return null==(C=(_=c(_)).$$smap.rtt)&&(C=y),null==(D=_.$$smap.rct)&&(D=y),null==(v=_.$$smap.rttn)&&(v=y),null==(a=_.$$smap.rtt_format)&&(a=f("DEFAULT_RTT")),null==(w=_.$$smap.rct_format)&&(w=f("DEFAULT_RCT")),null==(t=_.$$smap.rttn_format)&&(t=f("DEFAULT_RTTN")),null==(o=_.$$smap.s_format)&&(o=f("DEFAULT_S")),i.categories=x(b.$map(),"with_index",[1],function(X,V){var ne,ue,ie;return null==X&&(X=y),null==V&&(V=y),ue=null==(ne=q(X))[0]?y:ne[0],ie=null==ne[1]?y:ne[1],Q(f("SaiFicSkillTable"),"Category").$new(ue,ie,V,o)},{$$has_top_level_mlhs_arg:!0}),i.rtt=C,i.rct=D,i.rttn=v.$to_a(),i.rtt_format=a,i.rct_format=w,i.rttn_format=t},-2),T(h[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),l.$attr_reader("categories"),N(l,"$roll_command",function(b,_){var D,C=this,v=y,a=y;return k(["RTT",C.rtt]["$include?"](D=_))?C.$format_skill(C.rtt_format,C.$roll_skill(b)):k(["RCT",C.rct]["$include?"](D))?(v=C.$roll_category(b),C.$format(C.rct_format,A(["category_dice","category_name"],{category_dice:v.$dice(),category_name:v.$name()}))):k(a=f("RTTN").$index(D))||k(a=C.rttn.$index(D))?C.$format_skill(C.rttn_format,C.categories["$[]"](a).$roll(b)):y}),N(l,"$roll_category",function(b){return this.categories["$[]"](H(b.$roll_once(6),1))}),N(l,"$roll_skill",function(b){return this.$roll_category(b).$roll(b)}),N(l,"$prefixes",function(){var b=this;return W(["RTT[1-6]?","RCT",b.rtt,b.rct],b.rttn).$compact()}),l.$private(),N(l,"$format_skill",function(b,_){return this.$format(b,A(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:_.$category_dice(),row_dice:_.$row_dice(),category_name:_.$category_name(),skill_name:_.$name(),text:_.$to_s()}))})},Opal.modules["bcdice/dice_table/table"]=function(e){var k,S,d,n,R,r,$,Q,W,F=e.module,L=e.klass,c=e.hash2,A=e.defs,x=e.truthy,z=e.def,U=e.rb_minus,T=[],q=e.nil;return k=T,S=W=[F(T[0],"BCDice")].concat(k),d=Q=[F(W[0],"DiceTable")].concat(S),R=[n=L(Q[0],null,"Table")].concat(d),r=e.$r(R),($=n.$$prototype).times=$.sides=$.name=$.items=q,A(n,"$from_i18n",function(I,E){var l=q;return l=r("I18n").$t(I,c(["locale"],{locale:E})),this.$new(l["$[]"]("name"),l["$[]"]("type"),l["$[]"]("items"))}),z(n,"$initialize",function(I,E,p){var l=this,h=q;return l.name=I,l.items=p.$freeze(),h=/(\d+)D(\d+)/i.$match(E),x(h)||l.$raise(r("ArgumentError"),"Unexpected table type: "+E),l.times=h["$[]"](1).$to_i(),l.sides=h["$[]"](2).$to_i()}),z(n,"$roll",function(I){var p,E=this;return p=I.$roll_sum(E.times,E.sides),E.$choice(p)}),z(n,"$choice",function(I){var p,E=this;return p=U(I,E.times),r("RollResult").$new(E.name,I,E.items["$[]"](p))})},Opal.modules["bcdice/dice_table"]=function(e){var F=e.top;return F.$require("bcdice/dice_table/roll_result"),F.$require("bcdice/dice_table/chain_table"),F.$require("bcdice/dice_table/d66_grid_table"),F.$require("bcdice/dice_table/d66_half_grid_table"),F.$require("bcdice/dice_table/d66_one_third_table"),F.$require("bcdice/dice_table/d66_left_range_table"),F.$require("bcdice/dice_table/d66_parity_table"),F.$require("bcdice/dice_table/d66_range_table"),F.$require("bcdice/dice_table/d66_table"),F.$require("bcdice/dice_table/range_table"),F.$require("bcdice/dice_table/sai_fic_skill_table"),F.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(e){var z,N,H,T,F=e.module,L=e.const_set,c=[];return z=c,N=T=[F(c[0],"BCDice")].concat(z),H=[F(T[0],"D66SortType")].concat(N),L(H[0],"NO_SORT","no_sort"),L(H[0],"ASC","asc"),L(H[0],"DESC","desc"),function(q,N){var H=[F(q,"RoundType")].concat(N);return L(H[0],"CEIL","ceil"),L(H[0],"FLOOR","floor"),L(H[0],"ROUND","round")}(T[0],T)},Opal.modules["bcdice/translate"]=function(e){var N,M,S,y,Q,H,F=e.module,L=e.ensure_kwargs,c=e.kwrestargs,x=e.hash2,z=e.def,U=[],T=e.nil;return N=U,M=H=[F(U[0],"BCDice")].concat(N),y=[S=F(H[0],"Translate")].concat(M),Q=e.$r(y),z(S,"$translate",function(s,d){var n,R=this;return null==R.locale&&(R.locale=T),d=L(d),n=c(d,{}),Q("I18n").$translate(s,x(["locale","raise"],{locale:R.locale,raise:!0}).$merge(e.to_hash(n)))},-2)},Opal.modules["bcdice/result"]=function(e){var S,G,y,N,H,L=e.klass,c=e.send,A=e.def,x=e.return_val,z=e.return_ivar,U=[],T=e.nil;return N=U,S=H=[(0,e.module)(U[0],"BCDice")].concat(N),[y=L(H[0],null,"Result")].concat(S),A(G=e.get_singleton_class(y),"$success",function(n){return c(this.$new(),"tap",[],function($){var m;return null==$&&($=T),$["$text="](n),c($,"success=",m=[!0]),m[m.length-1]})}),A(G,"$failure",function(n){return c(this.$new(),"tap",[],function($){var m;return null==$&&($=T),$["$text="](n),c($,"failure=",m=[!0]),m[m.length-1]})}),A(G,"$critical",function(n){return c(this.$new(),"tap",[],function($){var m;return null==$&&($=T),$["$text="](n),$["$critical="](!0),c($,"success=",m=[!0]),m[m.length-1]})}),A(G,"$fumble",function(n){return c(this.$new(),"tap",[],function($){var m;return null==$&&($=T),$["$text="](n),$["$fumble="](!0),c($,"failure=",m=[!0]),m[m.length-1]})}),A(G,"$nothing",x("nothing")),A(y,"$initialize",function(s){var d=this;return null==s&&(s=T),d.text=s,d.rands=T,d.detailed_rands=T,d.secret=!1,d.success=!1,d.failure=!1,d.critical=!1,d.fumble=!1},-1),y.$attr_accessor("text","rands","detailed_rands"),y.$attr_writer("secret","success","failure","critical","fumble"),A(y,"$secret?",z("secret")),A(y,"$success?",z("success")),A(y,"$failure?",z("failure")),A(y,"$critical?",z("critical")),A(y,"$fumble?",z("fumble")),A(y,"$condition=",function(s){return this.success=s,this.failure=s["$!"]()})},Opal.modules["racc/parser"]=function(e){var I,p,l,F=e.module,L=e.klass,c=e.truthy,A=e.const_set,x=e.defs,z=e.gvars,U=e.rb_lt,T=e.def,q=e.to_ary,N=e.send,k=e.neqeq,H=e.rb_plus,W=e.eqeq,M=e.rb_ge,S=e.rb_gt,y=e.rb_minus,Q=e.rb_le,G=e.rb_times,s=e.assign_ivar_val,n=[],R=e.$r(n),r=e.nil,$=e.$$$;return I=n,p=[F(n[0],"Racc")].concat(I),l=e.$r(p),L(p[0],l("StandardError"),"ParseError"),c($("::","ParseError","skip_raise")?"constant":r)||A(n[0],"ParseError",$(R("Racc"),"ParseError")),function(m,I){var u,b,_,C,D,l=[F(m,"Racc")].concat(I),h=e.$r(l);return c(h("Racc_No_Extensions","skip_raise")?"constant":r)||A(l[0],"Racc_No_Extensions",!1),u=l,_=[b=L(l[0],null,"Parser")].concat(u),C=e.$r(_),(D=b.$$prototype).yydebug=D.racc_debug_out=D.racc_error_status=D.racc_t=D.racc_vstack=D.racc_val=D.racc_state=D.racc_tstack=r,A(_[0],"Racc_Runtime_Version","1.4.6"),A(_[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),A(_[0],"Racc_Runtime_Core_Version_R","1.4.6"),A(_[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),A(_[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),A(_[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),A(_[0],"Racc_Runtime_Core_Version",C("Racc_Runtime_Core_Version_R")),A(_[0],"Racc_Runtime_Core_Revision",C("Racc_Runtime_Core_Revision_R")),A(_[0],"Racc_Runtime_Type","ruby"),x(C("Parser"),"$racc_runtime_type",function(){return C("Racc_Runtime_Type")}),T(b,"$_racc_setup",function(){var a,w,t=this,o=r,i=r;return null==z.stderr&&(z.stderr=r),c($(t.$class(),"Racc_debug_parser"))||(t.yydebug=!1),c(null!=(a=t.yydebug)&&a!==r?"instance-variable":r)||(t.yydebug=!1),c(t.yydebug)&&(c(null!=(w=t.racc_debug_out)&&w!==r?"instance-variable":r)||(t.racc_debug_out=z.stderr),t.racc_debug_out=c(o=t.racc_debug_out)?o:z.stderr),i=$(t.$class(),"Racc_arg"),c(U(i.$size(),14))&&i["$[]="](13,!0),i}),T(b,"$_racc_init_sysvars",function(){var a=this;return a.racc_state=[0],a.racc_tstack=[],a.racc_vstack=[],a.racc_t=r,a.racc_val=r,a.racc_read_next=!0,a.racc_user_yyerror=!1,a.racc_error_status=0}),T(b,"$do_parse",function(){return this.$__send__(C("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)}),T(b,"$next_token",function(){return this.$raise(C("NotImplementedError"),this.$class()+"#next_token is not defined")}),T(b,"$_racc_do_parse_rb",function(a,w){var t,i=this,K=r,X=r,V=r,ne=r,ue=r,ie=r,se=r,te=r;return t=q(a),K=null==t[0]?r:t[0],X=null==t[1]?r:t[1],V=null==t[2]?r:t[2],ne=null==t[3]?r:t[3],ue=null==t[10]?r:t[10],i.$_racc_init_sysvars(),ie=se=te=r,N(i,"catch",["racc_end_parse"],function Y(){var P,Z,j=null==Y.$$s?this:Y.$$s,B=r;for(null==j.racc_state&&(j.racc_state=r),null==j.racc_read_next&&(j.racc_read_next=r),null==j.racc_t&&(j.racc_t=r),null==j.yydebug&&(j.yydebug=r),null==j.racc_val&&(j.racc_val=r);c(!0);)for(c(te=ne["$[]"](j.racc_state["$[]"](-1)))?(c(j.racc_read_next)&&k(j.racc_t,0)&&(Z=j.$next_token(),P=q(Z),ie=null==P[0]?r:P[0],j.racc_val=null==P[1]?r:P[1],j.racc_t=c(ie)?c(B=ue["$[]"](ie))?B:1:0,c(j.yydebug)&&j.$racc_read_token(j.racc_t,ie,j.racc_val),j.racc_read_next=!1),te=H(te,j.racc_t),c(M(te,0))&&c(se=K["$[]"](te))&&W(X["$[]"](te),j.racc_state["$[]"](-1))||(se=V["$[]"](j.racc_state["$[]"](-1)))):se=V["$[]"](j.racc_state["$[]"](-1));c(se=j.$_racc_evalact(se,a)););},{$$s:i})}),T(b,"$yyparse",function(a,w){return this.$__send__(C("Racc_YY_Parse_Method"),a,w,this.$_racc_setup(),!0)}),T(b,"$_racc_yyparse_rb",function(a,w,t,o){var i,X=this,V=r,ne=r,$e=r,ue=r,se=r,te=r,Y=r;return i=q(t),V=null==i[0]?r:i[0],ne=null==i[1]?r:i[1],$e=null==i[2]?r:i[2],ue=null==i[3]?r:i[3],se=null==i[10]?r:i[10],X.$_racc_init_sysvars(),te=r,Y=r,N(X,"catch",["racc_end_parse"],function P(){var Z=null==P.$$s?this:P.$$s;for(null==Z.racc_state&&(Z.racc_state=r);!c(Y=ue["$[]"](Z.racc_state["$[]"](-1)));)for(;c(te=Z.$_racc_evalact($e["$[]"](Z.racc_state["$[]"](-1)),t)););return N(a,"__send__",[w],function j(B,ee){var O=null==j.$$s?this:j.$$s,re=r,J=r;for(null==O.racc_t&&(O.racc_t=r),null==O.racc_state&&(O.racc_state=r),null==O.racc_read_next&&(O.racc_read_next=r),null==B&&(B=r),null==ee&&(ee=r),O.racc_t=c(B)?c(re=se["$[]"](B))?re:1:0,O.racc_val=ee,O.racc_read_next=!1,Y=H(Y,O.racc_t),c(M(Y,0))&&c(te=V["$[]"](Y))&&W(ne["$[]"](Y),O.racc_state["$[]"](-1))||(te=$e["$[]"](O.racc_state["$[]"](-1)));c(te=O.$_racc_evalact(te,t)););for(;c(c(re=c(J=(Y=ue["$[]"](O.racc_state["$[]"](-1)))["$!"]())?J:O.racc_read_next["$!"]())?re:O.racc_t["$=="](0));)for(c(Y)&&c(Y=H(Y,O.racc_t))&&c(M(Y,0))&&c(te=V["$[]"](Y))&&W(ne["$[]"](Y),O.racc_state["$[]"](-1))||(te=$e["$[]"](O.racc_state["$[]"](-1)));c(te=O.$_racc_evalact(te,t)););},{$$s:Z})},{$$s:X})}),T(b,"$_racc_evalact",function(a,w){var t,$e,i=this,K=r,X=r,ne=r,ue=r,ie=r,se=r;if(K=null==(t=q(w))[0]?r:t[0],X=null==t[1]?r:t[1],ne=null==t[3]?r:t[3],$e=null==t[11]?r:t[11],ue=null==t[12]?r:t[12],c(S(a,0))&&c(U(a,$e)))c(S(i.racc_error_status,0))&&(W(i.racc_t,1)||(i.racc_error_status=y(i.racc_error_status,1))),i.racc_vstack.$push(i.racc_val),i.racc_state.$push(a),i.racc_read_next=!0,c(i.yydebug)&&(i.racc_tstack.$push(i.racc_t),i.$racc_shift(i.racc_t,i.racc_tstack,i.racc_vstack));else if(c(U(a,0))&&c(S(a,ue["$-@"]()))){if(ie=N(i,"catch",["racc_jump"],function te(){var Y=null==te.$$s?this:te.$$s;return null==Y.racc_state&&(Y.racc_state=r),Y.racc_state.$push(Y.$_racc_do_reduce(w,a)),!1},{$$s:i}),c(ie))switch(ie){case 1:return i.racc_user_yyerror=!0,ue["$-@"]();case 2:return $e;default:i.$raise("[Racc Bug] unknown jump code")}}else if(W(a,$e))c(i.yydebug)&&i.$racc_accept(),i.$throw("racc_end_parse",i.racc_vstack["$[]"](0));else{if(W(a,ue["$-@"]())){switch(i.racc_error_status){case 0:c(w["$[]"](21))||i.$on_error(i.racc_t,i.racc_val,i.racc_vstack);break;case 3:W(i.racc_t,0)&&i.$throw("racc_end_parse",r),i.racc_read_next=!0}for(i.racc_user_yyerror=!1,i.racc_error_status=3;c(!0)&&!(c(se=ne["$[]"](i.racc_state["$[]"](-1)))&&(se=H(se,1),c(M(se,0))&&c(a=K["$[]"](se))&&W(X["$[]"](se),i.racc_state["$[]"](-1))));)c(Q(i.racc_state.$size(),1))&&i.$throw("racc_end_parse",r),i.racc_state.$pop(),i.racc_vstack.$pop(),c(i.yydebug)&&(i.racc_tstack.$pop(),i.$racc_e_pop(i.racc_state,i.racc_tstack,i.racc_vstack));return a}i.$raise("[Racc Bug] unknown action "+a.$inspect())}return c(i.yydebug)&&i.$racc_next_state(i.racc_state["$[]"](-1),i.racc_state),r}),T(b,"$_racc_do_reduce",function(a,w){var t,ue,se,B,ee,O,ae,i=this,X=r,V=r,ne=r,$e=r,ie=r,te=r,Y=r,P=r,Z=r,j=r,re=r,J=r,ce=r;return X=null==(t=q(a))[4]?r:t[4],V=null==t[5]?r:t[5],ne=null==t[6]?r:t[6],$e=null==t[7]?r:t[7],ue=null==t[8]?r:t[8],ie=null==t[9]?r:t[9],se=null==t[13]?r:t[13],te=i.racc_state,Y=i.racc_vstack,P=i.racc_tstack,Z=G(w,-3),j=ie["$[]"](Z),B=ie["$[]"](H(Z,1)),ee=ie["$[]"](H(Z,2)),O=[],c(i.yydebug)&&(re=P["$[]"](j["$-@"](),j)),J=Y["$[]"](j["$-@"](),j),c(i.yydebug)&&P["$[]="](j["$-@"](),j,O),Y["$[]="](j["$-@"](),j,O),te["$[]="](j["$-@"](),j,O),c(se)?Y.$push(i.$__send__(ee,J,Y,J["$[]"](0))):Y.$push(i.$__send__(ee,J,Y)),P.$push(B),c(i.yydebug)&&i.$racc_reduce(re,B,P,Y),ae=y(B,ue),c(Z=$e["$[]"](ae))&&(Z=H(Z,te["$[]"](-1)),c(M(Z,0))&&c(ce=X["$[]"](Z))&&W(V["$[]"](Z),ae))?ce:ne["$[]"](ae)}),T(b,"$on_error",function(a,w,t){var i,o=this;return o.$raise(C("ParseError"),o.$sprintf("\nparse error on value %s (%s)",w.$inspect(),c(i=o.$token_to_str(a))?i:"?"))}),T(b,"$yyerror",function(){return this.$throw("racc_jump",1)}),T(b,"$yyaccept",function(){return this.$throw("racc_jump",2)}),T(b,"$yyerrok",s("racc_error_status",0)),T(b,"$racc_read_token",function(a,w,t){var o=this;return o.racc_debug_out.$print("read    "),o.racc_debug_out.$print(w.$inspect(),"(",o.$racc_token2str(a),") "),o.racc_debug_out.$puts(t.$inspect()),o.racc_debug_out.$puts()}),T(b,"$racc_shift",function(a,w,t){var o=this;return o.racc_debug_out.$puts("shift   "+o.$racc_token2str(a)),o.$racc_print_stacks(w,t),o.racc_debug_out.$puts()}),T(b,"$racc_reduce",function(a,w,t,o){var i=this,K=r;return(K=i.racc_debug_out).$print("reduce "),c(a["$empty?"]())?K.$print(" <none>"):N(a,"each",[],function X(V){return null==V&&(V=r),K.$print(" ",(null==X.$$s?this:X.$$s).$racc_token2str(V))},{$$s:i}),K.$puts(" --\x3e "+i.$racc_token2str(w)),i.$racc_print_stacks(t,o),i.racc_debug_out.$puts()}),T(b,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()}),T(b,"$racc_e_pop",function(a,w,t){var o=this;return o.racc_debug_out.$puts("error recovering mode: pop token"),o.$racc_print_states(a),o.$racc_print_stacks(w,t),o.racc_debug_out.$puts()}),T(b,"$racc_next_state",function(a,w){var t=this;return t.racc_debug_out.$puts("goto    "+a),t.$racc_print_states(w),t.racc_debug_out.$puts()}),T(b,"$racc_print_stacks",function(a,w){var o=r;return(o=this.racc_debug_out).$print("        ["),N(a,"each_index",[],function i(K){return null==K&&(K=r),o.$print(" (",(null==i.$$s?this:i.$$s).$racc_token2str(a["$[]"](K))," ",w["$[]"](K).$inspect(),")")},{$$s:this}),o.$puts(" ]")}),T(b,"$racc_print_states",function(a){var t=r;return(t=this.racc_debug_out).$print("        ["),N(a,"each",[],function(i){return null==i&&(i=r),t.$print(" ",i)}),t.$puts(" ]")}),T(b,"$racc_token2str",function(a){var t;return c(t=$(this.$class(),"Racc_token_to_s_table")["$[]"](a))?t:this.$raise("[Racc Bug] can't convert token "+a+" to string")}),T(b,"$token_to_str",function(a){return $(this.$class(),"Racc_token_to_s_table")["$[]"](a)})}(n[0],n)},Opal.modules["bcdice/arithmetic/node"]=function(e){var s,r,E,u,b,l,h,m,n,F=e.module,L=e.klass,c=e.def,A=e.thrower,x=e.return_ivar,z=e.send2,U=e.find_super,T=e.eqeq,q=e.const_set,N=e.eqeqeq,k=e.rb_divide,H=e.truthy,W=e.assign_ivar,M=e.alias,S=[],y=e.nil,Q=e.$$$;return s=S,r=n=[F(S[0],"BCDice")].concat(s),E=m=[F(n[0],"Arithmetic")].concat(r),l=[F(m[0],"Node")].concat(E),h=e.$r(l),(b=(u=L(l[0],null,"BinaryOp")).$$prototype).lhs=b.rhs=b.op=y,c(u,"$initialize",function(C,D,v){var a=this;return a.lhs=C,a.op=D,a.rhs=v}),c(u,"$eval",function(C){try{A("eval_return");var w,v=this,a=y;return a=v.lhs.$eval(C),w=v.rhs.$eval(C),a.$send(v.op,w)}catch(t){if(t===e.t_eval_return)return t.$v;throw t}}),c(u,"$output",function(){var C=this;return""+C.lhs.$output()+C.op+C.rhs.$output()}),c(u,"$s_exp",function(){var C=this;return"("+C.$op_for_s_exp()+" "+C.lhs.$s_exp()+" "+C.rhs.$s_exp()+")"}),c(u,"$op_for_s_exp",x("op")),function(f,g,u){var b=L(f,g,"DivideBase"),_=[b].concat(u),C=e.$r(_),D=b.$$prototype;D.lhs=D.rhs=D.op=y,c(b,"$initialize",function v(a,w){return v.$$p=null,z(this,U(this,"initialize",v,!1,!0),"initialize",[a,"/",w],null)}),c(b,"$eval",function(a){try{A("eval_return");var o,i,t=this;return o=t.lhs.$eval(a),i=t.rhs.$eval(a),T(i,0)&&t.$raise(C("ZeroDivisionError")),t.$divide_and_round(o,i,a)}catch(K){if(K===e.t_eval_return)return K.$v;throw K}}),c(b,"$output",function v(){var a=v.$$p||y,w=this;return v.$$p=null,""+z(w,U(w,"output",v,!1,!0),"output",[],a)+w.$rounding_method()}),b.$private(),c(b,"$rounding_method",function(){return Q(this.$class(),"ROUNDING_METHOD")}),c(b,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()}),c(b,"$divide_and_round",function(a,w,t){return this.$raise(C("NotImplementedError"))})}(l[0],h("BinaryOp"),l),function(f,g,u){var b=L(f,g,"DivideWithGameSystemDefault"),_=[b].concat(u),C=e.$r(_);q(_[0],"ROUNDING_METHOD",""),b.$private(),c(b,"$divide_and_round",function(v,a,w){var t,o=y;return N(Q(C("RoundType"),"CEIL"),t=w)?k(v.$to_f(),a).$ceil():N(Q(C("RoundType"),"ROUND"),t)?(o=k(v.$to_f(),a),H(o["$negative?"]())?o.$abs().$round()["$-@"]():o.$round()):k(v,a).$floor()})}(l[0],h("DivideBase"),l),function(f,g,u){var b=L(f,g,"DivideWithCeil"),_=[b].concat(u);q(_[0],"ROUNDING_METHOD","C"),b.$private(),c(b,"$divide_and_round",function(D,v,a){return k(D.$to_f(),v).$ceil()})}(l[0],h("DivideBase"),l),function(f,g,u){var b=L(f,g,"DivideWithRound"),_=[b].concat(u);q(_[0],"ROUNDING_METHOD","R"),b.$private(),c(b,"$divide_and_round",function(D,v,a){var w=y;return w=k(D.$to_f(),v),H(w["$negative?"]())?w.$abs().$round()["$-@"]():w.$round()})}(l[0],h("DivideBase"),l),function(f,g,u){var b=L(f,g,"DivideWithFloor"),_=[b].concat(u);q(_[0],"ROUNDING_METHOD","F"),b.$private(),c(b,"$divide_and_round",function(D,v,a){return k(D,v).$floor()})}(l[0],h("DivideBase"),l),function(f,g){var u=L(f,null,"Negative");u.$$prototype.body=y,c(u,"$initialize",W("body")),c(u,"$eval",function(C){try{return A("eval_return"),this.body.$eval(C)["$-@"]()}catch(a){if(a===e.t_eval_return)return a.$v;throw a}}),c(u,"$output",function(){return"-"+this.body.$output()}),c(u,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"})}(l[0]),function(f,g){var u=L(f,null,"Parenthesis");u.$$prototype.expr=y,c(u,"$initialize",W("expr")),c(u,"$eval",function(C){try{return A("eval_return"),this.expr.$eval(C)}catch(a){if(a===e.t_eval_return)return a.$v;throw a}}),c(u,"$output",function(){return"("+this.expr.$output()+")"}),c(u,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"})}(l[0]),function(f,g){var u=L(f,null,"Number");return u.$$prototype.value=y,c(u,"$initialize",W("value")),c(u,"$eval",x("value")),c(u,"$output",function(){return this.value.$to_s()}),M(u,"s_exp","output")}(l[0])},Opal.modules.strscan=function(e){var W,M,S,y,Q,L=e.def,c=e.truthy,A=e.eqeqeq,x=e.Opal,z=e.return_ivar,U=e.send,T=e.alias,q=[],N=e.nil;return W=q,S=[M=(0,e.klass)(q[0],null,"StringScanner")].concat(W),y=e.$r(S),(Q=M.$$prototype).pos=Q.string=Q.working=Q.matched=Q.prev_pos=Q.match=N,M.$attr_reader("pos","matched"),L(M,"$initialize",function(s){var d=this;return d.string=s,d.pos=0,d.matched=N,d.working=s,d.match=[]}),M.$attr_reader("string"),L(M,"$beginning_of_line?",function(){var s=this;return 0===s.pos||"\n"===s.string.charAt(s.pos-1)}),L(M,"$scan",function(s){var d=this,n=(s=d.$anchor(s)).exec(d.working);return null==n?d.matched=N:(d.prev_pos=d.pos,d.pos+=n[0].length,d.working=d.working.substring(n[0].length),d.matched=n[0],d.match=n,n[0])}),L(M,"$scan_until",function(s){var d=this;s=d.$anchor(s);for(var n=d.working,R=0;n.length!=R;++R){var r=s.exec(n.substr(R));if(null!==r){var $=R+r[0].length,m=n.substr(0,$);return d.matched=r[0],d.match=r,d.prev_pos=d.pos+R,d.pos+=$,d.working=n.substr($),m}}return d.matched=N}),L(M,"$[]",function(s){var n;if(c(this.match["$empty?"]()))return N;A(y("Symbol"),n=s)?s=s.$to_s():A(y("String"),n)||(s=x["$coerce_to!"](s,y("Integer"),"to_int"));var R=this.match;return s<0&&(s+=R.length),s<0||s>=R.length||null==R[s]?N:R[s]}),L(M,"$check",function(s){var d=this,n=(s=d.$anchor(s)).exec(d.working);return d.matched=null==n?N:n[0]}),L(M,"$check_until",function(s){var d=this,n=d.prev_pos,R=d.pos,r=d.working,$=d.$scan_until(s);return d.prev_pos=n,d.pos=R,d.working=r,$}),L(M,"$peek",function(s){return this.working.substring(0,s)}),L(M,"$eos?",function(){return 0===this.working.length}),L(M,"$exist?",function(s){var n=s.exec(this.working);return null==n?N:0==n.index?0:n.index+1}),L(M,"$skip",function(s){var d=this,n=(s=d.$anchor(s)).exec(d.working);if(null==n)return d.match=[],d.matched=N;var R=n[0],r=R.length;return d.matched=R,d.match=n,d.prev_pos=d.pos,d.pos+=r,d.working=d.working.substring(r),r}),L(M,"$skip_until",function(s){var n=this.$scan_until(s);return n===N?N:(this.matched=n.substr(-1),n.length)}),L(M,"$get_byte",function(){var s=this,d=N;return s.pos<s.string.length?(s.prev_pos=s.pos,s.pos+=1,d=s.matched=s.working.substring(0,1),s.working=s.working.substring(1)):s.matched=N,d}),L(M,"$match?",function(s){var d=this,n=(s=d.$anchor(s)).exec(d.working);return null==n?N:(d.prev_pos=d.pos,n[0].length)}),L(M,"$pos=",function(s){var d=this;return s<0&&(s+=d.string.$length()),d.pos=s,d.working=d.string.slice(s)}),L(M,"$matched_size",function(){return this.matched===N?N:this.matched.length}),L(M,"$post_match",function(){var s=this;return s.matched===N?N:s.string.substr(s.pos)}),L(M,"$pre_match",function(){var s=this;return s.matched===N?N:s.string.substr(0,s.prev_pos)}),L(M,"$reset",function(){var s=this;return s.working=s.string,s.matched=N,s.pos=0}),L(M,"$rest",z("working")),L(M,"$rest?",function(){return 0!==this.working.length}),L(M,"$rest_size",function(){return this.$rest().$size()}),L(M,"$terminate",function(){var s,d=this;return d.match=N,s=[d.string.$length()],U(d,"pos=",s),s[s.length-1]}),L(M,"$unscan",function(){var s=this;return s.pos=s.prev_pos,s.prev_pos=N,s.match=N,s}),T(M,"bol?","beginning_of_line?"),T(M,"getch","get_byte"),M.$private(),L(M,"$anchor",function(s){var d=s.toString().match(/\/([^\/]+)$/);return d=d?d[1]:void 0,new RegExp("^(?:"+s.source+")",d)})},Opal.modules["bcdice/normalize"]=function(e){var T,H,N,F=e.module,L=e.eqeqeq,c=e.def,A=e.eqeq,x=[],z=e.nil;return T=x,N=[F(x[0],"BCDice")].concat(T),(H=F(N[0],"Normalize")).$module_function(),c(H,"$comparison_operator",function(M){var S;return L(/<=|=</,S=M)?"<=":L(/>=|=>/,S)?">=":L(/<>|!=|=!/,S)?"!=":L(/</,S)?"<":L(/>/,S)?">":L(/=/,S)?"==":z}),c(H,"$target_number",function(M){return A(M,"?")?M:M.$to_i()})},Opal.modules["bcdice/command/lexer"]=function(e){var W,Q,R,r,$,m,I,s,S,F=e.module,L=e.klass,c=e.const_set,A=e.hash2,x=e.truthy,z=e.send,U=e.def,T=e.thrower,q=e.top,N=[],k=e.nil;return q.$require("strscan"),q.$require("bcdice/normalize"),W=N,Q=S=[F(N[0],"BCDice")].concat(W),R=s=[F(S[0],"Command")].concat(Q),$=[r=L(s[0],null,"Lexer")].concat(R),m=e.$r($),(I=r.$$prototype).scanner=I.notations=k,c($[0],"SYMBOLS",A(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),U(r,"$initialize",function(p,l){var h,f,u;return p=x(u=(h=(f=p)===k||null==f?k:f.$split(" ",2))===k||null==h?k:h.$first())?u:"",this.scanner=m("StringScanner").$new(p),this.notations=z(l,"map",[],function(_){return null==_&&(_=k),x(_["$is_a?"](m("String")))?m("Regexp").$new(_):_})}),U(r,"$next_token",function(){try{var p=T("return"),l=this,h=k,f=k,u=k,b=k;return x(l.scanner["$eos?"]())?[!1,"$"]:(z(l.notations,"each",[],function _(C){var v,D=null==_.$$s?this:_.$$s;if(null==D.scanner&&(D.scanner=k),null==C&&(C=k),v=D.scanner.$scan(C),!x(v))return k;p.$throw(["NOTATION",v])},{$$s:l,$$ret:p}),x(h=l.scanner.$scan(/\d+/))?["NUMBER",h.$to_i()]:x(f=l.scanner.$scan(/[<>!=]+/))?(f=m("Normalize").$comparison_operator(f),[x(f)?"CMP_OP":"ILLEGAL",f]):(u=l.scanner.$getch().$upcase(),[x(b=m("SYMBOLS")["$[]"](u))?b:u.$to_sym(),u]))}catch(_){if(_===p)return _.$v;throw _}}),U(r,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/command/parsed"]=function(e){var q,W,G,s,d,n,R,S,k,F=e.module,L=e.klass,c=e.def,A=e.return_ivar,x=e.truthy,z=[],U=e.nil;return q=z,W=k=[F(z[0],"BCDice")].concat(q),G=S=[F(k[0],"Command")].concat(W),d=[s=L(S[0],null,"Parsed")].concat(G),n=e.$r(d),(R=s.$$prototype).critical=R.fumble=R.dollar=R.modify_number=R.question_target=R.target_number=R.prefix_number=R.command=R.suffix_number=R.cmp_op=U,s.$attr_accessor("command"),s.$attr_accessor("prefix_number"),s.$attr_accessor("suffix_number"),s.$attr_accessor("critical"),s.$attr_accessor("fumble"),s.$attr_accessor("dollar"),s.$attr_accessor("modify_number"),s.$attr_accessor("cmp_op"),s.$attr_accessor("target_number"),s.$attr_writer("question_target"),c(s,"$initialize",function(){var $=this;return $.prefix_number=U,$.suffix_number=U,$.critical=U,$.fumble=U,$.dollar=U,$.cmp_op=U,$.target_number=U,$.question_target=!1}),c(s,"$question_target?",A("question_target")),c(s,"$to_s",function($){var m=this,I=U,E=U,p=U,l=U,h=U;switch(null==$&&($="after_command"),I=x(m.critical)?"@"+m.critical:U,E=x(m.fumble)?"#"+m.fumble:U,p=x(m.dollar)?"$"+m.dollar:U,l=n("Format").$modifier(m.modify_number),h=x(m.question_target)?"?":m.target_number,$){case"after_command":return[m.prefix_number,m.command,m.suffix_number,I,E,p,l,m.cmp_op,h].$join();case"after_modify_number":return[m.prefix_number,m.command,m.suffix_number,l,I,E,p,m.cmp_op,h].$join();case"after_target_number":return[m.prefix_number,m.command,m.suffix_number,l,m.cmp_op,h,I,E,p].$join();default:return U}},-1)},Opal.modules["bcdice/command/parser"]=function(e){var $,p,b,v,a,w,t,o,i,K,X,V,ue,_,C,D,te,h,f,I,F=e.klass,L=e.module,c=e.slice,A=e.extract_kwargs,x=e.ensure_kwargs,z=e.get_kwarg,U=e.send2,T=e.find_super,q=e.def,N=e.send,k=e.eqeq,H=e.thrower,W=e.hash,M=e.const_set,S=e.truthy,y=e.to_ary,Q=e.hash2,G=e.top,s=[],d=e.$r(s),n=e.nil,R=e.$$$;return G.$require("racc/parser.rb"),G.$require("bcdice/arithmetic/node"),G.$require("bcdice/command/lexer"),G.$require("bcdice/command/parsed"),F(R(d("BCDice"),"Command"),R(d("Racc"),"Parser"),"Parser"),$=s,p=I=[L(s[0],"BCDice")].concat($),h=[L(I[0],"Command")].concat(p),f=e.$r(h),b=h,C=[_=F(h[0],R(f("Racc"),"Parser"),"Parser")].concat(b),D=e.$r(C),(te=_.$$prototype).notations=te.lexer=te.modifier=te.suffix_number=te.prefix_number=te.need_suffix_number=te.need_prefix_number=te.critical=te.fumble=te.dollar=te.allowed_cmp_op=te.question_target=n,q(_,"$initialize",function Y(P,Z){var j,B,ee,O,J=this;return Y.$$p=null,j=c(arguments),B=A(j),B=x(B),ee=j,O=z(B,"round_type"),U(J,T(J,"initialize",Y,!1,!0),"initialize",[],null),J.notations=ee,J.round_type=O,J.prefix_number=!1,J.suffix_number=!1,J.need_prefix_number=!1,J.need_suffix_number=!1,J.modifier=!0,J.critical=!1,J.fumble=!1,J.dollar=!1,J.allowed_cmp_op=[n,">=",">","<=","<","==","!="],J.question_target=!1},-2),q(_,"$disable_modifier",function(){return this.modifier=!1,this}),q(_,"$enable_prefix_number",function(){return this.prefix_number=!0,this}),q(_,"$enable_suffix_number",function(){return this.suffix_number=!0,this}),q(_,"$has_prefix_number",function(){var P=this;return P.prefix_number=!0,P.need_prefix_number=!0,P}),q(_,"$has_suffix_number",function(){var P=this;return P.suffix_number=!0,P.need_suffix_number=!0,P}),q(_,"$enable_critical",function(){return this.critical=!0,this}),q(_,"$enable_fumble",function(){return this.fumble=!0,this}),q(_,"$enable_dollar",function(){return this.dollar=!0,this}),q(_,"$restrict_cmp_op_to",function(P){var Z,B=this;return Z=c(arguments),B.allowed_cmp_op=Z,B},-1),q(_,"$enable_question_target",function(){return this.question_target=!0,this}),q(_,"$parse",function(P){var Z=this;try{return Z.lexer=D("Lexer").$new(P,Z.notations),Z.$do_parse()}catch(j){if(!e.rescue(j,[D("ParseError"),D("ZeroDivisionError")]))throw j;try{return n}finally{e.pop_exception()}}}),_.$private(),q(_,"$parsed",function(P,Z,j,B){try{return H("eval_return"),N(D("Parsed").$new(),"tap",[],function re(J){var ae,ce,oe,fe,de,le,me,_e=null==re.$$s?this:re.$$s;return null==_e.round_type&&(_e.round_type=n),null==J&&(J=n),J["$command="](P["$[]"]("command")),J["$prefix_number="]((ae=P["$[]"]("prefix"))===n||null==ae?n:ae.$eval(_e.round_type)),J["$suffix_number="]((ce=P["$[]"]("suffix"))===n||null==ce?n:ce.$eval(_e.round_type)),J["$critical="]((oe=Z["$[]"]("critical"))===n||null==oe?n:oe.$eval(_e.round_type)),J["$fumble="]((fe=Z["$[]"]("fumble"))===n||null==fe?n:fe.$eval(_e.round_type)),J["$dollar="]((de=Z["$[]"]("dollar"))===n||null==de?n:de.$eval(_e.round_type)),J["$modify_number="](j.$eval(_e.round_type)),J["$cmp_op="](B["$[]"]("cmp_op")),k(B["$[]"]("target"),"?")?(J["$question_target="](!0),N(J,"target_number=",le=[0]),le[le.length-1]):(J["$question_target="](!1),le=[(me=B["$[]"]("target"),me===n||null==me?n:me.$eval(_e.round_type))],N(J,"target_number=",le),le[le.length-1])},{$$s:this})}catch(re){if(re===e.t_eval_return)return re.$v;throw re}}),q(_,"$next_token",function(){return this.lexer.$next_token()}),v=e.large_array_unpack("6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,33,34,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,,,17,18,6,,5,,,17,18,,,5,23,24,25,26,56,54,55,57"),a=e.large_array_unpack("0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,,17,15,15,18,18,23,,18,30,30,23,23,24,,23,31,31,24,24,25,,24,44,44,25,25,28,,25,47,47,28,28,29,,28,48,48,29,29,33,,29,49,49,33,33,34,,33,50,50,34,34,36,,34,,,36,36,37,,36,,,37,37,,,37,27,27,27,27,52,52,52,52"),w=e.large_array_unpack("-2,4,16,-3,-1,11,,33,13,35,23,30,1,,28,40,,37,44,,,-2,,51,58,65,0,106,72,79,47,54,,86,93,,100,107,,,,,,,63,,,68,75,82,89,,120,,,,,"),t=e.large_array_unpack("-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29"),o=e.large_array_unpack("30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,,,21,47,48,40,51,52,49,50,44,46,3,,,,13,,,,,,,,32"),i=e.large_array_unpack("8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,,,4,8,8,5,7,7,8,8,9,5,6,,,,6,,,,,,,,6"),K=[n,6,13,3,9,-1,27,-15,-10,-1,-38],X=[n,n,n,n,n,n,19,16,15,n,n],V=e.large_array_unpack("0,0,racc_error,4,20,_reduce_1,4,20,_reduce_2,3,20,_reduce_3,3,21,_reduce_4,2,21,_reduce_5,2,21,_reduce_6,1,21,_reduce_7,0,22,_reduce_8,3,22,_reduce_9,3,22,_reduce_10,3,22,_reduce_11,2,23,_reduce_12,2,23,_reduce_13,3,23,_reduce_14,3,23,_reduce_15,0,24,_reduce_16,2,24,_reduce_17,2,24,_reduce_18,3,28,_reduce_19,3,28,_reduce_20,1,28,_reduce_none,3,27,_reduce_22,4,27,_reduce_23,1,27,_reduce_none,0,29,_reduce_25,1,29,_reduce_26,1,29,_reduce_27,1,29,_reduce_28,1,29,_reduce_29,2,26,_reduce_30,2,26,_reduce_31,1,26,_reduce_none,3,25,_reduce_33,1,25,_reduce_34"),ue=W(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),M(C[0],"Racc_arg",[v,a,t,w,o,i,X,K,19,V,ue,58,35,!0]),M(C[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),M(C[0],"Racc_debug_parser",!1),q(_,"$_reduce_1",function(P,Z,j){var B,O=this;return S(O.modifier)||O.$raise(D("ParseError")),B=y(P),O.$parsed(null==B[0]?n:B[0],null==B[1]?n:B[1],null==B[2]?n:B[2],null==B[3]?n:B[3])}),q(_,"$_reduce_2",function(P,Z,j){var B,O=this;return S(O.modifier)||O.$raise(D("ParseError")),B=y(P),O.$parsed(null==B[0]?n:B[0],null==B[2]?n:B[2],null==B[1]?n:B[1],null==B[3]?n:B[3])}),q(_,"$_reduce_3",function(P,Z,j){var B,ae;return ae=null==(B=y(P))[2]?n:B[2],this.$parsed(null==B[0]?n:B[0],null==B[1]?n:B[1],R(R(D("Arithmetic"),"Node"),"Number").$new(0),ae)}),q(_,"$_reduce_4",function(P,Z,j){var B=this;return S(B.prefix_number)&&S(B.suffix_number)||B.$raise(D("ParseError")),Q(["command","prefix","suffix"],{command:P["$[]"](1),prefix:P["$[]"](0),suffix:P["$[]"](2)})}),q(_,"$_reduce_5",function(P,Z,j){var B=this;return S(B.prefix_number)||B.$raise(D("ParseError")),S(B.need_suffix_number)&&B.$raise(D("ParseError")),Q(["command","prefix"],{command:P["$[]"](1),prefix:P["$[]"](0)})}),q(_,"$_reduce_6",function(P,Z,j){var B=this;return S(B.suffix_number)||B.$raise(D("ParseError")),S(B.need_prefix_number)&&B.$raise(D("ParseError")),Q(["command","suffix"],{command:P["$[]"](0),suffix:P["$[]"](1)})}),q(_,"$_reduce_7",function(P,Z,j){var B=this;return(S(B.need_prefix_number)||S(B.need_suffix_number))&&B.$raise(D("ParseError")),Q(["command"],{command:P["$[]"](0)})}),q(_,"$_reduce_8",function(P,Z,j){return Q([],{})}),q(_,"$_reduce_9",function(P,Z,j){var B,ae,re=n;return re=null==(B=y(P))[0]?n:B[0],ae=null==B[2]?n:B[2],S(this.critical)&&S(re["$[]"]("critical")["$nil?"]())||this.$raise(D("ParseError")),re["$[]="]("critical",ae),re}),q(_,"$_reduce_10",function(P,Z,j){var B,ae,re=n;return re=null==(B=y(P))[0]?n:B[0],ae=null==B[2]?n:B[2],S(this.fumble)&&S(re["$[]"]("fumble")["$nil?"]())||this.$raise(D("ParseError")),re["$[]="]("fumble",ae),re}),q(_,"$_reduce_11",function(P,Z,j){var B,ae,re=n;return re=null==(B=y(P))[0]?n:B[0],ae=null==B[2]?n:B[2],S(this.dollar)&&S(re["$[]"]("dollar")["$nil?"]())||this.$raise(D("ParseError")),re["$[]="]("dollar",ae),re}),q(_,"$_reduce_12",function(P,Z,j){return P["$[]"](1)}),q(_,"$_reduce_13",function(P,Z,j){return R(R(D("Arithmetic"),"Node"),"Negative").$new(P["$[]"](1))}),q(_,"$_reduce_14",function(P,Z,j){return R(R(D("Arithmetic"),"Node"),"BinaryOp").$new(P["$[]"](0),"+",P["$[]"](2))}),q(_,"$_reduce_15",function(P,Z,j){return R(R(D("Arithmetic"),"Node"),"BinaryOp").$new(P["$[]"](0),"-",P["$[]"](2))}),q(_,"$_reduce_16",function(P,Z,j){return S(this.allowed_cmp_op["$include?"](n))||this.$raise(D("ParseError")),Q([],{})}),q(_,"$_reduce_17",function(P,Z,j){var B,re,J;return J=null==(B=y(P))[1]?n:B[1],S(this.allowed_cmp_op["$include?"](re=null==B[0]?n:B[0]))||this.$raise(D("ParseError")),Q(["cmp_op","target"],{cmp_op:re,target:J})}),q(_,"$_reduce_18",function(P,Z,j){var ee,B=this;return ee=P["$[]"](0),S(B.question_target)||B.$raise(D("ParseError")),S(B.allowed_cmp_op["$include?"](ee))||B.$raise(D("ParseError")),Q(["cmp_op","target"],{cmp_op:ee,target:"?"})}),q(_,"$_reduce_19",function(P,Z,j){return R(R(D("Arithmetic"),"Node"),"BinaryOp").$new(P["$[]"](0),"+",P["$[]"](2))}),q(_,"$_reduce_20",function(P,Z,j){return R(R(D("Arithmetic"),"Node"),"BinaryOp").$new(P["$[]"](0),"-",P["$[]"](2))}),q(_,"$_reduce_22",function(P,Z,j){return R(R(D("Arithmetic"),"Node"),"BinaryOp").$new(P["$[]"](0),"*",P["$[]"](2))}),q(_,"$_reduce_23",function(P,Z,j){return P["$[]"](3).$new(P["$[]"](0),P["$[]"](2))}),q(_,"$_reduce_25",function(P,Z,j){return R(R(D("Arithmetic"),"Node"),"DivideWithGameSystemDefault")}),q(_,"$_reduce_26",function(P,Z,j){return R(R(D("Arithmetic"),"Node"),"DivideWithCeil")}),q(_,"$_reduce_27",function(P,Z,j){return R(R(D("Arithmetic"),"Node"),"DivideWithCeil")}),q(_,"$_reduce_28",function(P,Z,j){return R(R(D("Arithmetic"),"Node"),"DivideWithRound")}),q(_,"$_reduce_29",function(P,Z,j){return R(R(D("Arithmetic"),"Node"),"DivideWithFloor")}),q(_,"$_reduce_30",function(P,Z,j){return P["$[]"](1)}),q(_,"$_reduce_31",function(P,Z,j){return R(R(D("Arithmetic"),"Node"),"Negative").$new(P["$[]"](1))}),q(_,"$_reduce_33",function(P,Z,j){return P["$[]"](1)}),q(_,"$_reduce_34",function(P,Z,j){return R(R(D("Arithmetic"),"Node"),"Number").$new(P["$[]"](0))}),q(_,"$_reduce_none",function(P,Z,j){return P["$[]"](0)})},Opal.modules["bcdice/deprecated/checker"]=function(e){var N,M,G,s,d,n,y,H,F=e.module,L=e.send,c=e.eqeqeq,A=e.truthy,x=e.def,z=e.return_val,U=[],T=e.nil;return N=U,M=H=[F(U[0],"BCDice")].concat(N),G=y=[F(H[0],"Deprecated")].concat(M),d=[s=F(y[0],"Checker")].concat(G),n=e.$r(d),s.$private(),x(s,"$check_result_legacy",function(r,$,m,I){var h,E=this,p=T,l=T,f=T,g=T;return p=L($,"map",[],"sides".$to_proc()),h=(l=L($,"map",[],"value".$to_proc())).$sum(),f=c([100],g=p)?E.$check_1D100(r,h,m,I):c([20],g)?E.$check_1D20(r,h,m,I):c([6,6],g)?E.$check_2D6(r,h,l,m,I):T,(A(f["$nil?"]())||A(f["$empty?"]()))&&(f=c([10],g=p.$uniq())?E.$check_nD10(r,h,l,m,I):c([6],g)?E.$check_nD6(r,h,l,m,I):T,A(f["$nil?"]())||A(f["$empty?"]()))?T:n("Result").$new(f.$delete_prefix(" \uff1e "))}),x(s,"$check_1D100",z(T)),x(s,"$check_1D20",z(T)),x(s,"$check_nD10",z(T)),x(s,"$check_2D6",z(T)),x(s,"$check_nD6",z(T))},Opal.modules["bcdice/base"]=function(e){var d,E,g,D,a,w,u,b,_,C,l,F=e.module,L=e.klass,c=e.slice,A=e.rb_plus,x=e.truthy,z=e.def,U=e.regexp,T=e.send,q=e.thrower,N=e.return_ivar,k=e.assign_ivar_val,H=e.eqeqeq,W=e.eqeq,M=e.return_val,S=e.range,y=e.rb_minus,Q=e.rb_divide,G=e.rb_times,s=e.rb_ge,n=e.top,R=[],r=e.$r(R),$=e.nil,m=e.$$$;return n.$require("i18n"),n.$require("i18n/backend/fallbacks"),n.$require("bcdice/randomizer"),n.$require("bcdice/dice_table"),n.$require("bcdice/enum"),n.$require("bcdice/translate"),n.$require("bcdice/result"),n.$require("bcdice/command/parser"),n.$require("bcdice/deprecated/checker"),E=R,g=l=[F(R[0],"BCDice")].concat(E),b=[u=L(l[0],null,"Base")].concat(g),_=e.$r(b),(C=u.$$prototype).raw_input=C.randomizer=C.enabled_upcase_input=C.debug=$,a=[D=e.get_singleton_class(u)].concat(b),w=e.$r(a),D.$attr_reader("prefixes"),z(D,"$register_prefix",function(o){var K,X=this,V=$;return null==X.prefixes&&(X.prefixes=$),K=c(arguments),X.prefixes=A(x(V=X.prefixes)?V:[],K.$flatten())},-1),z(D,"$register_prefix_from_super_class",function(){return this.$register_prefix(this.$superclass().$prefixes())}),z(D,"$prefixes_pattern",function(){var o=this,i=$;return null==o.prefixes_pattern&&(o.prefixes_pattern=$),null==o.prefixes&&(o.prefixes=$),o.prefixes_pattern=x(i=o.prefixes_pattern)?i:$,x(o.prefixes_pattern)?o.prefixes_pattern:(o.prefixes=x(i=o.prefixes)?i:[],o.prefixes.$freeze(),o.prefixes_pattern=(x(o.prefixes["$empty?"]())?/(?!)/:U(["^(S)?(",o.prefixes.$join("|"),")"],"i")).$freeze())}),z(D,"$command_pattern",function(){var o=this,i=$,K=$;return null==o.command_pattern&&(o.command_pattern=$),null==o.prefixes&&(o.prefixes=$),o.command_pattern=x(i=o.command_pattern)?i:$,x(o.command_pattern)?o.command_pattern:(o.prefixes=x(i=o.prefixes)?i:[],o.prefixes.$freeze(),K=A(T(m(w("CommonCommand"),"COMMANDS"),"map",[],function(V){return null==V&&(V=$),m(V,"PREFIX_PATTERN").$source()}),o.prefixes),o.command_pattern=U(["^S?(",K.$join("|"),")"],"i").$freeze())}),z(D,"$eval",function(o){try{return q("eval_return"),this.$new(o).$eval()}catch(X){if(X===e.t_eval_return)return X.$v;throw X}}),u.$include(_("Translate")),u.$include(m(_("Deprecated"),"Checker")),z(u,"$initialize",function(v){var a=this;return a.raw_input=v,a.sort_add_dice=!1,a.sort_barabara_dice=!1,a.d66_sort_type=m(_("D66SortType"),"NO_SORT"),a.enabled_d9=!1,a.round_type=m(_("RoundType"),"FLOOR"),a.sides_implicit_d=6,a.upper_dice_reroll_threshold=$,a.reroll_dice_reroll_threshold=$,a.default_cmp_op=$,a.default_target_number=$,a.enabled_upcase_input=!0,a.locale="ja_jp",a.randomizer=m(_("BCDice"),"Randomizer").$new(),a.debug=!1}),u.$attr_accessor("randomizer"),u.$attr_reader("d66_sort_type"),u.$attr_reader("round_type"),u.$attr_reader("sides_implicit_d"),u.$attr_reader("upper_dice_reroll_threshold"),u.$attr_reader("reroll_dice_reroll_threshold"),u.$attr_reader("default_cmp_op"),u.$attr_reader("default_target_number"),z(u,"$sort_add_dice?",N("sort_add_dice")),z(u,"$sort_barabara_dice?",N("sort_barabara_dice")),z(u,"$enabled_d9?",N("enabled_d9")),z(u,"$enable_debug",k("debug",!0)),z(u,"$eval",function(){var a,t,v=this,w=$;return a=m(_("BCDice"),"Preprocessor").$process(v.raw_input,v),w=x(t=v.$dice_command(a))?t:v.$eval_common_command(v.raw_input),x(w)?(w["$rands="](v.randomizer.$rand_results()),w["$detailed_rands="](v.randomizer.$detailed_rand_results()),w):$}),z(u,"$change_text",function(v){return v}),z(u,"$check_result",function(v,a,w,t){var o=this,i=$,K=$,X=$,V=$,ne=$;return i=o.$check_result_legacy(v,a,w,t),x(i)?i:(K=T(a,"map",[],"sides".$to_proc()),V=(X=T(a,"map",[],"value".$to_proc())).$sum(),i=H([100],ne=K)?o.$result_1d100(v,V,w,t):H([20],ne)?o.$result_1d20(v,V,w,t):H([6,6],ne)?o.$result_2d6(v,V,X,w,t):$,W(i,_("Result").$nothing())?$:x(i)?i:(i=H([10],ne=K.$uniq())?o.$result_nd10(v,V,X,w,t):H([6],ne)?o.$result_nd6(v,V,X,w,t):$,W(i,_("Result").$nothing())?$:x(i)?i:o.$result_ndx(v,w,t)))}),z(u,"$grich_text",M($)),u.$private(),z(u,"$eval_common_command",function(v){try{q("eval_return");var w=q("return");return v=this.$change_text(v),T(m(_("CommonCommand"),"COMMANDS"),"each",[],function o(i){var X,K=null==o.$$s?this:o.$$s;if(null==K.randomizer&&(K.randomizer=$),null==i&&(i=$),X=i.$eval(v,K,K.randomizer),!x(X))return $;w.$throw(X)},{$$s:this,$$ret:w}),$}catch(o){if(o===e.t_eval_return||o===w)return o.$v;throw o}}),z(u,"$dice_command",function(v){var a=this,w=$,t=$,o=$,i=$;return x(a.enabled_upcase_input)&&(v=v.$upcase()),w=a.$class().$prefixes_pattern().$match(v),x(w)?(t=w["$[]"](1)["$nil?"]()["$!"](),x(t)&&(v=v["$[]"](S(1,-1,!1))),o=a.$eval_game_system_specific_command(v),x(o["$is_a?"](_("Result")))?(o["$secret="](x(i=o["$secret?"]())?i:t),o):x(o["$nil?"]())||x(o["$empty?"]())||W(o,"1")?$:T(_("Result").$new(),"tap",[],function(X){var V;return null==X&&(X=$),X["$text="](o.$to_s()),T(X,"secret=",V=[t]),V[V.length-1]})):$}),z(u,"$eval_game_system_specific_command",M($)),z(u,"$result_ndx",function(v,a,w){return x(w["$is_a?"](_("String")))?$:x(v.$send(a,w))?_("Result").$success(this.$translate("success")):_("Result").$failure(this.$translate("failure"))}),z(u,"$result_1d100",M($)),z(u,"$result_1d20",M($)),z(u,"$result_nd10",M($)),z(u,"$result_2d6",M($)),z(u,"$result_nd6",M($)),z(u,"$get_table_by_2d6",function(v){return this.$get_table_by_nD6(v,2)}),z(u,"$get_table_by_1d6",function(v){return this.$get_table_by_nD6(v,1)}),z(u,"$get_table_by_nD6",function(v,a){return this.$get_table_by_nDx(v,a,6)}),z(u,"$get_table_by_nDx",function(v,a,w){var o,i=$;return o=this.randomizer.$roll_sum(a,w),i=this.$get_table_value(v["$[]"](y(o,a))),x(i["$nil?"]())?["1",0]:[i,o]}),z(u,"$get_table_by_1d3",function(v){var t,o,a=this,i=$;return a.$debug("get_table_by_1d3"),t=a.randomizer.$roll_sum(1,6),a.$debug("num",t),o=Q(y(t,1),2).$to_i(),a.$debug("index",o),i=v["$[]"](o),x(i["$nil?"]())?["1",0]:[i,t]}),z(u,"$get_table_by_d66_swap",function(v){var w;return w=this.randomizer.$roll_d66(m(_("D66SortType"),"ASC")),[this.$get_table_by_number(w,v),w]}),z(u,"$get_table_by_d66",function(v){var w,t,o,K,i=$;return w=this.randomizer.$roll_once(6),t=this.randomizer.$roll_once(6),o=A(G(y(w,1),6),y(t,1)),i=v["$[]"](o),K=""+w+t,x(i["$nil?"]())?["1",K]:[i,K]}),z(u,"$get_table_by_number",function(v,a,w){try{var t=q("return");return null==w&&(w="1"),T(a,"each",[],function i(K){var V,X=null==i.$$s?this:i.$$s;if(null==K&&(K=$),V=K["$[]"](0),!x(s(V,v)))return $;t.$throw(X.$get_table_value(K["$[]"](1)))},{$$s:this,$$ret:t}),this.$get_table_value(w)}catch(i){if(i===t)return i.$v;throw i}},-3),z(u,"$get_table_value",function(v){return x(v["$is_a?"](_("Proc")))?v.$call():v}),z(u,"$roll_tables",function(v,a){var t=$;return t=a["$[]"](v),x(t)?t.$roll(this.randomizer).$to_s():$}),z(u,"$debug",function(v,a){var t,o=this,i=$,K=$;return t=c(arguments,1),x(o.debug)?(i=x(v["$is_a?"](_("String")))?v:v.$inspect(),x(t["$empty?"]())?o.$warn(i):(K=T(t,"map",[],function(V){return null==V&&(V=$),x(V["$is_a?"](_("String")))?'"'+V+'"':V.$inspect()}),o.$warn(i+": "+K.$join(", ")))):$},-2),m(m(r("I18n"),"Backend"),"Simple").$include(m(m(r("I18n"),"Backend"),"Fallbacks")),r("I18n").$load_path()["$<<"](r("Dir")["$[]"](r("File").$join("bcdice","../../i18n/**/*.yml"))),r("I18n")["$default_locale="]("ja_jp"),d=[["ja_jp"]],T(r("I18n").$fallbacks(),"defaults=",d),d[d.length-1]},Opal.queue(function(e){var G,R,p,l,h,f,$,m,d,F=e.module,L=e.klass,c=e.const_set,A=e.hash2,x=e.send2,z=e.find_super,U=e.def,T=e.truthy,q=e.send,N=e.rb_ge,k=e.rb_gt,H=e.rb_plus,M=[],S=e.nil,y=e.$$$;return e.top.$require("bcdice/base"),G=M,R=d=[F(M[0],"BCDice")].concat(G),$=[F(d[0],"GameSystem")].concat(R),m=e.$r($),p=$,h=[l=L($[0],m("Base"),"ConvictorDrive")].concat(p),f=e.$r(h),l.$$prototype.randomizer=S,c(h[0],"ID","ConvictorDrive"),c(h[0],"NAME","\u30b3\u30f3\u30f4\u30a3\u30af\u30bf\u30fc\u30fb\u30c9\u30e9\u30a4\u30d6"),c(h[0],"SORT_KEY","\u3053\u3093\u3046\u3044\u304f\u305f\u3042\u3068\u3089\u3044\u3075"),c(h[0],"HELP_MESSAGE","xCD@z>=y: x\u500b\u306e10\u9762\u30c0\u30a4\u30b9\u3067\u76ee\u6a19\u5024y\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u30e9\u30a4\u30f3z\u306e\u5224\u5b9a\u3092\u884c\u3046\nSLT: \u6280\u80fd\u30ec\u30d9\u30eb\u8868\u3092\u632f\u308b\nDCT: \u9045\u5ef6\u30a4\u30d9\u30f3\u30c8\u8868\u3092\u632f\u308b\n"),c(h[0],"TABLES",A(["SLT","DCT"],{SLT:y(f("DiceTable"),"Table").$new("\u6280\u80fd\u30e9\u30f3\u30af\u8868","2D10",["\u30e9\u30f3\u30af\u5916","E-","E","E+","D-","D","D+","C-","C","C+","B-","B","B+","A-","A","A+","S-","S","S+"]),DCT:y(f("DiceTable"),"Table").$new("\u9045\u5ef6\u30a4\u30d9\u30f3\u30c8\u8868","1D10",["\u72b6\u6cc1\u9045\u5ef6\u2160\uff08\u5168\u54e1\u306e\u521d\u671f\u30ea\u30bd\u30fc\u30b9\u3092-1\u3059\u308b\uff09","\u72b6\u6cc1\u9045\u5ef6\u2161\uff08\u5168\u54e1\u306e\u521d\u671f\u30ea\u30bd\u30fc\u30b9\u3092-1\u3059\u308b\uff09","\u72b6\u6cc1\u9045\u5ef6\u2162\uff08\u5168\u54e1\u306e\u521d\u671f\u30ea\u30bd\u30fc\u30b9\u3092-2\u3059\u308b\uff09","\u6b66\u88c5\u3092\u8a31\u3059\u2160\uff08\u30dc\u30b9\u306e\u653b\u6483\u30c0\u30a4\u30b9\u3092+1d\u3059\u308b\uff09","\u6b66\u88c5\u3092\u8a31\u3059\u2161\uff08\u8105\u5a01\u5ea64\u4ee5\u4e0b\u306e\u30a8\u30cd\u30df\u30fc\u306e\u653b\u6483\u30c0\u30a4\u30b9\u30922\u4f53\u307e\u3067+1d\u3059\u308b\uff09","\u6b66\u88c5\u3092\u8a31\u3059\u2162\uff08\u8105\u5a01\u5ea63\u4ee5\u4e0b\u306e\u30a8\u30cd\u30df\u30fc\u306e\u653b\u6483\u30c0\u30a4\u30b9\u30921\u4f53+2d\u3059\u308b\uff09","\u7dca\u6025\u51fa\u6483\u2160\uff08\u30e9\u30f3\u30c0\u30e0\u306aPC\u306eHP\u3092-1\u3059\u308b\uff09","\u7dca\u6025\u51fa\u6483\u2161\uff08\u30e9\u30f3\u30c0\u30e0\u306aPC\u306eHP\u3092-1\u3059\u308b\uff09","\u7dca\u6025\u51fa\u6483\u2162\uff08\u30e9\u30f3\u30c0\u30e0\u306aPC2\u4eba\u306eHP\u3092-1\u3059\u308b\uff09","\u7d76\u671b\uff08\u30c0\u30a4\u30b9\u3092\u4e8c\u5ea6\u632f\u308a\u3001\u4e8c\u3064\u9069\u7528\u3059\u308b\uff09"])}).$freeze()),l.$register_prefix("[-+*0-9()]*CD",f("TABLES").$keys()),U(l,"$initialize",function u(b){var C=this;return u.$$p=null,x(C,z(C,"initialize",u,!1,!0),"initialize",[b],null),C.sides_implicit_d=10}),U(l,"$eval_game_system_specific_command",function(b){var C,_=this;return _.$debug("eval_game_system_specific_command Begin"),T(C=_.$roll_command(b))?C:_.$roll_tables(b,f("TABLES"))}),U(l,"$roll_command",function(b){var _,D=S,v=S,a=S,w=S,t=S,o=S,i=S,K=S;return D=y(f("Command"),"Parser").$new("CD",A(["round_type"],{round_type:this.$round_type()})).$has_prefix_number().$enable_critical().$restrict_cmp_op_to(">="),v=D.$parse(b),T(v)?(a=this.randomizer.$roll_barabara(v.$prefix_number(),10),w=T(t=(_=v.$critical())===S||null==_?S:_.$clamp(v.$target_number(),10))?t:10,o=q(a,"count",[],function(V){return null==V&&(V=S),N(V,v.$target_number())}),i=q(a,"count",[],function(V){return null==V&&(V=S),N(V,w)}),K=[v.$to_s(),a.$join(","),T(k(i,0))?"\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u6570"+i:S,"\u6210\u529f\u6570"+H(o,i)].$compact().$join(" \uff1e "),q(f("Result").$new(),"tap",[],function(V){var ne;return null==V&&(V=S),V["$success="](k(o,0)),V["$critical="](k(i,0)),q(V,"text=",ne=[K]),ne[ne.length-1]})):S})})}}]);