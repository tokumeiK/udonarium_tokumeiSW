(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[2250],{2255:(be,he,ve)=>{ve(9993),Opal.modules["i18n/backend/fallbacks"]=function(e){var G,n,r,a,s,d,F=e.module,L=e.class_variable_set,c=e.truthy,B=e.class_variable_get,x=e.def,S=e.send,U=e.send2,E=e.find_super,z=e.hash2,P=e.find_block_super,D=e.neqeq,H=e.thrower,Y=e.return_val,M=[],N=e.nil,m=e.$$$;return G=M,d=[s=F(M[0],"I18n")].concat(G),L(d[0],"@@fallbacks",N),n=e.get_singleton_class(s),r=[n].concat(d),a=e.$r(r),x(n,"$fallbacks",function(){var T=N;return L(r[1],"@@fallbacks",c(null!=r[1].$$cvars["@@fallbacks"]?"class variable":N)&&c(T=B(r[1],"@@fallbacks",!1))?T:m(m(a("I18n"),"Locale"),"Fallbacks").$new()),c(T=a("Thread").$current()["$[]"]("i18n_fallbacks"))?T:B(r[1],"@@fallbacks",!1)}),x(n,"$fallbacks=",function(I){var T;return L(r[1],"@@fallbacks",c(I["$is_a?"](a("Array")))?m(m(a("I18n"),"Locale"),"Fallbacks").$new(I):I),T=["i18n_fallbacks",B(r[1],"@@fallbacks",!1)],S(a("Thread").$current(),"[]=",T),T[T.length-1]}),function(n,q){var I,T,k,l,a=[F(n,"Backend")].concat(q);return I=a,k=[T=F(a[0],"Fallbacks")].concat(I),l=e.$r(k),x(T,"$translate",function p(f,h,u){try{var y=H("return"),_=p.$$p||N,w=this,R=N,b=N;return p.$$p=null,null==u&&(u=l("EMPTY_HASH")),c(u.$fetch("fallback",!0))?c(u["$[]"]("fallback_in_progress"))?U(w,E(w,"translate",p,!1,!0),"translate",[f,h,u],_):(c(u["$[]"]("default"))&&(R=w["$extract_non_symbol_default!"](u)),b=u.$merge(z(["fallback_in_progress"],{fallback_in_progress:!0})),S(l("I18n").$fallbacks()["$[]"](f),"each",[],function i(g){var t=null==i.$$s?this:i.$$s;null==g&&(g=N);try{return S(t,"catch",["exception"],function o(){var $=null==o.$$s?this:o.$$s,W=N;if(W=U($,P($,"translate",o.$$def||i.$$def||p,!1,!1),"translate",[g,h,b],null),c(W["$nil?"]()))return N;D(f.$to_s(),g.$to_s())&&$.$on_fallback(f,g,h,u),y.$throw(W)},{$$s:t,$$ret:y})}catch(o){if(!e.rescue(o,[m(l("I18n"),"InvalidLocale")]))throw o;try{return N}finally{e.pop_exception()}}},{$$s:w}),c(u["$key?"]("default"))&&c(u["$[]"]("default")["$nil?"]())?N:c(R)?U(w,E(w,"translate",p,!1,!0),"translate",[f,N,u.$merge(z(["default"],{default:R}))],null):w.$throw("exception",m(l("I18n"),"MissingTranslation").$new(f,h,u))):U(w,E(w,"translate",p,!1,!0),"translate",[f,h,u],_)}catch(i){if(i===y)return i.$v;throw i}},-3),x(T,"$extract_non_symbol_default!",function(f){var u,h=N;return h=[f["$[]"]("default")].$flatten(),u=S(h,"detect",[],function(_){return null==_&&(_=N),_["$is_a?"](l("Symbol"))["$!"]()}),c(u)&&f["$[]="]("default",h["$[]"](0,h.$index(u))),u}),x(T,"$exists?",function p(f,h,u){try{var y=H("return"),_=p.$$p||N,w=this;return p.$$p=null,null==u&&(u=l("EMPTY_HASH")),c(u.$fetch("fallback",!0))?(S(l("I18n").$fallbacks()["$[]"](f),"each",[],function R(b){var i=null==R.$$s?this:R.$$s;null==b&&(b=N);try{if(!c(U(i,P(i,"exists?",R.$$def||p,!1,!1),"exists?",[b,h],null)))return N;y.$throw(!0)}catch(g){if(!e.rescue(g,[m(l("I18n"),"InvalidLocale")]))throw g;try{return N}finally{e.pop_exception()}}},{$$s:w,$$ret:y}),!1):U(w,E(w,"exists?",p,!1,!0),"exists?",[f,h,u],_)}catch(R){if(R===y)return R.$v;throw R}},-3),T.$private(),x(T,"$on_fallback",Y(N))}(d[0],d)},Opal.modules["bcdice/randomizer"]=function(e){var s,v,I,T,k,l,n,q,L=e.klass,c=e.const_set,B=e.def,x=e.truthy,S=e.rb_gt,U=e.rb_plus,E=e.rb_le,z=e.send,P=e.rb_minus,D=e.eqeq,H=e.rb_times,Y=e.eqeqeq,M=e.rb_ge,N=[],m=e.nil,V=e.$$$;return s=N,n=[(0,e.module)(N[0],"BCDice")].concat(s),q=e.$r(n),v=n,T=[I=L(n[0],null,"Randomizer")].concat(v),k=e.$r(T),(l=I.$$prototype).rand_results=l.detailed_rand_results=m,c(T[0],"UPPER_LIMIT_DICE_TIMES",200),c(T[0],"UPPER_LIMIT_DICE_SIDES",1e4),c(T[0],"UPPER_LIMIT_RANDS",1e4),B(I,"$initialize",function(){return this.rand_results=[],this.detailed_rand_results=[]}),I.$attr_reader("rand_results"),I.$attr_reader("detailed_rand_results"),c(T[0],"DetailedRandResult",k("Struct").$new("kind","sides","value")),B(I,"$roll_barabara",function(f,h){var u=this;return x(S(U(u.rand_results.$size(),f),k("UPPER_LIMIT_RANDS")))&&u.$raise(k("TooManyRandsError")),x(E(f,0))||x(S(f,k("UPPER_LIMIT_DICE_TIMES")))?[]:z(k("Array"),"new",[f],function y(){return(null==y.$$s?this:y.$$s).$roll_once(h)},{$$s:u})}),B(I,"$roll_sum",function(f,h){return this.$roll_barabara(f,h).$sum()}),B(I,"$roll_once",function(f){var u=m;return x(E(f,0))||x(S(f,k("UPPER_LIMIT_DICE_SIDES")))?0:(u=this.$rand_inner(f),this.$push_to_detail("normal",f,u),u)}),B(I,"$roll_index",function(f){return P(this.$roll_once(f),1)}),B(I,"$roll_tens_d10",function(){var u,h=m;return h=this.$rand_inner(10),D(h,10)&&(h=0),u=H(h,10),this.$push_to_detail("tens_d10",10,u),u}),B(I,"$roll_d9",function(){var h;return h=P(this.$rand_inner(10),1),this.$push_to_detail("d9",10,h),h}),B(I,"$roll_d66",function(f){var y,u=m;return u=z(k("Array"),"new",[2],function _(){return(null==_.$$s?this:_.$$s).$roll_once(6)},{$$s:this}),Y(V(k("D66SortType"),"ASC"),y=f)?u["$sort!"]():Y(V(k("D66SortType"),"DESC"),y)&&u["$sort!"]()["$reverse!"](),U(H(u["$[]"](0),10),u["$[]"](1))}),I.$private(),B(I,"$rand_inner",function(f){var u,h=this;return x(M(h.rand_results.$size(),k("UPPER_LIMIT_RANDS")))&&h.$raise(k("TooManyRandsError")),u=h.$random(f),h.rand_results["$<<"]([u,f]),u}),B(I,"$random",function(f){return U(k("Kernel").$rand(f),1)}),B(I,"$push_to_detail",function(f,h,u){var _;return _=k("DetailedRandResult").$new(f,h,u),this.detailed_rand_results.$push(_)}),L(n[0],q("StandardError"),"TooManyRandsError"),m},Opal.modules["bcdice/dice_table/roll_result"]=function(e){var z,Y,G,s,d,n,q,N,D,F=e.module,L=e.klass,c=e.def,B=e.truthy,x=e.return_val,S=[],U=e.nil;return z=S,Y=D=[F(S[0],"BCDice")].concat(z),G=N=[F(D[0],"DiceTable")].concat(Y),d=[s=L(N[0],null,"RollResult")].concat(G),n=e.$r(d),(q=s.$$prototype).table_name=q.value=q.body=U,c(s,"$initialize",function(a,v,I){var T=this;return T.table_name=a,T.value=v,T.body=I}),s.$attr_reader("table_name"),s.$attr_reader("value"),s.$attr_reader("body"),c(s,"$to_s",function(){var a=this;return a.table_name+"("+a.value+") \uff1e "+a.body}),c(s,"$last_body",function(){var a=this;return B(a.body["$is_a?"](n("RollResult")))?a.body.$last_body():a.body}),c(s,"$empty?",x(!1))},Opal.modules["bcdice/dice_table/chain_table"]=function(e){var z,Y,G,s,d,n,q,N,D,F=e.module,L=e.klass,c=e.truthy,B=e.def,x=e.rb_minus,S=[],U=e.nil;return z=S,Y=D=[F(S[0],"BCDice")].concat(z),G=N=[F(D[0],"DiceTable")].concat(Y),d=[s=L(N[0],null,"ChainTable")].concat(G),n=e.$r(d),(q=s.$$prototype).times=q.sides=q.items=q.name=U,B(s,"$initialize",function(a,v,I){var T=this,k=U;return T.name=a,T.items=I.$freeze(),k=/(\d+)D(\d+)/i.$match(v),c(k)||T.$raise(n("ArgumentError"),"Unexpected table type: "+v),T.times=k["$[]"](1).$to_i(),T.sides=k["$[]"](2).$to_i()}),B(s,"$roll",function(a){var I,T,v=this,k=U;return I=a.$roll_sum(v.times,v.sides),T=x(I,v.times),k=v.items["$[]"](T),c(k["$respond_to?"]("roll"))&&(k=k.$roll(a)),n("RollResult").$new(v.name,I,k)})},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(e){var H,m,n,q,r,a,v,G,M,F=e.module,L=e.klass,c=e.hash2,B=e.defs,x=e.def,S=e.rb_plus,U=e.rb_times,E=e.rb_minus,z=[],P=e.nil;return H=z,m=M=[F(z[0],"BCDice")].concat(H),n=G=[F(M[0],"DiceTable")].concat(m),r=[q=L(G[0],null,"D66GridTable")].concat(n),a=e.$r(r),(v=q.$$prototype).name=v.items=P,B(q,"$from_i18n",function(T,k){var p=P;return p=a("I18n").$t(T,c(["locale","raise"],{locale:k,raise:!0})),this.$new(p["$[]"]("name"),p["$[]"]("items"))}),x(q,"$initialize",function(T,k){return this.name=T,this.items=k.$freeze()}),x(q,"$roll",function(T){var l,p,f,h,u;return l=T.$roll_once(6),p=T.$roll_once(6),f=S(U(l,10),p),h=E(l,1),u=E(p,1),a("RollResult").$new(this.name,f,this.items["$[]"](h)["$[]"](u))})},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(e){var P,M,d,n,q,r,m,V,H,F=e.module,L=e.klass,c=e.hash2,B=e.defs,x=e.def,U=[],E=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),P=U,M=H=[F(U[0],"BCDice")].concat(P),m=[F(H[0],"DiceTable")].concat(M),V=e.$r(m),d=m,q=[n=L(m[0],V("D66GridTable"),"D66HalfGridTable")].concat(d),r=e.$r(q),B(n,"$from_i18n",function(v,I){var k=E;return k=r("I18n").$t(v,c(["locale","raise"],{locale:I,raise:!0})),this.$new(k["$[]"]("name"),k["$[]"]("items_1_2_3"),k["$[]"]("items_4_5_6"))}),x(n,"$initialize",function(v,I,T){return this.name=v,this.items=[I,I,I,T,T,T].$freeze()})},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(e){var P,M,d,n,q,r,m,V,H,F=e.module,L=e.klass,c=e.hash2,B=e.defs,x=e.def,U=[],E=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),P=U,M=H=[F(U[0],"BCDice")].concat(P),m=[F(H[0],"DiceTable")].concat(M),V=e.$r(m),d=m,q=[n=L(m[0],V("D66GridTable"),"D66OneThirdTable")].concat(d),r=e.$r(q),B(n,"$from_i18n",function(v,I){var k=E;return k=r("I18n").$t(v,c(["locale","raise"],{locale:I,raise:!0})),this.$new(k["$[]"]("name"),k["$[]"]("items_1_2"),k["$[]"]("items_3_4"),k["$[]"]("items_5_6"))}),x(n,"$initialize",function(v,I,T,k){return this.name=v,this.items=[I,I,T,T,k,k].$freeze()})},Opal.modules["bcdice/dice_table/d66_table"]=function(e){var M,G,r,a,v,I,T,d,m,F=e.module,L=e.klass,c=e.hash2,B=e.defs,x=e.def,S=e.eqeqeq,U=e.rb_plus,E=e.rb_times,z=e.truthy,P=[],D=e.nil,H=e.$$$;return M=P,G=m=[F(P[0],"BCDice")].concat(M),r=d=[F(m[0],"DiceTable")].concat(G),v=[a=L(d[0],null,"D66Table")].concat(r),I=e.$r(v),(T=a.$$prototype).sort_type=T.items=T.name=D,B(a,"$from_i18n",function(l,p){var u,h=D;return h=I("I18n").$t(l,c(["locale"],{locale:p})),u=I("D66SortType").$const_get(h["$[]"]("d66_sort_type")),this.$new(h["$[]"]("name"),u,h["$[]"]("items"))}),x(a,"$initialize",function(l,p,f){var h=this;return h.name=l,h.sort_type=p,h.items=f.$freeze()}),x(a,"$roll",function(l){var p=this,f=D,h=D,u=D,y=D;return f=l.$roll_barabara(2,6),S(H(I("D66SortType"),"ASC"),h=p.sort_type)?f["$sort!"]():S(H(I("D66SortType"),"DESC"),h)&&f["$sort!"]()["$reverse!"](),u=U(E(f["$[]"](0),10),f["$[]"](1)),y=z(h=p.items["$[]"](u))?h:p.items["$[]"](u.$to_s()),z(y["$respond_to?"]("roll"))&&(y=y.$roll(l)),I("RollResult").$new(p.name,u,y)}),x(a,"$choice",function(l){return I("RollResult").$new(this.name,l,this.items["$[]"](l))})},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(e){var N,s,n,q,V,F=e.module,L=e.klass,c=e.hash2,B=e.send,x=e.to_ary,S=e.rb_plus,U=e.rb_times,E=e.send2,z=e.find_super,P=e.def,H=[],Y=e.nil;return e.top.$require("bcdice/dice_table/d66_table"),N=H,s=V=[F(H[0],"BCDice")].concat(N),n=[F(V[0],"DiceTable")].concat(s),q=e.$r(n),P(L(n[0],q("D66Table"),"D66LeftRangeTable"),"$initialize",function I(T,k,l){var h;return I.$$p=null,h=c([],{}),B(l,"each",[],function(y){var _,b;return null==y&&(y=Y),_=x(y),b=null==_[1]?Y:_[1],B(null==_[0]?Y:_[0],"each",[],function(g){return null==g&&(g=Y),B(b,"each_with_index",[],function(o,$){var W,X;return null==o&&(o=Y),null==$&&($=Y),X=S(U(g,10),S($,1)),B(h,"[]=",W=[X,o]),W[W.length-1]})})}),E(this,z(this,"initialize",I,!1,!0),"initialize",[T,k,h],null)})},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(e){var Y,V,q,r,a,v,I,s,N,F=e.module,L=e.klass,c=e.hash2,B=e.defs,x=e.def,S=e.truthy,U=e.rb_minus,E=e.rb_plus,z=e.rb_times,P=[],D=e.nil;return Y=P,V=N=[F(P[0],"BCDice")].concat(Y),q=s=[F(N[0],"DiceTable")].concat(V),a=[r=L(s[0],null,"D66ParityTable")].concat(q),v=e.$r(a),(I=r.$$prototype).odd=I.even=I.name=D,B(r,"$from_i18n",function(k,l){var f=D;return f=v("I18n").$t(k,c(["locale","raise"],{locale:l,raise:!0})),this.$new(f["$[]"]("name"),f["$[]"]("odd"),f["$[]"]("even"))}),x(r,"$initialize",function(k,l,p){var f=this;return f.name=k,f.odd=l.$freeze(),f.even=p.$freeze()}),x(r,"$roll",function(k){var f,u,y,l=this,p=D;return p=k.$roll_once(6),f=k.$roll_once(6),u=(S(p["$odd?"]())?l.odd:l.even)["$[]"](U(f,1)),y=E(z(p,10),f),v("RollResult").$new(l.name,y,u)})},Opal.modules["bcdice/dice_table/d66_range_table"]=function(e){var P,M,s,d,n,q,r,m,H,F=e.module,L=e.klass,c=e.def,B=e.rb_plus,x=e.rb_times,S=e.send,U=[],E=e.nil;return P=U,M=H=[F(U[0],"BCDice")].concat(P),s=m=[F(H[0],"DiceTable")].concat(M),n=[d=L(m[0],null,"D66RangeTable")].concat(s),q=e.$r(n),(r=d.$$prototype).items=r.name=E,c(d,"$initialize",function(v,I){return this.name=v,this.items=I.$freeze()}),c(d,"$roll",function(v){var T,k,l,p=E;return T=v.$roll_once(6),k=v.$roll_once(6),l=B(x(T,10),k),p=S(this.items,"find",[],function(h){return null==h&&(h=E),h["$[]"](0)["$include?"](l)}),q("RollResult").$new(this.name,l,p["$[]"](1))})},Opal.modules["bcdice/dice_table/range_table"]=function(e){var Y,V,q,r,a,v,I,s,N,F=e.module,L=e.klass,c=e.const_set,B=e.send,x=e.truthy,S=e.def,U=e.eqeqeq,E=e.rb_times,z=e.rb_plus,P=[],D=e.nil;return Y=P,V=N=[F(P[0],"BCDice")].concat(Y),q=s=[F(N[0],"DiceTable")].concat(V),a=[r=L(s[0],null,"RangeTable")].concat(q),v=e.$r(a),(I=r.$$prototype).name=I.items=I.num_of_dice=I.num_of_sides=I.formatter=D,c(a[0],"RollResult",B(v("Struct"),"new",["sum","values","content","formatted"],function T(){return(null==T.$$s?this:T.$$s).$alias_method("to_s","formatted")},{$$s:r})),c(a[0],"Item",v("Struct").$new("range","content")),c(a[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),c(a[0],"DEFAULT_FORMATTER",B(r,"lambda",[],function(k,l){return null==k&&(k=D),null==l&&(l=D),k.$name()+"("+l.$sum()+") \uff1e "+l.$content()})),r.$attr_reader("name"),r.$attr_reader("num_of_dice"),r.$attr_reader("num_of_sides"),S(r,"$initialize",function T(k,l,p){var u,f=T.$$p||D,h=this,y=D;return T.$$p=null,h.name=k.$freeze(),h.formatter=x(u=f)?u:v("DEFAULT_FORMATTER"),y=v("DICE_ROLL_METHOD_RE").$match(l),x(y)||h.$raise(v("ArgumentError"),h.name+": invalid dice roll method: "+l),h.num_of_dice=y["$[]"](1).$to_i(),h.num_of_sides=y["$[]"](2).$to_i(),h.$store(p)}),S(r,"$fetch",function(k){var p,l=this;return p=B(l.items,"find",[],function(h){return null==h&&(h=D),h.$range()["$include?"](k)}),x(p)||l.$raise(v("RangeError"),l.name+": value is out of range: "+k),p}),S(r,"$roll",function(k){var f,l=this,p=D,h=D;return f=(p=k.$roll_barabara(l.num_of_dice,l.num_of_sides)).$sum(),(h=v("RollResult").$new(f,p,l.$fetch(f).$content()))["$formatted="](l.formatter["$[]"](l,h)),h}),r.$private(),S(r,"$store",function(k){var p,f,l=this;return p=B(k,"map",[],function h(u,y){return null==u&&(u=D),null==y&&(y=D),[(null==h.$$s?this:h.$$s).$coerce_to_int_range(u),y]},{$$s:l}),f=B(p,"sort_by",[],function(u,y){return null==u&&(u=D),null==y&&(y=D),u.$min()}),l.$assert_min_sum_is_covered(f),l.$assert_max_sum_is_covered(f),l.$assert_no_gap_or_overlap_in_ranges(f),l.items=B(f,"map",[],function(u,y){return null==u&&(u=D),null==y&&(y=D),v("Item").$new(u,y.$freeze()).$freeze()}).$freeze(),l}),S(r,"$coerce_to_int_range",function(k){var p;return U(v("Integer"),p=k)?v("Range").$new(k,k):U(v("Range"),p)&&x(k.$begin()["$is_a?"](v("Integer")))&&x(k.$end()["$is_a?"](v("Integer")))?k:this.$raise(v("TypeError"),this.name+": "+k+" ("+k.$class()+") must be an Integer or a Range with Integers ")}),S(r,"$assert_min_sum_is_covered",function(k){var p,l=this,f=D;return p=l.num_of_dice,f=k.$first()["$[]"](0),x(f["$include?"](p))||l.$raise(v("RangeError"),l.name+": min value ("+p+") is not covered: "+f),l}),S(r,"$assert_max_sum_is_covered",function(k){var p,l=this,f=D;return p=E(l.num_of_dice,l.num_of_sides),f=k.$last()["$[]"](0),x(f["$include?"](p))||l.$raise(v("RangeError"),l.name+": max value ("+p+") is not covered: "+f),l}),S(r,"$assert_no_gap_or_overlap_in_ranges",function(k){return B(k,"each_cons",[2],function p(f,h){var w,R,u=null==p.$$s?this:p.$$s,y=D,_=D;return null==u.name&&(u.name=D),null==f&&(f=D),null==h&&(h=D),y=f["$[]"](0),_=h["$[]"](0),w=y.$max(),R=z(w,1),x(_["$include?"](w))&&u.$raise(v("RangeError"),u.name+": Range overlap: "+y+" and "+_),x(_["$include?"](R))?D:u.$raise(v("RangeError"),u.name+": Range gap: "+y+" and "+_)},{$$s:this}),this})},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(e){var D,N,d,v,I,T,k,q,V,Y,F=e.module,L=e.klass,c=e.send,B=e.def,x=e.rb_minus,S=e.return_ivar,U=[],E=e.nil,z=e.$$$;return D=U,N=Y=[F(U[0],"BCDice")].concat(D),d=V=[F(Y[0],"DiceTable")].concat(N),v=q=[L(V[0],null,"SaiFicSkillTable")].concat(d),T=[I=L(q[0],null,"Category")].concat(v),k=e.$r(T),B(I,"$initialize",function(p,f,h,u){var y=this;return y.name=p,y.skills=c(f.$map(),"with_index",[2],function(w,R){return null==w&&(w=E),null==R&&(R=E),z(k("SaiFicSkillTable"),"Skill").$new(p,w,h,R,u)}),y.dice=h}),B(I,"$roll",function(p){return this.$skills()["$[]"](x(p.$roll_sum(2,6),2))}),B(I,"$to_s",S("name")),I.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(e){var E,H,V,q,r,s,M,P,F=e.module,L=e.klass,c=e.def,B=e.hash2,x=[],S=e.nil;return E=x,H=P=[F(x[0],"BCDice")].concat(E),V=M=[F(P[0],"DiceTable")].concat(H),s=[L(M[0],null,"SaiFicSkillTable")].concat(V),(r=(q=L(s[0],null,"Skill")).$$prototype).s_format=r.category_dice=r.row_dice=r.category_name=r.name=S,c(q,"$initialize",function(v,I,T,k,l){var p=this;return p.category_name=v,p.name=I,p.category_dice=T,p.row_dice=k,p.s_format=l}),c(q,"$to_s",function(){var v=this;return v.$format(v.s_format,B(["category_dice","row_dice","category_name","skill_name"],{category_dice:v.category_dice,row_dice:v.row_dice,category_name:v.category_name,skill_name:v.name}))}),q.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(e){var s,r,k,l,p,f,h,v,n,F=e.module,L=e.klass,c=e.ensure_kwargs,B=e.hash2,x=e.send,U=e.defs,E=e.const_set,z=e.to_ary,P=e.def,D=e.truthy,H=e.rb_minus,Y=e.rb_plus,M=e.top,N=[],m=e.nil,V=e.$$$;return M.$require("bcdice/dice_table/sai_fic_skill_table/category"),M.$require("bcdice/dice_table/sai_fic_skill_table/skill"),s=N,r=n=[F(N[0],"BCDice")].concat(s),k=v=[F(n[0],"DiceTable")].concat(r),p=[l=L(v[0],null,"SaiFicSkillTable")].concat(k),f=e.$r(p),(h=l.$$prototype).rtt=h.rtt_format=h.rct=h.rct_format=h.rttn=h.rttn_format=h.categories=m,U(l,"$from_i18n",function(y,_,w){var R,b,i,$,o=m;return null==(R=(w=c(w)).$$smap.rtt)&&(R=m),null==(b=w.$$smap.rct)&&(b=m),null==(i=w.$$smap.rttn)&&(i=m),$=(o=f("I18n").$t("RTT",B(["locale","raise","default"],{locale:_,raise:!1,default:B([],{})})).$merge(f("I18n").$t(y,B(["locale","raise"],{locale:_,raise:!0}))))["$[]"]("items"),o=x(o,"select",[],function(X,Q){return null==X&&(X=m),null==Q&&(Q=m),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](X)}),this.$new($,e.to_hash(o).$merge(B(["rtt","rct","rttn"],{rtt:R,rct:b,rttn:i})))},-3),E(p[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),E(p[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),E(p[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),E(p[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),P(l,"$initialize",function(y,_){var w,R,b,i,g,t,o,$=this;return null==(w=(_=c(_)).$$smap.rtt)&&(w=m),null==(R=_.$$smap.rct)&&(R=m),null==(b=_.$$smap.rttn)&&(b=m),null==(i=_.$$smap.rtt_format)&&(i=f("DEFAULT_RTT")),null==(g=_.$$smap.rct_format)&&(g=f("DEFAULT_RCT")),null==(t=_.$$smap.rttn_format)&&(t=f("DEFAULT_RTTN")),null==(o=_.$$smap.s_format)&&(o=f("DEFAULT_S")),$.categories=x(y.$map(),"with_index",[1],function(X,Q){var ne,se,$e;return null==X&&(X=m),null==Q&&(Q=m),se=null==(ne=z(X))[0]?m:ne[0],$e=null==ne[1]?m:ne[1],V(f("SaiFicSkillTable"),"Category").$new(se,$e,Q,o)},{$$has_top_level_mlhs_arg:!0}),$.rtt=w,$.rct=R,$.rttn=b.$to_a(),$.rtt_format=i,$.rct_format=g,$.rttn_format=t},-2),E(p[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),l.$attr_reader("categories"),P(l,"$roll_command",function(y,_){var R,w=this,b=m,i=m;return D(["RTT",w.rtt]["$include?"](R=_))?w.$format_skill(w.rtt_format,w.$roll_skill(y)):D(["RCT",w.rct]["$include?"](R))?(b=w.$roll_category(y),w.$format(w.rct_format,B(["category_dice","category_name"],{category_dice:b.$dice(),category_name:b.$name()}))):D(i=f("RTTN").$index(R))||D(i=w.rttn.$index(R))?w.$format_skill(w.rttn_format,w.categories["$[]"](i).$roll(y)):m}),P(l,"$roll_category",function(y){return this.categories["$[]"](H(y.$roll_once(6),1))}),P(l,"$roll_skill",function(y){return this.$roll_category(y).$roll(y)}),P(l,"$prefixes",function(){var y=this;return Y(["RTT[1-6]?","RCT",y.rtt,y.rct],y.rttn).$compact()}),l.$private(),P(l,"$format_skill",function(y,_){return this.$format(y,B(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:_.$category_dice(),row_dice:_.$row_dice(),category_name:_.$category_name(),skill_name:_.$name(),text:_.$to_s()}))})},Opal.modules["bcdice/dice_table/table"]=function(e){var D,N,d,n,q,r,a,V,Y,F=e.module,L=e.klass,c=e.hash2,B=e.defs,x=e.truthy,S=e.def,U=e.rb_minus,E=[],z=e.nil;return D=E,N=Y=[F(E[0],"BCDice")].concat(D),d=V=[F(Y[0],"DiceTable")].concat(N),q=[n=L(V[0],null,"Table")].concat(d),r=e.$r(q),(a=n.$$prototype).times=a.sides=a.name=a.items=z,B(n,"$from_i18n",function(I,T){var l=z;return l=r("I18n").$t(I,c(["locale"],{locale:T})),this.$new(l["$[]"]("name"),l["$[]"]("type"),l["$[]"]("items"))}),S(n,"$initialize",function(I,T,k){var l=this,p=z;return l.name=I,l.items=k.$freeze(),p=/(\d+)D(\d+)/i.$match(T),x(p)||l.$raise(r("ArgumentError"),"Unexpected table type: "+T),l.times=p["$[]"](1).$to_i(),l.sides=p["$[]"](2).$to_i()}),S(n,"$roll",function(I){var k,T=this;return k=I.$roll_sum(T.times,T.sides),T.$choice(k)}),S(n,"$choice",function(I){var k,T=this;return k=U(I,T.times),r("RollResult").$new(T.name,I,T.items["$[]"](k))})},Opal.modules["bcdice/dice_table"]=function(e){var F=e.top;return F.$require("bcdice/dice_table/roll_result"),F.$require("bcdice/dice_table/chain_table"),F.$require("bcdice/dice_table/d66_grid_table"),F.$require("bcdice/dice_table/d66_half_grid_table"),F.$require("bcdice/dice_table/d66_one_third_table"),F.$require("bcdice/dice_table/d66_left_range_table"),F.$require("bcdice/dice_table/d66_parity_table"),F.$require("bcdice/dice_table/d66_range_table"),F.$require("bcdice/dice_table/d66_table"),F.$require("bcdice/dice_table/range_table"),F.$require("bcdice/dice_table/sai_fic_skill_table"),F.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(e){var S,P,H,E,F=e.module,L=e.const_set,c=[];return S=c,P=E=[F(c[0],"BCDice")].concat(S),H=[F(E[0],"D66SortType")].concat(P),L(H[0],"NO_SORT","no_sort"),L(H[0],"ASC","asc"),L(H[0],"DESC","desc"),function(z,P){var H=[F(z,"RoundType")].concat(P);return L(H[0],"CEIL","ceil"),L(H[0],"FLOOR","floor"),L(H[0],"ROUND","round")}(E[0],E)},Opal.modules["bcdice/translate"]=function(e){var P,M,N,m,V,H,F=e.module,L=e.ensure_kwargs,c=e.kwrestargs,x=e.hash2,S=e.def,U=[],E=e.nil;return P=U,M=H=[F(U[0],"BCDice")].concat(P),m=[N=F(H[0],"Translate")].concat(M),V=e.$r(m),S(N,"$translate",function(s,d){var n,q=this;return null==q.locale&&(q.locale=E),d=L(d),n=c(d,{}),V("I18n").$translate(s,x(["locale","raise"],{locale:q.locale,raise:!0}).$merge(e.to_hash(n)))},-2)},Opal.modules["bcdice/result"]=function(e){var N,G,m,P,H,L=e.klass,c=e.send,B=e.def,x=e.return_val,S=e.return_ivar,U=[],E=e.nil;return P=U,N=H=[(0,e.module)(U[0],"BCDice")].concat(P),[m=L(H[0],null,"Result")].concat(N),B(G=e.get_singleton_class(m),"$success",function(n){return c(this.$new(),"tap",[],function(a){var v;return null==a&&(a=E),a["$text="](n),c(a,"success=",v=[!0]),v[v.length-1]})}),B(G,"$failure",function(n){return c(this.$new(),"tap",[],function(a){var v;return null==a&&(a=E),a["$text="](n),c(a,"failure=",v=[!0]),v[v.length-1]})}),B(G,"$critical",function(n){return c(this.$new(),"tap",[],function(a){var v;return null==a&&(a=E),a["$text="](n),a["$critical="](!0),c(a,"success=",v=[!0]),v[v.length-1]})}),B(G,"$fumble",function(n){return c(this.$new(),"tap",[],function(a){var v;return null==a&&(a=E),a["$text="](n),a["$fumble="](!0),c(a,"failure=",v=[!0]),v[v.length-1]})}),B(G,"$nothing",x("nothing")),B(m,"$initialize",function(s){var d=this;return null==s&&(s=E),d.text=s,d.rands=E,d.detailed_rands=E,d.secret=!1,d.success=!1,d.failure=!1,d.critical=!1,d.fumble=!1},-1),m.$attr_accessor("text","rands","detailed_rands"),m.$attr_writer("secret","success","failure","critical","fumble"),B(m,"$secret?",S("secret")),B(m,"$success?",S("success")),B(m,"$failure?",S("failure")),B(m,"$critical?",S("critical")),B(m,"$fumble?",S("fumble")),B(m,"$condition=",function(s){return this.success=s,this.failure=s["$!"]()})},Opal.modules["racc/parser"]=function(e){var I,k,l,F=e.module,L=e.klass,c=e.truthy,B=e.const_set,x=e.defs,S=e.gvars,U=e.rb_lt,E=e.def,z=e.to_ary,P=e.send,D=e.neqeq,H=e.rb_plus,Y=e.eqeq,M=e.rb_ge,N=e.rb_gt,m=e.rb_minus,V=e.rb_le,G=e.rb_times,s=e.assign_ivar_val,n=[],q=e.$r(n),r=e.nil,a=e.$$$;return I=n,k=[F(n[0],"Racc")].concat(I),l=e.$r(k),L(k[0],l("StandardError"),"ParseError"),c(a("::","ParseError","skip_raise")?"constant":r)||B(n[0],"ParseError",a(q("Racc"),"ParseError")),function(v,I){var u,y,_,w,R,l=[F(v,"Racc")].concat(I),p=e.$r(l);return c(p("Racc_No_Extensions","skip_raise")?"constant":r)||B(l[0],"Racc_No_Extensions",!1),u=l,_=[y=L(l[0],null,"Parser")].concat(u),w=e.$r(_),(R=y.$$prototype).yydebug=R.racc_debug_out=R.racc_error_status=R.racc_t=R.racc_vstack=R.racc_val=R.racc_state=R.racc_tstack=r,B(_[0],"Racc_Runtime_Version","1.4.6"),B(_[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),B(_[0],"Racc_Runtime_Core_Version_R","1.4.6"),B(_[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),B(_[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),B(_[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),B(_[0],"Racc_Runtime_Core_Version",w("Racc_Runtime_Core_Version_R")),B(_[0],"Racc_Runtime_Core_Revision",w("Racc_Runtime_Core_Revision_R")),B(_[0],"Racc_Runtime_Type","ruby"),x(w("Parser"),"$racc_runtime_type",function(){return w("Racc_Runtime_Type")}),E(y,"$_racc_setup",function(){var i,g,t=this,o=r,$=r;return null==S.stderr&&(S.stderr=r),c(a(t.$class(),"Racc_debug_parser"))||(t.yydebug=!1),c(null!=(i=t.yydebug)&&i!==r?"instance-variable":r)||(t.yydebug=!1),c(t.yydebug)&&(c(null!=(g=t.racc_debug_out)&&g!==r?"instance-variable":r)||(t.racc_debug_out=S.stderr),t.racc_debug_out=c(o=t.racc_debug_out)?o:S.stderr),$=a(t.$class(),"Racc_arg"),c(U($.$size(),14))&&$["$[]="](13,!0),$}),E(y,"$_racc_init_sysvars",function(){var i=this;return i.racc_state=[0],i.racc_tstack=[],i.racc_vstack=[],i.racc_t=r,i.racc_val=r,i.racc_read_next=!0,i.racc_user_yyerror=!1,i.racc_error_status=0}),E(y,"$do_parse",function(){return this.$__send__(w("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)}),E(y,"$next_token",function(){return this.$raise(w("NotImplementedError"),this.$class()+"#next_token is not defined")}),E(y,"$_racc_do_parse_rb",function(i,g){var t,$=this,W=r,X=r,Q=r,ne=r,se=r,$e=r,ue=r,te=r;return t=z(i),W=null==t[0]?r:t[0],X=null==t[1]?r:t[1],Q=null==t[2]?r:t[2],ne=null==t[3]?r:t[3],se=null==t[10]?r:t[10],$.$_racc_init_sysvars(),$e=ue=te=r,P($,"catch",["racc_end_parse"],function K(){var C,Z,j=null==K.$$s?this:K.$$s,A=r;for(null==j.racc_state&&(j.racc_state=r),null==j.racc_read_next&&(j.racc_read_next=r),null==j.racc_t&&(j.racc_t=r),null==j.yydebug&&(j.yydebug=r),null==j.racc_val&&(j.racc_val=r);c(!0);)for(c(te=ne["$[]"](j.racc_state["$[]"](-1)))?(c(j.racc_read_next)&&D(j.racc_t,0)&&(Z=j.$next_token(),C=z(Z),$e=null==C[0]?r:C[0],j.racc_val=null==C[1]?r:C[1],j.racc_t=c($e)?c(A=se["$[]"]($e))?A:1:0,c(j.yydebug)&&j.$racc_read_token(j.racc_t,$e,j.racc_val),j.racc_read_next=!1),te=H(te,j.racc_t),c(M(te,0))&&c(ue=W["$[]"](te))&&Y(X["$[]"](te),j.racc_state["$[]"](-1))||(ue=Q["$[]"](j.racc_state["$[]"](-1)))):ue=Q["$[]"](j.racc_state["$[]"](-1));c(ue=j.$_racc_evalact(ue,i)););},{$$s:$})}),E(y,"$yyparse",function(i,g){return this.$__send__(w("Racc_YY_Parse_Method"),i,g,this.$_racc_setup(),!0)}),E(y,"$_racc_yyparse_rb",function(i,g,t,o){var $,X=this,Q=r,ne=r,ie=r,se=r,ue=r,te=r,K=r;return $=z(t),Q=null==$[0]?r:$[0],ne=null==$[1]?r:$[1],ie=null==$[2]?r:$[2],se=null==$[3]?r:$[3],ue=null==$[10]?r:$[10],X.$_racc_init_sysvars(),te=r,K=r,P(X,"catch",["racc_end_parse"],function C(){var Z=null==C.$$s?this:C.$$s;for(null==Z.racc_state&&(Z.racc_state=r);!c(K=se["$[]"](Z.racc_state["$[]"](-1)));)for(;c(te=Z.$_racc_evalact(ie["$[]"](Z.racc_state["$[]"](-1)),t)););return P(i,"__send__",[g],function j(A,ee){var O=null==j.$$s?this:j.$$s,re=r,J=r;for(null==O.racc_t&&(O.racc_t=r),null==O.racc_state&&(O.racc_state=r),null==O.racc_read_next&&(O.racc_read_next=r),null==A&&(A=r),null==ee&&(ee=r),O.racc_t=c(A)?c(re=ue["$[]"](A))?re:1:0,O.racc_val=ee,O.racc_read_next=!1,K=H(K,O.racc_t),c(M(K,0))&&c(te=Q["$[]"](K))&&Y(ne["$[]"](K),O.racc_state["$[]"](-1))||(te=ie["$[]"](O.racc_state["$[]"](-1)));c(te=O.$_racc_evalact(te,t)););for(;c(c(re=c(J=(K=se["$[]"](O.racc_state["$[]"](-1)))["$!"]())?J:O.racc_read_next["$!"]())?re:O.racc_t["$=="](0));)for(c(K)&&c(K=H(K,O.racc_t))&&c(M(K,0))&&c(te=Q["$[]"](K))&&Y(ne["$[]"](K),O.racc_state["$[]"](-1))||(te=ie["$[]"](O.racc_state["$[]"](-1)));c(te=O.$_racc_evalact(te,t)););},{$$s:Z})},{$$s:X})}),E(y,"$_racc_evalact",function(i,g){var t,ie,$=this,W=r,X=r,ne=r,se=r,$e=r,ue=r;if(W=null==(t=z(g))[0]?r:t[0],X=null==t[1]?r:t[1],ne=null==t[3]?r:t[3],ie=null==t[11]?r:t[11],se=null==t[12]?r:t[12],c(N(i,0))&&c(U(i,ie)))c(N($.racc_error_status,0))&&(Y($.racc_t,1)||($.racc_error_status=m($.racc_error_status,1))),$.racc_vstack.$push($.racc_val),$.racc_state.$push(i),$.racc_read_next=!0,c($.yydebug)&&($.racc_tstack.$push($.racc_t),$.$racc_shift($.racc_t,$.racc_tstack,$.racc_vstack));else if(c(U(i,0))&&c(N(i,se["$-@"]()))){if($e=P($,"catch",["racc_jump"],function te(){var K=null==te.$$s?this:te.$$s;return null==K.racc_state&&(K.racc_state=r),K.racc_state.$push(K.$_racc_do_reduce(g,i)),!1},{$$s:$}),c($e))switch($e){case 1:return $.racc_user_yyerror=!0,se["$-@"]();case 2:return ie;default:$.$raise("[Racc Bug] unknown jump code")}}else if(Y(i,ie))c($.yydebug)&&$.$racc_accept(),$.$throw("racc_end_parse",$.racc_vstack["$[]"](0));else{if(Y(i,se["$-@"]())){switch($.racc_error_status){case 0:c(g["$[]"](21))||$.$on_error($.racc_t,$.racc_val,$.racc_vstack);break;case 3:Y($.racc_t,0)&&$.$throw("racc_end_parse",r),$.racc_read_next=!0}for($.racc_user_yyerror=!1,$.racc_error_status=3;c(!0)&&!(c(ue=ne["$[]"]($.racc_state["$[]"](-1)))&&(ue=H(ue,1),c(M(ue,0))&&c(i=W["$[]"](ue))&&Y(X["$[]"](ue),$.racc_state["$[]"](-1))));)c(V($.racc_state.$size(),1))&&$.$throw("racc_end_parse",r),$.racc_state.$pop(),$.racc_vstack.$pop(),c($.yydebug)&&($.racc_tstack.$pop(),$.$racc_e_pop($.racc_state,$.racc_tstack,$.racc_vstack));return i}$.$raise("[Racc Bug] unknown action "+i.$inspect())}return c($.yydebug)&&$.$racc_next_state($.racc_state["$[]"](-1),$.racc_state),r}),E(y,"$_racc_do_reduce",function(i,g){var t,se,ue,A,ee,O,ae,$=this,X=r,Q=r,ne=r,ie=r,$e=r,te=r,K=r,C=r,Z=r,j=r,re=r,J=r,ce=r;return X=null==(t=z(i))[4]?r:t[4],Q=null==t[5]?r:t[5],ne=null==t[6]?r:t[6],ie=null==t[7]?r:t[7],se=null==t[8]?r:t[8],$e=null==t[9]?r:t[9],ue=null==t[13]?r:t[13],te=$.racc_state,K=$.racc_vstack,C=$.racc_tstack,Z=G(g,-3),j=$e["$[]"](Z),A=$e["$[]"](H(Z,1)),ee=$e["$[]"](H(Z,2)),O=[],c($.yydebug)&&(re=C["$[]"](j["$-@"](),j)),J=K["$[]"](j["$-@"](),j),c($.yydebug)&&C["$[]="](j["$-@"](),j,O),K["$[]="](j["$-@"](),j,O),te["$[]="](j["$-@"](),j,O),c(ue)?K.$push($.$__send__(ee,J,K,J["$[]"](0))):K.$push($.$__send__(ee,J,K)),C.$push(A),c($.yydebug)&&$.$racc_reduce(re,A,C,K),ae=m(A,se),c(Z=ie["$[]"](ae))&&(Z=H(Z,te["$[]"](-1)),c(M(Z,0))&&c(ce=X["$[]"](Z))&&Y(Q["$[]"](Z),ae))?ce:ne["$[]"](ae)}),E(y,"$on_error",function(i,g,t){var $,o=this;return o.$raise(w("ParseError"),o.$sprintf("\nparse error on value %s (%s)",g.$inspect(),c($=o.$token_to_str(i))?$:"?"))}),E(y,"$yyerror",function(){return this.$throw("racc_jump",1)}),E(y,"$yyaccept",function(){return this.$throw("racc_jump",2)}),E(y,"$yyerrok",s("racc_error_status",0)),E(y,"$racc_read_token",function(i,g,t){var o=this;return o.racc_debug_out.$print("read    "),o.racc_debug_out.$print(g.$inspect(),"(",o.$racc_token2str(i),") "),o.racc_debug_out.$puts(t.$inspect()),o.racc_debug_out.$puts()}),E(y,"$racc_shift",function(i,g,t){var o=this;return o.racc_debug_out.$puts("shift   "+o.$racc_token2str(i)),o.$racc_print_stacks(g,t),o.racc_debug_out.$puts()}),E(y,"$racc_reduce",function(i,g,t,o){var $=this,W=r;return(W=$.racc_debug_out).$print("reduce "),c(i["$empty?"]())?W.$print(" <none>"):P(i,"each",[],function X(Q){return null==Q&&(Q=r),W.$print(" ",(null==X.$$s?this:X.$$s).$racc_token2str(Q))},{$$s:$}),W.$puts(" --\x3e "+$.$racc_token2str(g)),$.$racc_print_stacks(t,o),$.racc_debug_out.$puts()}),E(y,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()}),E(y,"$racc_e_pop",function(i,g,t){var o=this;return o.racc_debug_out.$puts("error recovering mode: pop token"),o.$racc_print_states(i),o.$racc_print_stacks(g,t),o.racc_debug_out.$puts()}),E(y,"$racc_next_state",function(i,g){var t=this;return t.racc_debug_out.$puts("goto    "+i),t.$racc_print_states(g),t.racc_debug_out.$puts()}),E(y,"$racc_print_stacks",function(i,g){var o=r;return(o=this.racc_debug_out).$print("        ["),P(i,"each_index",[],function $(W){return null==W&&(W=r),o.$print(" (",(null==$.$$s?this:$.$$s).$racc_token2str(i["$[]"](W))," ",g["$[]"](W).$inspect(),")")},{$$s:this}),o.$puts(" ]")}),E(y,"$racc_print_states",function(i){var t=r;return(t=this.racc_debug_out).$print("        ["),P(i,"each",[],function($){return null==$&&($=r),t.$print(" ",$)}),t.$puts(" ]")}),E(y,"$racc_token2str",function(i){var t;return c(t=a(this.$class(),"Racc_token_to_s_table")["$[]"](i))?t:this.$raise("[Racc Bug] can't convert token "+i+" to string")}),E(y,"$token_to_str",function(i){return a(this.$class(),"Racc_token_to_s_table")["$[]"](i)})}(n[0],n)},Opal.modules["bcdice/arithmetic/node"]=function(e){var s,r,T,u,y,l,p,v,n,F=e.module,L=e.klass,c=e.def,B=e.thrower,x=e.return_ivar,S=e.send2,U=e.find_super,E=e.eqeq,z=e.const_set,P=e.eqeqeq,D=e.rb_divide,H=e.truthy,Y=e.assign_ivar,M=e.alias,N=[],m=e.nil,V=e.$$$;return s=N,r=n=[F(N[0],"BCDice")].concat(s),T=v=[F(n[0],"Arithmetic")].concat(r),l=[F(v[0],"Node")].concat(T),p=e.$r(l),(y=(u=L(l[0],null,"BinaryOp")).$$prototype).lhs=y.rhs=y.op=m,c(u,"$initialize",function(w,R,b){var i=this;return i.lhs=w,i.op=R,i.rhs=b}),c(u,"$eval",function(w){try{B("eval_return");var g,b=this,i=m;return i=b.lhs.$eval(w),g=b.rhs.$eval(w),i.$send(b.op,g)}catch(t){if(t===e.t_eval_return)return t.$v;throw t}}),c(u,"$output",function(){var w=this;return""+w.lhs.$output()+w.op+w.rhs.$output()}),c(u,"$s_exp",function(){var w=this;return"("+w.$op_for_s_exp()+" "+w.lhs.$s_exp()+" "+w.rhs.$s_exp()+")"}),c(u,"$op_for_s_exp",x("op")),function(f,h,u){var y=L(f,h,"DivideBase"),_=[y].concat(u),w=e.$r(_),R=y.$$prototype;R.lhs=R.rhs=R.op=m,c(y,"$initialize",function b(i,g){return b.$$p=null,S(this,U(this,"initialize",b,!1,!0),"initialize",[i,"/",g],null)}),c(y,"$eval",function(i){try{B("eval_return");var o,$,t=this;return o=t.lhs.$eval(i),$=t.rhs.$eval(i),E($,0)&&t.$raise(w("ZeroDivisionError")),t.$divide_and_round(o,$,i)}catch(W){if(W===e.t_eval_return)return W.$v;throw W}}),c(y,"$output",function b(){var i=b.$$p||m,g=this;return b.$$p=null,""+S(g,U(g,"output",b,!1,!0),"output",[],i)+g.$rounding_method()}),y.$private(),c(y,"$rounding_method",function(){return V(this.$class(),"ROUNDING_METHOD")}),c(y,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()}),c(y,"$divide_and_round",function(i,g,t){return this.$raise(w("NotImplementedError"))})}(l[0],p("BinaryOp"),l),function(f,h,u){var y=L(f,h,"DivideWithGameSystemDefault"),_=[y].concat(u),w=e.$r(_);z(_[0],"ROUNDING_METHOD",""),y.$private(),c(y,"$divide_and_round",function(b,i,g){var t,o=m;return P(V(w("RoundType"),"CEIL"),t=g)?D(b.$to_f(),i).$ceil():P(V(w("RoundType"),"ROUND"),t)?(o=D(b.$to_f(),i),H(o["$negative?"]())?o.$abs().$round()["$-@"]():o.$round()):D(b,i).$floor()})}(l[0],p("DivideBase"),l),function(f,h,u){var y=L(f,h,"DivideWithCeil"),_=[y].concat(u);z(_[0],"ROUNDING_METHOD","C"),y.$private(),c(y,"$divide_and_round",function(R,b,i){return D(R.$to_f(),b).$ceil()})}(l[0],p("DivideBase"),l),function(f,h,u){var y=L(f,h,"DivideWithRound"),_=[y].concat(u);z(_[0],"ROUNDING_METHOD","R"),y.$private(),c(y,"$divide_and_round",function(R,b,i){var g=m;return g=D(R.$to_f(),b),H(g["$negative?"]())?g.$abs().$round()["$-@"]():g.$round()})}(l[0],p("DivideBase"),l),function(f,h,u){var y=L(f,h,"DivideWithFloor"),_=[y].concat(u);z(_[0],"ROUNDING_METHOD","F"),y.$private(),c(y,"$divide_and_round",function(R,b,i){return D(R,b).$floor()})}(l[0],p("DivideBase"),l),function(f,h){var u=L(f,null,"Negative");u.$$prototype.body=m,c(u,"$initialize",Y("body")),c(u,"$eval",function(w){try{return B("eval_return"),this.body.$eval(w)["$-@"]()}catch(i){if(i===e.t_eval_return)return i.$v;throw i}}),c(u,"$output",function(){return"-"+this.body.$output()}),c(u,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"})}(l[0]),function(f,h){var u=L(f,null,"Parenthesis");u.$$prototype.expr=m,c(u,"$initialize",Y("expr")),c(u,"$eval",function(w){try{return B("eval_return"),this.expr.$eval(w)}catch(i){if(i===e.t_eval_return)return i.$v;throw i}}),c(u,"$output",function(){return"("+this.expr.$output()+")"}),c(u,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"})}(l[0]),function(f,h){var u=L(f,null,"Number");return u.$$prototype.value=m,c(u,"$initialize",Y("value")),c(u,"$eval",x("value")),c(u,"$output",function(){return this.value.$to_s()}),M(u,"s_exp","output")}(l[0])},Opal.modules.strscan=function(e){var Y,M,N,m,V,L=e.def,c=e.truthy,B=e.eqeqeq,x=e.Opal,S=e.return_ivar,U=e.send,E=e.alias,z=[],P=e.nil;return Y=z,N=[M=(0,e.klass)(z[0],null,"StringScanner")].concat(Y),m=e.$r(N),(V=M.$$prototype).pos=V.string=V.working=V.matched=V.prev_pos=V.match=P,M.$attr_reader("pos","matched"),L(M,"$initialize",function(s){var d=this;return d.string=s,d.pos=0,d.matched=P,d.working=s,d.match=[]}),M.$attr_reader("string"),L(M,"$beginning_of_line?",function(){var s=this;return 0===s.pos||"\n"===s.string.charAt(s.pos-1)}),L(M,"$scan",function(s){var d=this,n=(s=d.$anchor(s)).exec(d.working);return null==n?d.matched=P:(d.prev_pos=d.pos,d.pos+=n[0].length,d.working=d.working.substring(n[0].length),d.matched=n[0],d.match=n,n[0])}),L(M,"$scan_until",function(s){var d=this;s=d.$anchor(s);for(var n=d.working,q=0;n.length!=q;++q){var r=s.exec(n.substr(q));if(null!==r){var a=q+r[0].length,v=n.substr(0,a);return d.matched=r[0],d.match=r,d.prev_pos=d.pos+q,d.pos+=a,d.working=n.substr(a),v}}return d.matched=P}),L(M,"$[]",function(s){var n;if(c(this.match["$empty?"]()))return P;B(m("Symbol"),n=s)?s=s.$to_s():B(m("String"),n)||(s=x["$coerce_to!"](s,m("Integer"),"to_int"));var q=this.match;return s<0&&(s+=q.length),s<0||s>=q.length||null==q[s]?P:q[s]}),L(M,"$check",function(s){var d=this,n=(s=d.$anchor(s)).exec(d.working);return d.matched=null==n?P:n[0]}),L(M,"$check_until",function(s){var d=this,n=d.prev_pos,q=d.pos,r=d.working,a=d.$scan_until(s);return d.prev_pos=n,d.pos=q,d.working=r,a}),L(M,"$peek",function(s){return this.working.substring(0,s)}),L(M,"$eos?",function(){return 0===this.working.length}),L(M,"$exist?",function(s){var n=s.exec(this.working);return null==n?P:0==n.index?0:n.index+1}),L(M,"$skip",function(s){var d=this,n=(s=d.$anchor(s)).exec(d.working);if(null==n)return d.match=[],d.matched=P;var q=n[0],r=q.length;return d.matched=q,d.match=n,d.prev_pos=d.pos,d.pos+=r,d.working=d.working.substring(r),r}),L(M,"$skip_until",function(s){var n=this.$scan_until(s);return n===P?P:(this.matched=n.substr(-1),n.length)}),L(M,"$get_byte",function(){var s=this,d=P;return s.pos<s.string.length?(s.prev_pos=s.pos,s.pos+=1,d=s.matched=s.working.substring(0,1),s.working=s.working.substring(1)):s.matched=P,d}),L(M,"$match?",function(s){var d=this,n=(s=d.$anchor(s)).exec(d.working);return null==n?P:(d.prev_pos=d.pos,n[0].length)}),L(M,"$pos=",function(s){var d=this;return s<0&&(s+=d.string.$length()),d.pos=s,d.working=d.string.slice(s)}),L(M,"$matched_size",function(){return this.matched===P?P:this.matched.length}),L(M,"$post_match",function(){var s=this;return s.matched===P?P:s.string.substr(s.pos)}),L(M,"$pre_match",function(){var s=this;return s.matched===P?P:s.string.substr(0,s.prev_pos)}),L(M,"$reset",function(){var s=this;return s.working=s.string,s.matched=P,s.pos=0}),L(M,"$rest",S("working")),L(M,"$rest?",function(){return 0!==this.working.length}),L(M,"$rest_size",function(){return this.$rest().$size()}),L(M,"$terminate",function(){var s,d=this;return d.match=P,s=[d.string.$length()],U(d,"pos=",s),s[s.length-1]}),L(M,"$unscan",function(){var s=this;return s.pos=s.prev_pos,s.prev_pos=P,s.match=P,s}),E(M,"bol?","beginning_of_line?"),E(M,"getch","get_byte"),M.$private(),L(M,"$anchor",function(s){var d=s.toString().match(/\/([^\/]+)$/);return d=d?d[1]:void 0,new RegExp("^(?:"+s.source+")",d)})},Opal.modules["bcdice/normalize"]=function(e){var E,H,P,F=e.module,L=e.eqeqeq,c=e.def,B=e.eqeq,x=[],S=e.nil;return E=x,P=[F(x[0],"BCDice")].concat(E),(H=F(P[0],"Normalize")).$module_function(),c(H,"$comparison_operator",function(M){var N;return L(/<=|=</,N=M)?"<=":L(/>=|=>/,N)?">=":L(/<>|!=|=!/,N)?"!=":L(/</,N)?"<":L(/>/,N)?">":L(/=/,N)?"==":S}),c(H,"$target_number",function(M){return B(M,"?")?M:M.$to_i()})},Opal.modules["bcdice/command/lexer"]=function(e){var Y,V,q,r,a,v,I,s,N,F=e.module,L=e.klass,c=e.const_set,B=e.hash2,x=e.truthy,S=e.send,U=e.def,E=e.thrower,z=e.top,P=[],D=e.nil;return z.$require("strscan"),z.$require("bcdice/normalize"),Y=P,V=N=[F(P[0],"BCDice")].concat(Y),q=s=[F(N[0],"Command")].concat(V),a=[r=L(s[0],null,"Lexer")].concat(q),v=e.$r(a),(I=r.$$prototype).scanner=I.notations=D,c(a[0],"SYMBOLS",B(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),U(r,"$initialize",function(k,l){var p,f,u;return k=x(u=(p=(f=k)===D||null==f?D:f.$split(" ",2))===D||null==p?D:p.$first())?u:"",this.scanner=v("StringScanner").$new(k),this.notations=S(l,"map",[],function(_){return null==_&&(_=D),x(_["$is_a?"](v("String")))?v("Regexp").$new(_):_})}),U(r,"$next_token",function(){try{var k=E("return"),l=this,p=D,f=D,u=D,y=D;return x(l.scanner["$eos?"]())?[!1,"$"]:(S(l.notations,"each",[],function _(w){var b,R=null==_.$$s?this:_.$$s;if(null==R.scanner&&(R.scanner=D),null==w&&(w=D),b=R.scanner.$scan(w),!x(b))return D;k.$throw(["NOTATION",b])},{$$s:l,$$ret:k}),x(p=l.scanner.$scan(/\d+/))?["NUMBER",p.$to_i()]:x(f=l.scanner.$scan(/[<>!=]+/))?(f=v("Normalize").$comparison_operator(f),[x(f)?"CMP_OP":"ILLEGAL",f]):(u=l.scanner.$getch().$upcase(),[x(y=v("SYMBOLS")["$[]"](u))?y:u.$to_sym(),u]))}catch(_){if(_===k)return _.$v;throw _}}),U(r,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/command/parsed"]=function(e){var z,Y,G,s,d,n,q,N,D,F=e.module,L=e.klass,c=e.def,B=e.return_ivar,x=e.truthy,S=[],U=e.nil;return z=S,Y=D=[F(S[0],"BCDice")].concat(z),G=N=[F(D[0],"Command")].concat(Y),d=[s=L(N[0],null,"Parsed")].concat(G),n=e.$r(d),(q=s.$$prototype).critical=q.fumble=q.dollar=q.modify_number=q.question_target=q.target_number=q.prefix_number=q.command=q.suffix_number=q.cmp_op=U,s.$attr_accessor("command"),s.$attr_accessor("prefix_number"),s.$attr_accessor("suffix_number"),s.$attr_accessor("critical"),s.$attr_accessor("fumble"),s.$attr_accessor("dollar"),s.$attr_accessor("modify_number"),s.$attr_accessor("cmp_op"),s.$attr_accessor("target_number"),s.$attr_writer("question_target"),c(s,"$initialize",function(){var a=this;return a.prefix_number=U,a.suffix_number=U,a.critical=U,a.fumble=U,a.dollar=U,a.cmp_op=U,a.target_number=U,a.question_target=!1}),c(s,"$question_target?",B("question_target")),c(s,"$to_s",function(a){var v=this,I=U,T=U,k=U,l=U,p=U;switch(null==a&&(a="after_command"),I=x(v.critical)?"@"+v.critical:U,T=x(v.fumble)?"#"+v.fumble:U,k=x(v.dollar)?"$"+v.dollar:U,l=n("Format").$modifier(v.modify_number),p=x(v.question_target)?"?":v.target_number,a){case"after_command":return[v.prefix_number,v.command,v.suffix_number,I,T,k,l,v.cmp_op,p].$join();case"after_modify_number":return[v.prefix_number,v.command,v.suffix_number,l,I,T,k,v.cmp_op,p].$join();case"after_target_number":return[v.prefix_number,v.command,v.suffix_number,l,v.cmp_op,p,I,T,k].$join();default:return U}},-1)},Opal.modules["bcdice/command/parser"]=function(e){var a,k,y,b,i,g,t,o,$,W,X,Q,se,_,w,R,te,p,f,I,F=e.klass,L=e.module,c=e.slice,B=e.extract_kwargs,x=e.ensure_kwargs,S=e.get_kwarg,U=e.send2,E=e.find_super,z=e.def,P=e.send,D=e.eqeq,H=e.thrower,Y=e.hash,M=e.const_set,N=e.truthy,m=e.to_ary,V=e.hash2,G=e.top,s=[],d=e.$r(s),n=e.nil,q=e.$$$;return G.$require("racc/parser.rb"),G.$require("bcdice/arithmetic/node"),G.$require("bcdice/command/lexer"),G.$require("bcdice/command/parsed"),F(q(d("BCDice"),"Command"),q(d("Racc"),"Parser"),"Parser"),a=s,k=I=[L(s[0],"BCDice")].concat(a),p=[L(I[0],"Command")].concat(k),f=e.$r(p),y=p,w=[_=F(p[0],q(f("Racc"),"Parser"),"Parser")].concat(y),R=e.$r(w),(te=_.$$prototype).notations=te.lexer=te.modifier=te.suffix_number=te.prefix_number=te.need_suffix_number=te.need_prefix_number=te.critical=te.fumble=te.dollar=te.allowed_cmp_op=te.question_target=n,z(_,"$initialize",function K(C,Z){var j,A,ee,O,J=this;return K.$$p=null,j=c(arguments),A=B(j),A=x(A),ee=j,O=S(A,"round_type"),U(J,E(J,"initialize",K,!1,!0),"initialize",[],null),J.notations=ee,J.round_type=O,J.prefix_number=!1,J.suffix_number=!1,J.need_prefix_number=!1,J.need_suffix_number=!1,J.modifier=!0,J.critical=!1,J.fumble=!1,J.dollar=!1,J.allowed_cmp_op=[n,">=",">","<=","<","==","!="],J.question_target=!1},-2),z(_,"$disable_modifier",function(){return this.modifier=!1,this}),z(_,"$enable_prefix_number",function(){return this.prefix_number=!0,this}),z(_,"$enable_suffix_number",function(){return this.suffix_number=!0,this}),z(_,"$has_prefix_number",function(){var C=this;return C.prefix_number=!0,C.need_prefix_number=!0,C}),z(_,"$has_suffix_number",function(){var C=this;return C.suffix_number=!0,C.need_suffix_number=!0,C}),z(_,"$enable_critical",function(){return this.critical=!0,this}),z(_,"$enable_fumble",function(){return this.fumble=!0,this}),z(_,"$enable_dollar",function(){return this.dollar=!0,this}),z(_,"$restrict_cmp_op_to",function(C){var Z,A=this;return Z=c(arguments),A.allowed_cmp_op=Z,A},-1),z(_,"$enable_question_target",function(){return this.question_target=!0,this}),z(_,"$parse",function(C){var Z=this;try{return Z.lexer=R("Lexer").$new(C,Z.notations),Z.$do_parse()}catch(j){if(!e.rescue(j,[R("ParseError"),R("ZeroDivisionError")]))throw j;try{return n}finally{e.pop_exception()}}}),_.$private(),z(_,"$parsed",function(C,Z,j,A){try{return H("eval_return"),P(R("Parsed").$new(),"tap",[],function re(J){var ae,ce,oe,fe,de,le,me,_e=null==re.$$s?this:re.$$s;return null==_e.round_type&&(_e.round_type=n),null==J&&(J=n),J["$command="](C["$[]"]("command")),J["$prefix_number="]((ae=C["$[]"]("prefix"))===n||null==ae?n:ae.$eval(_e.round_type)),J["$suffix_number="]((ce=C["$[]"]("suffix"))===n||null==ce?n:ce.$eval(_e.round_type)),J["$critical="]((oe=Z["$[]"]("critical"))===n||null==oe?n:oe.$eval(_e.round_type)),J["$fumble="]((fe=Z["$[]"]("fumble"))===n||null==fe?n:fe.$eval(_e.round_type)),J["$dollar="]((de=Z["$[]"]("dollar"))===n||null==de?n:de.$eval(_e.round_type)),J["$modify_number="](j.$eval(_e.round_type)),J["$cmp_op="](A["$[]"]("cmp_op")),D(A["$[]"]("target"),"?")?(J["$question_target="](!0),P(J,"target_number=",le=[0]),le[le.length-1]):(J["$question_target="](!1),le=[(me=A["$[]"]("target"),me===n||null==me?n:me.$eval(_e.round_type))],P(J,"target_number=",le),le[le.length-1])},{$$s:this})}catch(re){if(re===e.t_eval_return)return re.$v;throw re}}),z(_,"$next_token",function(){return this.lexer.$next_token()}),b=e.large_array_unpack("6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,33,34,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,,,17,18,6,,5,,,17,18,,,5,23,24,25,26,56,54,55,57"),i=e.large_array_unpack("0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,,17,15,15,18,18,23,,18,30,30,23,23,24,,23,31,31,24,24,25,,24,44,44,25,25,28,,25,47,47,28,28,29,,28,48,48,29,29,33,,29,49,49,33,33,34,,33,50,50,34,34,36,,34,,,36,36,37,,36,,,37,37,,,37,27,27,27,27,52,52,52,52"),g=e.large_array_unpack("-2,4,16,-3,-1,11,,33,13,35,23,30,1,,28,40,,37,44,,,-2,,51,58,65,0,106,72,79,47,54,,86,93,,100,107,,,,,,,63,,,68,75,82,89,,120,,,,,"),t=e.large_array_unpack("-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29"),o=e.large_array_unpack("30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,,,21,47,48,40,51,52,49,50,44,46,3,,,,13,,,,,,,,32"),$=e.large_array_unpack("8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,,,4,8,8,5,7,7,8,8,9,5,6,,,,6,,,,,,,,6"),W=[n,6,13,3,9,-1,27,-15,-10,-1,-38],X=[n,n,n,n,n,n,19,16,15,n,n],Q=e.large_array_unpack("0,0,racc_error,4,20,_reduce_1,4,20,_reduce_2,3,20,_reduce_3,3,21,_reduce_4,2,21,_reduce_5,2,21,_reduce_6,1,21,_reduce_7,0,22,_reduce_8,3,22,_reduce_9,3,22,_reduce_10,3,22,_reduce_11,2,23,_reduce_12,2,23,_reduce_13,3,23,_reduce_14,3,23,_reduce_15,0,24,_reduce_16,2,24,_reduce_17,2,24,_reduce_18,3,28,_reduce_19,3,28,_reduce_20,1,28,_reduce_none,3,27,_reduce_22,4,27,_reduce_23,1,27,_reduce_none,0,29,_reduce_25,1,29,_reduce_26,1,29,_reduce_27,1,29,_reduce_28,1,29,_reduce_29,2,26,_reduce_30,2,26,_reduce_31,1,26,_reduce_none,3,25,_reduce_33,1,25,_reduce_34"),se=Y(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),M(w[0],"Racc_arg",[b,i,t,g,o,$,X,W,19,Q,se,58,35,!0]),M(w[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),M(w[0],"Racc_debug_parser",!1),z(_,"$_reduce_1",function(C,Z,j){var A,O=this;return N(O.modifier)||O.$raise(R("ParseError")),A=m(C),O.$parsed(null==A[0]?n:A[0],null==A[1]?n:A[1],null==A[2]?n:A[2],null==A[3]?n:A[3])}),z(_,"$_reduce_2",function(C,Z,j){var A,O=this;return N(O.modifier)||O.$raise(R("ParseError")),A=m(C),O.$parsed(null==A[0]?n:A[0],null==A[2]?n:A[2],null==A[1]?n:A[1],null==A[3]?n:A[3])}),z(_,"$_reduce_3",function(C,Z,j){var A,ae;return ae=null==(A=m(C))[2]?n:A[2],this.$parsed(null==A[0]?n:A[0],null==A[1]?n:A[1],q(q(R("Arithmetic"),"Node"),"Number").$new(0),ae)}),z(_,"$_reduce_4",function(C,Z,j){var A=this;return N(A.prefix_number)&&N(A.suffix_number)||A.$raise(R("ParseError")),V(["command","prefix","suffix"],{command:C["$[]"](1),prefix:C["$[]"](0),suffix:C["$[]"](2)})}),z(_,"$_reduce_5",function(C,Z,j){var A=this;return N(A.prefix_number)||A.$raise(R("ParseError")),N(A.need_suffix_number)&&A.$raise(R("ParseError")),V(["command","prefix"],{command:C["$[]"](1),prefix:C["$[]"](0)})}),z(_,"$_reduce_6",function(C,Z,j){var A=this;return N(A.suffix_number)||A.$raise(R("ParseError")),N(A.need_prefix_number)&&A.$raise(R("ParseError")),V(["command","suffix"],{command:C["$[]"](0),suffix:C["$[]"](1)})}),z(_,"$_reduce_7",function(C,Z,j){var A=this;return(N(A.need_prefix_number)||N(A.need_suffix_number))&&A.$raise(R("ParseError")),V(["command"],{command:C["$[]"](0)})}),z(_,"$_reduce_8",function(C,Z,j){return V([],{})}),z(_,"$_reduce_9",function(C,Z,j){var A,ae,re=n;return re=null==(A=m(C))[0]?n:A[0],ae=null==A[2]?n:A[2],N(this.critical)&&N(re["$[]"]("critical")["$nil?"]())||this.$raise(R("ParseError")),re["$[]="]("critical",ae),re}),z(_,"$_reduce_10",function(C,Z,j){var A,ae,re=n;return re=null==(A=m(C))[0]?n:A[0],ae=null==A[2]?n:A[2],N(this.fumble)&&N(re["$[]"]("fumble")["$nil?"]())||this.$raise(R("ParseError")),re["$[]="]("fumble",ae),re}),z(_,"$_reduce_11",function(C,Z,j){var A,ae,re=n;return re=null==(A=m(C))[0]?n:A[0],ae=null==A[2]?n:A[2],N(this.dollar)&&N(re["$[]"]("dollar")["$nil?"]())||this.$raise(R("ParseError")),re["$[]="]("dollar",ae),re}),z(_,"$_reduce_12",function(C,Z,j){return C["$[]"](1)}),z(_,"$_reduce_13",function(C,Z,j){return q(q(R("Arithmetic"),"Node"),"Negative").$new(C["$[]"](1))}),z(_,"$_reduce_14",function(C,Z,j){return q(q(R("Arithmetic"),"Node"),"BinaryOp").$new(C["$[]"](0),"+",C["$[]"](2))}),z(_,"$_reduce_15",function(C,Z,j){return q(q(R("Arithmetic"),"Node"),"BinaryOp").$new(C["$[]"](0),"-",C["$[]"](2))}),z(_,"$_reduce_16",function(C,Z,j){return N(this.allowed_cmp_op["$include?"](n))||this.$raise(R("ParseError")),V([],{})}),z(_,"$_reduce_17",function(C,Z,j){var A,re,J;return J=null==(A=m(C))[1]?n:A[1],N(this.allowed_cmp_op["$include?"](re=null==A[0]?n:A[0]))||this.$raise(R("ParseError")),V(["cmp_op","target"],{cmp_op:re,target:J})}),z(_,"$_reduce_18",function(C,Z,j){var ee,A=this;return ee=C["$[]"](0),N(A.question_target)||A.$raise(R("ParseError")),N(A.allowed_cmp_op["$include?"](ee))||A.$raise(R("ParseError")),V(["cmp_op","target"],{cmp_op:ee,target:"?"})}),z(_,"$_reduce_19",function(C,Z,j){return q(q(R("Arithmetic"),"Node"),"BinaryOp").$new(C["$[]"](0),"+",C["$[]"](2))}),z(_,"$_reduce_20",function(C,Z,j){return q(q(R("Arithmetic"),"Node"),"BinaryOp").$new(C["$[]"](0),"-",C["$[]"](2))}),z(_,"$_reduce_22",function(C,Z,j){return q(q(R("Arithmetic"),"Node"),"BinaryOp").$new(C["$[]"](0),"*",C["$[]"](2))}),z(_,"$_reduce_23",function(C,Z,j){return C["$[]"](3).$new(C["$[]"](0),C["$[]"](2))}),z(_,"$_reduce_25",function(C,Z,j){return q(q(R("Arithmetic"),"Node"),"DivideWithGameSystemDefault")}),z(_,"$_reduce_26",function(C,Z,j){return q(q(R("Arithmetic"),"Node"),"DivideWithCeil")}),z(_,"$_reduce_27",function(C,Z,j){return q(q(R("Arithmetic"),"Node"),"DivideWithCeil")}),z(_,"$_reduce_28",function(C,Z,j){return q(q(R("Arithmetic"),"Node"),"DivideWithRound")}),z(_,"$_reduce_29",function(C,Z,j){return q(q(R("Arithmetic"),"Node"),"DivideWithFloor")}),z(_,"$_reduce_30",function(C,Z,j){return C["$[]"](1)}),z(_,"$_reduce_31",function(C,Z,j){return q(q(R("Arithmetic"),"Node"),"Negative").$new(C["$[]"](1))}),z(_,"$_reduce_33",function(C,Z,j){return C["$[]"](1)}),z(_,"$_reduce_34",function(C,Z,j){return q(q(R("Arithmetic"),"Node"),"Number").$new(C["$[]"](0))}),z(_,"$_reduce_none",function(C,Z,j){return C["$[]"](0)})},Opal.modules["bcdice/deprecated/checker"]=function(e){var P,M,G,s,d,n,m,H,F=e.module,L=e.send,c=e.eqeqeq,B=e.truthy,x=e.def,S=e.return_val,U=[],E=e.nil;return P=U,M=H=[F(U[0],"BCDice")].concat(P),G=m=[F(H[0],"Deprecated")].concat(M),d=[s=F(m[0],"Checker")].concat(G),n=e.$r(d),s.$private(),x(s,"$check_result_legacy",function(r,a,v,I){var p,T=this,k=E,l=E,f=E,h=E;return k=L(a,"map",[],"sides".$to_proc()),p=(l=L(a,"map",[],"value".$to_proc())).$sum(),f=c([100],h=k)?T.$check_1D100(r,p,v,I):c([20],h)?T.$check_1D20(r,p,v,I):c([6,6],h)?T.$check_2D6(r,p,l,v,I):E,(B(f["$nil?"]())||B(f["$empty?"]()))&&(f=c([10],h=k.$uniq())?T.$check_nD10(r,p,l,v,I):c([6],h)?T.$check_nD6(r,p,l,v,I):E,B(f["$nil?"]())||B(f["$empty?"]()))?E:n("Result").$new(f.$delete_prefix(" \uff1e "))}),x(s,"$check_1D100",S(E)),x(s,"$check_1D20",S(E)),x(s,"$check_nD10",S(E)),x(s,"$check_2D6",S(E)),x(s,"$check_nD6",S(E))},Opal.modules["bcdice/base"]=function(e){var d,T,h,R,i,g,u,y,_,w,l,F=e.module,L=e.klass,c=e.slice,B=e.rb_plus,x=e.truthy,S=e.def,U=e.regexp,E=e.send,z=e.thrower,P=e.return_ivar,D=e.assign_ivar_val,H=e.eqeqeq,Y=e.eqeq,M=e.return_val,N=e.range,m=e.rb_minus,V=e.rb_divide,G=e.rb_times,s=e.rb_ge,n=e.top,q=[],r=e.$r(q),a=e.nil,v=e.$$$;return n.$require("i18n"),n.$require("i18n/backend/fallbacks"),n.$require("bcdice/randomizer"),n.$require("bcdice/dice_table"),n.$require("bcdice/enum"),n.$require("bcdice/translate"),n.$require("bcdice/result"),n.$require("bcdice/command/parser"),n.$require("bcdice/deprecated/checker"),T=q,h=l=[F(q[0],"BCDice")].concat(T),y=[u=L(l[0],null,"Base")].concat(h),_=e.$r(y),(w=u.$$prototype).raw_input=w.randomizer=w.enabled_upcase_input=w.debug=a,i=[R=e.get_singleton_class(u)].concat(y),g=e.$r(i),R.$attr_reader("prefixes"),S(R,"$register_prefix",function(o){var W,X=this,Q=a;return null==X.prefixes&&(X.prefixes=a),W=c(arguments),X.prefixes=B(x(Q=X.prefixes)?Q:[],W.$flatten())},-1),S(R,"$register_prefix_from_super_class",function(){return this.$register_prefix(this.$superclass().$prefixes())}),S(R,"$prefixes_pattern",function(){var o=this,$=a;return null==o.prefixes_pattern&&(o.prefixes_pattern=a),null==o.prefixes&&(o.prefixes=a),o.prefixes_pattern=x($=o.prefixes_pattern)?$:a,x(o.prefixes_pattern)?o.prefixes_pattern:(o.prefixes=x($=o.prefixes)?$:[],o.prefixes.$freeze(),o.prefixes_pattern=(x(o.prefixes["$empty?"]())?/(?!)/:U(["^(S)?(",o.prefixes.$join("|"),")"],"i")).$freeze())}),S(R,"$command_pattern",function(){var o=this,$=a,W=a;return null==o.command_pattern&&(o.command_pattern=a),null==o.prefixes&&(o.prefixes=a),o.command_pattern=x($=o.command_pattern)?$:a,x(o.command_pattern)?o.command_pattern:(o.prefixes=x($=o.prefixes)?$:[],o.prefixes.$freeze(),W=B(E(v(g("CommonCommand"),"COMMANDS"),"map",[],function(Q){return null==Q&&(Q=a),v(Q,"PREFIX_PATTERN").$source()}),o.prefixes),o.command_pattern=U(["^S?(",W.$join("|"),")"],"i").$freeze())}),S(R,"$eval",function(o){try{return z("eval_return"),this.$new(o).$eval()}catch(X){if(X===e.t_eval_return)return X.$v;throw X}}),u.$include(_("Translate")),u.$include(v(_("Deprecated"),"Checker")),S(u,"$initialize",function(b){var i=this;return i.raw_input=b,i.sort_add_dice=!1,i.sort_barabara_dice=!1,i.d66_sort_type=v(_("D66SortType"),"NO_SORT"),i.enabled_d9=!1,i.round_type=v(_("RoundType"),"FLOOR"),i.sides_implicit_d=6,i.upper_dice_reroll_threshold=a,i.reroll_dice_reroll_threshold=a,i.default_cmp_op=a,i.default_target_number=a,i.enabled_upcase_input=!0,i.locale="ja_jp",i.randomizer=v(_("BCDice"),"Randomizer").$new(),i.debug=!1}),u.$attr_accessor("randomizer"),u.$attr_reader("d66_sort_type"),u.$attr_reader("round_type"),u.$attr_reader("sides_implicit_d"),u.$attr_reader("upper_dice_reroll_threshold"),u.$attr_reader("reroll_dice_reroll_threshold"),u.$attr_reader("default_cmp_op"),u.$attr_reader("default_target_number"),S(u,"$sort_add_dice?",P("sort_add_dice")),S(u,"$sort_barabara_dice?",P("sort_barabara_dice")),S(u,"$enabled_d9?",P("enabled_d9")),S(u,"$enable_debug",D("debug",!0)),S(u,"$eval",function(){var i,t,b=this,g=a;return i=v(_("BCDice"),"Preprocessor").$process(b.raw_input,b),g=x(t=b.$dice_command(i))?t:b.$eval_common_command(b.raw_input),x(g)?(g["$rands="](b.randomizer.$rand_results()),g["$detailed_rands="](b.randomizer.$detailed_rand_results()),g):a}),S(u,"$change_text",function(b){return b}),S(u,"$check_result",function(b,i,g,t){var o=this,$=a,W=a,X=a,Q=a,ne=a;return $=o.$check_result_legacy(b,i,g,t),x($)?$:(W=E(i,"map",[],"sides".$to_proc()),Q=(X=E(i,"map",[],"value".$to_proc())).$sum(),$=H([100],ne=W)?o.$result_1d100(b,Q,g,t):H([20],ne)?o.$result_1d20(b,Q,g,t):H([6,6],ne)?o.$result_2d6(b,Q,X,g,t):a,Y($,_("Result").$nothing())?a:x($)?$:($=H([10],ne=W.$uniq())?o.$result_nd10(b,Q,X,g,t):H([6],ne)?o.$result_nd6(b,Q,X,g,t):a,Y($,_("Result").$nothing())?a:x($)?$:o.$result_ndx(b,g,t)))}),S(u,"$grich_text",M(a)),u.$private(),S(u,"$eval_common_command",function(b){try{z("eval_return");var g=z("return");return b=this.$change_text(b),E(v(_("CommonCommand"),"COMMANDS"),"each",[],function o($){var X,W=null==o.$$s?this:o.$$s;if(null==W.randomizer&&(W.randomizer=a),null==$&&($=a),X=$.$eval(b,W,W.randomizer),!x(X))return a;g.$throw(X)},{$$s:this,$$ret:g}),a}catch(o){if(o===e.t_eval_return||o===g)return o.$v;throw o}}),S(u,"$dice_command",function(b){var i=this,g=a,t=a,o=a,$=a;return x(i.enabled_upcase_input)&&(b=b.$upcase()),g=i.$class().$prefixes_pattern().$match(b),x(g)?(t=g["$[]"](1)["$nil?"]()["$!"](),x(t)&&(b=b["$[]"](N(1,-1,!1))),o=i.$eval_game_system_specific_command(b),x(o["$is_a?"](_("Result")))?(o["$secret="](x($=o["$secret?"]())?$:t),o):x(o["$nil?"]())||x(o["$empty?"]())||Y(o,"1")?a:E(_("Result").$new(),"tap",[],function(X){var Q;return null==X&&(X=a),X["$text="](o.$to_s()),E(X,"secret=",Q=[t]),Q[Q.length-1]})):a}),S(u,"$eval_game_system_specific_command",M(a)),S(u,"$result_ndx",function(b,i,g){return x(g["$is_a?"](_("String")))?a:x(b.$send(i,g))?_("Result").$success(this.$translate("success")):_("Result").$failure(this.$translate("failure"))}),S(u,"$result_1d100",M(a)),S(u,"$result_1d20",M(a)),S(u,"$result_nd10",M(a)),S(u,"$result_2d6",M(a)),S(u,"$result_nd6",M(a)),S(u,"$get_table_by_2d6",function(b){return this.$get_table_by_nD6(b,2)}),S(u,"$get_table_by_1d6",function(b){return this.$get_table_by_nD6(b,1)}),S(u,"$get_table_by_nD6",function(b,i){return this.$get_table_by_nDx(b,i,6)}),S(u,"$get_table_by_nDx",function(b,i,g){var o,$=a;return o=this.randomizer.$roll_sum(i,g),$=this.$get_table_value(b["$[]"](m(o,i))),x($["$nil?"]())?["1",0]:[$,o]}),S(u,"$get_table_by_1d3",function(b){var t,o,i=this,$=a;return i.$debug("get_table_by_1d3"),t=i.randomizer.$roll_sum(1,6),i.$debug("num",t),o=V(m(t,1),2).$to_i(),i.$debug("index",o),$=b["$[]"](o),x($["$nil?"]())?["1",0]:[$,t]}),S(u,"$get_table_by_d66_swap",function(b){var g;return g=this.randomizer.$roll_d66(v(_("D66SortType"),"ASC")),[this.$get_table_by_number(g,b),g]}),S(u,"$get_table_by_d66",function(b){var g,t,o,W,$=a;return g=this.randomizer.$roll_once(6),t=this.randomizer.$roll_once(6),o=B(G(m(g,1),6),m(t,1)),$=b["$[]"](o),W=""+g+t,x($["$nil?"]())?["1",W]:[$,W]}),S(u,"$get_table_by_number",function(b,i,g){try{var t=z("return");return null==g&&(g="1"),E(i,"each",[],function $(W){var Q,X=null==$.$$s?this:$.$$s;if(null==W&&(W=a),Q=W["$[]"](0),!x(s(Q,b)))return a;t.$throw(X.$get_table_value(W["$[]"](1)))},{$$s:this,$$ret:t}),this.$get_table_value(g)}catch($){if($===t)return $.$v;throw $}},-3),S(u,"$get_table_value",function(b){return x(b["$is_a?"](_("Proc")))?b.$call():b}),S(u,"$roll_tables",function(b,i){var t=a;return t=i["$[]"](b),x(t)?t.$roll(this.randomizer).$to_s():a}),S(u,"$debug",function(b,i){var t,o=this,$=a,W=a;return t=c(arguments,1),x(o.debug)?($=x(b["$is_a?"](_("String")))?b:b.$inspect(),x(t["$empty?"]())?o.$warn($):(W=E(t,"map",[],function(Q){return null==Q&&(Q=a),x(Q["$is_a?"](_("String")))?'"'+Q+'"':Q.$inspect()}),o.$warn($+": "+W.$join(", ")))):a},-2),v(v(r("I18n"),"Backend"),"Simple").$include(v(v(r("I18n"),"Backend"),"Fallbacks")),r("I18n").$load_path()["$<<"](r("Dir")["$[]"](r("File").$join("bcdice","../../i18n/**/*.yml"))),r("I18n")["$default_locale="]("ja_jp"),d=[["ja_jp"]],E(r("I18n").$fallbacks(),"defaults=",d),d[d.length-1]},Opal.queue(function(e){var s,r,l,p,f,h,v,I,n,F=e.module,L=e.klass,c=e.const_set,B=e.hash2,x=e.truthy,S=e.eqeq,U=e.send,E=e.rb_plus,z=e.rb_times,P=e.def,D=e.not,H=e.rb_le,Y=e.rb_ge,N=[],m=e.nil,V=e.$$$;return e.top.$require("bcdice/base"),s=N,r=n=[F(N[0],"BCDice")].concat(s),v=[F(n[0],"GameSystem")].concat(r),I=e.$r(v),l=v,f=[p=L(v[0],I("Base"),"SamsaraBallad")].concat(l),h=e.$r(f),p.$$prototype.randomizer=m,c(f[0],"ID","SamsaraBallad"),c(f[0],"NAME","\u30b5\u30f3\u30b5\u30fc\u30e9\u30fb\u30d0\u30e9\u30c3\u30c9"),c(f[0],"SORT_KEY","\u3055\u3093\u3055\u3042\u3089\u306f\u3089\u3064\u3068"),c(f[0],"HELP_MESSAGE","SB\t \u901a\u5e38\u306eD100\u30ed\u30fc\u30eb\u3092\u884c\u3046\nSBS\t \u30b9\u30ef\u30c3\u30d7\u30ed\u30fc\u30eb\u3067D100\u30ed\u30fc\u30eb\u3092\u884c\u3046\nSB#x@y\t F\u5024\u3092x\u3001C\u5024\u3092y\u3068\u3057\u3066\u901a\u5e38\u306eD100\u30ed\u30fc\u30eb\u3092\u884c\u3046\nSBS#x@y\t F\u5024\u3092x\u3001C\u5024\u3092y\u3068\u3057\u3066\u30b9\u30ef\u30c3\u30d7\u30ed\u30fc\u30eb\u3067D100\u30ed\u30fc\u30eb\u3092\u884c\u3046\n\n\u4f8b\uff1a\nSB<=85 \u901a\u5e38\u306e\u6280\u80fd\u3067\u6210\u529f\u738785%\u306e\u5224\u5b9a\nSBS<=70 \u7fd2\u719f\u3092\u5f97\u305f\u6280\u80fd\u3067\u6210\u529f\u738770%\u306e\u5224\u5b9a\nSBS#3@7<=80 \u7fd2\u719f\u3092\u5f97\u305f\u6280\u80fd\u3067\u3001F\u50243\u3001C\u50247\u3067\u6210\u529f\u738780%\u306e\u653b\u6483\u5224\u5b9a\nSB<57 \u901a\u5e38\u306e\u6280\u80fd\u3067\u3001\u80fd\u52d5\u5074\u306e\u9054\u6210\u5024\u304c57\u306e\u53d7\u52d5\u5224\u5b9a\nSBS<70 \u7fd2\u719f\u3092\u5f97\u305f\u6280\u80fd\u3067\u3001\u80fd\u52d5\u5074\u306e\u9054\u6210\u5024\u304c70\u306e\u53d7\u52d5\u5224\u5b9a\n"),p.$register_prefix("SBS?"),P(p,"$eval_game_system_specific_command",function(_){var w=this,b=m,i=m,g=m,t=m,o=m,$=m,W=m,X=m,Q=m,ne=m;return w.$debug("eval_game_system_specific_command Begin"),b=V(h("Command"),"Parser").$new("SBS","SB",B(["round_type"],{round_type:w.$round_type()})).$enable_critical().$enable_fumble().$restrict_cmp_op_to(m,"<=","<").$parse(_),x(b)?(S(b.$command(),"SB")?(i=m,g=w.randomizer.$roll_once(100)):(i=(t=w.randomizer.$roll_once(10))+","+(o=w.randomizer.$roll_once(10)),$=U([t,o],"map",[],function(se){return null==se&&(se=m),S(se,10)?0:se}).$sort(),g=E(z($["$[]"](0),10),$["$[]"](1)),S(g,0)&&(g=100)),W=w.$compare(g,b),X=x(W["$failure?"]())?"\u5931\u6557":x(W["$success?"]())?"\u6210\u529f":m,Q=x(W["$fumble?"]())?"\u30d5\u30a1\u30f3\u30d6\u30eb":x(W["$critical?"]())?"\u30af\u30ea\u30c6\u30a3\u30ab\u30eb":m,ne=["(D100"+b.$cmp_op()+b.$target_number()+")",i,g.$to_s(),X,Q].$compact(),W["$text="](ne.$join(" \uff1e ")),W):m}),p.$private(),P(p,"$compare",function(_,w){var R=this;return x(["<=","<"]["$include?"](w.$cmp_op()))?D(_.$send(w.$cmp_op(),w.$target_number()))?h("Result").$failure(m):x(R["$fumble_?"](_,w.$fumble()))?U(h("Result").$new(),"tap",[],function(i){var g;return null==i&&(i=m),i["$success="](!0),U(i,"fumble=",g=[!0]),g[g.length-1]}):x(R["$critical_?"](_,w.$critical()))?h("Result").$critical(m):h("Result").$success(m):x(R["$fumble_?"](_,w.$fumble()))?U(h("Result").$new(),"tap",[],function(i){var g;return null==i&&(i=m),U(i,"fumble=",g=[!0]),g[g.length-1]}):x(R["$critical_?"](_,w.$critical()))?U(h("Result").$new(),"tap",[],function(i){var g;return null==i&&(i=m),U(i,"critical=",g=[!0]),g[g.length-1]}):h("Result").$new()}),P(p,"$fumble_?",function(_,w){var R;return x(R=w)?H(_["$%"](10),w):R}),P(p,"$critical_?",function(_,w){var R;return x(R=w)?Y(_["$%"](10),w):R})})}}]);