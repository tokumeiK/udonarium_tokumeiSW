(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[5188],{6450:(ge,xe,ne)=>{ne(9993),Opal.queue(function(l){var oe,ce,ve,s,B,b,L,N,me,O,Q=l.module,re=l.klass,C=l.const_set,te=l.send2,ie=l.find_super,c=l.def,i=l.truthy,d=l.send,I=l.rb_ge,g=l.rb_minus,o=l.rb_plus,k=l.rb_gt,w=l.eqeq,le=l.neqeq,U=l.thrower,W=l.rb_lt,K=l.rb_times,ue=l.hash2,X=l.rb_divide,Z=l.rb_le,F=[],e=l.nil,se=l.$$$;return oe=F,ce=O=[Q(F[0],"BCDice")].concat(oe),N=[Q(O[0],"GameSystem")].concat(ce),me=l.$r(N),ve=N,B=[s=re(N[0],me("Base"),"TunnelsAndTrolls")].concat(ve),b=l.$r(B),(L=s.$$prototype).dice_total=L.count_6=L.randomizer=L.dice_list=e,C(B[0],"ID","TunnelsAndTrolls"),C(B[0],"NAME","\u30c8\u30f3\u30cd\u30eb\u30ba\uff06\u30c8\u30ed\u30fc\u30eb\u30ba"),C(B[0],"SORT_KEY","\u3068\u3093\u306d\u308b\u3059\u3042\u3093\u3068\u3068\u308d\u304a\u308b\u3059"),C(B[0],"HELP_MESSAGE",'\u30fb\u884c\u70ba\u5224\u5b9a\u3000(nD6+x>=nLV)\n\u5931\u6557\u3001\u6210\u529f\u3001\u81ea\u52d5\u5931\u6557\u306e\u81ea\u52d5\u5224\u5b9a\u3068\u30be\u30ed\u76ee\u306e\u632f\u308a\u8db3\u3057\u7d4c\u9a13\u5024\u306e\u81ea\u52d5\u8a08\u7b97\u3092\u884c\u3044\u307e\u3059\u3002\nSAVE\u306e\u96e3\u6613\u5ea6\u3092\u300c\u30ec\u30d9\u30eb\u300d\u3067\u8868\u8a18\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u300c2Lv\u300d\u3068\u66f8\u304f\u3068\u300c25\u300d\u306b\u7f6e\u63db\u3055\u308c\u307e\u3059\u3002\n\u5224\u5b9a\u6642\u4ee5\u5916\u306f\u60aa\u610f\u30c0\u30e1\u30fc\u30b8\u3092\u8868\u793a\u3057\u307e\u3059\u3002\n\u30d0\u30fc\u30b5\u30fc\u30af\u3068\u30cf\u30a4\u30d1\u30fc\u30d0\u30fc\u30b5\u30fc\u30af\u7528\u306b\u5c02\u7528\u30b3\u30de\u30f3\u30c9\u304c\u4f7f\u3048\u307e\u3059\u3002\n\u4f8b\uff092D6+1>=1Lv\n\u3000 (2D6+1>=20) \uff1e 7[2,5]+1 \uff1e 8 \uff1e \u5931\u6557\n\u3000\u5224\u5b9a\u6642\u306b\u306f\u30be\u30ed\u76ee\u3092\u81ea\u52d5\u3067\u632f\u308a\u8db3\u3057\u307e\u3059\u3002\n\n\u30fb\u30d0\u30fc\u30b5\u30fc\u30af\u3068\u30cf\u30a4\u30d1\u30fc\u30d0\u30fc\u30b5\u30fc\u30af\u3000(nBS+x or nHBS+x)\n\u3000"(\u30c0\u30a4\u30b9\u6570)BS(\u4fee\u6b63\u5024)"\u3067\u30d0\u30fc\u30b5\u30fc\u30af\u3001"(\u30c0\u30a4\u30b9\u6570)HBS(\u4fee\u6b63\u5024)"\u3067\u30cf\u30a4\u30d1\u30fc\u30d0\u30fc\u30b5\u30fc\u30af\u3067\u30ed\u30fc\u30eb\u3067\u304d\u307e\u3059\u3002\n\u3000\u6700\u521d\u306e\u30c0\u30a4\u30b9\u306e\u8aad\u66ff\u306f\u3001\u500b\u5225\u306e\u51fa\u76ee\u306f\u305d\u306e\u307e\u307e\u3067\u8868\u793a\u3002\n\u3000\u4e0b\u304b\u3089\uff12\u756a\u76ee\u306e\u51fa\u76ee\u3092\u305a\u3089\u3057\u305f\u5206\u3060\u3051\u5408\u8a08\u306b\u30de\u30a4\u30ca\u30b9\u4fee\u6b63\u3092\u8ffd\u52a0\u3057\u3066\u8868\u793a\u3057\u307e\u3059\u3002\n'),s.$register_prefix("\\d+H?BS","\\d+R6","\\d+D\\d+"),c(s,"$initialize",function _($){var r=this;return _.$$p=null,te(r,ie(r,"initialize",_,!1,!0),"initialize",[$],null),r.sort_add_dice=!0}),s.$private(),c(s,"$replace_text",function($){return i(/BS/i["$=~"]($))&&($=d($,"gsub",[/(\d+)HBS([^\d\s][+\-\d]+)/i],function(){return b("Regexp").$last_match(1)+"R6"+b("Regexp").$last_match(2)+"[H]"}),$=d($,"gsub",[/(\d+)HBS/i],function(){return b("Regexp").$last_match(1)+"R6[H]"}),$=d($,"gsub",[/(\d+)BS([^\d\s][+\-\d]+)/i],function(){return b("Regexp").$last_match(1)+"R6"+b("Regexp").$last_match(2)}),$=d($,"gsub",[/(\d+)BS/i],function(){return b("Regexp").$last_match(1)+"R6"})),$}),c(s,"$eval_game_system_specific_command",function($){try{U("eval_return");var r=this,n=e,f=e,y=e,a=e,x=e,m=e,h=e,v=e,Y=e,D=e,S=e,J=e;return i(/^\d+D\d+/i["$match?"]($))?r.$roll_action($):($=r.$replace_text($),r.$debug("tandt_berserk string",$),n="1",i(f=/(^|\s)S?((\d+)[rR]6([+\-\d]*)(\[(\w+)\])?)(\s|$)/i.$match($))&&(r.$debug("tandt_berserk matched"),$=f["$[]"](2),y=f["$[]"](3).$to_i(),a=0,i(f["$[]"](4))&&(a=b("ArithmeticEvaluator").$eval(f["$[]"](4))),x=!1,i(f["$[]"](5))&&i(f["$[]"](6)["$=~"](/[Hh]/))&&(x=!0),m=[],h=0,v="",Y=!0,D=0,S=0,r.$debug("isHyperBerserk",x),m.$push(y),function(){try{var q=U("break");d(r,"loop",[],function z(){var M,ee,p=null==z.$$s?this:z.$$s,A=e,V=e,$e=e,G=e,R=e,E=e,H=e;if(null==p.randomizer&&(p.randomizer=e),p.$debug("loop dice_arr",m),M=m.$shift(),p.$debug("roll dice_wk d6",M),ee=(A=p.randomizer.$roll_barabara(M,6).$sort()).$sum(),V=A.$count(6),i(I(M,2))&&($e=A,R=[],d(G=6,"times",[],function(u){return null==u&&(u=e),R.$push(0)}),d($e,"each",[],function(u){var T;return null==u&&(u=e),T=[g(u,1),o(R["$[]"](g(u,1)),1)],d(R,"[]=",T),T[T.length-1]}),d(R,"each",[],function(u){return null==u&&(u=e),i(I(u,2))?(i(x)&&(u=o(u,1)),m.$push(u)):e}),i(Y)&&i(m["$empty?"]())&&(E=0,H=0,d(G,"times",[],function j(u){var P,T=null==j.$$s?this:j.$$s;return null==u&&(u=e),P=g(g(G,u),1),T.$debug("diceType index",P),i(k(R["$[]"](P),0))?(H=E,E=P):e},{$$s:p}),p.$debug("min1, min2",E,H),S=g(H,E)["$-@"](),w(H,5)&&(V=g(V,1)),i(x)?m.$push(3):m.$push(2))),h=o(h,ee),le(v,"")&&(v=o(v,"][")),v=o(v,A.$join(",")),D=o(D,V),Y=!1,p.$debug("loop last chek dice_arr",m),!i(m["$empty?"]()))return e;q.$throw()},{$$s:r})}catch(z){if(z===q)return z.$v;throw z}}(),r.$debug("loop breaked"),r.$debug("dice_now, bonus, bonus2",h,a,S),J=o(o(h,a),S),n=h+(v="["+v+"]"),i(W(S,0))&&(r.$debug("bonus2",S),n=o(n,S.$to_s())),r.$debug("bonus",a),i(k(a,0))?n=o(n,"+"+a):i(W(a,0))&&(n=o(n,a.$to_s())),n=i(n["$=~"](/[^\d\[\]]+/))?"("+$+") \uff1e "+n+" \uff1e "+J:"("+$+") \uff1e "+J,i(k(D,0))&&(n=o(n," \uff1e \u60aa\u610f"+D))),n)}catch(q){if(q===l.t_eval_return)return q.$v;throw q}}),c(s,"$roll_action",function($){var t=this,n=e,f=e,y=e,a=e;return $=d($,"sub",[/\d+LV$/i],function(h){return null==h&&(h=e),o(K(h.$to_i(),5),15)}),n=se(b("Command"),"Parser").$new(/\d+D6/,ue(["round_type"],{round_type:t.$round_type()})).$restrict_cmp_op_to(e,">=").$enable_question_target().$parse($),i(n)?(f=n.$command().$to_i(),t.$roll_action_dice(f),y=o(t.dice_total,n.$modify_number()),a=i(n["$question_target?"]())?"?":n.$target_number(),["("+n+")",t.$interim_expr(n,t.dice_total),y.$to_s(),t.$action_result(y,t.dice_total,a),t.$additional_result(t.count_6)].$compact().$join(" \uff1e ")):e}),c(s,"$roll_action_dice",function($){var t=this,r=e,n=e;for(r=t.randomizer.$roll_barabara($,6).$sort(),t.dice_list=[r];i(t["$same_all_dice?"](r));)r=t.randomizer.$roll_barabara($,6).$sort(),t.dice_list.$push(r);return n=t.dice_list.$flatten(),t.dice_total=n.$sum(),t.count_6=n.$count(6)}),c(s,"$same_all_dice?",function($){var t;return i(t=k($.$size(),1))?$.$uniq().$size()["$=="](1):t}),c(s,"$interim_expr",function($,t){var n=e,f=e;return w(this.dice_list.$flatten().$size(),1)&&w($.$modify_number(),0)?e:(n=d(this.dice_list,"map",[],function(a){return null==a&&(a=e),"["+a.$join(",")+"]"}).$join(""),f=b("Format").$modifier($.$modify_number()),[t.$to_s(),n,f].$join(""))}),c(s,"$action_result",function($,t,r){return w(t,3)?"\u81ea\u52d5\u5931\u6557":i(r["$nil?"]())?e:w(r,"?")?this.$success_level($,t):i(I($,r))?"\u6210\u529f \uff1e \u7d4c\u9a13\u5024"+this.$experience_point(r,t):"\u5931\u6557"}),c(s,"$success_level",function($,t){var r;return r=X(g($,15),5).$to_i(),i(Z(r,0))?"\u5931\u6557 \uff1e \u7d4c\u9a13\u5024"+t:r+"Lv\u6210\u529f \uff1e \u7d4c\u9a13\u5024"+t}),c(s,"$experience_point",function($,t){var n=e;return n=K(X(K(1,g($,15)),5),t),i(Z(n,0))?"0":i(this["$int?"](n))?n.$to_i().$to_s():this.$format("%.1f",n)}),c(s,"$int?",function($){return $["$=="]($.$to_i())}),c(s,"$additional_result",function($){return i(k($,0))?"\u60aa\u610f"+$:e})})}}]);