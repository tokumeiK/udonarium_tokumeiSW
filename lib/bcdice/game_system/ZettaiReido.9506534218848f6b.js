(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[4999],{6698:(he,be,ve)=>{ve(9993),Opal.modules["i18n/backend/fallbacks"]=function(e){var G,n,r,a,u,h,F=e.module,L=e.class_variable_set,_=e.truthy,P=e.class_variable_get,R=e.def,q=e.send,U=e.send2,E=e.find_super,z=e.hash2,N=e.find_block_super,w=e.neqeq,H=e.thrower,Y=e.return_val,M=[],A=e.nil,l=e.$$$;return G=M,h=[u=F(M[0],"I18n")].concat(G),L(h[0],"@@fallbacks",A),n=e.get_singleton_class(u),r=[n].concat(h),a=e.$r(r),R(n,"$fallbacks",function(){var S=A;return L(r[1],"@@fallbacks",_(null!=r[1].$$cvars["@@fallbacks"]?"class variable":A)&&_(S=P(r[1],"@@fallbacks",!1))?S:l(l(a("I18n"),"Locale"),"Fallbacks").$new()),_(S=a("Thread").$current()["$[]"]("i18n_fallbacks"))?S:P(r[1],"@@fallbacks",!1)}),R(n,"$fallbacks=",function(C){var S;return L(r[1],"@@fallbacks",_(C["$is_a?"](a("Array")))?l(l(a("I18n"),"Locale"),"Fallbacks").$new(C):C),S=["i18n_fallbacks",P(r[1],"@@fallbacks",!1)],q(a("Thread").$current(),"[]=",S),S[S.length-1]}),function(n,T){var C,S,k,o,a=[F(n,"Backend")].concat(T);return C=a,k=[S=F(a[0],"Fallbacks")].concat(C),o=e.$r(k),R(S,"$translate",function p(m,y,c){try{var f=H("return"),s=p.$$p||A,x=this,b=A,v=A;return p.$$p=null,null==c&&(c=o("EMPTY_HASH")),_(c.$fetch("fallback",!0))?_(c["$[]"]("fallback_in_progress"))?U(x,E(x,"translate",p,!1,!0),"translate",[m,y,c],s):(_(c["$[]"]("default"))&&(b=x["$extract_non_symbol_default!"](c)),v=c.$merge(z(["fallback_in_progress"],{fallback_in_progress:!0})),q(o("I18n").$fallbacks()["$[]"](m),"each",[],function $(D){var t=null==$.$$s?this:$.$$s;null==D&&(D=A);try{return q(t,"catch",["exception"],function d(){var i=null==d.$$s?this:d.$$s,W=A;if(W=U(i,N(i,"translate",d.$$def||$.$$def||p,!1,!1),"translate",[D,y,v],null),_(W["$nil?"]()))return A;w(m.$to_s(),D.$to_s())&&i.$on_fallback(m,D,y,c),f.$throw(W)},{$$s:t,$$ret:f})}catch(d){if(!e.rescue(d,[l(o("I18n"),"InvalidLocale")]))throw d;try{return A}finally{e.pop_exception()}}},{$$s:x}),_(c["$key?"]("default"))&&_(c["$[]"]("default")["$nil?"]())?A:_(b)?U(x,E(x,"translate",p,!1,!0),"translate",[m,A,c.$merge(z(["default"],{default:b}))],null):x.$throw("exception",l(o("I18n"),"MissingTranslation").$new(m,y,c))):U(x,E(x,"translate",p,!1,!0),"translate",[m,y,c],s)}catch($){if($===f)return $.$v;throw $}},-3),R(S,"$extract_non_symbol_default!",function(m){var c,y=A;return y=[m["$[]"]("default")].$flatten(),c=q(y,"detect",[],function(s){return null==s&&(s=A),s["$is_a?"](o("Symbol"))["$!"]()}),_(c)&&m["$[]="]("default",y["$[]"](0,y.$index(c))),c}),R(S,"$exists?",function p(m,y,c){try{var f=H("return"),s=p.$$p||A,x=this;return p.$$p=null,null==c&&(c=o("EMPTY_HASH")),_(c.$fetch("fallback",!0))?(q(o("I18n").$fallbacks()["$[]"](m),"each",[],function b(v){var $=null==b.$$s?this:b.$$s;null==v&&(v=A);try{if(!_(U($,N($,"exists?",b.$$def||p,!1,!1),"exists?",[v,y],null)))return A;f.$throw(!0)}catch(D){if(!e.rescue(D,[l(o("I18n"),"InvalidLocale")]))throw D;try{return A}finally{e.pop_exception()}}},{$$s:x,$$ret:f}),!1):U(x,E(x,"exists?",p,!1,!0),"exists?",[m,y,c],s)}catch(b){if(b===f)return b.$v;throw b}},-3),S.$private(),R(S,"$on_fallback",Y(A))}(h[0],h)},Opal.modules["bcdice/randomizer"]=function(e){var u,g,C,S,k,o,n,T,L=e.klass,_=e.const_set,P=e.def,R=e.truthy,q=e.rb_gt,U=e.rb_plus,E=e.rb_le,z=e.send,N=e.rb_minus,w=e.eqeq,H=e.rb_times,Y=e.eqeqeq,M=e.rb_ge,A=[],l=e.nil,Z=e.$$$;return u=A,n=[(0,e.module)(A[0],"BCDice")].concat(u),T=e.$r(n),g=n,S=[C=L(n[0],null,"Randomizer")].concat(g),k=e.$r(S),(o=C.$$prototype).rand_results=o.detailed_rand_results=l,_(S[0],"UPPER_LIMIT_DICE_TIMES",200),_(S[0],"UPPER_LIMIT_DICE_SIDES",1e4),_(S[0],"UPPER_LIMIT_RANDS",1e4),P(C,"$initialize",function(){return this.rand_results=[],this.detailed_rand_results=[]}),C.$attr_reader("rand_results"),C.$attr_reader("detailed_rand_results"),_(S[0],"DetailedRandResult",k("Struct").$new("kind","sides","value")),P(C,"$roll_barabara",function(m,y){var c=this;return R(q(U(c.rand_results.$size(),m),k("UPPER_LIMIT_RANDS")))&&c.$raise(k("TooManyRandsError")),R(E(m,0))||R(q(m,k("UPPER_LIMIT_DICE_TIMES")))?[]:z(k("Array"),"new",[m],function f(){return(null==f.$$s?this:f.$$s).$roll_once(y)},{$$s:c})}),P(C,"$roll_sum",function(m,y){return this.$roll_barabara(m,y).$sum()}),P(C,"$roll_once",function(m){var c=l;return R(E(m,0))||R(q(m,k("UPPER_LIMIT_DICE_SIDES")))?0:(c=this.$rand_inner(m),this.$push_to_detail("normal",m,c),c)}),P(C,"$roll_index",function(m){return N(this.$roll_once(m),1)}),P(C,"$roll_tens_d10",function(){var c,y=l;return y=this.$rand_inner(10),w(y,10)&&(y=0),c=H(y,10),this.$push_to_detail("tens_d10",10,c),c}),P(C,"$roll_d9",function(){var y;return y=N(this.$rand_inner(10),1),this.$push_to_detail("d9",10,y),y}),P(C,"$roll_d66",function(m){var f,c=l;return c=z(k("Array"),"new",[2],function s(){return(null==s.$$s?this:s.$$s).$roll_once(6)},{$$s:this}),Y(Z(k("D66SortType"),"ASC"),f=m)?c["$sort!"]():Y(Z(k("D66SortType"),"DESC"),f)&&c["$sort!"]()["$reverse!"](),U(H(c["$[]"](0),10),c["$[]"](1))}),C.$private(),P(C,"$rand_inner",function(m){var c,y=this;return R(M(y.rand_results.$size(),k("UPPER_LIMIT_RANDS")))&&y.$raise(k("TooManyRandsError")),c=y.$random(m),y.rand_results["$<<"]([c,m]),c}),P(C,"$random",function(m){return U(k("Kernel").$rand(m),1)}),P(C,"$push_to_detail",function(m,y,c){var s;return s=k("DetailedRandResult").$new(m,y,c),this.detailed_rand_results.$push(s)}),L(n[0],T("StandardError"),"TooManyRandsError"),l},Opal.modules["bcdice/dice_table/roll_result"]=function(e){var z,Y,G,u,h,n,T,A,w,F=e.module,L=e.klass,_=e.def,P=e.truthy,R=e.return_val,q=[],U=e.nil;return z=q,Y=w=[F(q[0],"BCDice")].concat(z),G=A=[F(w[0],"DiceTable")].concat(Y),h=[u=L(A[0],null,"RollResult")].concat(G),n=e.$r(h),(T=u.$$prototype).table_name=T.value=T.body=U,_(u,"$initialize",function(a,g,C){var S=this;return S.table_name=a,S.value=g,S.body=C}),u.$attr_reader("table_name"),u.$attr_reader("value"),u.$attr_reader("body"),_(u,"$to_s",function(){var a=this;return a.table_name+"("+a.value+") \uff1e "+a.body}),_(u,"$last_body",function(){var a=this;return P(a.body["$is_a?"](n("RollResult")))?a.body.$last_body():a.body}),_(u,"$empty?",R(!1))},Opal.modules["bcdice/dice_table/chain_table"]=function(e){var z,Y,G,u,h,n,T,A,w,F=e.module,L=e.klass,_=e.truthy,P=e.def,R=e.rb_minus,q=[],U=e.nil;return z=q,Y=w=[F(q[0],"BCDice")].concat(z),G=A=[F(w[0],"DiceTable")].concat(Y),h=[u=L(A[0],null,"ChainTable")].concat(G),n=e.$r(h),(T=u.$$prototype).times=T.sides=T.items=T.name=U,P(u,"$initialize",function(a,g,C){var S=this,k=U;return S.name=a,S.items=C.$freeze(),k=/(\d+)D(\d+)/i.$match(g),_(k)||S.$raise(n("ArgumentError"),"Unexpected table type: "+g),S.times=k["$[]"](1).$to_i(),S.sides=k["$[]"](2).$to_i()}),P(u,"$roll",function(a){var C,S,g=this,k=U;return C=a.$roll_sum(g.times,g.sides),S=R(C,g.times),k=g.items["$[]"](S),_(k["$respond_to?"]("roll"))&&(k=k.$roll(a)),n("RollResult").$new(g.name,C,k)})},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(e){var H,l,n,T,r,a,g,G,M,F=e.module,L=e.klass,_=e.hash2,P=e.defs,R=e.def,q=e.rb_plus,U=e.rb_times,E=e.rb_minus,z=[],N=e.nil;return H=z,l=M=[F(z[0],"BCDice")].concat(H),n=G=[F(M[0],"DiceTable")].concat(l),r=[T=L(G[0],null,"D66GridTable")].concat(n),a=e.$r(r),(g=T.$$prototype).name=g.items=N,P(T,"$from_i18n",function(S,k){var p=N;return p=a("I18n").$t(S,_(["locale","raise"],{locale:k,raise:!0})),this.$new(p["$[]"]("name"),p["$[]"]("items"))}),R(T,"$initialize",function(S,k){return this.name=S,this.items=k.$freeze()}),R(T,"$roll",function(S){var o,p,m,y,c;return o=S.$roll_once(6),p=S.$roll_once(6),m=q(U(o,10),p),y=E(o,1),c=E(p,1),a("RollResult").$new(this.name,m,this.items["$[]"](y)["$[]"](c))})},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(e){var N,M,h,n,T,r,l,Z,H,F=e.module,L=e.klass,_=e.hash2,P=e.defs,R=e.def,U=[],E=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),N=U,M=H=[F(U[0],"BCDice")].concat(N),l=[F(H[0],"DiceTable")].concat(M),Z=e.$r(l),h=l,T=[n=L(l[0],Z("D66GridTable"),"D66HalfGridTable")].concat(h),r=e.$r(T),P(n,"$from_i18n",function(g,C){var k=E;return k=r("I18n").$t(g,_(["locale","raise"],{locale:C,raise:!0})),this.$new(k["$[]"]("name"),k["$[]"]("items_1_2_3"),k["$[]"]("items_4_5_6"))}),R(n,"$initialize",function(g,C,S){return this.name=g,this.items=[C,C,C,S,S,S].$freeze()})},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(e){var N,M,h,n,T,r,l,Z,H,F=e.module,L=e.klass,_=e.hash2,P=e.defs,R=e.def,U=[],E=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),N=U,M=H=[F(U[0],"BCDice")].concat(N),l=[F(H[0],"DiceTable")].concat(M),Z=e.$r(l),h=l,T=[n=L(l[0],Z("D66GridTable"),"D66OneThirdTable")].concat(h),r=e.$r(T),P(n,"$from_i18n",function(g,C){var k=E;return k=r("I18n").$t(g,_(["locale","raise"],{locale:C,raise:!0})),this.$new(k["$[]"]("name"),k["$[]"]("items_1_2"),k["$[]"]("items_3_4"),k["$[]"]("items_5_6"))}),R(n,"$initialize",function(g,C,S,k){return this.name=g,this.items=[C,C,S,S,k,k].$freeze()})},Opal.modules["bcdice/dice_table/d66_table"]=function(e){var M,G,r,a,g,C,S,h,l,F=e.module,L=e.klass,_=e.hash2,P=e.defs,R=e.def,q=e.eqeqeq,U=e.rb_plus,E=e.rb_times,z=e.truthy,N=[],w=e.nil,H=e.$$$;return M=N,G=l=[F(N[0],"BCDice")].concat(M),r=h=[F(l[0],"DiceTable")].concat(G),g=[a=L(h[0],null,"D66Table")].concat(r),C=e.$r(g),(S=a.$$prototype).sort_type=S.items=S.name=w,P(a,"$from_i18n",function(o,p){var c,y=w;return y=C("I18n").$t(o,_(["locale"],{locale:p})),c=C("D66SortType").$const_get(y["$[]"]("d66_sort_type")),this.$new(y["$[]"]("name"),c,y["$[]"]("items"))}),R(a,"$initialize",function(o,p,m){var y=this;return y.name=o,y.sort_type=p,y.items=m.$freeze()}),R(a,"$roll",function(o){var p=this,m=w,y=w,c=w,f=w;return m=o.$roll_barabara(2,6),q(H(C("D66SortType"),"ASC"),y=p.sort_type)?m["$sort!"]():q(H(C("D66SortType"),"DESC"),y)&&m["$sort!"]()["$reverse!"](),c=U(E(m["$[]"](0),10),m["$[]"](1)),f=z(y=p.items["$[]"](c))?y:p.items["$[]"](c.$to_s()),z(f["$respond_to?"]("roll"))&&(f=f.$roll(o)),C("RollResult").$new(p.name,c,f)}),R(a,"$choice",function(o){return C("RollResult").$new(this.name,o,this.items["$[]"](o))})},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(e){var A,u,n,T,Z,F=e.module,L=e.klass,_=e.hash2,P=e.send,R=e.to_ary,q=e.rb_plus,U=e.rb_times,E=e.send2,z=e.find_super,N=e.def,H=[],Y=e.nil;return e.top.$require("bcdice/dice_table/d66_table"),A=H,u=Z=[F(H[0],"BCDice")].concat(A),n=[F(Z[0],"DiceTable")].concat(u),T=e.$r(n),N(L(n[0],T("D66Table"),"D66LeftRangeTable"),"$initialize",function C(S,k,o){var y;return C.$$p=null,y=_([],{}),P(o,"each",[],function(f){var s,v;return null==f&&(f=Y),s=R(f),v=null==s[1]?Y:s[1],P(null==s[0]?Y:s[0],"each",[],function(D){return null==D&&(D=Y),P(v,"each_with_index",[],function(d,i){var W,V;return null==d&&(d=Y),null==i&&(i=Y),V=q(U(D,10),q(i,1)),P(y,"[]=",W=[V,d]),W[W.length-1]})})}),E(this,z(this,"initialize",C,!1,!0),"initialize",[S,k,y],null)})},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(e){var Y,Z,T,r,a,g,C,u,A,F=e.module,L=e.klass,_=e.hash2,P=e.defs,R=e.def,q=e.truthy,U=e.rb_minus,E=e.rb_plus,z=e.rb_times,N=[],w=e.nil;return Y=N,Z=A=[F(N[0],"BCDice")].concat(Y),T=u=[F(A[0],"DiceTable")].concat(Z),a=[r=L(u[0],null,"D66ParityTable")].concat(T),g=e.$r(a),(C=r.$$prototype).odd=C.even=C.name=w,P(r,"$from_i18n",function(k,o){var m=w;return m=g("I18n").$t(k,_(["locale","raise"],{locale:o,raise:!0})),this.$new(m["$[]"]("name"),m["$[]"]("odd"),m["$[]"]("even"))}),R(r,"$initialize",function(k,o,p){var m=this;return m.name=k,m.odd=o.$freeze(),m.even=p.$freeze()}),R(r,"$roll",function(k){var m,c,f,o=this,p=w;return p=k.$roll_once(6),m=k.$roll_once(6),c=(q(p["$odd?"]())?o.odd:o.even)["$[]"](U(m,1)),f=E(z(p,10),m),g("RollResult").$new(o.name,f,c)})},Opal.modules["bcdice/dice_table/d66_range_table"]=function(e){var N,M,u,h,n,T,r,l,H,F=e.module,L=e.klass,_=e.def,P=e.rb_plus,R=e.rb_times,q=e.send,U=[],E=e.nil;return N=U,M=H=[F(U[0],"BCDice")].concat(N),u=l=[F(H[0],"DiceTable")].concat(M),n=[h=L(l[0],null,"D66RangeTable")].concat(u),T=e.$r(n),(r=h.$$prototype).items=r.name=E,_(h,"$initialize",function(g,C){return this.name=g,this.items=C.$freeze()}),_(h,"$roll",function(g){var S,k,o,p=E;return S=g.$roll_once(6),k=g.$roll_once(6),o=P(R(S,10),k),p=q(this.items,"find",[],function(y){return null==y&&(y=E),y["$[]"](0)["$include?"](o)}),T("RollResult").$new(this.name,o,p["$[]"](1))})},Opal.modules["bcdice/dice_table/range_table"]=function(e){var Y,Z,T,r,a,g,C,u,A,F=e.module,L=e.klass,_=e.const_set,P=e.send,R=e.truthy,q=e.def,U=e.eqeqeq,E=e.rb_times,z=e.rb_plus,N=[],w=e.nil;return Y=N,Z=A=[F(N[0],"BCDice")].concat(Y),T=u=[F(A[0],"DiceTable")].concat(Z),a=[r=L(u[0],null,"RangeTable")].concat(T),g=e.$r(a),(C=r.$$prototype).name=C.items=C.num_of_dice=C.num_of_sides=C.formatter=w,_(a[0],"RollResult",P(g("Struct"),"new",["sum","values","content","formatted"],function S(){return(null==S.$$s?this:S.$$s).$alias_method("to_s","formatted")},{$$s:r})),_(a[0],"Item",g("Struct").$new("range","content")),_(a[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),_(a[0],"DEFAULT_FORMATTER",P(r,"lambda",[],function(k,o){return null==k&&(k=w),null==o&&(o=w),k.$name()+"("+o.$sum()+") \uff1e "+o.$content()})),r.$attr_reader("name"),r.$attr_reader("num_of_dice"),r.$attr_reader("num_of_sides"),q(r,"$initialize",function S(k,o,p){var c,m=S.$$p||w,y=this,f=w;return S.$$p=null,y.name=k.$freeze(),y.formatter=R(c=m)?c:g("DEFAULT_FORMATTER"),f=g("DICE_ROLL_METHOD_RE").$match(o),R(f)||y.$raise(g("ArgumentError"),y.name+": invalid dice roll method: "+o),y.num_of_dice=f["$[]"](1).$to_i(),y.num_of_sides=f["$[]"](2).$to_i(),y.$store(p)}),q(r,"$fetch",function(k){var p,o=this;return p=P(o.items,"find",[],function(y){return null==y&&(y=w),y.$range()["$include?"](k)}),R(p)||o.$raise(g("RangeError"),o.name+": value is out of range: "+k),p}),q(r,"$roll",function(k){var m,o=this,p=w,y=w;return m=(p=k.$roll_barabara(o.num_of_dice,o.num_of_sides)).$sum(),(y=g("RollResult").$new(m,p,o.$fetch(m).$content()))["$formatted="](o.formatter["$[]"](o,y)),y}),r.$private(),q(r,"$store",function(k){var p,m,o=this;return p=P(k,"map",[],function y(c,f){return null==c&&(c=w),null==f&&(f=w),[(null==y.$$s?this:y.$$s).$coerce_to_int_range(c),f]},{$$s:o}),m=P(p,"sort_by",[],function(c,f){return null==c&&(c=w),null==f&&(f=w),c.$min()}),o.$assert_min_sum_is_covered(m),o.$assert_max_sum_is_covered(m),o.$assert_no_gap_or_overlap_in_ranges(m),o.items=P(m,"map",[],function(c,f){return null==c&&(c=w),null==f&&(f=w),g("Item").$new(c,f.$freeze()).$freeze()}).$freeze(),o}),q(r,"$coerce_to_int_range",function(k){var p;return U(g("Integer"),p=k)?g("Range").$new(k,k):U(g("Range"),p)&&R(k.$begin()["$is_a?"](g("Integer")))&&R(k.$end()["$is_a?"](g("Integer")))?k:this.$raise(g("TypeError"),this.name+": "+k+" ("+k.$class()+") must be an Integer or a Range with Integers ")}),q(r,"$assert_min_sum_is_covered",function(k){var p,o=this,m=w;return p=o.num_of_dice,m=k.$first()["$[]"](0),R(m["$include?"](p))||o.$raise(g("RangeError"),o.name+": min value ("+p+") is not covered: "+m),o}),q(r,"$assert_max_sum_is_covered",function(k){var p,o=this,m=w;return p=E(o.num_of_dice,o.num_of_sides),m=k.$last()["$[]"](0),R(m["$include?"](p))||o.$raise(g("RangeError"),o.name+": max value ("+p+") is not covered: "+m),o}),q(r,"$assert_no_gap_or_overlap_in_ranges",function(k){return P(k,"each_cons",[2],function p(m,y){var x,b,c=null==p.$$s?this:p.$$s,f=w,s=w;return null==c.name&&(c.name=w),null==m&&(m=w),null==y&&(y=w),f=m["$[]"](0),s=y["$[]"](0),x=f.$max(),b=z(x,1),R(s["$include?"](x))&&c.$raise(g("RangeError"),c.name+": Range overlap: "+f+" and "+s),R(s["$include?"](b))?w:c.$raise(g("RangeError"),c.name+": Range gap: "+f+" and "+s)},{$$s:this}),this})},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(e){var w,A,h,g,C,S,k,T,Z,Y,F=e.module,L=e.klass,_=e.send,P=e.def,R=e.rb_minus,q=e.return_ivar,U=[],E=e.nil,z=e.$$$;return w=U,A=Y=[F(U[0],"BCDice")].concat(w),h=Z=[F(Y[0],"DiceTable")].concat(A),g=T=[L(Z[0],null,"SaiFicSkillTable")].concat(h),S=[C=L(T[0],null,"Category")].concat(g),k=e.$r(S),P(C,"$initialize",function(p,m,y,c){var f=this;return f.name=p,f.skills=_(m.$map(),"with_index",[2],function(x,b){return null==x&&(x=E),null==b&&(b=E),z(k("SaiFicSkillTable"),"Skill").$new(p,x,y,b,c)}),f.dice=y}),P(C,"$roll",function(p){return this.$skills()["$[]"](R(p.$roll_sum(2,6),2))}),P(C,"$to_s",q("name")),C.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(e){var E,H,Z,T,r,u,M,N,F=e.module,L=e.klass,_=e.def,P=e.hash2,R=[],q=e.nil;return E=R,H=N=[F(R[0],"BCDice")].concat(E),Z=M=[F(N[0],"DiceTable")].concat(H),u=[L(M[0],null,"SaiFicSkillTable")].concat(Z),(r=(T=L(u[0],null,"Skill")).$$prototype).s_format=r.category_dice=r.row_dice=r.category_name=r.name=q,_(T,"$initialize",function(g,C,S,k,o){var p=this;return p.category_name=g,p.name=C,p.category_dice=S,p.row_dice=k,p.s_format=o}),_(T,"$to_s",function(){var g=this;return g.$format(g.s_format,P(["category_dice","row_dice","category_name","skill_name"],{category_dice:g.category_dice,row_dice:g.row_dice,category_name:g.category_name,skill_name:g.name}))}),T.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(e){var u,r,k,o,p,m,y,g,n,F=e.module,L=e.klass,_=e.ensure_kwargs,P=e.hash2,R=e.send,U=e.defs,E=e.const_set,z=e.to_ary,N=e.def,w=e.truthy,H=e.rb_minus,Y=e.rb_plus,M=e.top,A=[],l=e.nil,Z=e.$$$;return M.$require("bcdice/dice_table/sai_fic_skill_table/category"),M.$require("bcdice/dice_table/sai_fic_skill_table/skill"),u=A,r=n=[F(A[0],"BCDice")].concat(u),k=g=[F(n[0],"DiceTable")].concat(r),p=[o=L(g[0],null,"SaiFicSkillTable")].concat(k),m=e.$r(p),(y=o.$$prototype).rtt=y.rtt_format=y.rct=y.rct_format=y.rttn=y.rttn_format=y.categories=l,U(o,"$from_i18n",function(f,s,x){var b,v,$,i,d=l;return null==(b=(x=_(x)).$$smap.rtt)&&(b=l),null==(v=x.$$smap.rct)&&(v=l),null==($=x.$$smap.rttn)&&($=l),i=(d=m("I18n").$t("RTT",P(["locale","raise","default"],{locale:s,raise:!1,default:P([],{})})).$merge(m("I18n").$t(f,P(["locale","raise"],{locale:s,raise:!0}))))["$[]"]("items"),d=R(d,"select",[],function(V,Q){return null==V&&(V=l),null==Q&&(Q=l),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](V)}),this.$new(i,e.to_hash(d).$merge(P(["rtt","rct","rttn"],{rtt:b,rct:v,rttn:$})))},-3),E(p[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),E(p[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),E(p[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),E(p[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),N(o,"$initialize",function(f,s){var x,b,v,$,D,t,d,i=this;return null==(x=(s=_(s)).$$smap.rtt)&&(x=l),null==(b=s.$$smap.rct)&&(b=l),null==(v=s.$$smap.rttn)&&(v=l),null==($=s.$$smap.rtt_format)&&($=m("DEFAULT_RTT")),null==(D=s.$$smap.rct_format)&&(D=m("DEFAULT_RCT")),null==(t=s.$$smap.rttn_format)&&(t=m("DEFAULT_RTTN")),null==(d=s.$$smap.s_format)&&(d=m("DEFAULT_S")),i.categories=R(f.$map(),"with_index",[1],function(V,Q){var $e,se,ie;return null==V&&(V=l),null==Q&&(Q=l),se=null==($e=z(V))[0]?l:$e[0],ie=null==$e[1]?l:$e[1],Z(m("SaiFicSkillTable"),"Category").$new(se,ie,Q,d)},{$$has_top_level_mlhs_arg:!0}),i.rtt=x,i.rct=b,i.rttn=v.$to_a(),i.rtt_format=$,i.rct_format=D,i.rttn_format=t},-2),E(p[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),o.$attr_reader("categories"),N(o,"$roll_command",function(f,s){var b,x=this,v=l,$=l;return w(["RTT",x.rtt]["$include?"](b=s))?x.$format_skill(x.rtt_format,x.$roll_skill(f)):w(["RCT",x.rct]["$include?"](b))?(v=x.$roll_category(f),x.$format(x.rct_format,P(["category_dice","category_name"],{category_dice:v.$dice(),category_name:v.$name()}))):w($=m("RTTN").$index(b))||w($=x.rttn.$index(b))?x.$format_skill(x.rttn_format,x.categories["$[]"]($).$roll(f)):l}),N(o,"$roll_category",function(f){return this.categories["$[]"](H(f.$roll_once(6),1))}),N(o,"$roll_skill",function(f){return this.$roll_category(f).$roll(f)}),N(o,"$prefixes",function(){var f=this;return Y(["RTT[1-6]?","RCT",f.rtt,f.rct],f.rttn).$compact()}),o.$private(),N(o,"$format_skill",function(f,s){return this.$format(f,P(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:s.$category_dice(),row_dice:s.$row_dice(),category_name:s.$category_name(),skill_name:s.$name(),text:s.$to_s()}))})},Opal.modules["bcdice/dice_table/table"]=function(e){var w,A,h,n,T,r,a,Z,Y,F=e.module,L=e.klass,_=e.hash2,P=e.defs,R=e.truthy,q=e.def,U=e.rb_minus,E=[],z=e.nil;return w=E,A=Y=[F(E[0],"BCDice")].concat(w),h=Z=[F(Y[0],"DiceTable")].concat(A),T=[n=L(Z[0],null,"Table")].concat(h),r=e.$r(T),(a=n.$$prototype).times=a.sides=a.name=a.items=z,P(n,"$from_i18n",function(C,S){var o=z;return o=r("I18n").$t(C,_(["locale"],{locale:S})),this.$new(o["$[]"]("name"),o["$[]"]("type"),o["$[]"]("items"))}),q(n,"$initialize",function(C,S,k){var o=this,p=z;return o.name=C,o.items=k.$freeze(),p=/(\d+)D(\d+)/i.$match(S),R(p)||o.$raise(r("ArgumentError"),"Unexpected table type: "+S),o.times=p["$[]"](1).$to_i(),o.sides=p["$[]"](2).$to_i()}),q(n,"$roll",function(C){var k,S=this;return k=C.$roll_sum(S.times,S.sides),S.$choice(k)}),q(n,"$choice",function(C){var k,S=this;return k=U(C,S.times),r("RollResult").$new(S.name,C,S.items["$[]"](k))})},Opal.modules["bcdice/dice_table"]=function(e){var F=e.top;return F.$require("bcdice/dice_table/roll_result"),F.$require("bcdice/dice_table/chain_table"),F.$require("bcdice/dice_table/d66_grid_table"),F.$require("bcdice/dice_table/d66_half_grid_table"),F.$require("bcdice/dice_table/d66_one_third_table"),F.$require("bcdice/dice_table/d66_left_range_table"),F.$require("bcdice/dice_table/d66_parity_table"),F.$require("bcdice/dice_table/d66_range_table"),F.$require("bcdice/dice_table/d66_table"),F.$require("bcdice/dice_table/range_table"),F.$require("bcdice/dice_table/sai_fic_skill_table"),F.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(e){var q,N,H,E,F=e.module,L=e.const_set,_=[];return q=_,N=E=[F(_[0],"BCDice")].concat(q),H=[F(E[0],"D66SortType")].concat(N),L(H[0],"NO_SORT","no_sort"),L(H[0],"ASC","asc"),L(H[0],"DESC","desc"),function(z,N){var H=[F(z,"RoundType")].concat(N);return L(H[0],"CEIL","ceil"),L(H[0],"FLOOR","floor"),L(H[0],"ROUND","round")}(E[0],E)},Opal.modules["bcdice/translate"]=function(e){var N,M,A,l,Z,H,F=e.module,L=e.ensure_kwargs,_=e.kwrestargs,R=e.hash2,q=e.def,U=[],E=e.nil;return N=U,M=H=[F(U[0],"BCDice")].concat(N),l=[A=F(H[0],"Translate")].concat(M),Z=e.$r(l),q(A,"$translate",function(u,h){var n,T=this;return null==T.locale&&(T.locale=E),h=L(h),n=_(h,{}),Z("I18n").$translate(u,R(["locale","raise"],{locale:T.locale,raise:!0}).$merge(e.to_hash(n)))},-2)},Opal.modules["bcdice/result"]=function(e){var A,G,l,N,H,L=e.klass,_=e.send,P=e.def,R=e.return_val,q=e.return_ivar,U=[],E=e.nil;return N=U,A=H=[(0,e.module)(U[0],"BCDice")].concat(N),[l=L(H[0],null,"Result")].concat(A),P(G=e.get_singleton_class(l),"$success",function(n){return _(this.$new(),"tap",[],function(a){var g;return null==a&&(a=E),a["$text="](n),_(a,"success=",g=[!0]),g[g.length-1]})}),P(G,"$failure",function(n){return _(this.$new(),"tap",[],function(a){var g;return null==a&&(a=E),a["$text="](n),_(a,"failure=",g=[!0]),g[g.length-1]})}),P(G,"$critical",function(n){return _(this.$new(),"tap",[],function(a){var g;return null==a&&(a=E),a["$text="](n),a["$critical="](!0),_(a,"success=",g=[!0]),g[g.length-1]})}),P(G,"$fumble",function(n){return _(this.$new(),"tap",[],function(a){var g;return null==a&&(a=E),a["$text="](n),a["$fumble="](!0),_(a,"failure=",g=[!0]),g[g.length-1]})}),P(G,"$nothing",R("nothing")),P(l,"$initialize",function(u){var h=this;return null==u&&(u=E),h.text=u,h.rands=E,h.detailed_rands=E,h.secret=!1,h.success=!1,h.failure=!1,h.critical=!1,h.fumble=!1},-1),l.$attr_accessor("text","rands","detailed_rands"),l.$attr_writer("secret","success","failure","critical","fumble"),P(l,"$secret?",q("secret")),P(l,"$success?",q("success")),P(l,"$failure?",q("failure")),P(l,"$critical?",q("critical")),P(l,"$fumble?",q("fumble")),P(l,"$condition=",function(u){return this.success=u,this.failure=u["$!"]()})},Opal.modules["racc/parser"]=function(e){var C,k,o,F=e.module,L=e.klass,_=e.truthy,P=e.const_set,R=e.defs,q=e.gvars,U=e.rb_lt,E=e.def,z=e.to_ary,N=e.send,w=e.neqeq,H=e.rb_plus,Y=e.eqeq,M=e.rb_ge,A=e.rb_gt,l=e.rb_minus,Z=e.rb_le,G=e.rb_times,u=e.assign_ivar_val,n=[],T=e.$r(n),r=e.nil,a=e.$$$;return C=n,k=[F(n[0],"Racc")].concat(C),o=e.$r(k),L(k[0],o("StandardError"),"ParseError"),_(a("::","ParseError","skip_raise")?"constant":r)||P(n[0],"ParseError",a(T("Racc"),"ParseError")),function(g,C){var c,f,s,x,b,o=[F(g,"Racc")].concat(C),p=e.$r(o);return _(p("Racc_No_Extensions","skip_raise")?"constant":r)||P(o[0],"Racc_No_Extensions",!1),c=o,s=[f=L(o[0],null,"Parser")].concat(c),x=e.$r(s),(b=f.$$prototype).yydebug=b.racc_debug_out=b.racc_error_status=b.racc_t=b.racc_vstack=b.racc_val=b.racc_state=b.racc_tstack=r,P(s[0],"Racc_Runtime_Version","1.4.6"),P(s[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),P(s[0],"Racc_Runtime_Core_Version_R","1.4.6"),P(s[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),P(s[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),P(s[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),P(s[0],"Racc_Runtime_Core_Version",x("Racc_Runtime_Core_Version_R")),P(s[0],"Racc_Runtime_Core_Revision",x("Racc_Runtime_Core_Revision_R")),P(s[0],"Racc_Runtime_Type","ruby"),R(x("Parser"),"$racc_runtime_type",function(){return x("Racc_Runtime_Type")}),E(f,"$_racc_setup",function(){var $,D,t=this,d=r,i=r;return null==q.stderr&&(q.stderr=r),_(a(t.$class(),"Racc_debug_parser"))||(t.yydebug=!1),_(null!=($=t.yydebug)&&$!==r?"instance-variable":r)||(t.yydebug=!1),_(t.yydebug)&&(_(null!=(D=t.racc_debug_out)&&D!==r?"instance-variable":r)||(t.racc_debug_out=q.stderr),t.racc_debug_out=_(d=t.racc_debug_out)?d:q.stderr),i=a(t.$class(),"Racc_arg"),_(U(i.$size(),14))&&i["$[]="](13,!0),i}),E(f,"$_racc_init_sysvars",function(){var $=this;return $.racc_state=[0],$.racc_tstack=[],$.racc_vstack=[],$.racc_t=r,$.racc_val=r,$.racc_read_next=!0,$.racc_user_yyerror=!1,$.racc_error_status=0}),E(f,"$do_parse",function(){return this.$__send__(x("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)}),E(f,"$next_token",function(){return this.$raise(x("NotImplementedError"),this.$class()+"#next_token is not defined")}),E(f,"$_racc_do_parse_rb",function($,D){var t,i=this,W=r,V=r,Q=r,$e=r,se=r,ie=r,ue=r,te=r;return t=z($),W=null==t[0]?r:t[0],V=null==t[1]?r:t[1],Q=null==t[2]?r:t[2],$e=null==t[3]?r:t[3],se=null==t[10]?r:t[10],i.$_racc_init_sysvars(),ie=ue=te=r,N(i,"catch",["racc_end_parse"],function K(){var I,X,j=null==K.$$s?this:K.$$s,B=r;for(null==j.racc_state&&(j.racc_state=r),null==j.racc_read_next&&(j.racc_read_next=r),null==j.racc_t&&(j.racc_t=r),null==j.yydebug&&(j.yydebug=r),null==j.racc_val&&(j.racc_val=r);_(!0);)for(_(te=$e["$[]"](j.racc_state["$[]"](-1)))?(_(j.racc_read_next)&&w(j.racc_t,0)&&(X=j.$next_token(),I=z(X),ie=null==I[0]?r:I[0],j.racc_val=null==I[1]?r:I[1],j.racc_t=_(ie)?_(B=se["$[]"](ie))?B:1:0,_(j.yydebug)&&j.$racc_read_token(j.racc_t,ie,j.racc_val),j.racc_read_next=!1),te=H(te,j.racc_t),_(M(te,0))&&_(ue=W["$[]"](te))&&Y(V["$[]"](te),j.racc_state["$[]"](-1))||(ue=Q["$[]"](j.racc_state["$[]"](-1)))):ue=Q["$[]"](j.racc_state["$[]"](-1));_(ue=j.$_racc_evalact(ue,$)););},{$$s:i})}),E(f,"$yyparse",function($,D){return this.$__send__(x("Racc_YY_Parse_Method"),$,D,this.$_racc_setup(),!0)}),E(f,"$_racc_yyparse_rb",function($,D,t,d){var i,V=this,Q=r,$e=r,ne=r,se=r,ue=r,te=r,K=r;return i=z(t),Q=null==i[0]?r:i[0],$e=null==i[1]?r:i[1],ne=null==i[2]?r:i[2],se=null==i[3]?r:i[3],ue=null==i[10]?r:i[10],V.$_racc_init_sysvars(),te=r,K=r,N(V,"catch",["racc_end_parse"],function I(){var X=null==I.$$s?this:I.$$s;for(null==X.racc_state&&(X.racc_state=r);!_(K=se["$[]"](X.racc_state["$[]"](-1)));)for(;_(te=X.$_racc_evalact(ne["$[]"](X.racc_state["$[]"](-1)),t)););return N($,"__send__",[D],function j(B,ee){var O=null==j.$$s?this:j.$$s,re=r,J=r;for(null==O.racc_t&&(O.racc_t=r),null==O.racc_state&&(O.racc_state=r),null==O.racc_read_next&&(O.racc_read_next=r),null==B&&(B=r),null==ee&&(ee=r),O.racc_t=_(B)?_(re=ue["$[]"](B))?re:1:0,O.racc_val=ee,O.racc_read_next=!1,K=H(K,O.racc_t),_(M(K,0))&&_(te=Q["$[]"](K))&&Y($e["$[]"](K),O.racc_state["$[]"](-1))||(te=ne["$[]"](O.racc_state["$[]"](-1)));_(te=O.$_racc_evalact(te,t)););for(;_(_(re=_(J=(K=se["$[]"](O.racc_state["$[]"](-1)))["$!"]())?J:O.racc_read_next["$!"]())?re:O.racc_t["$=="](0));)for(_(K)&&_(K=H(K,O.racc_t))&&_(M(K,0))&&_(te=Q["$[]"](K))&&Y($e["$[]"](K),O.racc_state["$[]"](-1))||(te=ne["$[]"](O.racc_state["$[]"](-1)));_(te=O.$_racc_evalact(te,t)););},{$$s:X})},{$$s:V})}),E(f,"$_racc_evalact",function($,D){var t,ne,i=this,W=r,V=r,$e=r,se=r,ie=r,ue=r;if(W=null==(t=z(D))[0]?r:t[0],V=null==t[1]?r:t[1],$e=null==t[3]?r:t[3],ne=null==t[11]?r:t[11],se=null==t[12]?r:t[12],_(A($,0))&&_(U($,ne)))_(A(i.racc_error_status,0))&&(Y(i.racc_t,1)||(i.racc_error_status=l(i.racc_error_status,1))),i.racc_vstack.$push(i.racc_val),i.racc_state.$push($),i.racc_read_next=!0,_(i.yydebug)&&(i.racc_tstack.$push(i.racc_t),i.$racc_shift(i.racc_t,i.racc_tstack,i.racc_vstack));else if(_(U($,0))&&_(A($,se["$-@"]()))){if(ie=N(i,"catch",["racc_jump"],function te(){var K=null==te.$$s?this:te.$$s;return null==K.racc_state&&(K.racc_state=r),K.racc_state.$push(K.$_racc_do_reduce(D,$)),!1},{$$s:i}),_(ie))switch(ie){case 1:return i.racc_user_yyerror=!0,se["$-@"]();case 2:return ne;default:i.$raise("[Racc Bug] unknown jump code")}}else if(Y($,ne))_(i.yydebug)&&i.$racc_accept(),i.$throw("racc_end_parse",i.racc_vstack["$[]"](0));else{if(Y($,se["$-@"]())){switch(i.racc_error_status){case 0:_(D["$[]"](21))||i.$on_error(i.racc_t,i.racc_val,i.racc_vstack);break;case 3:Y(i.racc_t,0)&&i.$throw("racc_end_parse",r),i.racc_read_next=!0}for(i.racc_user_yyerror=!1,i.racc_error_status=3;_(!0)&&!(_(ue=$e["$[]"](i.racc_state["$[]"](-1)))&&(ue=H(ue,1),_(M(ue,0))&&_($=W["$[]"](ue))&&Y(V["$[]"](ue),i.racc_state["$[]"](-1))));)_(Z(i.racc_state.$size(),1))&&i.$throw("racc_end_parse",r),i.racc_state.$pop(),i.racc_vstack.$pop(),_(i.yydebug)&&(i.racc_tstack.$pop(),i.$racc_e_pop(i.racc_state,i.racc_tstack,i.racc_vstack));return $}i.$raise("[Racc Bug] unknown action "+$.$inspect())}return _(i.yydebug)&&i.$racc_next_state(i.racc_state["$[]"](-1),i.racc_state),r}),E(f,"$_racc_do_reduce",function($,D){var t,se,ue,B,ee,O,ae,i=this,V=r,Q=r,$e=r,ne=r,ie=r,te=r,K=r,I=r,X=r,j=r,re=r,J=r,ce=r;return V=null==(t=z($))[4]?r:t[4],Q=null==t[5]?r:t[5],$e=null==t[6]?r:t[6],ne=null==t[7]?r:t[7],se=null==t[8]?r:t[8],ie=null==t[9]?r:t[9],ue=null==t[13]?r:t[13],te=i.racc_state,K=i.racc_vstack,I=i.racc_tstack,X=G(D,-3),j=ie["$[]"](X),B=ie["$[]"](H(X,1)),ee=ie["$[]"](H(X,2)),O=[],_(i.yydebug)&&(re=I["$[]"](j["$-@"](),j)),J=K["$[]"](j["$-@"](),j),_(i.yydebug)&&I["$[]="](j["$-@"](),j,O),K["$[]="](j["$-@"](),j,O),te["$[]="](j["$-@"](),j,O),_(ue)?K.$push(i.$__send__(ee,J,K,J["$[]"](0))):K.$push(i.$__send__(ee,J,K)),I.$push(B),_(i.yydebug)&&i.$racc_reduce(re,B,I,K),ae=l(B,se),_(X=ne["$[]"](ae))&&(X=H(X,te["$[]"](-1)),_(M(X,0))&&_(ce=V["$[]"](X))&&Y(Q["$[]"](X),ae))?ce:$e["$[]"](ae)}),E(f,"$on_error",function($,D,t){var i,d=this;return d.$raise(x("ParseError"),d.$sprintf("\nparse error on value %s (%s)",D.$inspect(),_(i=d.$token_to_str($))?i:"?"))}),E(f,"$yyerror",function(){return this.$throw("racc_jump",1)}),E(f,"$yyaccept",function(){return this.$throw("racc_jump",2)}),E(f,"$yyerrok",u("racc_error_status",0)),E(f,"$racc_read_token",function($,D,t){var d=this;return d.racc_debug_out.$print("read    "),d.racc_debug_out.$print(D.$inspect(),"(",d.$racc_token2str($),") "),d.racc_debug_out.$puts(t.$inspect()),d.racc_debug_out.$puts()}),E(f,"$racc_shift",function($,D,t){var d=this;return d.racc_debug_out.$puts("shift   "+d.$racc_token2str($)),d.$racc_print_stacks(D,t),d.racc_debug_out.$puts()}),E(f,"$racc_reduce",function($,D,t,d){var i=this,W=r;return(W=i.racc_debug_out).$print("reduce "),_($["$empty?"]())?W.$print(" <none>"):N($,"each",[],function V(Q){return null==Q&&(Q=r),W.$print(" ",(null==V.$$s?this:V.$$s).$racc_token2str(Q))},{$$s:i}),W.$puts(" --\x3e "+i.$racc_token2str(D)),i.$racc_print_stacks(t,d),i.racc_debug_out.$puts()}),E(f,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()}),E(f,"$racc_e_pop",function($,D,t){var d=this;return d.racc_debug_out.$puts("error recovering mode: pop token"),d.$racc_print_states($),d.$racc_print_stacks(D,t),d.racc_debug_out.$puts()}),E(f,"$racc_next_state",function($,D){var t=this;return t.racc_debug_out.$puts("goto    "+$),t.$racc_print_states(D),t.racc_debug_out.$puts()}),E(f,"$racc_print_stacks",function($,D){var d=r;return(d=this.racc_debug_out).$print("        ["),N($,"each_index",[],function i(W){return null==W&&(W=r),d.$print(" (",(null==i.$$s?this:i.$$s).$racc_token2str($["$[]"](W))," ",D["$[]"](W).$inspect(),")")},{$$s:this}),d.$puts(" ]")}),E(f,"$racc_print_states",function($){var t=r;return(t=this.racc_debug_out).$print("        ["),N($,"each",[],function(i){return null==i&&(i=r),t.$print(" ",i)}),t.$puts(" ]")}),E(f,"$racc_token2str",function($){var t;return _(t=a(this.$class(),"Racc_token_to_s_table")["$[]"]($))?t:this.$raise("[Racc Bug] can't convert token "+$+" to string")}),E(f,"$token_to_str",function($){return a(this.$class(),"Racc_token_to_s_table")["$[]"]($)})}(n[0],n)},Opal.modules["bcdice/arithmetic/node"]=function(e){var u,r,S,c,f,o,p,g,n,F=e.module,L=e.klass,_=e.def,P=e.thrower,R=e.return_ivar,q=e.send2,U=e.find_super,E=e.eqeq,z=e.const_set,N=e.eqeqeq,w=e.rb_divide,H=e.truthy,Y=e.assign_ivar,M=e.alias,A=[],l=e.nil,Z=e.$$$;return u=A,r=n=[F(A[0],"BCDice")].concat(u),S=g=[F(n[0],"Arithmetic")].concat(r),o=[F(g[0],"Node")].concat(S),p=e.$r(o),(f=(c=L(o[0],null,"BinaryOp")).$$prototype).lhs=f.rhs=f.op=l,_(c,"$initialize",function(x,b,v){var $=this;return $.lhs=x,$.op=b,$.rhs=v}),_(c,"$eval",function(x){try{P("eval_return");var D,v=this,$=l;return $=v.lhs.$eval(x),D=v.rhs.$eval(x),$.$send(v.op,D)}catch(t){if(t===e.t_eval_return)return t.$v;throw t}}),_(c,"$output",function(){var x=this;return""+x.lhs.$output()+x.op+x.rhs.$output()}),_(c,"$s_exp",function(){var x=this;return"("+x.$op_for_s_exp()+" "+x.lhs.$s_exp()+" "+x.rhs.$s_exp()+")"}),_(c,"$op_for_s_exp",R("op")),function(m,y,c){var f=L(m,y,"DivideBase"),s=[f].concat(c),x=e.$r(s),b=f.$$prototype;b.lhs=b.rhs=b.op=l,_(f,"$initialize",function v($,D){return v.$$p=null,q(this,U(this,"initialize",v,!1,!0),"initialize",[$,"/",D],null)}),_(f,"$eval",function($){try{P("eval_return");var d,i,t=this;return d=t.lhs.$eval($),i=t.rhs.$eval($),E(i,0)&&t.$raise(x("ZeroDivisionError")),t.$divide_and_round(d,i,$)}catch(W){if(W===e.t_eval_return)return W.$v;throw W}}),_(f,"$output",function v(){var $=v.$$p||l,D=this;return v.$$p=null,""+q(D,U(D,"output",v,!1,!0),"output",[],$)+D.$rounding_method()}),f.$private(),_(f,"$rounding_method",function(){return Z(this.$class(),"ROUNDING_METHOD")}),_(f,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()}),_(f,"$divide_and_round",function($,D,t){return this.$raise(x("NotImplementedError"))})}(o[0],p("BinaryOp"),o),function(m,y,c){var f=L(m,y,"DivideWithGameSystemDefault"),s=[f].concat(c),x=e.$r(s);z(s[0],"ROUNDING_METHOD",""),f.$private(),_(f,"$divide_and_round",function(v,$,D){var t,d=l;return N(Z(x("RoundType"),"CEIL"),t=D)?w(v.$to_f(),$).$ceil():N(Z(x("RoundType"),"ROUND"),t)?(d=w(v.$to_f(),$),H(d["$negative?"]())?d.$abs().$round()["$-@"]():d.$round()):w(v,$).$floor()})}(o[0],p("DivideBase"),o),function(m,y,c){var f=L(m,y,"DivideWithCeil"),s=[f].concat(c);z(s[0],"ROUNDING_METHOD","C"),f.$private(),_(f,"$divide_and_round",function(b,v,$){return w(b.$to_f(),v).$ceil()})}(o[0],p("DivideBase"),o),function(m,y,c){var f=L(m,y,"DivideWithRound"),s=[f].concat(c);z(s[0],"ROUNDING_METHOD","R"),f.$private(),_(f,"$divide_and_round",function(b,v,$){var D=l;return D=w(b.$to_f(),v),H(D["$negative?"]())?D.$abs().$round()["$-@"]():D.$round()})}(o[0],p("DivideBase"),o),function(m,y,c){var f=L(m,y,"DivideWithFloor"),s=[f].concat(c);z(s[0],"ROUNDING_METHOD","F"),f.$private(),_(f,"$divide_and_round",function(b,v,$){return w(b,v).$floor()})}(o[0],p("DivideBase"),o),function(m,y){var c=L(m,null,"Negative");c.$$prototype.body=l,_(c,"$initialize",Y("body")),_(c,"$eval",function(x){try{return P("eval_return"),this.body.$eval(x)["$-@"]()}catch($){if($===e.t_eval_return)return $.$v;throw $}}),_(c,"$output",function(){return"-"+this.body.$output()}),_(c,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"})}(o[0]),function(m,y){var c=L(m,null,"Parenthesis");c.$$prototype.expr=l,_(c,"$initialize",Y("expr")),_(c,"$eval",function(x){try{return P("eval_return"),this.expr.$eval(x)}catch($){if($===e.t_eval_return)return $.$v;throw $}}),_(c,"$output",function(){return"("+this.expr.$output()+")"}),_(c,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"})}(o[0]),function(m,y){var c=L(m,null,"Number");return c.$$prototype.value=l,_(c,"$initialize",Y("value")),_(c,"$eval",R("value")),_(c,"$output",function(){return this.value.$to_s()}),M(c,"s_exp","output")}(o[0])},Opal.modules.strscan=function(e){var Y,M,A,l,Z,L=e.def,_=e.truthy,P=e.eqeqeq,R=e.Opal,q=e.return_ivar,U=e.send,E=e.alias,z=[],N=e.nil;return Y=z,A=[M=(0,e.klass)(z[0],null,"StringScanner")].concat(Y),l=e.$r(A),(Z=M.$$prototype).pos=Z.string=Z.working=Z.matched=Z.prev_pos=Z.match=N,M.$attr_reader("pos","matched"),L(M,"$initialize",function(u){var h=this;return h.string=u,h.pos=0,h.matched=N,h.working=u,h.match=[]}),M.$attr_reader("string"),L(M,"$beginning_of_line?",function(){var u=this;return 0===u.pos||"\n"===u.string.charAt(u.pos-1)}),L(M,"$scan",function(u){var h=this,n=(u=h.$anchor(u)).exec(h.working);return null==n?h.matched=N:(h.prev_pos=h.pos,h.pos+=n[0].length,h.working=h.working.substring(n[0].length),h.matched=n[0],h.match=n,n[0])}),L(M,"$scan_until",function(u){var h=this;u=h.$anchor(u);for(var n=h.working,T=0;n.length!=T;++T){var r=u.exec(n.substr(T));if(null!==r){var a=T+r[0].length,g=n.substr(0,a);return h.matched=r[0],h.match=r,h.prev_pos=h.pos+T,h.pos+=a,h.working=n.substr(a),g}}return h.matched=N}),L(M,"$[]",function(u){var n;if(_(this.match["$empty?"]()))return N;P(l("Symbol"),n=u)?u=u.$to_s():P(l("String"),n)||(u=R["$coerce_to!"](u,l("Integer"),"to_int"));var T=this.match;return u<0&&(u+=T.length),u<0||u>=T.length||null==T[u]?N:T[u]}),L(M,"$check",function(u){var h=this,n=(u=h.$anchor(u)).exec(h.working);return h.matched=null==n?N:n[0]}),L(M,"$check_until",function(u){var h=this,n=h.prev_pos,T=h.pos,r=h.working,a=h.$scan_until(u);return h.prev_pos=n,h.pos=T,h.working=r,a}),L(M,"$peek",function(u){return this.working.substring(0,u)}),L(M,"$eos?",function(){return 0===this.working.length}),L(M,"$exist?",function(u){var n=u.exec(this.working);return null==n?N:0==n.index?0:n.index+1}),L(M,"$skip",function(u){var h=this,n=(u=h.$anchor(u)).exec(h.working);if(null==n)return h.match=[],h.matched=N;var T=n[0],r=T.length;return h.matched=T,h.match=n,h.prev_pos=h.pos,h.pos+=r,h.working=h.working.substring(r),r}),L(M,"$skip_until",function(u){var n=this.$scan_until(u);return n===N?N:(this.matched=n.substr(-1),n.length)}),L(M,"$get_byte",function(){var u=this,h=N;return u.pos<u.string.length?(u.prev_pos=u.pos,u.pos+=1,h=u.matched=u.working.substring(0,1),u.working=u.working.substring(1)):u.matched=N,h}),L(M,"$match?",function(u){var h=this,n=(u=h.$anchor(u)).exec(h.working);return null==n?N:(h.prev_pos=h.pos,n[0].length)}),L(M,"$pos=",function(u){var h=this;return u<0&&(u+=h.string.$length()),h.pos=u,h.working=h.string.slice(u)}),L(M,"$matched_size",function(){return this.matched===N?N:this.matched.length}),L(M,"$post_match",function(){var u=this;return u.matched===N?N:u.string.substr(u.pos)}),L(M,"$pre_match",function(){var u=this;return u.matched===N?N:u.string.substr(0,u.prev_pos)}),L(M,"$reset",function(){var u=this;return u.working=u.string,u.matched=N,u.pos=0}),L(M,"$rest",q("working")),L(M,"$rest?",function(){return 0!==this.working.length}),L(M,"$rest_size",function(){return this.$rest().$size()}),L(M,"$terminate",function(){var u,h=this;return h.match=N,u=[h.string.$length()],U(h,"pos=",u),u[u.length-1]}),L(M,"$unscan",function(){var u=this;return u.pos=u.prev_pos,u.prev_pos=N,u.match=N,u}),E(M,"bol?","beginning_of_line?"),E(M,"getch","get_byte"),M.$private(),L(M,"$anchor",function(u){var h=u.toString().match(/\/([^\/]+)$/);return h=h?h[1]:void 0,new RegExp("^(?:"+u.source+")",h)})},Opal.modules["bcdice/normalize"]=function(e){var E,H,N,F=e.module,L=e.eqeqeq,_=e.def,P=e.eqeq,R=[],q=e.nil;return E=R,N=[F(R[0],"BCDice")].concat(E),(H=F(N[0],"Normalize")).$module_function(),_(H,"$comparison_operator",function(M){var A;return L(/<=|=</,A=M)?"<=":L(/>=|=>/,A)?">=":L(/<>|!=|=!/,A)?"!=":L(/</,A)?"<":L(/>/,A)?">":L(/=/,A)?"==":q}),_(H,"$target_number",function(M){return P(M,"?")?M:M.$to_i()})},Opal.modules["bcdice/command/lexer"]=function(e){var Y,Z,T,r,a,g,C,u,A,F=e.module,L=e.klass,_=e.const_set,P=e.hash2,R=e.truthy,q=e.send,U=e.def,E=e.thrower,z=e.top,N=[],w=e.nil;return z.$require("strscan"),z.$require("bcdice/normalize"),Y=N,Z=A=[F(N[0],"BCDice")].concat(Y),T=u=[F(A[0],"Command")].concat(Z),a=[r=L(u[0],null,"Lexer")].concat(T),g=e.$r(a),(C=r.$$prototype).scanner=C.notations=w,_(a[0],"SYMBOLS",P(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),U(r,"$initialize",function(k,o){var p,m,c;return k=R(c=(p=(m=k)===w||null==m?w:m.$split(" ",2))===w||null==p?w:p.$first())?c:"",this.scanner=g("StringScanner").$new(k),this.notations=q(o,"map",[],function(s){return null==s&&(s=w),R(s["$is_a?"](g("String")))?g("Regexp").$new(s):s})}),U(r,"$next_token",function(){try{var k=E("return"),o=this,p=w,m=w,c=w,f=w;return R(o.scanner["$eos?"]())?[!1,"$"]:(q(o.notations,"each",[],function s(x){var v,b=null==s.$$s?this:s.$$s;if(null==b.scanner&&(b.scanner=w),null==x&&(x=w),v=b.scanner.$scan(x),!R(v))return w;k.$throw(["NOTATION",v])},{$$s:o,$$ret:k}),R(p=o.scanner.$scan(/\d+/))?["NUMBER",p.$to_i()]:R(m=o.scanner.$scan(/[<>!=]+/))?(m=g("Normalize").$comparison_operator(m),[R(m)?"CMP_OP":"ILLEGAL",m]):(c=o.scanner.$getch().$upcase(),[R(f=g("SYMBOLS")["$[]"](c))?f:c.$to_sym(),c]))}catch(s){if(s===k)return s.$v;throw s}}),U(r,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/command/parsed"]=function(e){var z,Y,G,u,h,n,T,A,w,F=e.module,L=e.klass,_=e.def,P=e.return_ivar,R=e.truthy,q=[],U=e.nil;return z=q,Y=w=[F(q[0],"BCDice")].concat(z),G=A=[F(w[0],"Command")].concat(Y),h=[u=L(A[0],null,"Parsed")].concat(G),n=e.$r(h),(T=u.$$prototype).critical=T.fumble=T.dollar=T.modify_number=T.question_target=T.target_number=T.prefix_number=T.command=T.suffix_number=T.cmp_op=U,u.$attr_accessor("command"),u.$attr_accessor("prefix_number"),u.$attr_accessor("suffix_number"),u.$attr_accessor("critical"),u.$attr_accessor("fumble"),u.$attr_accessor("dollar"),u.$attr_accessor("modify_number"),u.$attr_accessor("cmp_op"),u.$attr_accessor("target_number"),u.$attr_writer("question_target"),_(u,"$initialize",function(){var a=this;return a.prefix_number=U,a.suffix_number=U,a.critical=U,a.fumble=U,a.dollar=U,a.cmp_op=U,a.target_number=U,a.question_target=!1}),_(u,"$question_target?",P("question_target")),_(u,"$to_s",function(a){var g=this,C=U,S=U,k=U,o=U,p=U;switch(null==a&&(a="after_command"),C=R(g.critical)?"@"+g.critical:U,S=R(g.fumble)?"#"+g.fumble:U,k=R(g.dollar)?"$"+g.dollar:U,o=n("Format").$modifier(g.modify_number),p=R(g.question_target)?"?":g.target_number,a){case"after_command":return[g.prefix_number,g.command,g.suffix_number,C,S,k,o,g.cmp_op,p].$join();case"after_modify_number":return[g.prefix_number,g.command,g.suffix_number,o,C,S,k,g.cmp_op,p].$join();case"after_target_number":return[g.prefix_number,g.command,g.suffix_number,o,g.cmp_op,p,C,S,k].$join();default:return U}},-1)},Opal.modules["bcdice/command/parser"]=function(e){var a,k,f,v,$,D,t,d,i,W,V,Q,se,s,x,b,te,p,m,C,F=e.klass,L=e.module,_=e.slice,P=e.extract_kwargs,R=e.ensure_kwargs,q=e.get_kwarg,U=e.send2,E=e.find_super,z=e.def,N=e.send,w=e.eqeq,H=e.thrower,Y=e.hash,M=e.const_set,A=e.truthy,l=e.to_ary,Z=e.hash2,G=e.top,u=[],h=e.$r(u),n=e.nil,T=e.$$$;return G.$require("racc/parser.rb"),G.$require("bcdice/arithmetic/node"),G.$require("bcdice/command/lexer"),G.$require("bcdice/command/parsed"),F(T(h("BCDice"),"Command"),T(h("Racc"),"Parser"),"Parser"),a=u,k=C=[L(u[0],"BCDice")].concat(a),p=[L(C[0],"Command")].concat(k),m=e.$r(p),f=p,x=[s=F(p[0],T(m("Racc"),"Parser"),"Parser")].concat(f),b=e.$r(x),(te=s.$$prototype).notations=te.lexer=te.modifier=te.suffix_number=te.prefix_number=te.need_suffix_number=te.need_prefix_number=te.critical=te.fumble=te.dollar=te.allowed_cmp_op=te.question_target=n,z(s,"$initialize",function K(I,X){var j,B,ee,O,J=this;return K.$$p=null,j=_(arguments),B=P(j),B=R(B),ee=j,O=q(B,"round_type"),U(J,E(J,"initialize",K,!1,!0),"initialize",[],null),J.notations=ee,J.round_type=O,J.prefix_number=!1,J.suffix_number=!1,J.need_prefix_number=!1,J.need_suffix_number=!1,J.modifier=!0,J.critical=!1,J.fumble=!1,J.dollar=!1,J.allowed_cmp_op=[n,">=",">","<=","<","==","!="],J.question_target=!1},-2),z(s,"$disable_modifier",function(){return this.modifier=!1,this}),z(s,"$enable_prefix_number",function(){return this.prefix_number=!0,this}),z(s,"$enable_suffix_number",function(){return this.suffix_number=!0,this}),z(s,"$has_prefix_number",function(){var I=this;return I.prefix_number=!0,I.need_prefix_number=!0,I}),z(s,"$has_suffix_number",function(){var I=this;return I.suffix_number=!0,I.need_suffix_number=!0,I}),z(s,"$enable_critical",function(){return this.critical=!0,this}),z(s,"$enable_fumble",function(){return this.fumble=!0,this}),z(s,"$enable_dollar",function(){return this.dollar=!0,this}),z(s,"$restrict_cmp_op_to",function(I){var X,B=this;return X=_(arguments),B.allowed_cmp_op=X,B},-1),z(s,"$enable_question_target",function(){return this.question_target=!0,this}),z(s,"$parse",function(I){var X=this;try{return X.lexer=b("Lexer").$new(I,X.notations),X.$do_parse()}catch(j){if(!e.rescue(j,[b("ParseError"),b("ZeroDivisionError")]))throw j;try{return n}finally{e.pop_exception()}}}),s.$private(),z(s,"$parsed",function(I,X,j,B){try{return H("eval_return"),N(b("Parsed").$new(),"tap",[],function re(J){var ae,ce,oe,fe,de,le,me,_e=null==re.$$s?this:re.$$s;return null==_e.round_type&&(_e.round_type=n),null==J&&(J=n),J["$command="](I["$[]"]("command")),J["$prefix_number="]((ae=I["$[]"]("prefix"))===n||null==ae?n:ae.$eval(_e.round_type)),J["$suffix_number="]((ce=I["$[]"]("suffix"))===n||null==ce?n:ce.$eval(_e.round_type)),J["$critical="]((oe=X["$[]"]("critical"))===n||null==oe?n:oe.$eval(_e.round_type)),J["$fumble="]((fe=X["$[]"]("fumble"))===n||null==fe?n:fe.$eval(_e.round_type)),J["$dollar="]((de=X["$[]"]("dollar"))===n||null==de?n:de.$eval(_e.round_type)),J["$modify_number="](j.$eval(_e.round_type)),J["$cmp_op="](B["$[]"]("cmp_op")),w(B["$[]"]("target"),"?")?(J["$question_target="](!0),N(J,"target_number=",le=[0]),le[le.length-1]):(J["$question_target="](!1),le=[(me=B["$[]"]("target"),me===n||null==me?n:me.$eval(_e.round_type))],N(J,"target_number=",le),le[le.length-1])},{$$s:this})}catch(re){if(re===e.t_eval_return)return re.$v;throw re}}),z(s,"$next_token",function(){return this.lexer.$next_token()}),v=e.large_array_unpack("6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,33,34,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,,,17,18,6,,5,,,17,18,,,5,23,24,25,26,56,54,55,57"),$=e.large_array_unpack("0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,,17,15,15,18,18,23,,18,30,30,23,23,24,,23,31,31,24,24,25,,24,44,44,25,25,28,,25,47,47,28,28,29,,28,48,48,29,29,33,,29,49,49,33,33,34,,33,50,50,34,34,36,,34,,,36,36,37,,36,,,37,37,,,37,27,27,27,27,52,52,52,52"),D=e.large_array_unpack("-2,4,16,-3,-1,11,,33,13,35,23,30,1,,28,40,,37,44,,,-2,,51,58,65,0,106,72,79,47,54,,86,93,,100,107,,,,,,,63,,,68,75,82,89,,120,,,,,"),t=e.large_array_unpack("-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29"),d=e.large_array_unpack("30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,,,21,47,48,40,51,52,49,50,44,46,3,,,,13,,,,,,,,32"),i=e.large_array_unpack("8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,,,4,8,8,5,7,7,8,8,9,5,6,,,,6,,,,,,,,6"),W=[n,6,13,3,9,-1,27,-15,-10,-1,-38],V=[n,n,n,n,n,n,19,16,15,n,n],Q=e.large_array_unpack("0,0,racc_error,4,20,_reduce_1,4,20,_reduce_2,3,20,_reduce_3,3,21,_reduce_4,2,21,_reduce_5,2,21,_reduce_6,1,21,_reduce_7,0,22,_reduce_8,3,22,_reduce_9,3,22,_reduce_10,3,22,_reduce_11,2,23,_reduce_12,2,23,_reduce_13,3,23,_reduce_14,3,23,_reduce_15,0,24,_reduce_16,2,24,_reduce_17,2,24,_reduce_18,3,28,_reduce_19,3,28,_reduce_20,1,28,_reduce_none,3,27,_reduce_22,4,27,_reduce_23,1,27,_reduce_none,0,29,_reduce_25,1,29,_reduce_26,1,29,_reduce_27,1,29,_reduce_28,1,29,_reduce_29,2,26,_reduce_30,2,26,_reduce_31,1,26,_reduce_none,3,25,_reduce_33,1,25,_reduce_34"),se=Y(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),M(x[0],"Racc_arg",[v,$,t,D,d,i,V,W,19,Q,se,58,35,!0]),M(x[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),M(x[0],"Racc_debug_parser",!1),z(s,"$_reduce_1",function(I,X,j){var B,O=this;return A(O.modifier)||O.$raise(b("ParseError")),B=l(I),O.$parsed(null==B[0]?n:B[0],null==B[1]?n:B[1],null==B[2]?n:B[2],null==B[3]?n:B[3])}),z(s,"$_reduce_2",function(I,X,j){var B,O=this;return A(O.modifier)||O.$raise(b("ParseError")),B=l(I),O.$parsed(null==B[0]?n:B[0],null==B[2]?n:B[2],null==B[1]?n:B[1],null==B[3]?n:B[3])}),z(s,"$_reduce_3",function(I,X,j){var B,ae;return ae=null==(B=l(I))[2]?n:B[2],this.$parsed(null==B[0]?n:B[0],null==B[1]?n:B[1],T(T(b("Arithmetic"),"Node"),"Number").$new(0),ae)}),z(s,"$_reduce_4",function(I,X,j){var B=this;return A(B.prefix_number)&&A(B.suffix_number)||B.$raise(b("ParseError")),Z(["command","prefix","suffix"],{command:I["$[]"](1),prefix:I["$[]"](0),suffix:I["$[]"](2)})}),z(s,"$_reduce_5",function(I,X,j){var B=this;return A(B.prefix_number)||B.$raise(b("ParseError")),A(B.need_suffix_number)&&B.$raise(b("ParseError")),Z(["command","prefix"],{command:I["$[]"](1),prefix:I["$[]"](0)})}),z(s,"$_reduce_6",function(I,X,j){var B=this;return A(B.suffix_number)||B.$raise(b("ParseError")),A(B.need_prefix_number)&&B.$raise(b("ParseError")),Z(["command","suffix"],{command:I["$[]"](0),suffix:I["$[]"](1)})}),z(s,"$_reduce_7",function(I,X,j){var B=this;return(A(B.need_prefix_number)||A(B.need_suffix_number))&&B.$raise(b("ParseError")),Z(["command"],{command:I["$[]"](0)})}),z(s,"$_reduce_8",function(I,X,j){return Z([],{})}),z(s,"$_reduce_9",function(I,X,j){var B,ae,re=n;return re=null==(B=l(I))[0]?n:B[0],ae=null==B[2]?n:B[2],A(this.critical)&&A(re["$[]"]("critical")["$nil?"]())||this.$raise(b("ParseError")),re["$[]="]("critical",ae),re}),z(s,"$_reduce_10",function(I,X,j){var B,ae,re=n;return re=null==(B=l(I))[0]?n:B[0],ae=null==B[2]?n:B[2],A(this.fumble)&&A(re["$[]"]("fumble")["$nil?"]())||this.$raise(b("ParseError")),re["$[]="]("fumble",ae),re}),z(s,"$_reduce_11",function(I,X,j){var B,ae,re=n;return re=null==(B=l(I))[0]?n:B[0],ae=null==B[2]?n:B[2],A(this.dollar)&&A(re["$[]"]("dollar")["$nil?"]())||this.$raise(b("ParseError")),re["$[]="]("dollar",ae),re}),z(s,"$_reduce_12",function(I,X,j){return I["$[]"](1)}),z(s,"$_reduce_13",function(I,X,j){return T(T(b("Arithmetic"),"Node"),"Negative").$new(I["$[]"](1))}),z(s,"$_reduce_14",function(I,X,j){return T(T(b("Arithmetic"),"Node"),"BinaryOp").$new(I["$[]"](0),"+",I["$[]"](2))}),z(s,"$_reduce_15",function(I,X,j){return T(T(b("Arithmetic"),"Node"),"BinaryOp").$new(I["$[]"](0),"-",I["$[]"](2))}),z(s,"$_reduce_16",function(I,X,j){return A(this.allowed_cmp_op["$include?"](n))||this.$raise(b("ParseError")),Z([],{})}),z(s,"$_reduce_17",function(I,X,j){var B,re,J;return J=null==(B=l(I))[1]?n:B[1],A(this.allowed_cmp_op["$include?"](re=null==B[0]?n:B[0]))||this.$raise(b("ParseError")),Z(["cmp_op","target"],{cmp_op:re,target:J})}),z(s,"$_reduce_18",function(I,X,j){var ee,B=this;return ee=I["$[]"](0),A(B.question_target)||B.$raise(b("ParseError")),A(B.allowed_cmp_op["$include?"](ee))||B.$raise(b("ParseError")),Z(["cmp_op","target"],{cmp_op:ee,target:"?"})}),z(s,"$_reduce_19",function(I,X,j){return T(T(b("Arithmetic"),"Node"),"BinaryOp").$new(I["$[]"](0),"+",I["$[]"](2))}),z(s,"$_reduce_20",function(I,X,j){return T(T(b("Arithmetic"),"Node"),"BinaryOp").$new(I["$[]"](0),"-",I["$[]"](2))}),z(s,"$_reduce_22",function(I,X,j){return T(T(b("Arithmetic"),"Node"),"BinaryOp").$new(I["$[]"](0),"*",I["$[]"](2))}),z(s,"$_reduce_23",function(I,X,j){return I["$[]"](3).$new(I["$[]"](0),I["$[]"](2))}),z(s,"$_reduce_25",function(I,X,j){return T(T(b("Arithmetic"),"Node"),"DivideWithGameSystemDefault")}),z(s,"$_reduce_26",function(I,X,j){return T(T(b("Arithmetic"),"Node"),"DivideWithCeil")}),z(s,"$_reduce_27",function(I,X,j){return T(T(b("Arithmetic"),"Node"),"DivideWithCeil")}),z(s,"$_reduce_28",function(I,X,j){return T(T(b("Arithmetic"),"Node"),"DivideWithRound")}),z(s,"$_reduce_29",function(I,X,j){return T(T(b("Arithmetic"),"Node"),"DivideWithFloor")}),z(s,"$_reduce_30",function(I,X,j){return I["$[]"](1)}),z(s,"$_reduce_31",function(I,X,j){return T(T(b("Arithmetic"),"Node"),"Negative").$new(I["$[]"](1))}),z(s,"$_reduce_33",function(I,X,j){return I["$[]"](1)}),z(s,"$_reduce_34",function(I,X,j){return T(T(b("Arithmetic"),"Node"),"Number").$new(I["$[]"](0))}),z(s,"$_reduce_none",function(I,X,j){return I["$[]"](0)})},Opal.modules["bcdice/deprecated/checker"]=function(e){var N,M,G,u,h,n,l,H,F=e.module,L=e.send,_=e.eqeqeq,P=e.truthy,R=e.def,q=e.return_val,U=[],E=e.nil;return N=U,M=H=[F(U[0],"BCDice")].concat(N),G=l=[F(H[0],"Deprecated")].concat(M),h=[u=F(l[0],"Checker")].concat(G),n=e.$r(h),u.$private(),R(u,"$check_result_legacy",function(r,a,g,C){var p,S=this,k=E,o=E,m=E,y=E;return k=L(a,"map",[],"sides".$to_proc()),p=(o=L(a,"map",[],"value".$to_proc())).$sum(),m=_([100],y=k)?S.$check_1D100(r,p,g,C):_([20],y)?S.$check_1D20(r,p,g,C):_([6,6],y)?S.$check_2D6(r,p,o,g,C):E,(P(m["$nil?"]())||P(m["$empty?"]()))&&(m=_([10],y=k.$uniq())?S.$check_nD10(r,p,o,g,C):_([6],y)?S.$check_nD6(r,p,o,g,C):E,P(m["$nil?"]())||P(m["$empty?"]()))?E:n("Result").$new(m.$delete_prefix(" \uff1e "))}),R(u,"$check_1D100",q(E)),R(u,"$check_1D20",q(E)),R(u,"$check_nD10",q(E)),R(u,"$check_2D6",q(E)),R(u,"$check_nD6",q(E))},Opal.modules["bcdice/base"]=function(e){var h,S,y,b,$,D,c,f,s,x,o,F=e.module,L=e.klass,_=e.slice,P=e.rb_plus,R=e.truthy,q=e.def,U=e.regexp,E=e.send,z=e.thrower,N=e.return_ivar,w=e.assign_ivar_val,H=e.eqeqeq,Y=e.eqeq,M=e.return_val,A=e.range,l=e.rb_minus,Z=e.rb_divide,G=e.rb_times,u=e.rb_ge,n=e.top,T=[],r=e.$r(T),a=e.nil,g=e.$$$;return n.$require("i18n"),n.$require("i18n/backend/fallbacks"),n.$require("bcdice/randomizer"),n.$require("bcdice/dice_table"),n.$require("bcdice/enum"),n.$require("bcdice/translate"),n.$require("bcdice/result"),n.$require("bcdice/command/parser"),n.$require("bcdice/deprecated/checker"),S=T,y=o=[F(T[0],"BCDice")].concat(S),f=[c=L(o[0],null,"Base")].concat(y),s=e.$r(f),(x=c.$$prototype).raw_input=x.randomizer=x.enabled_upcase_input=x.debug=a,$=[b=e.get_singleton_class(c)].concat(f),D=e.$r($),b.$attr_reader("prefixes"),q(b,"$register_prefix",function(d){var W,V=this,Q=a;return null==V.prefixes&&(V.prefixes=a),W=_(arguments),V.prefixes=P(R(Q=V.prefixes)?Q:[],W.$flatten())},-1),q(b,"$register_prefix_from_super_class",function(){return this.$register_prefix(this.$superclass().$prefixes())}),q(b,"$prefixes_pattern",function(){var d=this,i=a;return null==d.prefixes_pattern&&(d.prefixes_pattern=a),null==d.prefixes&&(d.prefixes=a),d.prefixes_pattern=R(i=d.prefixes_pattern)?i:a,R(d.prefixes_pattern)?d.prefixes_pattern:(d.prefixes=R(i=d.prefixes)?i:[],d.prefixes.$freeze(),d.prefixes_pattern=(R(d.prefixes["$empty?"]())?/(?!)/:U(["^(S)?(",d.prefixes.$join("|"),")"],"i")).$freeze())}),q(b,"$command_pattern",function(){var d=this,i=a,W=a;return null==d.command_pattern&&(d.command_pattern=a),null==d.prefixes&&(d.prefixes=a),d.command_pattern=R(i=d.command_pattern)?i:a,R(d.command_pattern)?d.command_pattern:(d.prefixes=R(i=d.prefixes)?i:[],d.prefixes.$freeze(),W=P(E(g(D("CommonCommand"),"COMMANDS"),"map",[],function(Q){return null==Q&&(Q=a),g(Q,"PREFIX_PATTERN").$source()}),d.prefixes),d.command_pattern=U(["^S?(",W.$join("|"),")"],"i").$freeze())}),q(b,"$eval",function(d){try{return z("eval_return"),this.$new(d).$eval()}catch(V){if(V===e.t_eval_return)return V.$v;throw V}}),c.$include(s("Translate")),c.$include(g(s("Deprecated"),"Checker")),q(c,"$initialize",function(v){var $=this;return $.raw_input=v,$.sort_add_dice=!1,$.sort_barabara_dice=!1,$.d66_sort_type=g(s("D66SortType"),"NO_SORT"),$.enabled_d9=!1,$.round_type=g(s("RoundType"),"FLOOR"),$.sides_implicit_d=6,$.upper_dice_reroll_threshold=a,$.reroll_dice_reroll_threshold=a,$.default_cmp_op=a,$.default_target_number=a,$.enabled_upcase_input=!0,$.locale="ja_jp",$.randomizer=g(s("BCDice"),"Randomizer").$new(),$.debug=!1}),c.$attr_accessor("randomizer"),c.$attr_reader("d66_sort_type"),c.$attr_reader("round_type"),c.$attr_reader("sides_implicit_d"),c.$attr_reader("upper_dice_reroll_threshold"),c.$attr_reader("reroll_dice_reroll_threshold"),c.$attr_reader("default_cmp_op"),c.$attr_reader("default_target_number"),q(c,"$sort_add_dice?",N("sort_add_dice")),q(c,"$sort_barabara_dice?",N("sort_barabara_dice")),q(c,"$enabled_d9?",N("enabled_d9")),q(c,"$enable_debug",w("debug",!0)),q(c,"$eval",function(){var $,t,v=this,D=a;return $=g(s("BCDice"),"Preprocessor").$process(v.raw_input,v),D=R(t=v.$dice_command($))?t:v.$eval_common_command(v.raw_input),R(D)?(D["$rands="](v.randomizer.$rand_results()),D["$detailed_rands="](v.randomizer.$detailed_rand_results()),D):a}),q(c,"$change_text",function(v){return v}),q(c,"$check_result",function(v,$,D,t){var d=this,i=a,W=a,V=a,Q=a,$e=a;return i=d.$check_result_legacy(v,$,D,t),R(i)?i:(W=E($,"map",[],"sides".$to_proc()),Q=(V=E($,"map",[],"value".$to_proc())).$sum(),i=H([100],$e=W)?d.$result_1d100(v,Q,D,t):H([20],$e)?d.$result_1d20(v,Q,D,t):H([6,6],$e)?d.$result_2d6(v,Q,V,D,t):a,Y(i,s("Result").$nothing())?a:R(i)?i:(i=H([10],$e=W.$uniq())?d.$result_nd10(v,Q,V,D,t):H([6],$e)?d.$result_nd6(v,Q,V,D,t):a,Y(i,s("Result").$nothing())?a:R(i)?i:d.$result_ndx(v,D,t)))}),q(c,"$grich_text",M(a)),c.$private(),q(c,"$eval_common_command",function(v){try{z("eval_return");var D=z("return");return v=this.$change_text(v),E(g(s("CommonCommand"),"COMMANDS"),"each",[],function d(i){var V,W=null==d.$$s?this:d.$$s;if(null==W.randomizer&&(W.randomizer=a),null==i&&(i=a),V=i.$eval(v,W,W.randomizer),!R(V))return a;D.$throw(V)},{$$s:this,$$ret:D}),a}catch(d){if(d===e.t_eval_return||d===D)return d.$v;throw d}}),q(c,"$dice_command",function(v){var $=this,D=a,t=a,d=a,i=a;return R($.enabled_upcase_input)&&(v=v.$upcase()),D=$.$class().$prefixes_pattern().$match(v),R(D)?(t=D["$[]"](1)["$nil?"]()["$!"](),R(t)&&(v=v["$[]"](A(1,-1,!1))),d=$.$eval_game_system_specific_command(v),R(d["$is_a?"](s("Result")))?(d["$secret="](R(i=d["$secret?"]())?i:t),d):R(d["$nil?"]())||R(d["$empty?"]())||Y(d,"1")?a:E(s("Result").$new(),"tap",[],function(V){var Q;return null==V&&(V=a),V["$text="](d.$to_s()),E(V,"secret=",Q=[t]),Q[Q.length-1]})):a}),q(c,"$eval_game_system_specific_command",M(a)),q(c,"$result_ndx",function(v,$,D){return R(D["$is_a?"](s("String")))?a:R(v.$send($,D))?s("Result").$success(this.$translate("success")):s("Result").$failure(this.$translate("failure"))}),q(c,"$result_1d100",M(a)),q(c,"$result_1d20",M(a)),q(c,"$result_nd10",M(a)),q(c,"$result_2d6",M(a)),q(c,"$result_nd6",M(a)),q(c,"$get_table_by_2d6",function(v){return this.$get_table_by_nD6(v,2)}),q(c,"$get_table_by_1d6",function(v){return this.$get_table_by_nD6(v,1)}),q(c,"$get_table_by_nD6",function(v,$){return this.$get_table_by_nDx(v,$,6)}),q(c,"$get_table_by_nDx",function(v,$,D){var d,i=a;return d=this.randomizer.$roll_sum($,D),i=this.$get_table_value(v["$[]"](l(d,$))),R(i["$nil?"]())?["1",0]:[i,d]}),q(c,"$get_table_by_1d3",function(v){var t,d,$=this,i=a;return $.$debug("get_table_by_1d3"),t=$.randomizer.$roll_sum(1,6),$.$debug("num",t),d=Z(l(t,1),2).$to_i(),$.$debug("index",d),i=v["$[]"](d),R(i["$nil?"]())?["1",0]:[i,t]}),q(c,"$get_table_by_d66_swap",function(v){var D;return D=this.randomizer.$roll_d66(g(s("D66SortType"),"ASC")),[this.$get_table_by_number(D,v),D]}),q(c,"$get_table_by_d66",function(v){var D,t,d,W,i=a;return D=this.randomizer.$roll_once(6),t=this.randomizer.$roll_once(6),d=P(G(l(D,1),6),l(t,1)),i=v["$[]"](d),W=""+D+t,R(i["$nil?"]())?["1",W]:[i,W]}),q(c,"$get_table_by_number",function(v,$,D){try{var t=z("return");return null==D&&(D="1"),E($,"each",[],function i(W){var Q,V=null==i.$$s?this:i.$$s;if(null==W&&(W=a),Q=W["$[]"](0),!R(u(Q,v)))return a;t.$throw(V.$get_table_value(W["$[]"](1)))},{$$s:this,$$ret:t}),this.$get_table_value(D)}catch(i){if(i===t)return i.$v;throw i}},-3),q(c,"$get_table_value",function(v){return R(v["$is_a?"](s("Proc")))?v.$call():v}),q(c,"$roll_tables",function(v,$){var t=a;return t=$["$[]"](v),R(t)?t.$roll(this.randomizer).$to_s():a}),q(c,"$debug",function(v,$){var t,d=this,i=a,W=a;return t=_(arguments,1),R(d.debug)?(i=R(v["$is_a?"](s("String")))?v:v.$inspect(),R(t["$empty?"]())?d.$warn(i):(W=E(t,"map",[],function(Q){return null==Q&&(Q=a),R(Q["$is_a?"](s("String")))?'"'+Q+'"':Q.$inspect()}),d.$warn(i+": "+W.$join(", ")))):a},-2),g(g(r("I18n"),"Backend"),"Simple").$include(g(g(r("I18n"),"Backend"),"Fallbacks")),r("I18n").$load_path()["$<<"](r("Dir")["$[]"](r("File").$join("bcdice","../../i18n/**/*.yml"))),r("I18n")["$default_locale="]("ja_jp"),h=[["ja_jp"]],E(r("I18n").$fallbacks(),"defaults=",h),h[h.length-1]},Opal.queue(function(e){var G,T,k,o,p,m,a,g,h,F=e.module,L=e.klass,_=e.const_set,P=e.truthy,R=e.def,q=e.to_ary,U=e.rb_plus,E=e.rb_minus,z=e.rb_gt,N=e.eqeq,w=e.rb_lt,H=e.thrower,Y=e.rb_ge,A=[],l=e.nil;return e.top.$require("bcdice/base"),G=A,T=h=[F(A[0],"BCDice")].concat(G),a=[F(h[0],"GameSystem")].concat(T),g=e.$r(a),k=a,p=[o=L(a[0],g("Base"),"ZettaiReido")].concat(k),m=e.$r(p),o.$$prototype.randomizer=l,_(p[0],"ID","ZettaiReido"),_(p[0],"NAME","\u7d76\u5bfe\u96b7\u5974"),_(p[0],"SORT_KEY","\u305b\u3064\u305f\u3044\u308c\u3044\u3068"),_(p[0],"HELP_MESSAGE","\u30fb\u5224\u5b9a\nm-2DR+n>=x\nm(\u57fa\u672c\u80fd\u529b),n(\u4fee\u6b63\u5024),x(\u76ee\u6a19\u5024)\nDP\u306e\u53d6\u5f97\u306e\u6709\u7121\u3082\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n"),o.$register_prefix("\\d+\\-2DR"),R(o,"$eval_game_system_specific_command",function(f){var x=l,b=l,v=l;return P(f["$=~"](/^(\d+)-2DR([+\-\d]*)(>=(\d+))?$/i))?(x=m("Regexp").$last_match(1).$to_i(),b=m("Regexp").$last_match(2),v=m("Regexp").$last_match(4),this.$roll2DR(x,b,v)):l}),R(o,"$roll2DR",function(f,s,x){var b,v,D,t,d,i,W,$=this,Q=l,$e=l,ne=l,se=l,ie=l;return v=$.$roll2DarkDice(),D=null==(b=q(v))[0]?l:b[0],t=null==b[1]?l:b[1],d=null==b[2]?l:b[2],v=$.$getModInfo(s),i=null==(b=q(v))[0]?l:b[0],s=null==b[1]?l:b[1],v=$.$getDiffInfo(x),W=null==(b=q(v))[0]?l:b[0],Q="("+f+"-2DR"+s+(null==b[1]?l:b[1])+")",$e=f+"-"+D+"["+t+"]"+s,ne=U(E(f,D),i),se=$.$getResult(D,ne,W),P(z(d,0))&&(ie=d+"DP"),se["$text="]([Q,$e,ne.$to_i(),se.$text(),ie].$compact().$join(" \uff1e ")),se}),R(o,"$roll2DarkDice",function(){var f,s,b,v,$,D,t,x=this,i=l;return b=x.randomizer.$roll_once(6),v=x.randomizer.$roll_once(6),s=x.$changeDiceToDarkDice(b),$=null==(f=q(s))[0]?l:f[0],D=null==f[1]?l:f[1],s=x.$changeDiceToDarkDice(v),t=null==(f=q(s))[0]?l:f[0],i=U(D,null==f[1]?l:f[1]),N(i,2)&&(i=4),[U($,t),$+","+t,i]}),R(o,"$changeDiceToDarkDice",function(f){var s=l,x=l;return s=0,x=f,N(f,6)&&(x=0,s=1),[x,s]}),R(o,"$getModInfo",function(f){try{H("eval_return");var x=l,b=l;return x=m("ArithmeticEvaluator").$eval(f),b="",P(w(x,0))?b=x.$to_s():P(z(x,0))&&(b=U("+",x.$to_s())),[x,b]}catch(v){if(v===e.t_eval_return)return v.$v;throw v}}),R(o,"$getDiffInfo",function(f){var s=l;return s="",P(f["$nil?"]())||(s=">="+(f=f.$to_i()).$to_i()),[f,s]}),R(o,"$getResult",function(f,s,x){var b=l;return N(f,0)?m("Result").$critical("\u30af\u30ea\u30c6\u30a3\u30ab\u30eb"):N(f,10)?m("Result").$fumble("\u30d5\u30a1\u30f3\u30d6\u30eb"):(P(x["$nil?"]())&&(x=0),b=E(s,x),P(Y(b,0))?m("Result").$success(b+" \u6210\u529f"):m("Result").$failure("\u5931\u6557"))})})}}]);