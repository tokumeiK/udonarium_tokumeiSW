(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[9640],{7184:(ye,pe,ge)=>{ge(9993),Opal.modules["i18n/backend/fallbacks"]=function(e){var W,u,r,t,c,y,Y=e.module,j=e.class_variable_set,_=e.truthy,U=e.class_variable_get,A=e.def,o=e.send,F=e.send2,g=e.find_super,E=e.hash2,M=e.find_block_super,D=e.neqeq,X=e.thrower,Q=e.return_val,G=[],L=e.nil,z=e.$$$;return W=G,y=[c=Y(G[0],"I18n")].concat(W),j(y[0],"@@fallbacks",L),u=e.get_singleton_class(c),r=[u].concat(y),t=e.$r(r),A(u,"$fallbacks",function(){var P=L;return j(r[1],"@@fallbacks",_(null!=r[1].$$cvars["@@fallbacks"]?"class variable":L)&&_(P=U(r[1],"@@fallbacks",!1))?P:z(z(t("I18n"),"Locale"),"Fallbacks").$new()),_(P=t("Thread").$current()["$[]"]("i18n_fallbacks"))?P:U(r[1],"@@fallbacks",!1)}),A(u,"$fallbacks=",function(C){var P;return j(r[1],"@@fallbacks",_(C["$is_a?"](t("Array")))?z(z(t("I18n"),"Locale"),"Fallbacks").$new(C):C),P=["i18n_fallbacks",U(r[1],"@@fallbacks",!1)],o(t("Thread").$current(),"[]=",P),P[P.length-1]}),function(u,N){var C,P,x,b,t=[Y(u,"Backend")].concat(N);return C=t,x=[P=Y(t[0],"Fallbacks")].concat(C),b=e.$r(x),A(P,"$translate",function T(k,R,a){try{var f=X("return"),l=T.$$p||L,H=this,m=L,S=L;return T.$$p=null,null==a&&(a=b("EMPTY_HASH")),_(a.$fetch("fallback",!0))?_(a["$[]"]("fallback_in_progress"))?F(H,g(H,"translate",T,!1,!0),"translate",[k,R,a],l):(_(a["$[]"]("default"))&&(m=H["$extract_non_symbol_default!"](a)),S=a.$merge(E(["fallback_in_progress"],{fallback_in_progress:!0})),o(b("I18n").$fallbacks()["$[]"](k),"each",[],function n(I){var s=null==n.$$s?this:n.$$s;null==I&&(I=L);try{return o(s,"catch",["exception"],function d(){var i=null==d.$$s?this:d.$$s,ee=L;if(ee=F(i,M(i,"translate",d.$$def||n.$$def||T,!1,!1),"translate",[I,R,S],null),_(ee["$nil?"]()))return L;D(k.$to_s(),I.$to_s())&&i.$on_fallback(k,I,R,a),f.$throw(ee)},{$$s:s,$$ret:f})}catch(d){if(!e.rescue(d,[z(b("I18n"),"InvalidLocale")]))throw d;try{return L}finally{e.pop_exception()}}},{$$s:H}),_(a["$key?"]("default"))&&_(a["$[]"]("default")["$nil?"]())?L:_(m)?F(H,g(H,"translate",T,!1,!0),"translate",[k,L,a.$merge(E(["default"],{default:m}))],null):H.$throw("exception",z(b("I18n"),"MissingTranslation").$new(k,R,a))):F(H,g(H,"translate",T,!1,!0),"translate",[k,R,a],l)}catch(n){if(n===f)return n.$v;throw n}},-3),A(P,"$extract_non_symbol_default!",function(k){var a,R=L;return R=[k["$[]"]("default")].$flatten(),a=o(R,"detect",[],function(l){return null==l&&(l=L),l["$is_a?"](b("Symbol"))["$!"]()}),_(a)&&k["$[]="]("default",R["$[]"](0,R.$index(a))),a}),A(P,"$exists?",function T(k,R,a){try{var f=X("return"),l=T.$$p||L,H=this;return T.$$p=null,null==a&&(a=b("EMPTY_HASH")),_(a.$fetch("fallback",!0))?(o(b("I18n").$fallbacks()["$[]"](k),"each",[],function m(S){var n=null==m.$$s?this:m.$$s;null==S&&(S=L);try{if(!_(F(n,M(n,"exists?",m.$$def||T,!1,!1),"exists?",[S,R],null)))return L;f.$throw(!0)}catch(I){if(!e.rescue(I,[z(b("I18n"),"InvalidLocale")]))throw I;try{return L}finally{e.pop_exception()}}},{$$s:H,$$ret:f}),!1):F(H,g(H,"exists?",T,!1,!0),"exists?",[k,R,a],l)}catch(m){if(m===f)return m.$v;throw m}},-3),P.$private(),A(P,"$on_fallback",Q(L))}(y[0],y)},Opal.modules["bcdice/randomizer"]=function(e){var c,p,C,P,x,b,u,N,j=e.klass,_=e.const_set,U=e.def,A=e.truthy,o=e.rb_gt,F=e.rb_plus,g=e.rb_le,E=e.send,M=e.rb_minus,D=e.eqeq,X=e.rb_times,Q=e.eqeqeq,G=e.rb_ge,L=[],z=e.nil,$=e.$$$;return c=L,u=[(0,e.module)(L[0],"BCDice")].concat(c),N=e.$r(u),p=u,P=[C=j(u[0],null,"Randomizer")].concat(p),x=e.$r(P),(b=C.$$prototype).rand_results=b.detailed_rand_results=z,_(P[0],"UPPER_LIMIT_DICE_TIMES",200),_(P[0],"UPPER_LIMIT_DICE_SIDES",1e4),_(P[0],"UPPER_LIMIT_RANDS",1e4),U(C,"$initialize",function(){return this.rand_results=[],this.detailed_rand_results=[]}),C.$attr_reader("rand_results"),C.$attr_reader("detailed_rand_results"),_(P[0],"DetailedRandResult",x("Struct").$new("kind","sides","value")),U(C,"$roll_barabara",function(k,R){var a=this;return A(o(F(a.rand_results.$size(),k),x("UPPER_LIMIT_RANDS")))&&a.$raise(x("TooManyRandsError")),A(g(k,0))||A(o(k,x("UPPER_LIMIT_DICE_TIMES")))?[]:E(x("Array"),"new",[k],function f(){return(null==f.$$s?this:f.$$s).$roll_once(R)},{$$s:a})}),U(C,"$roll_sum",function(k,R){return this.$roll_barabara(k,R).$sum()}),U(C,"$roll_once",function(k){var a=z;return A(g(k,0))||A(o(k,x("UPPER_LIMIT_DICE_SIDES")))?0:(a=this.$rand_inner(k),this.$push_to_detail("normal",k,a),a)}),U(C,"$roll_index",function(k){return M(this.$roll_once(k),1)}),U(C,"$roll_tens_d10",function(){var a,R=z;return R=this.$rand_inner(10),D(R,10)&&(R=0),a=X(R,10),this.$push_to_detail("tens_d10",10,a),a}),U(C,"$roll_d9",function(){var R;return R=M(this.$rand_inner(10),1),this.$push_to_detail("d9",10,R),R}),U(C,"$roll_d66",function(k){var f,a=z;return a=E(x("Array"),"new",[2],function l(){return(null==l.$$s?this:l.$$s).$roll_once(6)},{$$s:this}),Q($(x("D66SortType"),"ASC"),f=k)?a["$sort!"]():Q($(x("D66SortType"),"DESC"),f)&&a["$sort!"]()["$reverse!"](),F(X(a["$[]"](0),10),a["$[]"](1))}),C.$private(),U(C,"$rand_inner",function(k){var a,R=this;return A(G(R.rand_results.$size(),x("UPPER_LIMIT_RANDS")))&&R.$raise(x("TooManyRandsError")),a=R.$random(k),R.rand_results["$<<"]([a,k]),a}),U(C,"$random",function(k){return F(x("Kernel").$rand(k),1)}),U(C,"$push_to_detail",function(k,R,a){var l;return l=x("DetailedRandResult").$new(k,R,a),this.detailed_rand_results.$push(l)}),j(u[0],N("StandardError"),"TooManyRandsError"),z},Opal.modules["bcdice/dice_table/roll_result"]=function(e){var E,Q,W,c,y,u,N,L,D,Y=e.module,j=e.klass,_=e.def,U=e.truthy,A=e.return_val,o=[],F=e.nil;return E=o,Q=D=[Y(o[0],"BCDice")].concat(E),W=L=[Y(D[0],"DiceTable")].concat(Q),y=[c=j(L[0],null,"RollResult")].concat(W),u=e.$r(y),(N=c.$$prototype).table_name=N.value=N.body=F,_(c,"$initialize",function(t,p,C){var P=this;return P.table_name=t,P.value=p,P.body=C}),c.$attr_reader("table_name"),c.$attr_reader("value"),c.$attr_reader("body"),_(c,"$to_s",function(){var t=this;return t.table_name+"("+t.value+") \uff1e "+t.body}),_(c,"$last_body",function(){var t=this;return U(t.body["$is_a?"](u("RollResult")))?t.body.$last_body():t.body}),_(c,"$empty?",A(!1))},Opal.modules["bcdice/dice_table/chain_table"]=function(e){var E,Q,W,c,y,u,N,L,D,Y=e.module,j=e.klass,_=e.truthy,U=e.def,A=e.rb_minus,o=[],F=e.nil;return E=o,Q=D=[Y(o[0],"BCDice")].concat(E),W=L=[Y(D[0],"DiceTable")].concat(Q),y=[c=j(L[0],null,"ChainTable")].concat(W),u=e.$r(y),(N=c.$$prototype).times=N.sides=N.items=N.name=F,U(c,"$initialize",function(t,p,C){var P=this,x=F;return P.name=t,P.items=C.$freeze(),x=/(\d+)D(\d+)/i.$match(p),_(x)||P.$raise(u("ArgumentError"),"Unexpected table type: "+p),P.times=x["$[]"](1).$to_i(),P.sides=x["$[]"](2).$to_i()}),U(c,"$roll",function(t){var C,P,p=this,x=F;return C=t.$roll_sum(p.times,p.sides),P=A(C,p.times),x=p.items["$[]"](P),_(x["$respond_to?"]("roll"))&&(x=x.$roll(t)),u("RollResult").$new(p.name,C,x)})},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(e){var X,z,u,N,r,t,p,W,G,Y=e.module,j=e.klass,_=e.hash2,U=e.defs,A=e.def,o=e.rb_plus,F=e.rb_times,g=e.rb_minus,E=[],M=e.nil;return X=E,z=G=[Y(E[0],"BCDice")].concat(X),u=W=[Y(G[0],"DiceTable")].concat(z),r=[N=j(W[0],null,"D66GridTable")].concat(u),t=e.$r(r),(p=N.$$prototype).name=p.items=M,U(N,"$from_i18n",function(P,x){var T=M;return T=t("I18n").$t(P,_(["locale","raise"],{locale:x,raise:!0})),this.$new(T["$[]"]("name"),T["$[]"]("items"))}),A(N,"$initialize",function(P,x){return this.name=P,this.items=x.$freeze()}),A(N,"$roll",function(P){var b,T,k,R,a;return b=P.$roll_once(6),T=P.$roll_once(6),k=o(F(b,10),T),R=g(b,1),a=g(T,1),t("RollResult").$new(this.name,k,this.items["$[]"](R)["$[]"](a))})},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(e){var M,G,y,u,N,r,z,$,X,Y=e.module,j=e.klass,_=e.hash2,U=e.defs,A=e.def,F=[],g=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),M=F,G=X=[Y(F[0],"BCDice")].concat(M),z=[Y(X[0],"DiceTable")].concat(G),$=e.$r(z),y=z,N=[u=j(z[0],$("D66GridTable"),"D66HalfGridTable")].concat(y),r=e.$r(N),U(u,"$from_i18n",function(p,C){var x=g;return x=r("I18n").$t(p,_(["locale","raise"],{locale:C,raise:!0})),this.$new(x["$[]"]("name"),x["$[]"]("items_1_2_3"),x["$[]"]("items_4_5_6"))}),A(u,"$initialize",function(p,C,P){return this.name=p,this.items=[C,C,C,P,P,P].$freeze()})},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(e){var M,G,y,u,N,r,z,$,X,Y=e.module,j=e.klass,_=e.hash2,U=e.defs,A=e.def,F=[],g=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),M=F,G=X=[Y(F[0],"BCDice")].concat(M),z=[Y(X[0],"DiceTable")].concat(G),$=e.$r(z),y=z,N=[u=j(z[0],$("D66GridTable"),"D66OneThirdTable")].concat(y),r=e.$r(N),U(u,"$from_i18n",function(p,C){var x=g;return x=r("I18n").$t(p,_(["locale","raise"],{locale:C,raise:!0})),this.$new(x["$[]"]("name"),x["$[]"]("items_1_2"),x["$[]"]("items_3_4"),x["$[]"]("items_5_6"))}),A(u,"$initialize",function(p,C,P,x){return this.name=p,this.items=[C,C,P,P,x,x].$freeze()})},Opal.modules["bcdice/dice_table/d66_table"]=function(e){var G,W,r,t,p,C,P,y,z,Y=e.module,j=e.klass,_=e.hash2,U=e.defs,A=e.def,o=e.eqeqeq,F=e.rb_plus,g=e.rb_times,E=e.truthy,M=[],D=e.nil,X=e.$$$;return G=M,W=z=[Y(M[0],"BCDice")].concat(G),r=y=[Y(z[0],"DiceTable")].concat(W),p=[t=j(y[0],null,"D66Table")].concat(r),C=e.$r(p),(P=t.$$prototype).sort_type=P.items=P.name=D,U(t,"$from_i18n",function(b,T){var a,R=D;return R=C("I18n").$t(b,_(["locale"],{locale:T})),a=C("D66SortType").$const_get(R["$[]"]("d66_sort_type")),this.$new(R["$[]"]("name"),a,R["$[]"]("items"))}),A(t,"$initialize",function(b,T,k){var R=this;return R.name=b,R.sort_type=T,R.items=k.$freeze()}),A(t,"$roll",function(b){var T=this,k=D,R=D,a=D,f=D;return k=b.$roll_barabara(2,6),o(X(C("D66SortType"),"ASC"),R=T.sort_type)?k["$sort!"]():o(X(C("D66SortType"),"DESC"),R)&&k["$sort!"]()["$reverse!"](),a=F(g(k["$[]"](0),10),k["$[]"](1)),f=E(R=T.items["$[]"](a))?R:T.items["$[]"](a.$to_s()),E(f["$respond_to?"]("roll"))&&(f=f.$roll(b)),C("RollResult").$new(T.name,a,f)}),A(t,"$choice",function(b){return C("RollResult").$new(this.name,b,this.items["$[]"](b))})},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(e){var L,c,u,N,$,Y=e.module,j=e.klass,_=e.hash2,U=e.send,A=e.to_ary,o=e.rb_plus,F=e.rb_times,g=e.send2,E=e.find_super,M=e.def,X=[],Q=e.nil;return e.top.$require("bcdice/dice_table/d66_table"),L=X,c=$=[Y(X[0],"BCDice")].concat(L),u=[Y($[0],"DiceTable")].concat(c),N=e.$r(u),M(j(u[0],N("D66Table"),"D66LeftRangeTable"),"$initialize",function C(P,x,b){var R;return C.$$p=null,R=_([],{}),U(b,"each",[],function(f){var l,S;return null==f&&(f=Q),l=A(f),S=null==l[1]?Q:l[1],U(null==l[0]?Q:l[0],"each",[],function(I){return null==I&&(I=Q),U(S,"each_with_index",[],function(d,i){var ee,te;return null==d&&(d=Q),null==i&&(i=Q),te=o(F(I,10),o(i,1)),U(R,"[]=",ee=[te,d]),ee[ee.length-1]})})}),g(this,E(this,"initialize",C,!1,!0),"initialize",[P,x,R],null)})},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(e){var Q,$,N,r,t,p,C,c,L,Y=e.module,j=e.klass,_=e.hash2,U=e.defs,A=e.def,o=e.truthy,F=e.rb_minus,g=e.rb_plus,E=e.rb_times,M=[],D=e.nil;return Q=M,$=L=[Y(M[0],"BCDice")].concat(Q),N=c=[Y(L[0],"DiceTable")].concat($),t=[r=j(c[0],null,"D66ParityTable")].concat(N),p=e.$r(t),(C=r.$$prototype).odd=C.even=C.name=D,U(r,"$from_i18n",function(x,b){var k=D;return k=p("I18n").$t(x,_(["locale","raise"],{locale:b,raise:!0})),this.$new(k["$[]"]("name"),k["$[]"]("odd"),k["$[]"]("even"))}),A(r,"$initialize",function(x,b,T){var k=this;return k.name=x,k.odd=b.$freeze(),k.even=T.$freeze()}),A(r,"$roll",function(x){var k,a,f,b=this,T=D;return T=x.$roll_once(6),k=x.$roll_once(6),a=(o(T["$odd?"]())?b.odd:b.even)["$[]"](F(k,1)),f=g(E(T,10),k),p("RollResult").$new(b.name,f,a)})},Opal.modules["bcdice/dice_table/d66_range_table"]=function(e){var M,G,c,y,u,N,r,z,X,Y=e.module,j=e.klass,_=e.def,U=e.rb_plus,A=e.rb_times,o=e.send,F=[],g=e.nil;return M=F,G=X=[Y(F[0],"BCDice")].concat(M),c=z=[Y(X[0],"DiceTable")].concat(G),u=[y=j(z[0],null,"D66RangeTable")].concat(c),N=e.$r(u),(r=y.$$prototype).items=r.name=g,_(y,"$initialize",function(p,C){return this.name=p,this.items=C.$freeze()}),_(y,"$roll",function(p){var P,x,b,T=g;return P=p.$roll_once(6),x=p.$roll_once(6),b=U(A(P,10),x),T=o(this.items,"find",[],function(R){return null==R&&(R=g),R["$[]"](0)["$include?"](b)}),N("RollResult").$new(this.name,b,T["$[]"](1))})},Opal.modules["bcdice/dice_table/range_table"]=function(e){var Q,$,N,r,t,p,C,c,L,Y=e.module,j=e.klass,_=e.const_set,U=e.send,A=e.truthy,o=e.def,F=e.eqeqeq,g=e.rb_times,E=e.rb_plus,M=[],D=e.nil;return Q=M,$=L=[Y(M[0],"BCDice")].concat(Q),N=c=[Y(L[0],"DiceTable")].concat($),t=[r=j(c[0],null,"RangeTable")].concat(N),p=e.$r(t),(C=r.$$prototype).name=C.items=C.num_of_dice=C.num_of_sides=C.formatter=D,_(t[0],"RollResult",U(p("Struct"),"new",["sum","values","content","formatted"],function P(){return(null==P.$$s?this:P.$$s).$alias_method("to_s","formatted")},{$$s:r})),_(t[0],"Item",p("Struct").$new("range","content")),_(t[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),_(t[0],"DEFAULT_FORMATTER",U(r,"lambda",[],function(x,b){return null==x&&(x=D),null==b&&(b=D),x.$name()+"("+b.$sum()+") \uff1e "+b.$content()})),r.$attr_reader("name"),r.$attr_reader("num_of_dice"),r.$attr_reader("num_of_sides"),o(r,"$initialize",function P(x,b,T){var a,k=P.$$p||D,R=this,f=D;return P.$$p=null,R.name=x.$freeze(),R.formatter=A(a=k)?a:p("DEFAULT_FORMATTER"),f=p("DICE_ROLL_METHOD_RE").$match(b),A(f)||R.$raise(p("ArgumentError"),R.name+": invalid dice roll method: "+b),R.num_of_dice=f["$[]"](1).$to_i(),R.num_of_sides=f["$[]"](2).$to_i(),R.$store(T)}),o(r,"$fetch",function(x){var T,b=this;return T=U(b.items,"find",[],function(R){return null==R&&(R=D),R.$range()["$include?"](x)}),A(T)||b.$raise(p("RangeError"),b.name+": value is out of range: "+x),T}),o(r,"$roll",function(x){var k,b=this,T=D,R=D;return k=(T=x.$roll_barabara(b.num_of_dice,b.num_of_sides)).$sum(),(R=p("RollResult").$new(k,T,b.$fetch(k).$content()))["$formatted="](b.formatter["$[]"](b,R)),R}),r.$private(),o(r,"$store",function(x){var T,k,b=this;return T=U(x,"map",[],function R(a,f){return null==a&&(a=D),null==f&&(f=D),[(null==R.$$s?this:R.$$s).$coerce_to_int_range(a),f]},{$$s:b}),k=U(T,"sort_by",[],function(a,f){return null==a&&(a=D),null==f&&(f=D),a.$min()}),b.$assert_min_sum_is_covered(k),b.$assert_max_sum_is_covered(k),b.$assert_no_gap_or_overlap_in_ranges(k),b.items=U(k,"map",[],function(a,f){return null==a&&(a=D),null==f&&(f=D),p("Item").$new(a,f.$freeze()).$freeze()}).$freeze(),b}),o(r,"$coerce_to_int_range",function(x){var T;return F(p("Integer"),T=x)?p("Range").$new(x,x):F(p("Range"),T)&&A(x.$begin()["$is_a?"](p("Integer")))&&A(x.$end()["$is_a?"](p("Integer")))?x:this.$raise(p("TypeError"),this.name+": "+x+" ("+x.$class()+") must be an Integer or a Range with Integers ")}),o(r,"$assert_min_sum_is_covered",function(x){var T,b=this,k=D;return T=b.num_of_dice,k=x.$first()["$[]"](0),A(k["$include?"](T))||b.$raise(p("RangeError"),b.name+": min value ("+T+") is not covered: "+k),b}),o(r,"$assert_max_sum_is_covered",function(x){var T,b=this,k=D;return T=g(b.num_of_dice,b.num_of_sides),k=x.$last()["$[]"](0),A(k["$include?"](T))||b.$raise(p("RangeError"),b.name+": max value ("+T+") is not covered: "+k),b}),o(r,"$assert_no_gap_or_overlap_in_ranges",function(x){return U(x,"each_cons",[2],function T(k,R){var H,m,a=null==T.$$s?this:T.$$s,f=D,l=D;return null==a.name&&(a.name=D),null==k&&(k=D),null==R&&(R=D),f=k["$[]"](0),l=R["$[]"](0),H=f.$max(),m=E(H,1),A(l["$include?"](H))&&a.$raise(p("RangeError"),a.name+": Range overlap: "+f+" and "+l),A(l["$include?"](m))?D:a.$raise(p("RangeError"),a.name+": Range gap: "+f+" and "+l)},{$$s:this}),this})},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(e){var D,L,y,p,C,P,x,N,$,Q,Y=e.module,j=e.klass,_=e.send,U=e.def,A=e.rb_minus,o=e.return_ivar,F=[],g=e.nil,E=e.$$$;return D=F,L=Q=[Y(F[0],"BCDice")].concat(D),y=$=[Y(Q[0],"DiceTable")].concat(L),p=N=[j($[0],null,"SaiFicSkillTable")].concat(y),P=[C=j(N[0],null,"Category")].concat(p),x=e.$r(P),U(C,"$initialize",function(T,k,R,a){var f=this;return f.name=T,f.skills=_(k.$map(),"with_index",[2],function(H,m){return null==H&&(H=g),null==m&&(m=g),E(x("SaiFicSkillTable"),"Skill").$new(T,H,R,m,a)}),f.dice=R}),U(C,"$roll",function(T){return this.$skills()["$[]"](A(T.$roll_sum(2,6),2))}),U(C,"$to_s",o("name")),C.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(e){var g,X,$,N,r,c,G,M,Y=e.module,j=e.klass,_=e.def,U=e.hash2,A=[],o=e.nil;return g=A,X=M=[Y(A[0],"BCDice")].concat(g),$=G=[Y(M[0],"DiceTable")].concat(X),c=[j(G[0],null,"SaiFicSkillTable")].concat($),(r=(N=j(c[0],null,"Skill")).$$prototype).s_format=r.category_dice=r.row_dice=r.category_name=r.name=o,_(N,"$initialize",function(p,C,P,x,b){var T=this;return T.category_name=p,T.name=C,T.category_dice=P,T.row_dice=x,T.s_format=b}),_(N,"$to_s",function(){var p=this;return p.$format(p.s_format,U(["category_dice","row_dice","category_name","skill_name"],{category_dice:p.category_dice,row_dice:p.row_dice,category_name:p.category_name,skill_name:p.name}))}),N.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(e){var c,r,x,b,T,k,R,p,u,Y=e.module,j=e.klass,_=e.ensure_kwargs,U=e.hash2,A=e.send,F=e.defs,g=e.const_set,E=e.to_ary,M=e.def,D=e.truthy,X=e.rb_minus,Q=e.rb_plus,G=e.top,L=[],z=e.nil,$=e.$$$;return G.$require("bcdice/dice_table/sai_fic_skill_table/category"),G.$require("bcdice/dice_table/sai_fic_skill_table/skill"),c=L,r=u=[Y(L[0],"BCDice")].concat(c),x=p=[Y(u[0],"DiceTable")].concat(r),T=[b=j(p[0],null,"SaiFicSkillTable")].concat(x),k=e.$r(T),(R=b.$$prototype).rtt=R.rtt_format=R.rct=R.rct_format=R.rttn=R.rttn_format=R.categories=z,F(b,"$from_i18n",function(f,l,H){var m,S,n,i,d=z;return null==(m=(H=_(H)).$$smap.rtt)&&(m=z),null==(S=H.$$smap.rct)&&(S=z),null==(n=H.$$smap.rttn)&&(n=z),i=(d=k("I18n").$t("RTT",U(["locale","raise","default"],{locale:l,raise:!1,default:U([],{})})).$merge(k("I18n").$t(f,U(["locale","raise"],{locale:l,raise:!0}))))["$[]"]("items"),d=A(d,"select",[],function(te,re){return null==te&&(te=z),null==re&&(re=z),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](te)}),this.$new(i,e.to_hash(d).$merge(U(["rtt","rct","rttn"],{rtt:m,rct:S,rttn:n})))},-3),g(T[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),g(T[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),g(T[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),g(T[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),M(b,"$initialize",function(f,l){var H,m,S,n,I,s,d,i=this;return null==(H=(l=_(l)).$$smap.rtt)&&(H=z),null==(m=l.$$smap.rct)&&(m=z),null==(S=l.$$smap.rttn)&&(S=z),null==(n=l.$$smap.rtt_format)&&(n=k("DEFAULT_RTT")),null==(I=l.$$smap.rct_format)&&(I=k("DEFAULT_RCT")),null==(s=l.$$smap.rttn_format)&&(s=k("DEFAULT_RTTN")),null==(d=l.$$smap.s_format)&&(d=k("DEFAULT_S")),i.categories=A(f.$map(),"with_index",[1],function(te,re){var se,ce,$e;return null==te&&(te=z),null==re&&(re=z),ce=null==(se=E(te))[0]?z:se[0],$e=null==se[1]?z:se[1],$(k("SaiFicSkillTable"),"Category").$new(ce,$e,re,d)},{$$has_top_level_mlhs_arg:!0}),i.rtt=H,i.rct=m,i.rttn=S.$to_a(),i.rtt_format=n,i.rct_format=I,i.rttn_format=s},-2),g(T[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),b.$attr_reader("categories"),M(b,"$roll_command",function(f,l){var m,H=this,S=z,n=z;return D(["RTT",H.rtt]["$include?"](m=l))?H.$format_skill(H.rtt_format,H.$roll_skill(f)):D(["RCT",H.rct]["$include?"](m))?(S=H.$roll_category(f),H.$format(H.rct_format,U(["category_dice","category_name"],{category_dice:S.$dice(),category_name:S.$name()}))):D(n=k("RTTN").$index(m))||D(n=H.rttn.$index(m))?H.$format_skill(H.rttn_format,H.categories["$[]"](n).$roll(f)):z}),M(b,"$roll_category",function(f){return this.categories["$[]"](X(f.$roll_once(6),1))}),M(b,"$roll_skill",function(f){return this.$roll_category(f).$roll(f)}),M(b,"$prefixes",function(){var f=this;return Q(["RTT[1-6]?","RCT",f.rtt,f.rct],f.rttn).$compact()}),b.$private(),M(b,"$format_skill",function(f,l){return this.$format(f,U(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:l.$category_dice(),row_dice:l.$row_dice(),category_name:l.$category_name(),skill_name:l.$name(),text:l.$to_s()}))})},Opal.modules["bcdice/dice_table/table"]=function(e){var D,L,y,u,N,r,t,$,Q,Y=e.module,j=e.klass,_=e.hash2,U=e.defs,A=e.truthy,o=e.def,F=e.rb_minus,g=[],E=e.nil;return D=g,L=Q=[Y(g[0],"BCDice")].concat(D),y=$=[Y(Q[0],"DiceTable")].concat(L),N=[u=j($[0],null,"Table")].concat(y),r=e.$r(N),(t=u.$$prototype).times=t.sides=t.name=t.items=E,U(u,"$from_i18n",function(C,P){var b=E;return b=r("I18n").$t(C,_(["locale"],{locale:P})),this.$new(b["$[]"]("name"),b["$[]"]("type"),b["$[]"]("items"))}),o(u,"$initialize",function(C,P,x){var b=this,T=E;return b.name=C,b.items=x.$freeze(),T=/(\d+)D(\d+)/i.$match(P),A(T)||b.$raise(r("ArgumentError"),"Unexpected table type: "+P),b.times=T["$[]"](1).$to_i(),b.sides=T["$[]"](2).$to_i()}),o(u,"$roll",function(C){var x,P=this;return x=C.$roll_sum(P.times,P.sides),P.$choice(x)}),o(u,"$choice",function(C){var x,P=this;return x=F(C,P.times),r("RollResult").$new(P.name,C,P.items["$[]"](x))})},Opal.modules["bcdice/dice_table"]=function(e){var Y=e.top;return Y.$require("bcdice/dice_table/roll_result"),Y.$require("bcdice/dice_table/chain_table"),Y.$require("bcdice/dice_table/d66_grid_table"),Y.$require("bcdice/dice_table/d66_half_grid_table"),Y.$require("bcdice/dice_table/d66_one_third_table"),Y.$require("bcdice/dice_table/d66_left_range_table"),Y.$require("bcdice/dice_table/d66_parity_table"),Y.$require("bcdice/dice_table/d66_range_table"),Y.$require("bcdice/dice_table/d66_table"),Y.$require("bcdice/dice_table/range_table"),Y.$require("bcdice/dice_table/sai_fic_skill_table"),Y.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(e){var o,M,X,g,Y=e.module,j=e.const_set,_=[];return o=_,M=g=[Y(_[0],"BCDice")].concat(o),X=[Y(g[0],"D66SortType")].concat(M),j(X[0],"NO_SORT","no_sort"),j(X[0],"ASC","asc"),j(X[0],"DESC","desc"),function(E,M){var X=[Y(E,"RoundType")].concat(M);return j(X[0],"CEIL","ceil"),j(X[0],"FLOOR","floor"),j(X[0],"ROUND","round")}(g[0],g)},Opal.modules["bcdice/translate"]=function(e){var M,G,L,z,$,X,Y=e.module,j=e.ensure_kwargs,_=e.kwrestargs,A=e.hash2,o=e.def,F=[],g=e.nil;return M=F,G=X=[Y(F[0],"BCDice")].concat(M),z=[L=Y(X[0],"Translate")].concat(G),$=e.$r(z),o(L,"$translate",function(c,y){var u,N=this;return null==N.locale&&(N.locale=g),y=j(y),u=_(y,{}),$("I18n").$translate(c,A(["locale","raise"],{locale:N.locale,raise:!0}).$merge(e.to_hash(u)))},-2)},Opal.modules["bcdice/result"]=function(e){var L,W,z,M,X,j=e.klass,_=e.send,U=e.def,A=e.return_val,o=e.return_ivar,F=[],g=e.nil;return M=F,L=X=[(0,e.module)(F[0],"BCDice")].concat(M),[z=j(X[0],null,"Result")].concat(L),U(W=e.get_singleton_class(z),"$success",function(u){return _(this.$new(),"tap",[],function(t){var p;return null==t&&(t=g),t["$text="](u),_(t,"success=",p=[!0]),p[p.length-1]})}),U(W,"$failure",function(u){return _(this.$new(),"tap",[],function(t){var p;return null==t&&(t=g),t["$text="](u),_(t,"failure=",p=[!0]),p[p.length-1]})}),U(W,"$critical",function(u){return _(this.$new(),"tap",[],function(t){var p;return null==t&&(t=g),t["$text="](u),t["$critical="](!0),_(t,"success=",p=[!0]),p[p.length-1]})}),U(W,"$fumble",function(u){return _(this.$new(),"tap",[],function(t){var p;return null==t&&(t=g),t["$text="](u),t["$fumble="](!0),_(t,"failure=",p=[!0]),p[p.length-1]})}),U(W,"$nothing",A("nothing")),U(z,"$initialize",function(c){var y=this;return null==c&&(c=g),y.text=c,y.rands=g,y.detailed_rands=g,y.secret=!1,y.success=!1,y.failure=!1,y.critical=!1,y.fumble=!1},-1),z.$attr_accessor("text","rands","detailed_rands"),z.$attr_writer("secret","success","failure","critical","fumble"),U(z,"$secret?",o("secret")),U(z,"$success?",o("success")),U(z,"$failure?",o("failure")),U(z,"$critical?",o("critical")),U(z,"$fumble?",o("fumble")),U(z,"$condition=",function(c){return this.success=c,this.failure=c["$!"]()})},Opal.modules["racc/parser"]=function(e){var C,x,b,Y=e.module,j=e.klass,_=e.truthy,U=e.const_set,A=e.defs,o=e.gvars,F=e.rb_lt,g=e.def,E=e.to_ary,M=e.send,D=e.neqeq,X=e.rb_plus,Q=e.eqeq,G=e.rb_ge,L=e.rb_gt,z=e.rb_minus,$=e.rb_le,W=e.rb_times,c=e.assign_ivar_val,u=[],N=e.$r(u),r=e.nil,t=e.$$$;return C=u,x=[Y(u[0],"Racc")].concat(C),b=e.$r(x),j(x[0],b("StandardError"),"ParseError"),_(t("::","ParseError","skip_raise")?"constant":r)||U(u[0],"ParseError",t(N("Racc"),"ParseError")),function(p,C){var a,f,l,H,m,b=[Y(p,"Racc")].concat(C),T=e.$r(b);return _(T("Racc_No_Extensions","skip_raise")?"constant":r)||U(b[0],"Racc_No_Extensions",!1),a=b,l=[f=j(b[0],null,"Parser")].concat(a),H=e.$r(l),(m=f.$$prototype).yydebug=m.racc_debug_out=m.racc_error_status=m.racc_t=m.racc_vstack=m.racc_val=m.racc_state=m.racc_tstack=r,U(l[0],"Racc_Runtime_Version","1.4.6"),U(l[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),U(l[0],"Racc_Runtime_Core_Version_R","1.4.6"),U(l[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),U(l[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),U(l[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),U(l[0],"Racc_Runtime_Core_Version",H("Racc_Runtime_Core_Version_R")),U(l[0],"Racc_Runtime_Core_Revision",H("Racc_Runtime_Core_Revision_R")),U(l[0],"Racc_Runtime_Type","ruby"),A(H("Parser"),"$racc_runtime_type",function(){return H("Racc_Runtime_Type")}),g(f,"$_racc_setup",function(){var n,I,s=this,d=r,i=r;return null==o.stderr&&(o.stderr=r),_(t(s.$class(),"Racc_debug_parser"))||(s.yydebug=!1),_(null!=(n=s.yydebug)&&n!==r?"instance-variable":r)||(s.yydebug=!1),_(s.yydebug)&&(_(null!=(I=s.racc_debug_out)&&I!==r?"instance-variable":r)||(s.racc_debug_out=o.stderr),s.racc_debug_out=_(d=s.racc_debug_out)?d:o.stderr),i=t(s.$class(),"Racc_arg"),_(F(i.$size(),14))&&i["$[]="](13,!0),i}),g(f,"$_racc_init_sysvars",function(){var n=this;return n.racc_state=[0],n.racc_tstack=[],n.racc_vstack=[],n.racc_t=r,n.racc_val=r,n.racc_read_next=!0,n.racc_user_yyerror=!1,n.racc_error_status=0}),g(f,"$do_parse",function(){return this.$__send__(H("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)}),g(f,"$next_token",function(){return this.$raise(H("NotImplementedError"),this.$class()+"#next_token is not defined")}),g(f,"$_racc_do_parse_rb",function(n,I){var s,i=this,ee=r,te=r,re=r,se=r,ce=r,$e=r,_e=r,ae=r;return s=E(n),ee=null==s[0]?r:s[0],te=null==s[1]?r:s[1],re=null==s[2]?r:s[2],se=null==s[3]?r:s[3],ce=null==s[10]?r:s[10],i.$_racc_init_sysvars(),$e=_e=ae=r,M(i,"catch",["racc_end_parse"],function J(){var q,K,v=null==J.$$s?this:J.$$s,w=r;for(null==v.racc_state&&(v.racc_state=r),null==v.racc_read_next&&(v.racc_read_next=r),null==v.racc_t&&(v.racc_t=r),null==v.yydebug&&(v.yydebug=r),null==v.racc_val&&(v.racc_val=r);_(!0);)for(_(ae=se["$[]"](v.racc_state["$[]"](-1)))?(_(v.racc_read_next)&&D(v.racc_t,0)&&(K=v.$next_token(),q=E(K),$e=null==q[0]?r:q[0],v.racc_val=null==q[1]?r:q[1],v.racc_t=_($e)?_(w=ce["$[]"]($e))?w:1:0,_(v.yydebug)&&v.$racc_read_token(v.racc_t,$e,v.racc_val),v.racc_read_next=!1),ae=X(ae,v.racc_t),_(G(ae,0))&&_(_e=ee["$[]"](ae))&&Q(te["$[]"](ae),v.racc_state["$[]"](-1))||(_e=re["$[]"](v.racc_state["$[]"](-1)))):_e=re["$[]"](v.racc_state["$[]"](-1));_(_e=v.$_racc_evalact(_e,n)););},{$$s:i})}),g(f,"$yyparse",function(n,I){return this.$__send__(H("Racc_YY_Parse_Method"),n,I,this.$_racc_setup(),!0)}),g(f,"$_racc_yyparse_rb",function(n,I,s,d){var i,re=r,se=r,ue=r,ce=r,_e=r,ae=r,J=r;return i=E(s),re=null==i[0]?r:i[0],se=null==i[1]?r:i[1],ue=null==i[2]?r:i[2],ce=null==i[3]?r:i[3],_e=null==i[10]?r:i[10],this.$_racc_init_sysvars(),ae=r,J=r,M(this,"catch",["racc_end_parse"],function q(){var K=null==q.$$s?this:q.$$s;for(null==K.racc_state&&(K.racc_state=r);!_(J=ce["$[]"](K.racc_state["$[]"](-1)));)for(;_(ae=K.$_racc_evalact(ue["$[]"](K.racc_state["$[]"](-1)),s)););return M(n,"__send__",[I],function v(w,O){var h=null==v.$$s?this:v.$$s,B=r,Z=r;for(null==h.racc_t&&(h.racc_t=r),null==h.racc_state&&(h.racc_state=r),null==h.racc_read_next&&(h.racc_read_next=r),null==w&&(w=r),null==O&&(O=r),h.racc_t=_(w)?_(B=_e["$[]"](w))?B:1:0,h.racc_val=O,h.racc_read_next=!1,J=X(J,h.racc_t),_(G(J,0))&&_(ae=re["$[]"](J))&&Q(se["$[]"](J),h.racc_state["$[]"](-1))||(ae=ue["$[]"](h.racc_state["$[]"](-1)));_(ae=h.$_racc_evalact(ae,s)););for(;_(_(B=_(Z=(J=ce["$[]"](h.racc_state["$[]"](-1)))["$!"]())?Z:h.racc_read_next["$!"]())?B:h.racc_t["$=="](0));)for(_(J)&&_(J=X(J,h.racc_t))&&_(G(J,0))&&_(ae=re["$[]"](J))&&Q(se["$[]"](J),h.racc_state["$[]"](-1))||(ae=ue["$[]"](h.racc_state["$[]"](-1)));_(ae=h.$_racc_evalact(ae,s)););},{$$s:K})},{$$s:this})}),g(f,"$_racc_evalact",function(n,I){var s,ue,i=this,ee=r,te=r,se=r,ce=r,$e=r,_e=r;if(ee=null==(s=E(I))[0]?r:s[0],te=null==s[1]?r:s[1],se=null==s[3]?r:s[3],ue=null==s[11]?r:s[11],ce=null==s[12]?r:s[12],_(L(n,0))&&_(F(n,ue)))_(L(i.racc_error_status,0))&&(Q(i.racc_t,1)||(i.racc_error_status=z(i.racc_error_status,1))),i.racc_vstack.$push(i.racc_val),i.racc_state.$push(n),i.racc_read_next=!0,_(i.yydebug)&&(i.racc_tstack.$push(i.racc_t),i.$racc_shift(i.racc_t,i.racc_tstack,i.racc_vstack));else if(_(F(n,0))&&_(L(n,ce["$-@"]()))){if($e=M(i,"catch",["racc_jump"],function ae(){var J=null==ae.$$s?this:ae.$$s;return null==J.racc_state&&(J.racc_state=r),J.racc_state.$push(J.$_racc_do_reduce(I,n)),!1},{$$s:i}),_($e))switch($e){case 1:return i.racc_user_yyerror=!0,ce["$-@"]();case 2:return ue;default:i.$raise("[Racc Bug] unknown jump code")}}else if(Q(n,ue))_(i.yydebug)&&i.$racc_accept(),i.$throw("racc_end_parse",i.racc_vstack["$[]"](0));else{if(Q(n,ce["$-@"]())){switch(i.racc_error_status){case 0:_(I["$[]"](21))||i.$on_error(i.racc_t,i.racc_val,i.racc_vstack);break;case 3:Q(i.racc_t,0)&&i.$throw("racc_end_parse",r),i.racc_read_next=!0}for(i.racc_user_yyerror=!1,i.racc_error_status=3;_(!0)&&!(_(_e=se["$[]"](i.racc_state["$[]"](-1)))&&(_e=X(_e,1),_(G(_e,0))&&_(n=ee["$[]"](_e))&&Q(te["$[]"](_e),i.racc_state["$[]"](-1))));)_($(i.racc_state.$size(),1))&&i.$throw("racc_end_parse",r),i.racc_state.$pop(),i.racc_vstack.$pop(),_(i.yydebug)&&(i.racc_tstack.$pop(),i.$racc_e_pop(i.racc_state,i.racc_tstack,i.racc_vstack));return n}i.$raise("[Racc Bug] unknown action "+n.$inspect())}return _(i.yydebug)&&i.$racc_next_state(i.racc_state["$[]"](-1),i.racc_state),r}),g(f,"$_racc_do_reduce",function(n,I){var s,ce,_e,w,O,h,V,i=this,te=r,re=r,se=r,ue=r,$e=r,ae=r,J=r,q=r,K=r,v=r,B=r,Z=r,ne=r;return te=null==(s=E(n))[4]?r:s[4],re=null==s[5]?r:s[5],se=null==s[6]?r:s[6],ue=null==s[7]?r:s[7],ce=null==s[8]?r:s[8],$e=null==s[9]?r:s[9],_e=null==s[13]?r:s[13],ae=i.racc_state,J=i.racc_vstack,q=i.racc_tstack,K=W(I,-3),v=$e["$[]"](K),w=$e["$[]"](X(K,1)),O=$e["$[]"](X(K,2)),h=[],_(i.yydebug)&&(B=q["$[]"](v["$-@"](),v)),Z=J["$[]"](v["$-@"](),v),_(i.yydebug)&&q["$[]="](v["$-@"](),v,h),J["$[]="](v["$-@"](),v,h),ae["$[]="](v["$-@"](),v,h),_(_e)?J.$push(i.$__send__(O,Z,J,Z["$[]"](0))):J.$push(i.$__send__(O,Z,J)),q.$push(w),_(i.yydebug)&&i.$racc_reduce(B,w,q,J),V=z(w,ce),_(K=ue["$[]"](V))&&(K=X(K,ae["$[]"](-1)),_(G(K,0))&&_(ne=te["$[]"](K))&&Q(re["$[]"](K),V))?ne:se["$[]"](V)}),g(f,"$on_error",function(n,I,s){var i,d=this;return d.$raise(H("ParseError"),d.$sprintf("\nparse error on value %s (%s)",I.$inspect(),_(i=d.$token_to_str(n))?i:"?"))}),g(f,"$yyerror",function(){return this.$throw("racc_jump",1)}),g(f,"$yyaccept",function(){return this.$throw("racc_jump",2)}),g(f,"$yyerrok",c("racc_error_status",0)),g(f,"$racc_read_token",function(n,I,s){var d=this;return d.racc_debug_out.$print("read    "),d.racc_debug_out.$print(I.$inspect(),"(",d.$racc_token2str(n),") "),d.racc_debug_out.$puts(s.$inspect()),d.racc_debug_out.$puts()}),g(f,"$racc_shift",function(n,I,s){var d=this;return d.racc_debug_out.$puts("shift   "+d.$racc_token2str(n)),d.$racc_print_stacks(I,s),d.racc_debug_out.$puts()}),g(f,"$racc_reduce",function(n,I,s,d){var i=this,ee=r;return(ee=i.racc_debug_out).$print("reduce "),_(n["$empty?"]())?ee.$print(" <none>"):M(n,"each",[],function te(re){return null==re&&(re=r),ee.$print(" ",(null==te.$$s?this:te.$$s).$racc_token2str(re))},{$$s:i}),ee.$puts(" --\x3e "+i.$racc_token2str(I)),i.$racc_print_stacks(s,d),i.racc_debug_out.$puts()}),g(f,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()}),g(f,"$racc_e_pop",function(n,I,s){var d=this;return d.racc_debug_out.$puts("error recovering mode: pop token"),d.$racc_print_states(n),d.$racc_print_stacks(I,s),d.racc_debug_out.$puts()}),g(f,"$racc_next_state",function(n,I){var s=this;return s.racc_debug_out.$puts("goto    "+n),s.$racc_print_states(I),s.racc_debug_out.$puts()}),g(f,"$racc_print_stacks",function(n,I){var d=r;return(d=this.racc_debug_out).$print("        ["),M(n,"each_index",[],function i(ee){return null==ee&&(ee=r),d.$print(" (",(null==i.$$s?this:i.$$s).$racc_token2str(n["$[]"](ee))," ",I["$[]"](ee).$inspect(),")")},{$$s:this}),d.$puts(" ]")}),g(f,"$racc_print_states",function(n){var s=r;return(s=this.racc_debug_out).$print("        ["),M(n,"each",[],function(i){return null==i&&(i=r),s.$print(" ",i)}),s.$puts(" ]")}),g(f,"$racc_token2str",function(n){var s;return _(s=t(this.$class(),"Racc_token_to_s_table")["$[]"](n))?s:this.$raise("[Racc Bug] can't convert token "+n+" to string")}),g(f,"$token_to_str",function(n){return t(this.$class(),"Racc_token_to_s_table")["$[]"](n)})}(u[0],u)},Opal.modules["bcdice/arithmetic/node"]=function(e){var c,r,P,a,f,b,T,p,u,Y=e.module,j=e.klass,_=e.def,U=e.thrower,A=e.return_ivar,o=e.send2,F=e.find_super,g=e.eqeq,E=e.const_set,M=e.eqeqeq,D=e.rb_divide,X=e.truthy,Q=e.assign_ivar,G=e.alias,L=[],z=e.nil,$=e.$$$;return c=L,r=u=[Y(L[0],"BCDice")].concat(c),P=p=[Y(u[0],"Arithmetic")].concat(r),b=[Y(p[0],"Node")].concat(P),T=e.$r(b),(f=(a=j(b[0],null,"BinaryOp")).$$prototype).lhs=f.rhs=f.op=z,_(a,"$initialize",function(H,m,S){var n=this;return n.lhs=H,n.op=m,n.rhs=S}),_(a,"$eval",function(H){try{U("eval_return");var I,S=this,n=z;return n=S.lhs.$eval(H),I=S.rhs.$eval(H),n.$send(S.op,I)}catch(s){if(s===e.t_eval_return)return s.$v;throw s}}),_(a,"$output",function(){var H=this;return""+H.lhs.$output()+H.op+H.rhs.$output()}),_(a,"$s_exp",function(){var H=this;return"("+H.$op_for_s_exp()+" "+H.lhs.$s_exp()+" "+H.rhs.$s_exp()+")"}),_(a,"$op_for_s_exp",A("op")),function(k,R,a){var f=j(k,R,"DivideBase"),l=[f].concat(a),H=e.$r(l),m=f.$$prototype;m.lhs=m.rhs=m.op=z,_(f,"$initialize",function S(n,I){return S.$$p=null,o(this,F(this,"initialize",S,!1,!0),"initialize",[n,"/",I],null)}),_(f,"$eval",function(n){try{U("eval_return");var d,i,s=this;return d=s.lhs.$eval(n),i=s.rhs.$eval(n),g(i,0)&&s.$raise(H("ZeroDivisionError")),s.$divide_and_round(d,i,n)}catch(ee){if(ee===e.t_eval_return)return ee.$v;throw ee}}),_(f,"$output",function S(){var n=S.$$p||z,I=this;return S.$$p=null,""+o(I,F(I,"output",S,!1,!0),"output",[],n)+I.$rounding_method()}),f.$private(),_(f,"$rounding_method",function(){return $(this.$class(),"ROUNDING_METHOD")}),_(f,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()}),_(f,"$divide_and_round",function(n,I,s){return this.$raise(H("NotImplementedError"))})}(b[0],T("BinaryOp"),b),function(k,R,a){var f=j(k,R,"DivideWithGameSystemDefault"),l=[f].concat(a),H=e.$r(l);E(l[0],"ROUNDING_METHOD",""),f.$private(),_(f,"$divide_and_round",function(S,n,I){var s,d=z;return M($(H("RoundType"),"CEIL"),s=I)?D(S.$to_f(),n).$ceil():M($(H("RoundType"),"ROUND"),s)?(d=D(S.$to_f(),n),X(d["$negative?"]())?d.$abs().$round()["$-@"]():d.$round()):D(S,n).$floor()})}(b[0],T("DivideBase"),b),function(k,R,a){var f=j(k,R,"DivideWithCeil"),l=[f].concat(a);E(l[0],"ROUNDING_METHOD","C"),f.$private(),_(f,"$divide_and_round",function(m,S,n){return D(m.$to_f(),S).$ceil()})}(b[0],T("DivideBase"),b),function(k,R,a){var f=j(k,R,"DivideWithRound"),l=[f].concat(a);E(l[0],"ROUNDING_METHOD","R"),f.$private(),_(f,"$divide_and_round",function(m,S,n){var I=z;return I=D(m.$to_f(),S),X(I["$negative?"]())?I.$abs().$round()["$-@"]():I.$round()})}(b[0],T("DivideBase"),b),function(k,R,a){var f=j(k,R,"DivideWithFloor"),l=[f].concat(a);E(l[0],"ROUNDING_METHOD","F"),f.$private(),_(f,"$divide_and_round",function(m,S,n){return D(m,S).$floor()})}(b[0],T("DivideBase"),b),function(k,R){var a=j(k,null,"Negative");a.$$prototype.body=z,_(a,"$initialize",Q("body")),_(a,"$eval",function(H){try{return U("eval_return"),this.body.$eval(H)["$-@"]()}catch(n){if(n===e.t_eval_return)return n.$v;throw n}}),_(a,"$output",function(){return"-"+this.body.$output()}),_(a,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"})}(b[0]),function(k,R){var a=j(k,null,"Parenthesis");a.$$prototype.expr=z,_(a,"$initialize",Q("expr")),_(a,"$eval",function(H){try{return U("eval_return"),this.expr.$eval(H)}catch(n){if(n===e.t_eval_return)return n.$v;throw n}}),_(a,"$output",function(){return"("+this.expr.$output()+")"}),_(a,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"})}(b[0]),function(k,R){var a=j(k,null,"Number");return a.$$prototype.value=z,_(a,"$initialize",Q("value")),_(a,"$eval",A("value")),_(a,"$output",function(){return this.value.$to_s()}),G(a,"s_exp","output")}(b[0])},Opal.modules.strscan=function(e){var Q,G,L,z,$,j=e.def,_=e.truthy,U=e.eqeqeq,A=e.Opal,o=e.return_ivar,F=e.send,g=e.alias,E=[],M=e.nil;return Q=E,L=[G=(0,e.klass)(E[0],null,"StringScanner")].concat(Q),z=e.$r(L),($=G.$$prototype).pos=$.string=$.working=$.matched=$.prev_pos=$.match=M,G.$attr_reader("pos","matched"),j(G,"$initialize",function(c){var y=this;return y.string=c,y.pos=0,y.matched=M,y.working=c,y.match=[]}),G.$attr_reader("string"),j(G,"$beginning_of_line?",function(){var c=this;return 0===c.pos||"\n"===c.string.charAt(c.pos-1)}),j(G,"$scan",function(c){var y=this,u=(c=y.$anchor(c)).exec(y.working);return null==u?y.matched=M:(y.prev_pos=y.pos,y.pos+=u[0].length,y.working=y.working.substring(u[0].length),y.matched=u[0],y.match=u,u[0])}),j(G,"$scan_until",function(c){var y=this;c=y.$anchor(c);for(var u=y.working,N=0;u.length!=N;++N){var r=c.exec(u.substr(N));if(null!==r){var t=N+r[0].length,p=u.substr(0,t);return y.matched=r[0],y.match=r,y.prev_pos=y.pos+N,y.pos+=t,y.working=u.substr(t),p}}return y.matched=M}),j(G,"$[]",function(c){var u;if(_(this.match["$empty?"]()))return M;U(z("Symbol"),u=c)?c=c.$to_s():U(z("String"),u)||(c=A["$coerce_to!"](c,z("Integer"),"to_int"));var N=this.match;return c<0&&(c+=N.length),c<0||c>=N.length||null==N[c]?M:N[c]}),j(G,"$check",function(c){var y=this,u=(c=y.$anchor(c)).exec(y.working);return y.matched=null==u?M:u[0]}),j(G,"$check_until",function(c){var y=this,u=y.prev_pos,N=y.pos,r=y.working,t=y.$scan_until(c);return y.prev_pos=u,y.pos=N,y.working=r,t}),j(G,"$peek",function(c){return this.working.substring(0,c)}),j(G,"$eos?",function(){return 0===this.working.length}),j(G,"$exist?",function(c){var u=c.exec(this.working);return null==u?M:0==u.index?0:u.index+1}),j(G,"$skip",function(c){var y=this,u=(c=y.$anchor(c)).exec(y.working);if(null==u)return y.match=[],y.matched=M;var N=u[0],r=N.length;return y.matched=N,y.match=u,y.prev_pos=y.pos,y.pos+=r,y.working=y.working.substring(r),r}),j(G,"$skip_until",function(c){var u=this.$scan_until(c);return u===M?M:(this.matched=u.substr(-1),u.length)}),j(G,"$get_byte",function(){var c=this,y=M;return c.pos<c.string.length?(c.prev_pos=c.pos,c.pos+=1,y=c.matched=c.working.substring(0,1),c.working=c.working.substring(1)):c.matched=M,y}),j(G,"$match?",function(c){var y=this,u=(c=y.$anchor(c)).exec(y.working);return null==u?M:(y.prev_pos=y.pos,u[0].length)}),j(G,"$pos=",function(c){var y=this;return c<0&&(c+=y.string.$length()),y.pos=c,y.working=y.string.slice(c)}),j(G,"$matched_size",function(){return this.matched===M?M:this.matched.length}),j(G,"$post_match",function(){var c=this;return c.matched===M?M:c.string.substr(c.pos)}),j(G,"$pre_match",function(){var c=this;return c.matched===M?M:c.string.substr(0,c.prev_pos)}),j(G,"$reset",function(){var c=this;return c.working=c.string,c.matched=M,c.pos=0}),j(G,"$rest",o("working")),j(G,"$rest?",function(){return 0!==this.working.length}),j(G,"$rest_size",function(){return this.$rest().$size()}),j(G,"$terminate",function(){var c,y=this;return y.match=M,c=[y.string.$length()],F(y,"pos=",c),c[c.length-1]}),j(G,"$unscan",function(){var c=this;return c.pos=c.prev_pos,c.prev_pos=M,c.match=M,c}),g(G,"bol?","beginning_of_line?"),g(G,"getch","get_byte"),G.$private(),j(G,"$anchor",function(c){var y=c.toString().match(/\/([^\/]+)$/);return y=y?y[1]:void 0,new RegExp("^(?:"+c.source+")",y)})},Opal.modules["bcdice/normalize"]=function(e){var g,X,M,Y=e.module,j=e.eqeqeq,_=e.def,U=e.eqeq,A=[],o=e.nil;return g=A,M=[Y(A[0],"BCDice")].concat(g),(X=Y(M[0],"Normalize")).$module_function(),_(X,"$comparison_operator",function(G){var L;return j(/<=|=</,L=G)?"<=":j(/>=|=>/,L)?">=":j(/<>|!=|=!/,L)?"!=":j(/</,L)?"<":j(/>/,L)?">":j(/=/,L)?"==":o}),_(X,"$target_number",function(G){return U(G,"?")?G:G.$to_i()})},Opal.modules["bcdice/command/lexer"]=function(e){var Q,$,N,r,t,p,C,c,L,Y=e.module,j=e.klass,_=e.const_set,U=e.hash2,A=e.truthy,o=e.send,F=e.def,g=e.thrower,E=e.top,M=[],D=e.nil;return E.$require("strscan"),E.$require("bcdice/normalize"),Q=M,$=L=[Y(M[0],"BCDice")].concat(Q),N=c=[Y(L[0],"Command")].concat($),t=[r=j(c[0],null,"Lexer")].concat(N),p=e.$r(t),(C=r.$$prototype).scanner=C.notations=D,_(t[0],"SYMBOLS",U(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),F(r,"$initialize",function(x,b){var T,k,a;return x=A(a=(T=(k=x)===D||null==k?D:k.$split(" ",2))===D||null==T?D:T.$first())?a:"",this.scanner=p("StringScanner").$new(x),this.notations=o(b,"map",[],function(l){return null==l&&(l=D),A(l["$is_a?"](p("String")))?p("Regexp").$new(l):l})}),F(r,"$next_token",function(){try{var x=g("return"),b=this,T=D,k=D,a=D,f=D;return A(b.scanner["$eos?"]())?[!1,"$"]:(o(b.notations,"each",[],function l(H){var S,m=null==l.$$s?this:l.$$s;if(null==m.scanner&&(m.scanner=D),null==H&&(H=D),S=m.scanner.$scan(H),!A(S))return D;x.$throw(["NOTATION",S])},{$$s:b,$$ret:x}),A(T=b.scanner.$scan(/\d+/))?["NUMBER",T.$to_i()]:A(k=b.scanner.$scan(/[<>!=]+/))?(k=p("Normalize").$comparison_operator(k),[A(k)?"CMP_OP":"ILLEGAL",k]):(a=b.scanner.$getch().$upcase(),[A(f=p("SYMBOLS")["$[]"](a))?f:a.$to_sym(),a]))}catch(l){if(l===x)return l.$v;throw l}}),F(r,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/command/parsed"]=function(e){var E,Q,W,c,y,u,N,L,D,Y=e.module,j=e.klass,_=e.def,U=e.return_ivar,A=e.truthy,o=[],F=e.nil;return E=o,Q=D=[Y(o[0],"BCDice")].concat(E),W=L=[Y(D[0],"Command")].concat(Q),y=[c=j(L[0],null,"Parsed")].concat(W),u=e.$r(y),(N=c.$$prototype).critical=N.fumble=N.dollar=N.modify_number=N.question_target=N.target_number=N.prefix_number=N.command=N.suffix_number=N.cmp_op=F,c.$attr_accessor("command"),c.$attr_accessor("prefix_number"),c.$attr_accessor("suffix_number"),c.$attr_accessor("critical"),c.$attr_accessor("fumble"),c.$attr_accessor("dollar"),c.$attr_accessor("modify_number"),c.$attr_accessor("cmp_op"),c.$attr_accessor("target_number"),c.$attr_writer("question_target"),_(c,"$initialize",function(){var t=this;return t.prefix_number=F,t.suffix_number=F,t.critical=F,t.fumble=F,t.dollar=F,t.cmp_op=F,t.target_number=F,t.question_target=!1}),_(c,"$question_target?",U("question_target")),_(c,"$to_s",function(t){var p=this,C=F,P=F,x=F,b=F,T=F;switch(null==t&&(t="after_command"),C=A(p.critical)?"@"+p.critical:F,P=A(p.fumble)?"#"+p.fumble:F,x=A(p.dollar)?"$"+p.dollar:F,b=u("Format").$modifier(p.modify_number),T=A(p.question_target)?"?":p.target_number,t){case"after_command":return[p.prefix_number,p.command,p.suffix_number,C,P,x,b,p.cmp_op,T].$join();case"after_modify_number":return[p.prefix_number,p.command,p.suffix_number,b,C,P,x,p.cmp_op,T].$join();case"after_target_number":return[p.prefix_number,p.command,p.suffix_number,b,p.cmp_op,T,C,P,x].$join();default:return F}},-1)},Opal.modules["bcdice/command/parser"]=function(e){var t,x,f,S,n,I,s,d,i,ee,te,re,ce,l,H,m,ae,T,k,C,Y=e.klass,j=e.module,_=e.slice,U=e.extract_kwargs,A=e.ensure_kwargs,o=e.get_kwarg,F=e.send2,g=e.find_super,E=e.def,M=e.send,D=e.eqeq,X=e.thrower,Q=e.hash,G=e.const_set,L=e.truthy,z=e.to_ary,$=e.hash2,W=e.top,c=[],y=e.$r(c),u=e.nil,N=e.$$$;return W.$require("racc/parser.rb"),W.$require("bcdice/arithmetic/node"),W.$require("bcdice/command/lexer"),W.$require("bcdice/command/parsed"),Y(N(y("BCDice"),"Command"),N(y("Racc"),"Parser"),"Parser"),t=c,x=C=[j(c[0],"BCDice")].concat(t),T=[j(C[0],"Command")].concat(x),k=e.$r(T),f=T,H=[l=Y(T[0],N(k("Racc"),"Parser"),"Parser")].concat(f),m=e.$r(H),(ae=l.$$prototype).notations=ae.lexer=ae.modifier=ae.suffix_number=ae.prefix_number=ae.need_suffix_number=ae.need_prefix_number=ae.critical=ae.fumble=ae.dollar=ae.allowed_cmp_op=ae.question_target=u,E(l,"$initialize",function J(q,K){var v,w,O,h,Z=this;return J.$$p=null,v=_(arguments),w=U(v),w=A(w),O=v,h=o(w,"round_type"),F(Z,g(Z,"initialize",J,!1,!0),"initialize",[],null),Z.notations=O,Z.round_type=h,Z.prefix_number=!1,Z.suffix_number=!1,Z.need_prefix_number=!1,Z.need_suffix_number=!1,Z.modifier=!0,Z.critical=!1,Z.fumble=!1,Z.dollar=!1,Z.allowed_cmp_op=[u,">=",">","<=","<","==","!="],Z.question_target=!1},-2),E(l,"$disable_modifier",function(){return this.modifier=!1,this}),E(l,"$enable_prefix_number",function(){return this.prefix_number=!0,this}),E(l,"$enable_suffix_number",function(){return this.suffix_number=!0,this}),E(l,"$has_prefix_number",function(){var q=this;return q.prefix_number=!0,q.need_prefix_number=!0,q}),E(l,"$has_suffix_number",function(){var q=this;return q.suffix_number=!0,q.need_suffix_number=!0,q}),E(l,"$enable_critical",function(){return this.critical=!0,this}),E(l,"$enable_fumble",function(){return this.fumble=!0,this}),E(l,"$enable_dollar",function(){return this.dollar=!0,this}),E(l,"$restrict_cmp_op_to",function(q){var K,w=this;return K=_(arguments),w.allowed_cmp_op=K,w},-1),E(l,"$enable_question_target",function(){return this.question_target=!0,this}),E(l,"$parse",function(q){var K=this;try{return K.lexer=m("Lexer").$new(q,K.notations),K.$do_parse()}catch(v){if(!e.rescue(v,[m("ParseError"),m("ZeroDivisionError")]))throw v;try{return u}finally{e.pop_exception()}}}),l.$private(),E(l,"$parsed",function(q,K,v,w){try{return X("eval_return"),M(m("Parsed").$new(),"tap",[],function B(Z){var V,ne,ie,le,fe,oe,de,me=null==B.$$s?this:B.$$s;return null==me.round_type&&(me.round_type=u),null==Z&&(Z=u),Z["$command="](q["$[]"]("command")),Z["$prefix_number="]((V=q["$[]"]("prefix"))===u||null==V?u:V.$eval(me.round_type)),Z["$suffix_number="]((ne=q["$[]"]("suffix"))===u||null==ne?u:ne.$eval(me.round_type)),Z["$critical="]((ie=K["$[]"]("critical"))===u||null==ie?u:ie.$eval(me.round_type)),Z["$fumble="]((le=K["$[]"]("fumble"))===u||null==le?u:le.$eval(me.round_type)),Z["$dollar="]((fe=K["$[]"]("dollar"))===u||null==fe?u:fe.$eval(me.round_type)),Z["$modify_number="](v.$eval(me.round_type)),Z["$cmp_op="](w["$[]"]("cmp_op")),D(w["$[]"]("target"),"?")?(Z["$question_target="](!0),M(Z,"target_number=",oe=[0]),oe[oe.length-1]):(Z["$question_target="](!1),oe=[(de=w["$[]"]("target"),de===u||null==de?u:de.$eval(me.round_type))],M(Z,"target_number=",oe),oe[oe.length-1])},{$$s:this})}catch(B){if(B===e.t_eval_return)return B.$v;throw B}}),E(l,"$next_token",function(){return this.lexer.$next_token()}),S=e.large_array_unpack("6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,33,34,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,,,17,18,6,,5,,,17,18,,,5,23,24,25,26,56,54,55,57"),n=e.large_array_unpack("0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,,17,15,15,18,18,23,,18,30,30,23,23,24,,23,31,31,24,24,25,,24,44,44,25,25,28,,25,47,47,28,28,29,,28,48,48,29,29,33,,29,49,49,33,33,34,,33,50,50,34,34,36,,34,,,36,36,37,,36,,,37,37,,,37,27,27,27,27,52,52,52,52"),I=e.large_array_unpack("-2,4,16,-3,-1,11,,33,13,35,23,30,1,,28,40,,37,44,,,-2,,51,58,65,0,106,72,79,47,54,,86,93,,100,107,,,,,,,63,,,68,75,82,89,,120,,,,,"),s=e.large_array_unpack("-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29"),d=e.large_array_unpack("30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,,,21,47,48,40,51,52,49,50,44,46,3,,,,13,,,,,,,,32"),i=e.large_array_unpack("8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,,,4,8,8,5,7,7,8,8,9,5,6,,,,6,,,,,,,,6"),ee=[u,6,13,3,9,-1,27,-15,-10,-1,-38],te=[u,u,u,u,u,u,19,16,15,u,u],re=e.large_array_unpack("0,0,racc_error,4,20,_reduce_1,4,20,_reduce_2,3,20,_reduce_3,3,21,_reduce_4,2,21,_reduce_5,2,21,_reduce_6,1,21,_reduce_7,0,22,_reduce_8,3,22,_reduce_9,3,22,_reduce_10,3,22,_reduce_11,2,23,_reduce_12,2,23,_reduce_13,3,23,_reduce_14,3,23,_reduce_15,0,24,_reduce_16,2,24,_reduce_17,2,24,_reduce_18,3,28,_reduce_19,3,28,_reduce_20,1,28,_reduce_none,3,27,_reduce_22,4,27,_reduce_23,1,27,_reduce_none,0,29,_reduce_25,1,29,_reduce_26,1,29,_reduce_27,1,29,_reduce_28,1,29,_reduce_29,2,26,_reduce_30,2,26,_reduce_31,1,26,_reduce_none,3,25,_reduce_33,1,25,_reduce_34"),ce=Q(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),G(H[0],"Racc_arg",[S,n,s,I,d,i,te,ee,19,re,ce,58,35,!0]),G(H[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),G(H[0],"Racc_debug_parser",!1),E(l,"$_reduce_1",function(q,K,v){var w,h=this;return L(h.modifier)||h.$raise(m("ParseError")),w=z(q),h.$parsed(null==w[0]?u:w[0],null==w[1]?u:w[1],null==w[2]?u:w[2],null==w[3]?u:w[3])}),E(l,"$_reduce_2",function(q,K,v){var w,h=this;return L(h.modifier)||h.$raise(m("ParseError")),w=z(q),h.$parsed(null==w[0]?u:w[0],null==w[2]?u:w[2],null==w[1]?u:w[1],null==w[3]?u:w[3])}),E(l,"$_reduce_3",function(q,K,v){var w,V;return V=null==(w=z(q))[2]?u:w[2],this.$parsed(null==w[0]?u:w[0],null==w[1]?u:w[1],N(N(m("Arithmetic"),"Node"),"Number").$new(0),V)}),E(l,"$_reduce_4",function(q,K,v){var w=this;return L(w.prefix_number)&&L(w.suffix_number)||w.$raise(m("ParseError")),$(["command","prefix","suffix"],{command:q["$[]"](1),prefix:q["$[]"](0),suffix:q["$[]"](2)})}),E(l,"$_reduce_5",function(q,K,v){var w=this;return L(w.prefix_number)||w.$raise(m("ParseError")),L(w.need_suffix_number)&&w.$raise(m("ParseError")),$(["command","prefix"],{command:q["$[]"](1),prefix:q["$[]"](0)})}),E(l,"$_reduce_6",function(q,K,v){var w=this;return L(w.suffix_number)||w.$raise(m("ParseError")),L(w.need_prefix_number)&&w.$raise(m("ParseError")),$(["command","suffix"],{command:q["$[]"](0),suffix:q["$[]"](1)})}),E(l,"$_reduce_7",function(q,K,v){var w=this;return(L(w.need_prefix_number)||L(w.need_suffix_number))&&w.$raise(m("ParseError")),$(["command"],{command:q["$[]"](0)})}),E(l,"$_reduce_8",function(q,K,v){return $([],{})}),E(l,"$_reduce_9",function(q,K,v){var w,V,B=u;return B=null==(w=z(q))[0]?u:w[0],V=null==w[2]?u:w[2],L(this.critical)&&L(B["$[]"]("critical")["$nil?"]())||this.$raise(m("ParseError")),B["$[]="]("critical",V),B}),E(l,"$_reduce_10",function(q,K,v){var w,V,B=u;return B=null==(w=z(q))[0]?u:w[0],V=null==w[2]?u:w[2],L(this.fumble)&&L(B["$[]"]("fumble")["$nil?"]())||this.$raise(m("ParseError")),B["$[]="]("fumble",V),B}),E(l,"$_reduce_11",function(q,K,v){var w,V,B=u;return B=null==(w=z(q))[0]?u:w[0],V=null==w[2]?u:w[2],L(this.dollar)&&L(B["$[]"]("dollar")["$nil?"]())||this.$raise(m("ParseError")),B["$[]="]("dollar",V),B}),E(l,"$_reduce_12",function(q,K,v){return q["$[]"](1)}),E(l,"$_reduce_13",function(q,K,v){return N(N(m("Arithmetic"),"Node"),"Negative").$new(q["$[]"](1))}),E(l,"$_reduce_14",function(q,K,v){return N(N(m("Arithmetic"),"Node"),"BinaryOp").$new(q["$[]"](0),"+",q["$[]"](2))}),E(l,"$_reduce_15",function(q,K,v){return N(N(m("Arithmetic"),"Node"),"BinaryOp").$new(q["$[]"](0),"-",q["$[]"](2))}),E(l,"$_reduce_16",function(q,K,v){return L(this.allowed_cmp_op["$include?"](u))||this.$raise(m("ParseError")),$([],{})}),E(l,"$_reduce_17",function(q,K,v){var w,B,Z;return Z=null==(w=z(q))[1]?u:w[1],L(this.allowed_cmp_op["$include?"](B=null==w[0]?u:w[0]))||this.$raise(m("ParseError")),$(["cmp_op","target"],{cmp_op:B,target:Z})}),E(l,"$_reduce_18",function(q,K,v){var O,w=this;return O=q["$[]"](0),L(w.question_target)||w.$raise(m("ParseError")),L(w.allowed_cmp_op["$include?"](O))||w.$raise(m("ParseError")),$(["cmp_op","target"],{cmp_op:O,target:"?"})}),E(l,"$_reduce_19",function(q,K,v){return N(N(m("Arithmetic"),"Node"),"BinaryOp").$new(q["$[]"](0),"+",q["$[]"](2))}),E(l,"$_reduce_20",function(q,K,v){return N(N(m("Arithmetic"),"Node"),"BinaryOp").$new(q["$[]"](0),"-",q["$[]"](2))}),E(l,"$_reduce_22",function(q,K,v){return N(N(m("Arithmetic"),"Node"),"BinaryOp").$new(q["$[]"](0),"*",q["$[]"](2))}),E(l,"$_reduce_23",function(q,K,v){return q["$[]"](3).$new(q["$[]"](0),q["$[]"](2))}),E(l,"$_reduce_25",function(q,K,v){return N(N(m("Arithmetic"),"Node"),"DivideWithGameSystemDefault")}),E(l,"$_reduce_26",function(q,K,v){return N(N(m("Arithmetic"),"Node"),"DivideWithCeil")}),E(l,"$_reduce_27",function(q,K,v){return N(N(m("Arithmetic"),"Node"),"DivideWithCeil")}),E(l,"$_reduce_28",function(q,K,v){return N(N(m("Arithmetic"),"Node"),"DivideWithRound")}),E(l,"$_reduce_29",function(q,K,v){return N(N(m("Arithmetic"),"Node"),"DivideWithFloor")}),E(l,"$_reduce_30",function(q,K,v){return q["$[]"](1)}),E(l,"$_reduce_31",function(q,K,v){return N(N(m("Arithmetic"),"Node"),"Negative").$new(q["$[]"](1))}),E(l,"$_reduce_33",function(q,K,v){return q["$[]"](1)}),E(l,"$_reduce_34",function(q,K,v){return N(N(m("Arithmetic"),"Node"),"Number").$new(q["$[]"](0))}),E(l,"$_reduce_none",function(q,K,v){return q["$[]"](0)})},Opal.modules["bcdice/deprecated/checker"]=function(e){var M,G,W,c,y,u,z,X,Y=e.module,j=e.send,_=e.eqeqeq,U=e.truthy,A=e.def,o=e.return_val,F=[],g=e.nil;return M=F,G=X=[Y(F[0],"BCDice")].concat(M),W=z=[Y(X[0],"Deprecated")].concat(G),y=[c=Y(z[0],"Checker")].concat(W),u=e.$r(y),c.$private(),A(c,"$check_result_legacy",function(r,t,p,C){var T,P=this,x=g,b=g,k=g,R=g;return x=j(t,"map",[],"sides".$to_proc()),T=(b=j(t,"map",[],"value".$to_proc())).$sum(),k=_([100],R=x)?P.$check_1D100(r,T,p,C):_([20],R)?P.$check_1D20(r,T,p,C):_([6,6],R)?P.$check_2D6(r,T,b,p,C):g,(U(k["$nil?"]())||U(k["$empty?"]()))&&(k=_([10],R=x.$uniq())?P.$check_nD10(r,T,b,p,C):_([6],R)?P.$check_nD6(r,T,b,p,C):g,U(k["$nil?"]())||U(k["$empty?"]()))?g:u("Result").$new(k.$delete_prefix(" \uff1e "))}),A(c,"$check_1D100",o(g)),A(c,"$check_1D20",o(g)),A(c,"$check_nD10",o(g)),A(c,"$check_2D6",o(g)),A(c,"$check_nD6",o(g))},Opal.modules["bcdice/base"]=function(e){var y,P,R,m,n,I,a,f,l,H,b,Y=e.module,j=e.klass,_=e.slice,U=e.rb_plus,A=e.truthy,o=e.def,F=e.regexp,g=e.send,E=e.thrower,M=e.return_ivar,D=e.assign_ivar_val,X=e.eqeqeq,Q=e.eqeq,G=e.return_val,L=e.range,z=e.rb_minus,$=e.rb_divide,W=e.rb_times,c=e.rb_ge,u=e.top,N=[],r=e.$r(N),t=e.nil,p=e.$$$;return u.$require("i18n"),u.$require("i18n/backend/fallbacks"),u.$require("bcdice/randomizer"),u.$require("bcdice/dice_table"),u.$require("bcdice/enum"),u.$require("bcdice/translate"),u.$require("bcdice/result"),u.$require("bcdice/command/parser"),u.$require("bcdice/deprecated/checker"),P=N,R=b=[Y(N[0],"BCDice")].concat(P),f=[a=j(b[0],null,"Base")].concat(R),l=e.$r(f),(H=a.$$prototype).raw_input=H.randomizer=H.enabled_upcase_input=H.debug=t,n=[m=e.get_singleton_class(a)].concat(f),I=e.$r(n),m.$attr_reader("prefixes"),o(m,"$register_prefix",function(d){var ee,te=this,re=t;return null==te.prefixes&&(te.prefixes=t),ee=_(arguments),te.prefixes=U(A(re=te.prefixes)?re:[],ee.$flatten())},-1),o(m,"$register_prefix_from_super_class",function(){return this.$register_prefix(this.$superclass().$prefixes())}),o(m,"$prefixes_pattern",function(){var d=this,i=t;return null==d.prefixes_pattern&&(d.prefixes_pattern=t),null==d.prefixes&&(d.prefixes=t),d.prefixes_pattern=A(i=d.prefixes_pattern)?i:t,A(d.prefixes_pattern)?d.prefixes_pattern:(d.prefixes=A(i=d.prefixes)?i:[],d.prefixes.$freeze(),d.prefixes_pattern=(A(d.prefixes["$empty?"]())?/(?!)/:F(["^(S)?(",d.prefixes.$join("|"),")"],"i")).$freeze())}),o(m,"$command_pattern",function(){var d=this,i=t,ee=t;return null==d.command_pattern&&(d.command_pattern=t),null==d.prefixes&&(d.prefixes=t),d.command_pattern=A(i=d.command_pattern)?i:t,A(d.command_pattern)?d.command_pattern:(d.prefixes=A(i=d.prefixes)?i:[],d.prefixes.$freeze(),ee=U(g(p(I("CommonCommand"),"COMMANDS"),"map",[],function(re){return null==re&&(re=t),p(re,"PREFIX_PATTERN").$source()}),d.prefixes),d.command_pattern=F(["^S?(",ee.$join("|"),")"],"i").$freeze())}),o(m,"$eval",function(d){try{return E("eval_return"),this.$new(d).$eval()}catch(te){if(te===e.t_eval_return)return te.$v;throw te}}),a.$include(l("Translate")),a.$include(p(l("Deprecated"),"Checker")),o(a,"$initialize",function(S){var n=this;return n.raw_input=S,n.sort_add_dice=!1,n.sort_barabara_dice=!1,n.d66_sort_type=p(l("D66SortType"),"NO_SORT"),n.enabled_d9=!1,n.round_type=p(l("RoundType"),"FLOOR"),n.sides_implicit_d=6,n.upper_dice_reroll_threshold=t,n.reroll_dice_reroll_threshold=t,n.default_cmp_op=t,n.default_target_number=t,n.enabled_upcase_input=!0,n.locale="ja_jp",n.randomizer=p(l("BCDice"),"Randomizer").$new(),n.debug=!1}),a.$attr_accessor("randomizer"),a.$attr_reader("d66_sort_type"),a.$attr_reader("round_type"),a.$attr_reader("sides_implicit_d"),a.$attr_reader("upper_dice_reroll_threshold"),a.$attr_reader("reroll_dice_reroll_threshold"),a.$attr_reader("default_cmp_op"),a.$attr_reader("default_target_number"),o(a,"$sort_add_dice?",M("sort_add_dice")),o(a,"$sort_barabara_dice?",M("sort_barabara_dice")),o(a,"$enabled_d9?",M("enabled_d9")),o(a,"$enable_debug",D("debug",!0)),o(a,"$eval",function(){var n,s,S=this,I=t;return n=p(l("BCDice"),"Preprocessor").$process(S.raw_input,S),I=A(s=S.$dice_command(n))?s:S.$eval_common_command(S.raw_input),A(I)?(I["$rands="](S.randomizer.$rand_results()),I["$detailed_rands="](S.randomizer.$detailed_rand_results()),I):t}),o(a,"$change_text",function(S){return S}),o(a,"$check_result",function(S,n,I,s){var d=this,i=t,ee=t,te=t,re=t,se=t;return i=d.$check_result_legacy(S,n,I,s),A(i)?i:(ee=g(n,"map",[],"sides".$to_proc()),re=(te=g(n,"map",[],"value".$to_proc())).$sum(),i=X([100],se=ee)?d.$result_1d100(S,re,I,s):X([20],se)?d.$result_1d20(S,re,I,s):X([6,6],se)?d.$result_2d6(S,re,te,I,s):t,Q(i,l("Result").$nothing())?t:A(i)?i:(i=X([10],se=ee.$uniq())?d.$result_nd10(S,re,te,I,s):X([6],se)?d.$result_nd6(S,re,te,I,s):t,Q(i,l("Result").$nothing())?t:A(i)?i:d.$result_ndx(S,I,s)))}),o(a,"$grich_text",G(t)),a.$private(),o(a,"$eval_common_command",function(S){try{E("eval_return");var I=E("return");return S=this.$change_text(S),g(p(l("CommonCommand"),"COMMANDS"),"each",[],function d(i){var te,ee=null==d.$$s?this:d.$$s;if(null==ee.randomizer&&(ee.randomizer=t),null==i&&(i=t),te=i.$eval(S,ee,ee.randomizer),!A(te))return t;I.$throw(te)},{$$s:this,$$ret:I}),t}catch(d){if(d===e.t_eval_return||d===I)return d.$v;throw d}}),o(a,"$dice_command",function(S){var n=this,I=t,s=t,d=t,i=t;return A(n.enabled_upcase_input)&&(S=S.$upcase()),I=n.$class().$prefixes_pattern().$match(S),A(I)?(s=I["$[]"](1)["$nil?"]()["$!"](),A(s)&&(S=S["$[]"](L(1,-1,!1))),d=n.$eval_game_system_specific_command(S),A(d["$is_a?"](l("Result")))?(d["$secret="](A(i=d["$secret?"]())?i:s),d):A(d["$nil?"]())||A(d["$empty?"]())||Q(d,"1")?t:g(l("Result").$new(),"tap",[],function(te){var re;return null==te&&(te=t),te["$text="](d.$to_s()),g(te,"secret=",re=[s]),re[re.length-1]})):t}),o(a,"$eval_game_system_specific_command",G(t)),o(a,"$result_ndx",function(S,n,I){return A(I["$is_a?"](l("String")))?t:A(S.$send(n,I))?l("Result").$success(this.$translate("success")):l("Result").$failure(this.$translate("failure"))}),o(a,"$result_1d100",G(t)),o(a,"$result_1d20",G(t)),o(a,"$result_nd10",G(t)),o(a,"$result_2d6",G(t)),o(a,"$result_nd6",G(t)),o(a,"$get_table_by_2d6",function(S){return this.$get_table_by_nD6(S,2)}),o(a,"$get_table_by_1d6",function(S){return this.$get_table_by_nD6(S,1)}),o(a,"$get_table_by_nD6",function(S,n){return this.$get_table_by_nDx(S,n,6)}),o(a,"$get_table_by_nDx",function(S,n,I){var d,i=t;return d=this.randomizer.$roll_sum(n,I),i=this.$get_table_value(S["$[]"](z(d,n))),A(i["$nil?"]())?["1",0]:[i,d]}),o(a,"$get_table_by_1d3",function(S){var s,d,n=this,i=t;return n.$debug("get_table_by_1d3"),s=n.randomizer.$roll_sum(1,6),n.$debug("num",s),d=$(z(s,1),2).$to_i(),n.$debug("index",d),i=S["$[]"](d),A(i["$nil?"]())?["1",0]:[i,s]}),o(a,"$get_table_by_d66_swap",function(S){var I;return I=this.randomizer.$roll_d66(p(l("D66SortType"),"ASC")),[this.$get_table_by_number(I,S),I]}),o(a,"$get_table_by_d66",function(S){var I,s,d,ee,i=t;return I=this.randomizer.$roll_once(6),s=this.randomizer.$roll_once(6),d=U(W(z(I,1),6),z(s,1)),i=S["$[]"](d),ee=""+I+s,A(i["$nil?"]())?["1",ee]:[i,ee]}),o(a,"$get_table_by_number",function(S,n,I){try{var s=E("return");return null==I&&(I="1"),g(n,"each",[],function i(ee){var re,te=null==i.$$s?this:i.$$s;if(null==ee&&(ee=t),re=ee["$[]"](0),!A(c(re,S)))return t;s.$throw(te.$get_table_value(ee["$[]"](1)))},{$$s:this,$$ret:s}),this.$get_table_value(I)}catch(i){if(i===s)return i.$v;throw i}},-3),o(a,"$get_table_value",function(S){return A(S["$is_a?"](l("Proc")))?S.$call():S}),o(a,"$roll_tables",function(S,n){var s=t;return s=n["$[]"](S),A(s)?s.$roll(this.randomizer).$to_s():t}),o(a,"$debug",function(S,n){var s,d=this,i=t,ee=t;return s=_(arguments,1),A(d.debug)?(i=A(S["$is_a?"](l("String")))?S:S.$inspect(),A(s["$empty?"]())?d.$warn(i):(ee=g(s,"map",[],function(re){return null==re&&(re=t),A(re["$is_a?"](l("String")))?'"'+re+'"':re.$inspect()}),d.$warn(i+": "+ee.$join(", ")))):t},-2),p(p(r("I18n"),"Backend"),"Simple").$include(p(p(r("I18n"),"Backend"),"Fallbacks")),r("I18n").$load_path()["$<<"](r("Dir")["$[]"](r("File").$join("bcdice","../../i18n/**/*.yml"))),r("I18n")["$default_locale="]("ja_jp"),y=[["ja_jp"]],g(r("I18n").$fallbacks(),"defaults=",y),y[y.length-1]},Opal.modules["bcdice/game_system/sword_world/rating_lexer"]=function(e){var D,L,u,C,P,x,b,r,$,W,Q,Y=e.module,j=e.klass,_=e.const_set,U=e.hash2,A=e.truthy,o=e.def,g=[],E=e.nil;return e.top.$require("strscan"),D=g,L=Q=[Y(g[0],"BCDice")].concat(D),$=[Y(Q[0],"GameSystem")].concat(L),W=e.$r($),u=$,C=r=[j($[0],W("Base"),"SwordWorld")].concat(u),x=[P=j(r[0],null,"RatingLexer")].concat(C),b=e.$r(x),P.$$prototype.scanner=E,_(x[0],"SYMBOLS",U(["+","-","*","/","(",")","[","]","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","[":"BRACKETL","]":"BRACKETR","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),o(P,"$initialize",function(R){var a,f,H;return R=A(H=(a=(f=R)===E||null==f?E:f.$split(" ",2))===E||null==a?E:a.$first())?H:"",this.scanner=b("StringScanner").$new(R)}),o(P,"$next_token",function(){var R=this,a=E,f=E,H=E;return A(R.scanner["$eos?"]())?[!1,"$"]:A(a=R.scanner.$scan(/\d+/))?["NUMBER",a.$to_i()]:(f=R.scanner.$getch().$upcase(),[A(H=b("SYMBOLS")["$[]"](f))?H:f.$to_sym(),f])}),o(P,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/game_system/sword_world/rating_parsed"]=function(e){var X,z,N,P,x,b,T,k,t,W,c,G,Y=e.module,j=e.klass,_=e.def,U=e.truthy,A=e.rb_le,o=e.rb_plus,F=e.rb_lt,g=e.neqeq,E=[],M=e.nil;return X=E,z=G=[Y(E[0],"BCDice")].concat(X),W=[Y(G[0],"GameSystem")].concat(z),c=e.$r(W),N=W,P=t=[j(W[0],c("Base"),"SwordWorld")].concat(N),b=[x=j(t[0],null,"RatingParsed")].concat(P),T=e.$r(b),(k=x.$$prototype).modifier_after_half=k.semi_fixed_val=k.kept_modify=k.rate=k.greatest_fortune=k.modifier=M,x.$attr_accessor("rate"),x.$attr_accessor("critical"),x.$attr_accessor("kept_modify"),x.$attr_accessor("first_to"),x.$attr_accessor("first_modify"),x.$attr_accessor("rateup"),x.$attr_accessor("greatest_fortune"),x.$attr_accessor("semi_fixed_val"),x.$attr_accessor("tmp_fixed_val"),x.$attr_accessor("modifier"),x.$attr_accessor("modifier_after_half"),_(x,"$initialize",function(a,f){var l=this;return l.rate=a,l.modifier=f,l.critical=13,l.kept_modify=0,l.first_to=0,l.first_modify=0,l.greatest_fortune=!1,l.rateup=0,l.semi_fixed_val=0,l.tmp_fixed_val=0,l.modifier_after_half=M}),_(x,"$half",function(){return this.modifier_after_half["$nil?"]()["$!"]()}),_(x,"$min_critical",function(){var a=this;return U(A(a.semi_fixed_val,1))?3:o(o(a.semi_fixed_val,a.kept_modify),2).$clamp(3,13)}),_(x,"$infinite_roll?",function(){return F(this.$critical(),this.$min_critical())}),_(x,"$to_s",function(){var a=this,f=M;return f="KeyNo."+a.rate,U(F(a.$critical(),13))&&(f=o(f,"c["+a.$critical()+"]")),g(a.$first_modify(),0)&&(f=o(f,"m["+T("Format").$modifier(a.$first_modify())+"]")),g(a.$first_to(),0)&&(f=o(f,"m["+a.$first_to()+"]")),g(a.$rateup(),0)&&(f=o(f,"r["+a.$rateup()+"]")),U(a.greatest_fortune)&&(f=o(f,"gf")),g(a.$semi_fixed_val(),0)&&(f=o(f,"sf["+a.$semi_fixed_val()+"]")),g(a.$tmp_fixed_val(),0)&&(f=o(f,"tf["+a.$tmp_fixed_val()+"]")),g(a.$kept_modify(),0)&&(f=o(f,"a["+T("Format").$modifier(a.$kept_modify())+"]")),g(a.modifier,0)&&(f=o(f,T("Format").$modifier(a.modifier))),f})},Opal.modules["bcdice/game_system/sword_world/rating_options"]=function(e){var g,X,W,r,y,G,L,M,Y=e.module,j=e.klass,_=e.truthy,U=e.def,A=[];return g=A,X=M=[Y(A[0],"BCDice")].concat(g),G=[Y(M[0],"GameSystem")].concat(X),L=e.$r(G),W=G,y=[j(G[0],L("Base"),"SwordWorld")].concat(W),(r=j(y[0],null,"RatingOptions")).$attr_accessor("critical"),r.$attr_accessor("kept_modify"),r.$attr_accessor("first_to"),r.$attr_accessor("first_modify"),r.$attr_accessor("rateup"),r.$attr_accessor("greatest_fortune"),r.$attr_accessor("semi_fixed_val"),r.$attr_accessor("tmp_fixed_val"),r.$attr_accessor("modifier"),r.$attr_accessor("modifier_after_half"),U(r,"$settable_first_roll_adjust_option?",function(){var C;return _(C=this.$first_modify()["$nil?"]())?this.$first_to()["$nil?"]():C}),U(r,"$settable_non_2d_roll_option?",function(){var C,P,p=this;return _(C=_(P=p.$greatest_fortune()["$nil?"]())?p.$semi_fixed_val()["$nil?"]():P)?p.$tmp_fixed_val()["$nil?"]():C})},Opal.modules["bcdice/game_system/sword_world/rating_parser"]=function(e){var y,t,T,H,I,s,d,i,ee,te,re,se,ue,_e,m,S,n,q,R,a,C,P,N,Y=e.module,j=e.klass,_=e.ensure_kwargs,U=e.send2,A=e.find_super,o=e.def,F=e.send,g=e.truthy,E=e.not,M=e.thrower,D=e.hash,X=e.const_set,Q=e.to_ary,G=e.eqeq,L=e.top,z=[],$=e.nil,W=e.$$$;return L.$require("racc/parser.rb"),L.$require("bcdice/arithmetic/node"),L.$require("bcdice/enum"),L.$require("bcdice/game_system/sword_world/rating_lexer"),L.$require("bcdice/game_system/sword_world/rating_parsed"),L.$require("bcdice/game_system/sword_world/rating_options"),y=z,t=N=[Y(z[0],"BCDice")].concat(y),C=[Y(N[0],"GameSystem")].concat(t),P=e.$r(C),T=C,R=[j(C[0],P("Base"),"SwordWorld")].concat(T),a=e.$r(R),H=R,S=[m=j(R[0],W(a("Racc"),"Parser"),"RatingParser")].concat(H),n=e.$r(S),(q=m.$$prototype).lexer=q.round_type=q.version=$,o(m,"$initialize",function K(v){var w,O,B=this;return K.$$p=null,null==(w=(v=_(v)).$$smap.version)&&(w="v1_0"),null==(O=v.$$smap.round_type)&&(O=W(n("RoundType"),"CEIL")),U(B,A(B,"initialize",K,!1,!0),"initialize",[],null),B.version=w,B.round_type=O},-1),o(m,"$set_debug",function(){return this.yydebug=!0,this}),o(m,"$parse",function(v){try{return this.lexer=n("RatingLexer").$new(v),this.$do_parse()}catch(O){if(!e.rescue(O,[n("ParseError"),n("ZeroDivisionError")]))throw O;try{return $}finally{e.pop_exception()}}}),m.$private(),o(m,"$parsed",function(v,w,O){try{return M("eval_return"),F(n("RatingParsed").$new(v,w),"tap",[],function Z(V){var ne,ie,le,fe,oe,de,me,be,he=null==Z.$$s?this:Z.$$s,ve=$;return null==he.round_type&&(he.round_type=$),null==V&&(V=$),V["$kept_modify="](g(ve=(ne=O.$kept_modify())===$||null==ne?$:ne.$eval(he.round_type))?ve:0),V["$first_to="](g(ve=O.$first_to())?ve:0),V["$first_modify="](g(ve=O.$first_modify())?ve:0),V["$rateup="](g(ve=(ie=O.$rateup())===$||null==ie?$:ie.$eval(he.round_type))?ve:0),E(O.$greatest_fortune()["$nil?"]())&&V["$greatest_fortune="](O.$greatest_fortune()),V["$semi_fixed_val="](g(ve=(le=O.$semi_fixed_val())===$||null==le?$:le.$clamp(1,6))?ve:0),V["$tmp_fixed_val="](g(ve=(fe=O.$tmp_fixed_val())===$||null==fe?$:fe.$clamp(1,6))?ve:0),V["$modifier_after_half="]((oe=O.$modifier_after_half())===$||null==oe?$:oe.$eval(he.round_type)),de=[g((be=O.$critical(),me=be===$||null==be?$:be.$eval(he.round_type),ve=me===$||null==me?$:me.$clamp(0,13)))?ve:g(V.$half())?13:10],F(V,"critical=",de),de[de.length-1]},{$$s:this})}catch(Z){if(Z===e.t_eval_return)return Z.$v;throw Z}}),o(m,"$next_token",function(){return this.lexer.$next_token()}),I=e.large_array_unpack("15,14,16,5,17,18,20,21,57,58,23,24,11,59,12,19,13,15,14,16,4,17,18,20,21,4,30,3,30,11,8,12,19,13,26,27,26,27,29,30,29,30,55,56,55,56,30,26,27,26,27,29,30,29,26,27,9,30,29,30,26,27,55,56,29,26,27,26,27,29,30,29,30,55,56,55,56,30,26,27,26,27,29,30,29,26,27,37,30,29,30,26,27,55,56,29,26,27,26,27,29,30,29,30,55,56,38,39,32,26,27,26,27,29,46,29,33,34,51,52,53,54"),s=e.large_array_unpack("6,6,6,1,6,6,6,6,49,49,10,10,6,49,6,6,6,22,22,22,3,22,22,22,22,0,11,0,12,22,4,22,22,22,11,11,12,12,11,14,12,15,41,41,43,43,19,14,14,15,15,14,20,15,19,19,5,21,19,23,20,20,44,44,20,21,21,23,23,21,24,23,26,45,45,50,50,27,24,24,26,26,24,29,26,27,27,16,55,27,56,29,29,62,62,29,55,55,56,56,55,57,56,58,63,63,17,18,13,57,57,58,58,57,25,58,13,13,33,34,38,39"),d=e.large_array_unpack("22,3,,17,28,56,-4,,,,0,24,26,106,37,39,80,99,100,44,50,55,13,57,68,97,70,75,,81,,,,116,117,,,,118,119,,30,,32,50,61,,,,-2,63,,,,,86,88,99,101,,,,81,92"),i=e.large_array_unpack("-33,-33,-4,-33,-33,-33,-1,-4,-3,64,-5,-33,-33,-33,-11,-33,-33,-33,-33,-33,-33,-33,-2,-33,-33,-33,-33,-33,-30,-33,-32,-7,-8,-33,-33,-12,-13,-14,-33,-33,-17,-18,-27,-19,-20,-21,-6,-28,-29,-33,-24,-9,-10,-15,-16,-33,-33,-33,-33,-31,-25,-26,-22,-23"),ee=e.large_array_unpack("25,31,6,35,36,1,49,22,40,41,43,2,44,45,7,47,48,,50,,,,,,,,,,,,,,,,,,,,,,,,,,60,61,62,63"),te=e.large_array_unpack("5,5,3,5,5,1,7,3,5,6,6,2,6,6,2,5,5,,6,,,,,,,,,,,,,,,,,,,,,,,,,,5,5,6,6"),re=[$,5,11,0,$,-11,-11,-23,$],se=[$,$,$,$,10,42,$,$,28],ue=e.large_array_unpack("0,0,racc_error,2,22,_reduce_1,3,22,_reduce_2,2,23,_reduce_3,0,24,_reduce_4,2,24,_reduce_5,4,24,_reduce_6,3,24,_reduce_7,3,24,_reduce_8,4,24,_reduce_9,4,24,_reduce_10,2,24,_reduce_11,3,24,_reduce_12,3,24,_reduce_13,3,24,_reduce_14,4,24,_reduce_15,4,24,_reduce_16,3,24,_reduce_17,2,25,_reduce_18,2,25,_reduce_19,3,25,_reduce_20,3,25,_reduce_21,3,28,_reduce_22,3,28,_reduce_23,1,28,_reduce_none,3,27,_reduce_25,3,27,_reduce_26,1,27,_reduce_none,2,26,_reduce_28,2,26,_reduce_29,1,26,_reduce_none,3,29,_reduce_31,1,29,_reduce_32"),_e=D(!1,0,"error",1,"NUMBER",2,"K",3,"R",4,"H",5,"G",6,"F",7,"S",8,"T",9,"PLUS",10,"MINUS",11,"ASTERISK",12,"SLASH",13,"PARENL",14,"PARENR",15,"BRACKETL",16,"BRACKETR",17,"AT",18,"SHARP",19,"DOLLAR",20),X(S[0],"Racc_arg",[I,s,i,d,ee,te,se,re,21,ue,_e,64,33,!0]),X(S[0],"Racc_token_to_s_table",["$end","error","NUMBER","K","R","H","G","F","S","T","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","BRACKETL","BRACKETR","AT","SHARP","DOLLAR","$start","expr","rate","option","modifier","unary","mul","add","term"]),X(S[0],"Racc_debug_parser",!1),o(m,"$_reduce_1",function(v,w,O){try{M("eval_return");var B,ne,fe,ie=$,le=$;return ne=null==(B=Q(v))[0]?$:B[0],le=g(fe=(ie=null==B[1]?$:B[1]).$modifier())?fe:W(W(n("Arithmetic"),"Node"),"Number").$new(0),this.$parsed(ne,le.$eval(this.round_type),ie)}catch(oe){if(oe===e.t_eval_return)return oe.$v;throw oe}}),o(m,"$_reduce_2",function(v,w,O){try{M("eval_return");var B,ie,fe,le=$,oe=$;return ie=null==(B=Q(v))[1]?$:B[1],g((le=null==B[2]?$:B[2]).$modifier_after_half())||le["$modifier_after_half="](W(W(n("Arithmetic"),"Node"),"Number").$new(0)),oe=g(fe=le.$modifier())?fe:W(W(n("Arithmetic"),"Node"),"Number").$new(0),this.$parsed(ie,oe.$eval(this.round_type),le)}catch(de){if(de===e.t_eval_return)return de.$v;throw de}}),o(m,"$_reduce_3",function(v,w,O){return v["$[]"](1).$to_i()}),o(m,"$_reduce_4",function(v,w,O){return n("RatingOptions").$new()}),o(m,"$_reduce_5",function(v,w,O){var h,ne,V=$;return ne=null==(h=Q(v))[1]?$:h[1],g((V=null==h[0]?$:h[0]).$modifier()["$nil?"]())||this.$raise(n("ParseError")),V["$modifier="](ne),V}),o(m,"$_reduce_6",function(v,w,O){var h,ie,V=$;return ie=null==(h=Q(v))[2]?$:h[2],g((V=null==h[0]?$:h[0]).$critical()["$nil?"]())||this.$raise(n("ParseError")),V["$critical="](ie),V}),o(m,"$_reduce_7",function(v,w,O){var h,ie,V=$;return ie=null==(h=Q(v))[2]?$:h[2],g((V=null==h[0]?$:h[0]).$critical()["$nil?"]())||this.$raise(n("ParseError")),V["$critical="](ie),V}),o(m,"$_reduce_8",function(v,w,O){var h,V=$,ie=$;return ie=null==(h=Q(v))[2]?$:h[2],g((V=null==h[0]?$:h[0])["$settable_first_roll_adjust_option?"]())||this.$raise(n("ParseError")),V["$first_to="](ie.$to_i()),V}),o(m,"$_reduce_9",function(v,w,O){var h,V=$,ie=$;return ie=null==(h=Q(v))[3]?$:h[3],g((V=null==h[0]?$:h[0])["$settable_first_roll_adjust_option?"]())||this.$raise(n("ParseError")),V["$first_modify="](ie.$to_i()),V}),o(m,"$_reduce_10",function(v,w,O){var h,V=$,ie=$;return ie=null==(h=Q(v))[3]?$:h[3],g((V=null==h[0]?$:h[0])["$settable_first_roll_adjust_option?"]())||this.$raise(n("ParseError")),V["$first_modify="](ie.$to_i()["$-@"]()),V}),o(m,"$_reduce_11",function(v,w,O){var h,V=$;return h=Q(v),g((V=null==h[0]?$:h[0]).$modifier_after_half()["$nil?"]())||this.$raise(n("ParseError")),V["$modifier_after_half="](W(W(n("Arithmetic"),"Node"),"Number").$new(0)),V}),o(m,"$_reduce_12",function(v,w,O){var h,ie,V=$;return ie=null==(h=Q(v))[2]?$:h[2],g((V=null==h[0]?$:h[0]).$modifier_after_half()["$nil?"]())||this.$raise(n("ParseError")),V["$modifier_after_half="](ie),V}),o(m,"$_reduce_13",function(v,w,O){var h,ie,V=$;return V=null==(h=Q(v))[0]?$:h[0],ie=null==h[2]?$:h[2],g(["v2_5","v2_0"]["$include?"](this.version))&&g(V.$rateup()["$nil?"]())||this.$raise(n("ParseError")),V["$rateup="](ie),V}),o(m,"$_reduce_14",function(v,w,O){var h,V=$;return V=null==(h=Q(v))[0]?$:h[0],g(["v2_5","v2_0"]["$include?"](this.version))&&g(V["$settable_non_2d_roll_option?"]())||this.$raise(n("ParseError")),V["$greatest_fortune="](!0),V}),o(m,"$_reduce_15",function(v,w,O){var h,V=$,ie=$;return V=null==(h=Q(v))[0]?$:h[0],ie=null==h[3]?$:h[3],g(["v2_5","v2_0"]["$include?"](this.version))&&g(V["$settable_non_2d_roll_option?"]())||this.$raise(n("ParseError")),V["$semi_fixed_val="](ie.$to_i()),V}),o(m,"$_reduce_16",function(v,w,O){var h,V=$,ie=$;return V=null==(h=Q(v))[0]?$:h[0],ie=null==h[3]?$:h[3],g(["v2_5","v2_0"]["$include?"](this.version))&&g(V["$settable_non_2d_roll_option?"]())||this.$raise(n("ParseError")),V["$tmp_fixed_val="](ie.$to_i()),V}),o(m,"$_reduce_17",function(v,w,O){var h,ie,V=$;return V=null==(h=Q(v))[0]?$:h[0],ie=null==h[2]?$:h[2],G(this.version,"v2_5")&&g(V.$kept_modify()["$nil?"]())||this.$raise(n("ParseError")),V["$kept_modify="](ie),V}),o(m,"$_reduce_18",function(v,w,O){return v["$[]"](1)}),o(m,"$_reduce_19",function(v,w,O){return W(W(n("Arithmetic"),"Node"),"Negative").$new(v["$[]"](1))}),o(m,"$_reduce_20",function(v,w,O){return W(W(n("Arithmetic"),"Node"),"BinaryOp").$new(v["$[]"](0),"+",v["$[]"](2))}),o(m,"$_reduce_21",function(v,w,O){return W(W(n("Arithmetic"),"Node"),"BinaryOp").$new(v["$[]"](0),"-",v["$[]"](2))}),o(m,"$_reduce_22",function(v,w,O){return W(W(n("Arithmetic"),"Node"),"BinaryOp").$new(v["$[]"](0),"+",v["$[]"](2))}),o(m,"$_reduce_23",function(v,w,O){return W(W(n("Arithmetic"),"Node"),"BinaryOp").$new(v["$[]"](0),"-",v["$[]"](2))}),o(m,"$_reduce_25",function(v,w,O){return W(W(n("Arithmetic"),"Node"),"BinaryOp").$new(v["$[]"](0),"*",v["$[]"](2))}),o(m,"$_reduce_26",function(v,w,O){return W(W(n("Arithmetic"),"Node"),"DivideWithGameSystemDefault").$new(v["$[]"](0),v["$[]"](2))}),o(m,"$_reduce_28",function(v,w,O){return v["$[]"](1)}),o(m,"$_reduce_29",function(v,w,O){return W(W(n("Arithmetic"),"Node"),"Negative").$new(v["$[]"](1))}),o(m,"$_reduce_31",function(v,w,O){return v["$[]"](1)}),o(m,"$_reduce_32",function(v,w,O){return W(W(n("Arithmetic"),"Node"),"Number").$new(v["$[]"](0))}),o(m,"$_reduce_none",function(v,w,O){return v["$[]"](0)})},Opal.modules["bcdice/game_system/SwordWorld"]=function(e){var C,T,H,m,S,n,I,R,a,x,Y=e.module,j=e.klass,_=e.const_set,U=e.send2,A=e.find_super,o=e.def,F=e.truthy,g=e.rb_ge,E=e.rb_le,M=e.eqeq,D=e.neqeq,X=e.rb_minus,Q=e.rb_gt,G=e.hash2,L=e.send,z=e.to_ary,$=e.rb_plus,W=e.rb_lt,c=e.rb_times,y=e.thrower,u=e.rb_divide,N=e.top,r=[],t=e.nil;return N.$require("bcdice/base"),N.$require("bcdice/game_system/sword_world/rating_parser"),C=r,T=x=[Y(r[0],"BCDice")].concat(C),R=[Y(x[0],"GameSystem")].concat(T),a=e.$r(R),H=R,S=[m=j(R[0],a("Base"),"SwordWorld")].concat(H),n=e.$r(S),(I=m.$$prototype).rating_table=I.randomizer=t,_(S[0],"ID","SwordWorld"),_(S[0],"NAME","\u30bd\u30fc\u30c9\u30fb\u30ef\u30fc\u30eb\u30c9RPG"),_(S[0],"SORT_KEY","\u305d\u304a\u3068\u308f\u3042\u308b\u3068"),_(S[0],"HELP_MESSAGE","\u30fbSW\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3000(Kx[c]+m$f) (x:\u30ad\u30fc, c:\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024, m:\u30dc\u30fc\u30ca\u30b9, f:\u51fa\u76ee\u4fee\u6b63)\n"),m.$register_prefix("H?K"),o(m,"$initialize",function s(d){return s.$$p=null,U(this,A(this,"initialize",s,!1,!0),"initialize",[d],null),this.rating_table=0}),o(m,"$result_2d6",function(d,i,ee,te,re){return F(g(i,12))?n("Result").$critical(this.$translate("SwordWorld.critical")):F(E(i,2))?n("Result").$fumble(this.$translate("SwordWorld.fumble")):D(te,">=")||M(re,"?")?t:F(g(d,re))?n("Result").$success(this.$translate("success")):n("Result").$failure(this.$translate("failure"))}),o(m,"$eval_game_system_specific_command",function(d){return this.$rating(d)}),m.$private(),o(m,"$rating_parser",function(){return n("RatingParser").$new()}),o(m,"$rating",function(d){var i,ee,te=this,re=t,se=t,ue=t,ce=t,$e=t,_e=t,ae=t,J=t,q=t,K=t,v=t,w=t,O=t,h=t,Z=t,V=t;return te.$debug("rating string",d),re=te.$rating_parser().$parse(d),F(re)?(se=te.$getSW2_0_RatingTable(),ue=X(se.$length(),1),te.$debug("keyMax",ue),F(Q(re.$rate(),ue))?n("Result").$new(te.$translate("SwordWorld.keynumber_exceeds",G(["keyMax"],{keyMax:ue}))):F(re["$infinite_roll?"]())?n("Result").$new(te.$translate("SwordWorld.infinite_critical",G(["min_critical"],{min_critical:re.$min_critical()}))):(ce=te.$getNewRates(se),$e=re+" \uff1e ",_e=[],ae=[],J=[],q=0,K=0,v=0,w=0,O=re.$first_to(),h=re.$first_modify(),function(){try{var ne=y("break");L(te,"loop",[],function ie(){var le,fe,be,he,oe=null==ie.$$s?this:ie.$$s,de=t,me=t;if(fe=oe.$rollDice(re,w),me=null==(le=z(fe))[1]?t:le[1],q=de=null==le[0]?t:le[0],D(O,0)?(q=de=O,O=0):D(h,0)&&(q=$(q,h),h=0),F(E(de,2))&&(_e["$<<"](de.$to_s()),ae["$<<"](me.$to_s()),J["$<<"]("**"),w=$(w,1),ne.$throw()),D(re.$kept_modify(),0)&&D(q,2)&&(q=$(q,re.$kept_modify())),F(W(q,2))&&(q=2),F(Q(q,12))&&(q=12),be=[$(re.$rate(),c(w,re.$rateup())),ue].$min(),oe.$debug("currentKey",be),he=ce["$[]"](q)["$[]"](be),oe.$debug("rateValue",he),v=$(v,he),K=$(K,q),_e["$<<"](q.$to_s()),ae["$<<"](me.$to_s()),J["$<<"](F(Q(q,2))?he:"**"),w=$(w,1),F(g(q,re.$critical())))return t;ne.$throw()},{$$s:te})}catch(ie){if(ie===ne)return ie.$v;throw ie}}(),ee=te.$getResultText(v,re,ae,_e,J,K,w),i=z(ee),Z=null==i[1]?t:i[1],V=null==i[2]?t:i[2],$e=$($e,null==i[0]?t:i[0]),L(n("Result").$new(),"tap",[],function(ie){var le;return null==ie&&(ie=t),ie["$text="]($e),ie["$critical="](Z),L(ie,"fumble=",le=[V]),le[le.length-1]}))):(te.$debug("not matched"),"1")}),o(m,"$getSW2_0_RatingTable",function(){return["*,0,0,0,1,2,2,3,3,4,4","*,0,0,0,1,2,3,3,3,4,4","*,0,0,0,1,2,3,4,4,4,4","*,0,0,1,1,2,3,4,4,4,5","*,0,0,1,2,2,3,4,4,5,5","*,0,1,1,2,2,3,4,5,5,5","*,0,1,1,2,3,3,4,5,5,5","*,0,1,1,2,3,4,4,5,5,6","*,0,1,2,2,3,4,4,5,6,6","*,0,1,2,3,3,4,4,5,6,7","*,1,1,2,3,3,4,5,5,6,7","*,1,2,2,3,3,4,5,6,6,7","*,1,2,2,3,4,4,5,6,6,7","*,1,2,3,3,4,4,5,6,7,7","*,1,2,3,4,4,4,5,6,7,8","*,1,2,3,4,4,5,5,6,7,8","*,1,2,3,4,4,5,6,7,7,8","*,1,2,3,4,5,5,6,7,7,8","*,1,2,3,4,5,6,6,7,7,8","*,1,2,3,4,5,6,7,7,8,9","*,1,2,3,4,5,6,7,8,9,10","*,1,2,3,4,6,6,7,8,9,10","*,1,2,3,5,6,6,7,8,9,10","*,2,2,3,5,6,7,7,8,9,10","*,2,3,4,5,6,7,7,8,9,10","*,2,3,4,5,6,7,8,8,9,10","*,2,3,4,5,6,8,8,9,9,10","*,2,3,4,6,6,8,8,9,9,10","*,2,3,4,6,6,8,9,9,10,10","*,2,3,4,6,7,8,9,9,10,10","*,2,4,4,6,7,8,9,10,10,10","*,2,4,5,6,7,8,9,10,10,11","*,3,4,5,6,7,8,10,10,10,11","*,3,4,5,6,8,8,10,10,10,11","*,3,4,5,6,8,9,10,10,11,11","*,3,4,5,7,8,9,10,10,11,12","*,3,5,5,7,8,9,10,11,11,12","*,3,5,6,7,8,9,10,11,12,12","*,3,5,6,7,8,10,10,11,12,13","*,4,5,6,7,8,10,11,11,12,13","*,4,5,6,7,9,10,11,11,12,13","*,4,6,6,7,9,10,11,12,12,13","*,4,6,7,7,9,10,11,12,13,13","*,4,6,7,8,9,10,11,12,13,14","*,4,6,7,8,10,10,11,12,13,14","*,4,6,7,9,10,10,11,12,13,14","*,4,6,7,9,10,10,12,13,13,14","*,4,6,7,9,10,11,12,13,13,15","*,4,6,7,9,10,12,12,13,13,15","*,4,6,7,10,10,12,12,13,14,15","*,4,6,8,10,10,12,12,13,15,15","*,5,7,8,10,10,12,12,13,15,15","*,5,7,8,10,11,12,12,13,15,15","*,5,7,9,10,11,12,12,14,15,15","*,5,7,9,10,11,12,13,14,15,16","*,5,7,10,10,11,12,13,14,16,16","*,5,8,10,10,11,12,13,15,16,16","*,5,8,10,11,11,12,13,15,16,17","*,5,8,10,11,12,12,13,15,16,17","*,5,9,10,11,12,12,14,15,16,17","*,5,9,10,11,12,13,14,15,16,18","*,5,9,10,11,12,13,14,16,17,18","*,5,9,10,11,13,13,14,16,17,18","*,5,9,10,11,13,13,15,17,17,18","*,5,9,10,11,13,14,15,17,17,18","*,5,9,10,12,13,14,15,17,18,18","*,5,9,10,12,13,15,15,17,18,19","*,5,9,10,12,13,15,16,17,19,19","*,5,9,10,12,14,15,16,17,19,19","*,5,9,10,12,14,16,16,17,19,19","*,5,9,10,12,14,16,17,18,19,19","*,5,9,10,13,14,16,17,18,19,20","*,5,9,10,13,15,16,17,18,19,20","*,5,9,10,13,15,16,17,19,20,21","*,6,9,10,13,15,16,18,19,20,21","*,6,9,10,13,16,16,18,19,20,21","*,6,9,10,13,16,17,18,19,20,21","*,6,9,10,13,16,17,18,20,21,22","*,6,9,10,13,16,17,19,20,22,23","*,6,9,10,13,16,18,19,20,22,23","*,6,9,10,13,16,18,20,21,22,23","*,6,9,10,13,17,18,20,21,22,23","*,6,9,10,14,17,18,20,21,22,24","*,6,9,11,14,17,18,20,21,23,24","*,6,9,11,14,17,19,20,21,23,24","*,6,9,11,14,17,19,21,22,23,24","*,7,10,11,14,17,19,21,22,23,25","*,7,10,12,14,17,19,21,22,24,25","*,7,10,12,14,18,19,21,22,24,25","*,7,10,12,15,18,19,21,22,24,26","*,7,10,12,15,18,19,21,23,25,26","*,7,11,13,15,18,19,21,23,25,26","*,7,11,13,15,18,20,21,23,25,27","*,8,11,13,15,18,20,22,23,25,27","*,8,11,13,16,18,20,22,23,25,28","*,8,11,14,16,18,20,22,23,26,28","*,8,11,14,16,19,20,22,23,26,28","*,8,12,14,16,19,20,22,24,26,28","*,8,12,15,16,19,20,22,24,27,28","*,8,12,15,17,19,20,22,24,27,29","*,8,12,15,18,19,20,22,24,27,30"]}),o(m,"$getNewRates",function(d){var i,ee,re=t,se=t,ue=t,ce=t,$e=t,_e=t,ae=t,J=t,q=t,K=t,v=t;return re=[],se=[],ue=[],ce=[],$e=[],_e=[],ae=[],J=[],q=[],K=[],v=[],L(d,"each",[],function(h){var B=t;return null==h&&(h=t),B=h.$split(/,/),v.$push(0),re.$push(B["$[]"](1).$to_i()),se.$push(B["$[]"](2).$to_i()),ue.$push(B["$[]"](3).$to_i()),ce.$push(B["$[]"](4).$to_i()),$e.$push(B["$[]"](5).$to_i()),_e.$push(B["$[]"](6).$to_i()),ae.$push(B["$[]"](7).$to_i()),J.$push(B["$[]"](8).$to_i()),q.$push(B["$[]"](9).$to_i()),K.$push(B["$[]"](10).$to_i())}),M(this.rating_table,1)&&K["$[]="](31,(i=[32,(ee=[33,10],L(K,"[]=",ee),ee[ee.length-1])],L(K,"[]=",i),i[i.length-1])),[v,v,v,re,se,ue,ce,$e,_e,ae,J,q,K]}),o(m,"$rollDice",function(d,i){var te=t;return[(te=this.randomizer.$roll_barabara(2,6)).$sum(),te.$join(",")]}),o(m,"$getResultText",function(d,i,ee,te,re,se,ue){var $e=t,_e=t,ae=t,J=t,q=t;return($e=[]).$push("2D:["+ee.$join(" ")+"]="+te.$join(",")),F(E(se,2))?($e.$push(re.$join(",")),$e.$push(this.$translate("SwordWorld.fumble")),[$e.$join(" \uff1e "),!1,!0]):(F(Q(re.$size(),1))||D(i.$modifier(),0)?(_e=$(re.$join(","),n("Format").$modifier(i.$modifier())),F(i.$half())&&(_e="("+_e+")/2",D(i.$modifier_after_half(),0)&&(_e=$(_e,n("Format").$modifier(i.$modifier_after_half())))),$e.$push(_e)):F(i.$half())&&(_e=re.$first()+"/2",D(i.$modifier_after_half(),0)&&(_e=$(_e,n("Format").$modifier(i.$modifier_after_half()))),$e.$push(_e)),F(Q(ue,1))&&(ae=this.$translate("SwordWorld.round_text",G(["reroll_count"],{reroll_count:X(ue,1)})),$e.$push(ae)),J=$(d,i.$modifier()),F(i.$half())&&(J=u(J,2).$ceil(),D(i.$modifier_after_half(),0)&&(J=$(J,i.$modifier_after_half()))),q=J.$to_s(),$e.$push(q),[$e.$join(" \uff1e "),Q(ue,1),!1])})},Opal.queue(function(e){var D,L,u,N,r,$,W,Q,Y=e.module,j=e.klass,_=e.const_set,U=e.send2,A=e.find_super,o=e.def,g=[];return e.top.$require("bcdice/game_system/SwordWorld"),D=g,L=Q=[Y(g[0],"BCDice")].concat(D),$=[Y(Q[0],"GameSystem")].concat(L),W=e.$r($),u=$,_((r=[N=j($[0],W("SwordWorld"),"SwordWorld_SimplifiedChinese")].concat(u))[0],"ID","SwordWorld:SimplifiedChinese"),_(r[0],"NAME","\u5251\u4e16\u754c"),_(r[0],"SORT_KEY","\u56fd\u969b\u5316:Simplified Chinese:\u5251\u4e16\u754c"),_(r[0],"HELP_MESSAGE","\u30fbSW\u3000\u5a01\u529b\u8868\u3000(Kx[c]+m$f) (x:\u5a01\u529b\u503c, c:\u66b4\u51fb\u503c, m:\u52a0\u503c, f:\u9ab0\u5b50\u51fa\u76ee\u4fee\u6b63)\n"),N.$register_prefix_from_super_class(),o(N,"$initialize",function t(p){var P=this;return t.$$p=null,U(P,A(P,"initialize",t,!1,!0),"initialize",[p],null),P.locale="zh_hans"})})}}]);