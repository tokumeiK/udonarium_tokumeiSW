(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[9753],{9527:(ye,pe,ge)=>{ge(9993),Opal.modules["bcdice/arithmetic_evaluator"]=function(e){var F,j,u,l,k,A,q,Z,Y=e.module,W=e.ensure_kwargs,c=e.truthy,B=e.thrower,C=e.def,d=[],H=e.nil,y=e.$$$;return F=d,j=Z=[Y(d[0],"BCDice")].concat(F),q=[A=Y(Z[0],"ArithmeticEvaluator")].concat(j),l=[u=e.get_singleton_class(A)].concat(q),k=e.$r(l),C(u,"$eval",function(L,r){try{B("eval_return");var p,M=H;return null==(p=(r=W(r)).$$smap.round_type)&&(p=y(k("RoundType"),"FLOOR")),c(L)&&c(M=k("Arithmetic").$eval(L,p))?M:0}catch(N){if(N===e.t_eval_return)return N.$v;throw N}},-2)},Opal.modules["i18n/backend/fallbacks"]=function(e){var K,_,r,n,l,k,Y=e.module,W=e.class_variable_set,c=e.truthy,B=e.class_variable_get,C=e.def,d=e.send,H=e.send2,y=e.find_super,P=e.hash2,F=e.find_block_super,z=e.neqeq,Z=e.thrower,G=e.return_val,j=[],A=e.nil,q=e.$$$;return K=j,k=[l=Y(j[0],"I18n")].concat(K),W(k[0],"@@fallbacks",A),_=e.get_singleton_class(l),r=[_].concat(k),n=e.$r(r),C(_,"$fallbacks",function(){var N=A;return W(r[1],"@@fallbacks",c(null!=r[1].$$cvars["@@fallbacks"]?"class variable":A)&&c(N=B(r[1],"@@fallbacks",!1))?N:q(q(n("I18n"),"Locale"),"Fallbacks").$new()),c(N=n("Thread").$current()["$[]"]("i18n_fallbacks"))?N:B(r[1],"@@fallbacks",!1)}),C(_,"$fallbacks=",function(M){var N;return W(r[1],"@@fallbacks",c(M["$is_a?"](n("Array")))?q(q(n("I18n"),"Locale"),"Fallbacks").$new(M):M),N=["i18n_fallbacks",B(r[1],"@@fallbacks",!1)],d(n("Thread").$current(),"[]=",N),N[N.length-1]}),function(_,L){var M,N,R,b,n=[Y(_,"Backend")].concat(L);return M=n,R=[N=Y(n[0],"Fallbacks")].concat(M),b=e.$r(R),C(N,"$translate",function E(h,g,$){try{var o=Z("return"),f=E.$$p||A,D=this,s=A,m=A;return E.$$p=null,null==$&&($=b("EMPTY_HASH")),c($.$fetch("fallback",!0))?c($["$[]"]("fallback_in_progress"))?H(D,y(D,"translate",E,!1,!0),"translate",[h,g,$],f):(c($["$[]"]("default"))&&(s=D["$extract_non_symbol_default!"]($)),m=$.$merge(P(["fallback_in_progress"],{fallback_in_progress:!0})),d(b("I18n").$fallbacks()["$[]"](h),"each",[],function t(T){var i=null==t.$$s?this:t.$$s;null==T&&(T=A);try{return d(i,"catch",["exception"],function v(){var a=null==v.$$s?this:v.$$s,X=A;if(X=H(a,F(a,"translate",v.$$def||t.$$def||E,!1,!1),"translate",[T,g,m],null),c(X["$nil?"]()))return A;z(h.$to_s(),T.$to_s())&&a.$on_fallback(h,T,g,$),o.$throw(X)},{$$s:i,$$ret:o})}catch(v){if(!e.rescue(v,[q(b("I18n"),"InvalidLocale")]))throw v;try{return A}finally{e.pop_exception()}}},{$$s:D}),c($["$key?"]("default"))&&c($["$[]"]("default")["$nil?"]())?A:c(s)?H(D,y(D,"translate",E,!1,!0),"translate",[h,A,$.$merge(P(["default"],{default:s}))],null):D.$throw("exception",q(b("I18n"),"MissingTranslation").$new(h,g,$))):H(D,y(D,"translate",E,!1,!0),"translate",[h,g,$],f)}catch(t){if(t===o)return t.$v;throw t}},-3),C(N,"$extract_non_symbol_default!",function(h){var $,g=A;return g=[h["$[]"]("default")].$flatten(),$=d(g,"detect",[],function(f){return null==f&&(f=A),f["$is_a?"](b("Symbol"))["$!"]()}),c($)&&h["$[]="]("default",g["$[]"](0,g.$index($))),$}),C(N,"$exists?",function E(h,g,$){try{var o=Z("return"),f=E.$$p||A,D=this;return E.$$p=null,null==$&&($=b("EMPTY_HASH")),c($.$fetch("fallback",!0))?(d(b("I18n").$fallbacks()["$[]"](h),"each",[],function s(m){var t=null==s.$$s?this:s.$$s;null==m&&(m=A);try{if(!c(H(t,F(t,"exists?",s.$$def||E,!1,!1),"exists?",[m,g],null)))return A;o.$throw(!0)}catch(T){if(!e.rescue(T,[q(b("I18n"),"InvalidLocale")]))throw T;try{return A}finally{e.pop_exception()}}},{$$s:D,$$ret:o}),!1):H(D,y(D,"exists?",E,!1,!0),"exists?",[h,g,$],f)}catch(s){if(s===o)return s.$v;throw s}},-3),N.$private(),C(N,"$on_fallback",G(A))}(k[0],k)},Opal.modules["bcdice/randomizer"]=function(e){var l,p,M,N,R,b,_,L,W=e.klass,c=e.const_set,B=e.def,C=e.truthy,d=e.rb_gt,H=e.rb_plus,y=e.rb_le,P=e.send,F=e.rb_minus,z=e.eqeq,Z=e.rb_times,G=e.eqeqeq,j=e.rb_ge,A=[],q=e.nil,u=e.$$$;return l=A,_=[(0,e.module)(A[0],"BCDice")].concat(l),L=e.$r(_),p=_,N=[M=W(_[0],null,"Randomizer")].concat(p),R=e.$r(N),(b=M.$$prototype).rand_results=b.detailed_rand_results=q,c(N[0],"UPPER_LIMIT_DICE_TIMES",200),c(N[0],"UPPER_LIMIT_DICE_SIDES",1e4),c(N[0],"UPPER_LIMIT_RANDS",1e4),B(M,"$initialize",function(){return this.rand_results=[],this.detailed_rand_results=[]}),M.$attr_reader("rand_results"),M.$attr_reader("detailed_rand_results"),c(N[0],"DetailedRandResult",R("Struct").$new("kind","sides","value")),B(M,"$roll_barabara",function(h,g){var $=this;return C(d(H($.rand_results.$size(),h),R("UPPER_LIMIT_RANDS")))&&$.$raise(R("TooManyRandsError")),C(y(h,0))||C(d(h,R("UPPER_LIMIT_DICE_TIMES")))?[]:P(R("Array"),"new",[h],function o(){return(null==o.$$s?this:o.$$s).$roll_once(g)},{$$s:$})}),B(M,"$roll_sum",function(h,g){return this.$roll_barabara(h,g).$sum()}),B(M,"$roll_once",function(h){var $=q;return C(y(h,0))||C(d(h,R("UPPER_LIMIT_DICE_SIDES")))?0:($=this.$rand_inner(h),this.$push_to_detail("normal",h,$),$)}),B(M,"$roll_index",function(h){return F(this.$roll_once(h),1)}),B(M,"$roll_tens_d10",function(){var $,g=q;return g=this.$rand_inner(10),z(g,10)&&(g=0),$=Z(g,10),this.$push_to_detail("tens_d10",10,$),$}),B(M,"$roll_d9",function(){var g;return g=F(this.$rand_inner(10),1),this.$push_to_detail("d9",10,g),g}),B(M,"$roll_d66",function(h){var o,$=q;return $=P(R("Array"),"new",[2],function f(){return(null==f.$$s?this:f.$$s).$roll_once(6)},{$$s:this}),G(u(R("D66SortType"),"ASC"),o=h)?$["$sort!"]():G(u(R("D66SortType"),"DESC"),o)&&$["$sort!"]()["$reverse!"](),H(Z($["$[]"](0),10),$["$[]"](1))}),M.$private(),B(M,"$rand_inner",function(h){var $,g=this;return C(j(g.rand_results.$size(),R("UPPER_LIMIT_RANDS")))&&g.$raise(R("TooManyRandsError")),$=g.$random(h),g.rand_results["$<<"]([$,h]),$}),B(M,"$random",function(h){return H(R("Kernel").$rand(h),1)}),B(M,"$push_to_detail",function(h,g,$){var f;return f=R("DetailedRandResult").$new(h,g,$),this.detailed_rand_results.$push(f)}),W(_[0],L("StandardError"),"TooManyRandsError"),q},Opal.modules["bcdice/dice_table/roll_result"]=function(e){var P,G,K,l,k,_,L,A,z,Y=e.module,W=e.klass,c=e.def,B=e.truthy,C=e.return_val,d=[],H=e.nil;return P=d,G=z=[Y(d[0],"BCDice")].concat(P),K=A=[Y(z[0],"DiceTable")].concat(G),k=[l=W(A[0],null,"RollResult")].concat(K),_=e.$r(k),(L=l.$$prototype).table_name=L.value=L.body=H,c(l,"$initialize",function(n,p,M){var N=this;return N.table_name=n,N.value=p,N.body=M}),l.$attr_reader("table_name"),l.$attr_reader("value"),l.$attr_reader("body"),c(l,"$to_s",function(){var n=this;return n.table_name+"("+n.value+") \uff1e "+n.body}),c(l,"$last_body",function(){var n=this;return B(n.body["$is_a?"](_("RollResult")))?n.body.$last_body():n.body}),c(l,"$empty?",C(!1))},Opal.modules["bcdice/dice_table/chain_table"]=function(e){var P,G,K,l,k,_,L,A,z,Y=e.module,W=e.klass,c=e.truthy,B=e.def,C=e.rb_minus,d=[],H=e.nil;return P=d,G=z=[Y(d[0],"BCDice")].concat(P),K=A=[Y(z[0],"DiceTable")].concat(G),k=[l=W(A[0],null,"ChainTable")].concat(K),_=e.$r(k),(L=l.$$prototype).times=L.sides=L.items=L.name=H,B(l,"$initialize",function(n,p,M){var N=this,R=H;return N.name=n,N.items=M.$freeze(),R=/(\d+)D(\d+)/i.$match(p),c(R)||N.$raise(_("ArgumentError"),"Unexpected table type: "+p),N.times=R["$[]"](1).$to_i(),N.sides=R["$[]"](2).$to_i()}),B(l,"$roll",function(n){var M,N,p=this,R=H;return M=n.$roll_sum(p.times,p.sides),N=C(M,p.times),R=p.items["$[]"](N),c(R["$respond_to?"]("roll"))&&(R=R.$roll(n)),_("RollResult").$new(p.name,M,R)})},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(e){var Z,q,_,L,r,n,p,K,j,Y=e.module,W=e.klass,c=e.hash2,B=e.defs,C=e.def,d=e.rb_plus,H=e.rb_times,y=e.rb_minus,P=[],F=e.nil;return Z=P,q=j=[Y(P[0],"BCDice")].concat(Z),_=K=[Y(j[0],"DiceTable")].concat(q),r=[L=W(K[0],null,"D66GridTable")].concat(_),n=e.$r(r),(p=L.$$prototype).name=p.items=F,B(L,"$from_i18n",function(N,R){var E=F;return E=n("I18n").$t(N,c(["locale","raise"],{locale:R,raise:!0})),this.$new(E["$[]"]("name"),E["$[]"]("items"))}),C(L,"$initialize",function(N,R){return this.name=N,this.items=R.$freeze()}),C(L,"$roll",function(N){var b,E,h,g,$;return b=N.$roll_once(6),E=N.$roll_once(6),h=d(H(b,10),E),g=y(b,1),$=y(E,1),n("RollResult").$new(this.name,h,this.items["$[]"](g)["$[]"]($))})},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(e){var F,j,k,_,L,r,q,u,Z,Y=e.module,W=e.klass,c=e.hash2,B=e.defs,C=e.def,H=[],y=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),F=H,j=Z=[Y(H[0],"BCDice")].concat(F),q=[Y(Z[0],"DiceTable")].concat(j),u=e.$r(q),k=q,L=[_=W(q[0],u("D66GridTable"),"D66HalfGridTable")].concat(k),r=e.$r(L),B(_,"$from_i18n",function(p,M){var R=y;return R=r("I18n").$t(p,c(["locale","raise"],{locale:M,raise:!0})),this.$new(R["$[]"]("name"),R["$[]"]("items_1_2_3"),R["$[]"]("items_4_5_6"))}),C(_,"$initialize",function(p,M,N){return this.name=p,this.items=[M,M,M,N,N,N].$freeze()})},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(e){var F,j,k,_,L,r,q,u,Z,Y=e.module,W=e.klass,c=e.hash2,B=e.defs,C=e.def,H=[],y=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),F=H,j=Z=[Y(H[0],"BCDice")].concat(F),q=[Y(Z[0],"DiceTable")].concat(j),u=e.$r(q),k=q,L=[_=W(q[0],u("D66GridTable"),"D66OneThirdTable")].concat(k),r=e.$r(L),B(_,"$from_i18n",function(p,M){var R=y;return R=r("I18n").$t(p,c(["locale","raise"],{locale:M,raise:!0})),this.$new(R["$[]"]("name"),R["$[]"]("items_1_2"),R["$[]"]("items_3_4"),R["$[]"]("items_5_6"))}),C(_,"$initialize",function(p,M,N,R){return this.name=p,this.items=[M,M,N,N,R,R].$freeze()})},Opal.modules["bcdice/dice_table/d66_table"]=function(e){var j,K,r,n,p,M,N,k,q,Y=e.module,W=e.klass,c=e.hash2,B=e.defs,C=e.def,d=e.eqeqeq,H=e.rb_plus,y=e.rb_times,P=e.truthy,F=[],z=e.nil,Z=e.$$$;return j=F,K=q=[Y(F[0],"BCDice")].concat(j),r=k=[Y(q[0],"DiceTable")].concat(K),p=[n=W(k[0],null,"D66Table")].concat(r),M=e.$r(p),(N=n.$$prototype).sort_type=N.items=N.name=z,B(n,"$from_i18n",function(b,E){var $,g=z;return g=M("I18n").$t(b,c(["locale"],{locale:E})),$=M("D66SortType").$const_get(g["$[]"]("d66_sort_type")),this.$new(g["$[]"]("name"),$,g["$[]"]("items"))}),C(n,"$initialize",function(b,E,h){var g=this;return g.name=b,g.sort_type=E,g.items=h.$freeze()}),C(n,"$roll",function(b){var E=this,h=z,g=z,$=z,o=z;return h=b.$roll_barabara(2,6),d(Z(M("D66SortType"),"ASC"),g=E.sort_type)?h["$sort!"]():d(Z(M("D66SortType"),"DESC"),g)&&h["$sort!"]()["$reverse!"](),$=H(y(h["$[]"](0),10),h["$[]"](1)),o=P(g=E.items["$[]"]($))?g:E.items["$[]"]($.$to_s()),P(o["$respond_to?"]("roll"))&&(o=o.$roll(b)),M("RollResult").$new(E.name,$,o)}),C(n,"$choice",function(b){return M("RollResult").$new(this.name,b,this.items["$[]"](b))})},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(e){var A,l,_,L,u,Y=e.module,W=e.klass,c=e.hash2,B=e.send,C=e.to_ary,d=e.rb_plus,H=e.rb_times,y=e.send2,P=e.find_super,F=e.def,Z=[],G=e.nil;return e.top.$require("bcdice/dice_table/d66_table"),A=Z,l=u=[Y(Z[0],"BCDice")].concat(A),_=[Y(u[0],"DiceTable")].concat(l),L=e.$r(_),F(W(_[0],L("D66Table"),"D66LeftRangeTable"),"$initialize",function M(N,R,b){var g;return M.$$p=null,g=c([],{}),B(b,"each",[],function(o){var f,m;return null==o&&(o=G),f=C(o),m=null==f[1]?G:f[1],B(null==f[0]?G:f[0],"each",[],function(T){return null==T&&(T=G),B(m,"each_with_index",[],function(v,a){var X,te;return null==v&&(v=G),null==a&&(a=G),te=d(H(T,10),d(a,1)),B(g,"[]=",X=[te,v]),X[X.length-1]})})}),y(this,P(this,"initialize",M,!1,!0),"initialize",[N,R,g],null)})},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(e){var G,u,L,r,n,p,M,l,A,Y=e.module,W=e.klass,c=e.hash2,B=e.defs,C=e.def,d=e.truthy,H=e.rb_minus,y=e.rb_plus,P=e.rb_times,F=[],z=e.nil;return G=F,u=A=[Y(F[0],"BCDice")].concat(G),L=l=[Y(A[0],"DiceTable")].concat(u),n=[r=W(l[0],null,"D66ParityTable")].concat(L),p=e.$r(n),(M=r.$$prototype).odd=M.even=M.name=z,B(r,"$from_i18n",function(R,b){var h=z;return h=p("I18n").$t(R,c(["locale","raise"],{locale:b,raise:!0})),this.$new(h["$[]"]("name"),h["$[]"]("odd"),h["$[]"]("even"))}),C(r,"$initialize",function(R,b,E){var h=this;return h.name=R,h.odd=b.$freeze(),h.even=E.$freeze()}),C(r,"$roll",function(R){var h,$,o,b=this,E=z;return E=R.$roll_once(6),h=R.$roll_once(6),$=(d(E["$odd?"]())?b.odd:b.even)["$[]"](H(h,1)),o=y(P(E,10),h),p("RollResult").$new(b.name,o,$)})},Opal.modules["bcdice/dice_table/d66_range_table"]=function(e){var F,j,l,k,_,L,r,q,Z,Y=e.module,W=e.klass,c=e.def,B=e.rb_plus,C=e.rb_times,d=e.send,H=[],y=e.nil;return F=H,j=Z=[Y(H[0],"BCDice")].concat(F),l=q=[Y(Z[0],"DiceTable")].concat(j),_=[k=W(q[0],null,"D66RangeTable")].concat(l),L=e.$r(_),(r=k.$$prototype).items=r.name=y,c(k,"$initialize",function(p,M){return this.name=p,this.items=M.$freeze()}),c(k,"$roll",function(p){var N,R,b,E=y;return N=p.$roll_once(6),R=p.$roll_once(6),b=B(C(N,10),R),E=d(this.items,"find",[],function(g){return null==g&&(g=y),g["$[]"](0)["$include?"](b)}),L("RollResult").$new(this.name,b,E["$[]"](1))})},Opal.modules["bcdice/dice_table/range_table"]=function(e){var G,u,L,r,n,p,M,l,A,Y=e.module,W=e.klass,c=e.const_set,B=e.send,C=e.truthy,d=e.def,H=e.eqeqeq,y=e.rb_times,P=e.rb_plus,F=[],z=e.nil;return G=F,u=A=[Y(F[0],"BCDice")].concat(G),L=l=[Y(A[0],"DiceTable")].concat(u),n=[r=W(l[0],null,"RangeTable")].concat(L),p=e.$r(n),(M=r.$$prototype).name=M.items=M.num_of_dice=M.num_of_sides=M.formatter=z,c(n[0],"RollResult",B(p("Struct"),"new",["sum","values","content","formatted"],function N(){return(null==N.$$s?this:N.$$s).$alias_method("to_s","formatted")},{$$s:r})),c(n[0],"Item",p("Struct").$new("range","content")),c(n[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),c(n[0],"DEFAULT_FORMATTER",B(r,"lambda",[],function(R,b){return null==R&&(R=z),null==b&&(b=z),R.$name()+"("+b.$sum()+") \uff1e "+b.$content()})),r.$attr_reader("name"),r.$attr_reader("num_of_dice"),r.$attr_reader("num_of_sides"),d(r,"$initialize",function N(R,b,E){var $,h=N.$$p||z,g=this,o=z;return N.$$p=null,g.name=R.$freeze(),g.formatter=C($=h)?$:p("DEFAULT_FORMATTER"),o=p("DICE_ROLL_METHOD_RE").$match(b),C(o)||g.$raise(p("ArgumentError"),g.name+": invalid dice roll method: "+b),g.num_of_dice=o["$[]"](1).$to_i(),g.num_of_sides=o["$[]"](2).$to_i(),g.$store(E)}),d(r,"$fetch",function(R){var E,b=this;return E=B(b.items,"find",[],function(g){return null==g&&(g=z),g.$range()["$include?"](R)}),C(E)||b.$raise(p("RangeError"),b.name+": value is out of range: "+R),E}),d(r,"$roll",function(R){var h,b=this,E=z,g=z;return h=(E=R.$roll_barabara(b.num_of_dice,b.num_of_sides)).$sum(),(g=p("RollResult").$new(h,E,b.$fetch(h).$content()))["$formatted="](b.formatter["$[]"](b,g)),g}),r.$private(),d(r,"$store",function(R){var E,h,b=this;return E=B(R,"map",[],function g($,o){return null==$&&($=z),null==o&&(o=z),[(null==g.$$s?this:g.$$s).$coerce_to_int_range($),o]},{$$s:b}),h=B(E,"sort_by",[],function($,o){return null==$&&($=z),null==o&&(o=z),$.$min()}),b.$assert_min_sum_is_covered(h),b.$assert_max_sum_is_covered(h),b.$assert_no_gap_or_overlap_in_ranges(h),b.items=B(h,"map",[],function($,o){return null==$&&($=z),null==o&&(o=z),p("Item").$new($,o.$freeze()).$freeze()}).$freeze(),b}),d(r,"$coerce_to_int_range",function(R){var E;return H(p("Integer"),E=R)?p("Range").$new(R,R):H(p("Range"),E)&&C(R.$begin()["$is_a?"](p("Integer")))&&C(R.$end()["$is_a?"](p("Integer")))?R:this.$raise(p("TypeError"),this.name+": "+R+" ("+R.$class()+") must be an Integer or a Range with Integers ")}),d(r,"$assert_min_sum_is_covered",function(R){var E,b=this,h=z;return E=b.num_of_dice,h=R.$first()["$[]"](0),C(h["$include?"](E))||b.$raise(p("RangeError"),b.name+": min value ("+E+") is not covered: "+h),b}),d(r,"$assert_max_sum_is_covered",function(R){var E,b=this,h=z;return E=y(b.num_of_dice,b.num_of_sides),h=R.$last()["$[]"](0),C(h["$include?"](E))||b.$raise(p("RangeError"),b.name+": max value ("+E+") is not covered: "+h),b}),d(r,"$assert_no_gap_or_overlap_in_ranges",function(R){return B(R,"each_cons",[2],function E(h,g){var D,s,$=null==E.$$s?this:E.$$s,o=z,f=z;return null==$.name&&($.name=z),null==h&&(h=z),null==g&&(g=z),o=h["$[]"](0),f=g["$[]"](0),D=o.$max(),s=P(D,1),C(f["$include?"](D))&&$.$raise(p("RangeError"),$.name+": Range overlap: "+o+" and "+f),C(f["$include?"](s))?z:$.$raise(p("RangeError"),$.name+": Range gap: "+o+" and "+f)},{$$s:this}),this})},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(e){var z,A,k,p,M,N,R,L,u,G,Y=e.module,W=e.klass,c=e.send,B=e.def,C=e.rb_minus,d=e.return_ivar,H=[],y=e.nil,P=e.$$$;return z=H,A=G=[Y(H[0],"BCDice")].concat(z),k=u=[Y(G[0],"DiceTable")].concat(A),p=L=[W(u[0],null,"SaiFicSkillTable")].concat(k),N=[M=W(L[0],null,"Category")].concat(p),R=e.$r(N),B(M,"$initialize",function(E,h,g,$){var o=this;return o.name=E,o.skills=c(h.$map(),"with_index",[2],function(D,s){return null==D&&(D=y),null==s&&(s=y),P(R("SaiFicSkillTable"),"Skill").$new(E,D,g,s,$)}),o.dice=g}),B(M,"$roll",function(E){return this.$skills()["$[]"](C(E.$roll_sum(2,6),2))}),B(M,"$to_s",d("name")),M.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(e){var y,Z,u,L,r,l,j,F,Y=e.module,W=e.klass,c=e.def,B=e.hash2,C=[],d=e.nil;return y=C,Z=F=[Y(C[0],"BCDice")].concat(y),u=j=[Y(F[0],"DiceTable")].concat(Z),l=[W(j[0],null,"SaiFicSkillTable")].concat(u),(r=(L=W(l[0],null,"Skill")).$$prototype).s_format=r.category_dice=r.row_dice=r.category_name=r.name=d,c(L,"$initialize",function(p,M,N,R,b){var E=this;return E.category_name=p,E.name=M,E.category_dice=N,E.row_dice=R,E.s_format=b}),c(L,"$to_s",function(){var p=this;return p.$format(p.s_format,B(["category_dice","row_dice","category_name","skill_name"],{category_dice:p.category_dice,row_dice:p.row_dice,category_name:p.category_name,skill_name:p.name}))}),L.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(e){var l,r,R,b,E,h,g,p,_,Y=e.module,W=e.klass,c=e.ensure_kwargs,B=e.hash2,C=e.send,H=e.defs,y=e.const_set,P=e.to_ary,F=e.def,z=e.truthy,Z=e.rb_minus,G=e.rb_plus,j=e.top,A=[],q=e.nil,u=e.$$$;return j.$require("bcdice/dice_table/sai_fic_skill_table/category"),j.$require("bcdice/dice_table/sai_fic_skill_table/skill"),l=A,r=_=[Y(A[0],"BCDice")].concat(l),R=p=[Y(_[0],"DiceTable")].concat(r),E=[b=W(p[0],null,"SaiFicSkillTable")].concat(R),h=e.$r(E),(g=b.$$prototype).rtt=g.rtt_format=g.rct=g.rct_format=g.rttn=g.rttn_format=g.categories=q,H(b,"$from_i18n",function(o,f,D){var s,m,t,a,v=q;return null==(s=(D=c(D)).$$smap.rtt)&&(s=q),null==(m=D.$$smap.rct)&&(m=q),null==(t=D.$$smap.rttn)&&(t=q),a=(v=h("I18n").$t("RTT",B(["locale","raise","default"],{locale:f,raise:!1,default:B([],{})})).$merge(h("I18n").$t(o,B(["locale","raise"],{locale:f,raise:!0}))))["$[]"]("items"),v=C(v,"select",[],function(te,O){return null==te&&(te=q),null==O&&(O=q),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](te)}),this.$new(a,e.to_hash(v).$merge(B(["rtt","rct","rttn"],{rtt:s,rct:m,rttn:t})))},-3),y(E[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),y(E[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),y(E[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),y(E[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),F(b,"$initialize",function(o,f){var D,s,m,t,T,i,v,a=this;return null==(D=(f=c(f)).$$smap.rtt)&&(D=q),null==(s=f.$$smap.rct)&&(s=q),null==(m=f.$$smap.rttn)&&(m=q),null==(t=f.$$smap.rtt_format)&&(t=h("DEFAULT_RTT")),null==(T=f.$$smap.rct_format)&&(T=h("DEFAULT_RCT")),null==(i=f.$$smap.rttn_format)&&(i=h("DEFAULT_RTTN")),null==(v=f.$$smap.s_format)&&(v=h("DEFAULT_S")),a.categories=C(o.$map(),"with_index",[1],function(te,O){var ue,ce,se;return null==te&&(te=q),null==O&&(O=q),ce=null==(ue=P(te))[0]?q:ue[0],se=null==ue[1]?q:ue[1],u(h("SaiFicSkillTable"),"Category").$new(ce,se,O,v)},{$$has_top_level_mlhs_arg:!0}),a.rtt=D,a.rct=s,a.rttn=m.$to_a(),a.rtt_format=t,a.rct_format=T,a.rttn_format=i},-2),y(E[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),b.$attr_reader("categories"),F(b,"$roll_command",function(o,f){var s,D=this,m=q,t=q;return z(["RTT",D.rtt]["$include?"](s=f))?D.$format_skill(D.rtt_format,D.$roll_skill(o)):z(["RCT",D.rct]["$include?"](s))?(m=D.$roll_category(o),D.$format(D.rct_format,B(["category_dice","category_name"],{category_dice:m.$dice(),category_name:m.$name()}))):z(t=h("RTTN").$index(s))||z(t=D.rttn.$index(s))?D.$format_skill(D.rttn_format,D.categories["$[]"](t).$roll(o)):q}),F(b,"$roll_category",function(o){return this.categories["$[]"](Z(o.$roll_once(6),1))}),F(b,"$roll_skill",function(o){return this.$roll_category(o).$roll(o)}),F(b,"$prefixes",function(){var o=this;return G(["RTT[1-6]?","RCT",o.rtt,o.rct],o.rttn).$compact()}),b.$private(),F(b,"$format_skill",function(o,f){return this.$format(o,B(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:f.$category_dice(),row_dice:f.$row_dice(),category_name:f.$category_name(),skill_name:f.$name(),text:f.$to_s()}))})},Opal.modules["bcdice/dice_table/table"]=function(e){var z,A,k,_,L,r,n,u,G,Y=e.module,W=e.klass,c=e.hash2,B=e.defs,C=e.truthy,d=e.def,H=e.rb_minus,y=[],P=e.nil;return z=y,A=G=[Y(y[0],"BCDice")].concat(z),k=u=[Y(G[0],"DiceTable")].concat(A),L=[_=W(u[0],null,"Table")].concat(k),r=e.$r(L),(n=_.$$prototype).times=n.sides=n.name=n.items=P,B(_,"$from_i18n",function(M,N){var b=P;return b=r("I18n").$t(M,c(["locale"],{locale:N})),this.$new(b["$[]"]("name"),b["$[]"]("type"),b["$[]"]("items"))}),d(_,"$initialize",function(M,N,R){var b=this,E=P;return b.name=M,b.items=R.$freeze(),E=/(\d+)D(\d+)/i.$match(N),C(E)||b.$raise(r("ArgumentError"),"Unexpected table type: "+N),b.times=E["$[]"](1).$to_i(),b.sides=E["$[]"](2).$to_i()}),d(_,"$roll",function(M){var R,N=this;return R=M.$roll_sum(N.times,N.sides),N.$choice(R)}),d(_,"$choice",function(M){var R,N=this;return R=H(M,N.times),r("RollResult").$new(N.name,M,N.items["$[]"](R))})},Opal.modules["bcdice/dice_table"]=function(e){var Y=e.top;return Y.$require("bcdice/dice_table/roll_result"),Y.$require("bcdice/dice_table/chain_table"),Y.$require("bcdice/dice_table/d66_grid_table"),Y.$require("bcdice/dice_table/d66_half_grid_table"),Y.$require("bcdice/dice_table/d66_one_third_table"),Y.$require("bcdice/dice_table/d66_left_range_table"),Y.$require("bcdice/dice_table/d66_parity_table"),Y.$require("bcdice/dice_table/d66_range_table"),Y.$require("bcdice/dice_table/d66_table"),Y.$require("bcdice/dice_table/range_table"),Y.$require("bcdice/dice_table/sai_fic_skill_table"),Y.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(e){var d,F,Z,y,Y=e.module,W=e.const_set,c=[];return d=c,F=y=[Y(c[0],"BCDice")].concat(d),Z=[Y(y[0],"D66SortType")].concat(F),W(Z[0],"NO_SORT","no_sort"),W(Z[0],"ASC","asc"),W(Z[0],"DESC","desc"),function(P,F){var Z=[Y(P,"RoundType")].concat(F);return W(Z[0],"CEIL","ceil"),W(Z[0],"FLOOR","floor"),W(Z[0],"ROUND","round")}(y[0],y)},Opal.modules["bcdice/translate"]=function(e){var F,j,A,q,u,Z,Y=e.module,W=e.ensure_kwargs,c=e.kwrestargs,C=e.hash2,d=e.def,H=[],y=e.nil;return F=H,j=Z=[Y(H[0],"BCDice")].concat(F),q=[A=Y(Z[0],"Translate")].concat(j),u=e.$r(q),d(A,"$translate",function(l,k){var _,L=this;return null==L.locale&&(L.locale=y),k=W(k),_=c(k,{}),u("I18n").$translate(l,C(["locale","raise"],{locale:L.locale,raise:!0}).$merge(e.to_hash(_)))},-2)},Opal.modules["bcdice/result"]=function(e){var A,K,q,F,Z,W=e.klass,c=e.send,B=e.def,C=e.return_val,d=e.return_ivar,H=[],y=e.nil;return F=H,A=Z=[(0,e.module)(H[0],"BCDice")].concat(F),[q=W(Z[0],null,"Result")].concat(A),B(K=e.get_singleton_class(q),"$success",function(_){return c(this.$new(),"tap",[],function(n){var p;return null==n&&(n=y),n["$text="](_),c(n,"success=",p=[!0]),p[p.length-1]})}),B(K,"$failure",function(_){return c(this.$new(),"tap",[],function(n){var p;return null==n&&(n=y),n["$text="](_),c(n,"failure=",p=[!0]),p[p.length-1]})}),B(K,"$critical",function(_){return c(this.$new(),"tap",[],function(n){var p;return null==n&&(n=y),n["$text="](_),n["$critical="](!0),c(n,"success=",p=[!0]),p[p.length-1]})}),B(K,"$fumble",function(_){return c(this.$new(),"tap",[],function(n){var p;return null==n&&(n=y),n["$text="](_),n["$fumble="](!0),c(n,"failure=",p=[!0]),p[p.length-1]})}),B(K,"$nothing",C("nothing")),B(q,"$initialize",function(l){var k=this;return null==l&&(l=y),k.text=l,k.rands=y,k.detailed_rands=y,k.secret=!1,k.success=!1,k.failure=!1,k.critical=!1,k.fumble=!1},-1),q.$attr_accessor("text","rands","detailed_rands"),q.$attr_writer("secret","success","failure","critical","fumble"),B(q,"$secret?",d("secret")),B(q,"$success?",d("success")),B(q,"$failure?",d("failure")),B(q,"$critical?",d("critical")),B(q,"$fumble?",d("fumble")),B(q,"$condition=",function(l){return this.success=l,this.failure=l["$!"]()})},Opal.modules["racc/parser"]=function(e){var M,R,b,Y=e.module,W=e.klass,c=e.truthy,B=e.const_set,C=e.defs,d=e.gvars,H=e.rb_lt,y=e.def,P=e.to_ary,F=e.send,z=e.neqeq,Z=e.rb_plus,G=e.eqeq,j=e.rb_ge,A=e.rb_gt,q=e.rb_minus,u=e.rb_le,K=e.rb_times,l=e.assign_ivar_val,_=[],L=e.$r(_),r=e.nil,n=e.$$$;return M=_,R=[Y(_[0],"Racc")].concat(M),b=e.$r(R),W(R[0],b("StandardError"),"ParseError"),c(n("::","ParseError","skip_raise")?"constant":r)||B(_[0],"ParseError",n(L("Racc"),"ParseError")),function(p,M){var $,o,f,D,s,b=[Y(p,"Racc")].concat(M),E=e.$r(b);return c(E("Racc_No_Extensions","skip_raise")?"constant":r)||B(b[0],"Racc_No_Extensions",!1),$=b,f=[o=W(b[0],null,"Parser")].concat($),D=e.$r(f),(s=o.$$prototype).yydebug=s.racc_debug_out=s.racc_error_status=s.racc_t=s.racc_vstack=s.racc_val=s.racc_state=s.racc_tstack=r,B(f[0],"Racc_Runtime_Version","1.4.6"),B(f[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),B(f[0],"Racc_Runtime_Core_Version_R","1.4.6"),B(f[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),B(f[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),B(f[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),B(f[0],"Racc_Runtime_Core_Version",D("Racc_Runtime_Core_Version_R")),B(f[0],"Racc_Runtime_Core_Revision",D("Racc_Runtime_Core_Revision_R")),B(f[0],"Racc_Runtime_Type","ruby"),C(D("Parser"),"$racc_runtime_type",function(){return D("Racc_Runtime_Type")}),y(o,"$_racc_setup",function(){var t,T,i=this,v=r,a=r;return null==d.stderr&&(d.stderr=r),c(n(i.$class(),"Racc_debug_parser"))||(i.yydebug=!1),c(null!=(t=i.yydebug)&&t!==r?"instance-variable":r)||(i.yydebug=!1),c(i.yydebug)&&(c(null!=(T=i.racc_debug_out)&&T!==r?"instance-variable":r)||(i.racc_debug_out=d.stderr),i.racc_debug_out=c(v=i.racc_debug_out)?v:d.stderr),a=n(i.$class(),"Racc_arg"),c(H(a.$size(),14))&&a["$[]="](13,!0),a}),y(o,"$_racc_init_sysvars",function(){var t=this;return t.racc_state=[0],t.racc_tstack=[],t.racc_vstack=[],t.racc_t=r,t.racc_val=r,t.racc_read_next=!0,t.racc_user_yyerror=!1,t.racc_error_status=0}),y(o,"$do_parse",function(){return this.$__send__(D("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)}),y(o,"$next_token",function(){return this.$raise(D("NotImplementedError"),this.$class()+"#next_token is not defined")}),y(o,"$_racc_do_parse_rb",function(t,T){var i,a=this,X=r,te=r,O=r,ue=r,ce=r,se=r,_e=r,ae=r;return i=P(t),X=null==i[0]?r:i[0],te=null==i[1]?r:i[1],O=null==i[2]?r:i[2],ue=null==i[3]?r:i[3],ce=null==i[10]?r:i[10],a.$_racc_init_sysvars(),se=_e=ae=r,F(a,"catch",["racc_end_parse"],function ee(){var I,V,x=null==ee.$$s?this:ee.$$s,S=r;for(null==x.racc_state&&(x.racc_state=r),null==x.racc_read_next&&(x.racc_read_next=r),null==x.racc_t&&(x.racc_t=r),null==x.yydebug&&(x.yydebug=r),null==x.racc_val&&(x.racc_val=r);c(!0);)for(c(ae=ue["$[]"](x.racc_state["$[]"](-1)))?(c(x.racc_read_next)&&z(x.racc_t,0)&&(V=x.$next_token(),I=P(V),se=null==I[0]?r:I[0],x.racc_val=null==I[1]?r:I[1],x.racc_t=c(se)?c(S=ce["$[]"](se))?S:1:0,c(x.yydebug)&&x.$racc_read_token(x.racc_t,se,x.racc_val),x.racc_read_next=!1),ae=Z(ae,x.racc_t),c(j(ae,0))&&c(_e=X["$[]"](ae))&&G(te["$[]"](ae),x.racc_state["$[]"](-1))||(_e=O["$[]"](x.racc_state["$[]"](-1)))):_e=O["$[]"](x.racc_state["$[]"](-1));c(_e=x.$_racc_evalact(_e,t)););},{$$s:a})}),y(o,"$yyparse",function(t,T){return this.$__send__(D("Racc_YY_Parse_Method"),t,T,this.$_racc_setup(),!0)}),y(o,"$_racc_yyparse_rb",function(t,T,i,v){var a,O=r,ue=r,$e=r,ce=r,_e=r,ae=r,ee=r;return a=P(i),O=null==a[0]?r:a[0],ue=null==a[1]?r:a[1],$e=null==a[2]?r:a[2],ce=null==a[3]?r:a[3],_e=null==a[10]?r:a[10],this.$_racc_init_sysvars(),ae=r,ee=r,F(this,"catch",["racc_end_parse"],function I(){var V=null==I.$$s?this:I.$$s;for(null==V.racc_state&&(V.racc_state=r);!c(ee=ce["$[]"](V.racc_state["$[]"](-1)));)for(;c(ae=V.$_racc_evalact($e["$[]"](V.racc_state["$[]"](-1)),i)););return F(t,"__send__",[T],function x(S,re){var w=null==x.$$s?this:x.$$s,U=r,J=r;for(null==w.racc_t&&(w.racc_t=r),null==w.racc_state&&(w.racc_state=r),null==w.racc_read_next&&(w.racc_read_next=r),null==S&&(S=r),null==re&&(re=r),w.racc_t=c(S)?c(U=_e["$[]"](S))?U:1:0,w.racc_val=re,w.racc_read_next=!1,ee=Z(ee,w.racc_t),c(j(ee,0))&&c(ae=O["$[]"](ee))&&G(ue["$[]"](ee),w.racc_state["$[]"](-1))||(ae=$e["$[]"](w.racc_state["$[]"](-1)));c(ae=w.$_racc_evalact(ae,i)););for(;c(c(U=c(J=(ee=ce["$[]"](w.racc_state["$[]"](-1)))["$!"]())?J:w.racc_read_next["$!"]())?U:w.racc_t["$=="](0));)for(c(ee)&&c(ee=Z(ee,w.racc_t))&&c(j(ee,0))&&c(ae=O["$[]"](ee))&&G(ue["$[]"](ee),w.racc_state["$[]"](-1))||(ae=$e["$[]"](w.racc_state["$[]"](-1)));c(ae=w.$_racc_evalact(ae,i)););},{$$s:V})},{$$s:this})}),y(o,"$_racc_evalact",function(t,T){var i,$e,a=this,X=r,te=r,ue=r,ce=r,se=r,_e=r;if(X=null==(i=P(T))[0]?r:i[0],te=null==i[1]?r:i[1],ue=null==i[3]?r:i[3],$e=null==i[11]?r:i[11],ce=null==i[12]?r:i[12],c(A(t,0))&&c(H(t,$e)))c(A(a.racc_error_status,0))&&(G(a.racc_t,1)||(a.racc_error_status=q(a.racc_error_status,1))),a.racc_vstack.$push(a.racc_val),a.racc_state.$push(t),a.racc_read_next=!0,c(a.yydebug)&&(a.racc_tstack.$push(a.racc_t),a.$racc_shift(a.racc_t,a.racc_tstack,a.racc_vstack));else if(c(H(t,0))&&c(A(t,ce["$-@"]()))){if(se=F(a,"catch",["racc_jump"],function ae(){var ee=null==ae.$$s?this:ae.$$s;return null==ee.racc_state&&(ee.racc_state=r),ee.racc_state.$push(ee.$_racc_do_reduce(T,t)),!1},{$$s:a}),c(se))switch(se){case 1:return a.racc_user_yyerror=!0,ce["$-@"]();case 2:return $e;default:a.$raise("[Racc Bug] unknown jump code")}}else if(G(t,$e))c(a.yydebug)&&a.$racc_accept(),a.$throw("racc_end_parse",a.racc_vstack["$[]"](0));else{if(G(t,ce["$-@"]())){switch(a.racc_error_status){case 0:c(T["$[]"](21))||a.$on_error(a.racc_t,a.racc_val,a.racc_vstack);break;case 3:G(a.racc_t,0)&&a.$throw("racc_end_parse",r),a.racc_read_next=!0}for(a.racc_user_yyerror=!1,a.racc_error_status=3;c(!0)&&!(c(_e=ue["$[]"](a.racc_state["$[]"](-1)))&&(_e=Z(_e,1),c(j(_e,0))&&c(t=X["$[]"](_e))&&G(te["$[]"](_e),a.racc_state["$[]"](-1))));)c(u(a.racc_state.$size(),1))&&a.$throw("racc_end_parse",r),a.racc_state.$pop(),a.racc_vstack.$pop(),c(a.yydebug)&&(a.racc_tstack.$pop(),a.$racc_e_pop(a.racc_state,a.racc_tstack,a.racc_vstack));return t}a.$raise("[Racc Bug] unknown action "+t.$inspect())}return c(a.yydebug)&&a.$racc_next_state(a.racc_state["$[]"](-1),a.racc_state),r}),y(o,"$_racc_do_reduce",function(t,T){var i,ce,_e,S,re,w,Q,a=this,te=r,O=r,ue=r,$e=r,se=r,ae=r,ee=r,I=r,V=r,x=r,U=r,J=r,ne=r;return te=null==(i=P(t))[4]?r:i[4],O=null==i[5]?r:i[5],ue=null==i[6]?r:i[6],$e=null==i[7]?r:i[7],ce=null==i[8]?r:i[8],se=null==i[9]?r:i[9],_e=null==i[13]?r:i[13],ae=a.racc_state,ee=a.racc_vstack,I=a.racc_tstack,V=K(T,-3),x=se["$[]"](V),S=se["$[]"](Z(V,1)),re=se["$[]"](Z(V,2)),w=[],c(a.yydebug)&&(U=I["$[]"](x["$-@"](),x)),J=ee["$[]"](x["$-@"](),x),c(a.yydebug)&&I["$[]="](x["$-@"](),x,w),ee["$[]="](x["$-@"](),x,w),ae["$[]="](x["$-@"](),x,w),c(_e)?ee.$push(a.$__send__(re,J,ee,J["$[]"](0))):ee.$push(a.$__send__(re,J,ee)),I.$push(S),c(a.yydebug)&&a.$racc_reduce(U,S,I,ee),Q=q(S,ce),c(V=$e["$[]"](Q))&&(V=Z(V,ae["$[]"](-1)),c(j(V,0))&&c(ne=te["$[]"](V))&&G(O["$[]"](V),Q))?ne:ue["$[]"](Q)}),y(o,"$on_error",function(t,T,i){var a,v=this;return v.$raise(D("ParseError"),v.$sprintf("\nparse error on value %s (%s)",T.$inspect(),c(a=v.$token_to_str(t))?a:"?"))}),y(o,"$yyerror",function(){return this.$throw("racc_jump",1)}),y(o,"$yyaccept",function(){return this.$throw("racc_jump",2)}),y(o,"$yyerrok",l("racc_error_status",0)),y(o,"$racc_read_token",function(t,T,i){var v=this;return v.racc_debug_out.$print("read    "),v.racc_debug_out.$print(T.$inspect(),"(",v.$racc_token2str(t),") "),v.racc_debug_out.$puts(i.$inspect()),v.racc_debug_out.$puts()}),y(o,"$racc_shift",function(t,T,i){var v=this;return v.racc_debug_out.$puts("shift   "+v.$racc_token2str(t)),v.$racc_print_stacks(T,i),v.racc_debug_out.$puts()}),y(o,"$racc_reduce",function(t,T,i,v){var a=this,X=r;return(X=a.racc_debug_out).$print("reduce "),c(t["$empty?"]())?X.$print(" <none>"):F(t,"each",[],function te(O){return null==O&&(O=r),X.$print(" ",(null==te.$$s?this:te.$$s).$racc_token2str(O))},{$$s:a}),X.$puts(" --\x3e "+a.$racc_token2str(T)),a.$racc_print_stacks(i,v),a.racc_debug_out.$puts()}),y(o,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()}),y(o,"$racc_e_pop",function(t,T,i){var v=this;return v.racc_debug_out.$puts("error recovering mode: pop token"),v.$racc_print_states(t),v.$racc_print_stacks(T,i),v.racc_debug_out.$puts()}),y(o,"$racc_next_state",function(t,T){var i=this;return i.racc_debug_out.$puts("goto    "+t),i.$racc_print_states(T),i.racc_debug_out.$puts()}),y(o,"$racc_print_stacks",function(t,T){var v=r;return(v=this.racc_debug_out).$print("        ["),F(t,"each_index",[],function a(X){return null==X&&(X=r),v.$print(" (",(null==a.$$s?this:a.$$s).$racc_token2str(t["$[]"](X))," ",T["$[]"](X).$inspect(),")")},{$$s:this}),v.$puts(" ]")}),y(o,"$racc_print_states",function(t){var i=r;return(i=this.racc_debug_out).$print("        ["),F(t,"each",[],function(a){return null==a&&(a=r),i.$print(" ",a)}),i.$puts(" ]")}),y(o,"$racc_token2str",function(t){var i;return c(i=n(this.$class(),"Racc_token_to_s_table")["$[]"](t))?i:this.$raise("[Racc Bug] can't convert token "+t+" to string")}),y(o,"$token_to_str",function(t){return n(this.$class(),"Racc_token_to_s_table")["$[]"](t)})}(_[0],_)},Opal.modules["bcdice/arithmetic/node"]=function(e){var l,r,N,$,o,b,E,p,_,Y=e.module,W=e.klass,c=e.def,B=e.thrower,C=e.return_ivar,d=e.send2,H=e.find_super,y=e.eqeq,P=e.const_set,F=e.eqeqeq,z=e.rb_divide,Z=e.truthy,G=e.assign_ivar,j=e.alias,A=[],q=e.nil,u=e.$$$;return l=A,r=_=[Y(A[0],"BCDice")].concat(l),N=p=[Y(_[0],"Arithmetic")].concat(r),b=[Y(p[0],"Node")].concat(N),E=e.$r(b),(o=($=W(b[0],null,"BinaryOp")).$$prototype).lhs=o.rhs=o.op=q,c($,"$initialize",function(D,s,m){var t=this;return t.lhs=D,t.op=s,t.rhs=m}),c($,"$eval",function(D){try{B("eval_return");var T,m=this,t=q;return t=m.lhs.$eval(D),T=m.rhs.$eval(D),t.$send(m.op,T)}catch(i){if(i===e.t_eval_return)return i.$v;throw i}}),c($,"$output",function(){var D=this;return""+D.lhs.$output()+D.op+D.rhs.$output()}),c($,"$s_exp",function(){var D=this;return"("+D.$op_for_s_exp()+" "+D.lhs.$s_exp()+" "+D.rhs.$s_exp()+")"}),c($,"$op_for_s_exp",C("op")),function(h,g,$){var o=W(h,g,"DivideBase"),f=[o].concat($),D=e.$r(f),s=o.$$prototype;s.lhs=s.rhs=s.op=q,c(o,"$initialize",function m(t,T){return m.$$p=null,d(this,H(this,"initialize",m,!1,!0),"initialize",[t,"/",T],null)}),c(o,"$eval",function(t){try{B("eval_return");var v,a,i=this;return v=i.lhs.$eval(t),a=i.rhs.$eval(t),y(a,0)&&i.$raise(D("ZeroDivisionError")),i.$divide_and_round(v,a,t)}catch(X){if(X===e.t_eval_return)return X.$v;throw X}}),c(o,"$output",function m(){var t=m.$$p||q,T=this;return m.$$p=null,""+d(T,H(T,"output",m,!1,!0),"output",[],t)+T.$rounding_method()}),o.$private(),c(o,"$rounding_method",function(){return u(this.$class(),"ROUNDING_METHOD")}),c(o,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()}),c(o,"$divide_and_round",function(t,T,i){return this.$raise(D("NotImplementedError"))})}(b[0],E("BinaryOp"),b),function(h,g,$){var o=W(h,g,"DivideWithGameSystemDefault"),f=[o].concat($),D=e.$r(f);P(f[0],"ROUNDING_METHOD",""),o.$private(),c(o,"$divide_and_round",function(m,t,T){var i,v=q;return F(u(D("RoundType"),"CEIL"),i=T)?z(m.$to_f(),t).$ceil():F(u(D("RoundType"),"ROUND"),i)?(v=z(m.$to_f(),t),Z(v["$negative?"]())?v.$abs().$round()["$-@"]():v.$round()):z(m,t).$floor()})}(b[0],E("DivideBase"),b),function(h,g,$){var o=W(h,g,"DivideWithCeil"),f=[o].concat($);P(f[0],"ROUNDING_METHOD","C"),o.$private(),c(o,"$divide_and_round",function(s,m,t){return z(s.$to_f(),m).$ceil()})}(b[0],E("DivideBase"),b),function(h,g,$){var o=W(h,g,"DivideWithRound"),f=[o].concat($);P(f[0],"ROUNDING_METHOD","R"),o.$private(),c(o,"$divide_and_round",function(s,m,t){var T=q;return T=z(s.$to_f(),m),Z(T["$negative?"]())?T.$abs().$round()["$-@"]():T.$round()})}(b[0],E("DivideBase"),b),function(h,g,$){var o=W(h,g,"DivideWithFloor"),f=[o].concat($);P(f[0],"ROUNDING_METHOD","F"),o.$private(),c(o,"$divide_and_round",function(s,m,t){return z(s,m).$floor()})}(b[0],E("DivideBase"),b),function(h,g){var $=W(h,null,"Negative");$.$$prototype.body=q,c($,"$initialize",G("body")),c($,"$eval",function(D){try{return B("eval_return"),this.body.$eval(D)["$-@"]()}catch(t){if(t===e.t_eval_return)return t.$v;throw t}}),c($,"$output",function(){return"-"+this.body.$output()}),c($,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"})}(b[0]),function(h,g){var $=W(h,null,"Parenthesis");$.$$prototype.expr=q,c($,"$initialize",G("expr")),c($,"$eval",function(D){try{return B("eval_return"),this.expr.$eval(D)}catch(t){if(t===e.t_eval_return)return t.$v;throw t}}),c($,"$output",function(){return"("+this.expr.$output()+")"}),c($,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"})}(b[0]),function(h,g){var $=W(h,null,"Number");return $.$$prototype.value=q,c($,"$initialize",G("value")),c($,"$eval",C("value")),c($,"$output",function(){return this.value.$to_s()}),j($,"s_exp","output")}(b[0])},Opal.modules.strscan=function(e){var G,j,A,q,u,W=e.def,c=e.truthy,B=e.eqeqeq,C=e.Opal,d=e.return_ivar,H=e.send,y=e.alias,P=[],F=e.nil;return G=P,A=[j=(0,e.klass)(P[0],null,"StringScanner")].concat(G),q=e.$r(A),(u=j.$$prototype).pos=u.string=u.working=u.matched=u.prev_pos=u.match=F,j.$attr_reader("pos","matched"),W(j,"$initialize",function(l){var k=this;return k.string=l,k.pos=0,k.matched=F,k.working=l,k.match=[]}),j.$attr_reader("string"),W(j,"$beginning_of_line?",function(){var l=this;return 0===l.pos||"\n"===l.string.charAt(l.pos-1)}),W(j,"$scan",function(l){var k=this,_=(l=k.$anchor(l)).exec(k.working);return null==_?k.matched=F:(k.prev_pos=k.pos,k.pos+=_[0].length,k.working=k.working.substring(_[0].length),k.matched=_[0],k.match=_,_[0])}),W(j,"$scan_until",function(l){var k=this;l=k.$anchor(l);for(var _=k.working,L=0;_.length!=L;++L){var r=l.exec(_.substr(L));if(null!==r){var n=L+r[0].length,p=_.substr(0,n);return k.matched=r[0],k.match=r,k.prev_pos=k.pos+L,k.pos+=n,k.working=_.substr(n),p}}return k.matched=F}),W(j,"$[]",function(l){var _;if(c(this.match["$empty?"]()))return F;B(q("Symbol"),_=l)?l=l.$to_s():B(q("String"),_)||(l=C["$coerce_to!"](l,q("Integer"),"to_int"));var L=this.match;return l<0&&(l+=L.length),l<0||l>=L.length||null==L[l]?F:L[l]}),W(j,"$check",function(l){var k=this,_=(l=k.$anchor(l)).exec(k.working);return k.matched=null==_?F:_[0]}),W(j,"$check_until",function(l){var k=this,_=k.prev_pos,L=k.pos,r=k.working,n=k.$scan_until(l);return k.prev_pos=_,k.pos=L,k.working=r,n}),W(j,"$peek",function(l){return this.working.substring(0,l)}),W(j,"$eos?",function(){return 0===this.working.length}),W(j,"$exist?",function(l){var _=l.exec(this.working);return null==_?F:0==_.index?0:_.index+1}),W(j,"$skip",function(l){var k=this,_=(l=k.$anchor(l)).exec(k.working);if(null==_)return k.match=[],k.matched=F;var L=_[0],r=L.length;return k.matched=L,k.match=_,k.prev_pos=k.pos,k.pos+=r,k.working=k.working.substring(r),r}),W(j,"$skip_until",function(l){var _=this.$scan_until(l);return _===F?F:(this.matched=_.substr(-1),_.length)}),W(j,"$get_byte",function(){var l=this,k=F;return l.pos<l.string.length?(l.prev_pos=l.pos,l.pos+=1,k=l.matched=l.working.substring(0,1),l.working=l.working.substring(1)):l.matched=F,k}),W(j,"$match?",function(l){var k=this,_=(l=k.$anchor(l)).exec(k.working);return null==_?F:(k.prev_pos=k.pos,_[0].length)}),W(j,"$pos=",function(l){var k=this;return l<0&&(l+=k.string.$length()),k.pos=l,k.working=k.string.slice(l)}),W(j,"$matched_size",function(){return this.matched===F?F:this.matched.length}),W(j,"$post_match",function(){var l=this;return l.matched===F?F:l.string.substr(l.pos)}),W(j,"$pre_match",function(){var l=this;return l.matched===F?F:l.string.substr(0,l.prev_pos)}),W(j,"$reset",function(){var l=this;return l.working=l.string,l.matched=F,l.pos=0}),W(j,"$rest",d("working")),W(j,"$rest?",function(){return 0!==this.working.length}),W(j,"$rest_size",function(){return this.$rest().$size()}),W(j,"$terminate",function(){var l,k=this;return k.match=F,l=[k.string.$length()],H(k,"pos=",l),l[l.length-1]}),W(j,"$unscan",function(){var l=this;return l.pos=l.prev_pos,l.prev_pos=F,l.match=F,l}),y(j,"bol?","beginning_of_line?"),y(j,"getch","get_byte"),j.$private(),W(j,"$anchor",function(l){var k=l.toString().match(/\/([^\/]+)$/);return k=k?k[1]:void 0,new RegExp("^(?:"+l.source+")",k)})},Opal.modules["bcdice/normalize"]=function(e){var y,Z,F,Y=e.module,W=e.eqeqeq,c=e.def,B=e.eqeq,C=[],d=e.nil;return y=C,F=[Y(C[0],"BCDice")].concat(y),(Z=Y(F[0],"Normalize")).$module_function(),c(Z,"$comparison_operator",function(j){var A;return W(/<=|=</,A=j)?"<=":W(/>=|=>/,A)?">=":W(/<>|!=|=!/,A)?"!=":W(/</,A)?"<":W(/>/,A)?">":W(/=/,A)?"==":d}),c(Z,"$target_number",function(j){return B(j,"?")?j:j.$to_i()})},Opal.modules["bcdice/command/lexer"]=function(e){var G,u,L,r,n,p,M,l,A,Y=e.module,W=e.klass,c=e.const_set,B=e.hash2,C=e.truthy,d=e.send,H=e.def,y=e.thrower,P=e.top,F=[],z=e.nil;return P.$require("strscan"),P.$require("bcdice/normalize"),G=F,u=A=[Y(F[0],"BCDice")].concat(G),L=l=[Y(A[0],"Command")].concat(u),n=[r=W(l[0],null,"Lexer")].concat(L),p=e.$r(n),(M=r.$$prototype).scanner=M.notations=z,c(n[0],"SYMBOLS",B(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),H(r,"$initialize",function(R,b){var E,h,$;return R=C($=(E=(h=R)===z||null==h?z:h.$split(" ",2))===z||null==E?z:E.$first())?$:"",this.scanner=p("StringScanner").$new(R),this.notations=d(b,"map",[],function(f){return null==f&&(f=z),C(f["$is_a?"](p("String")))?p("Regexp").$new(f):f})}),H(r,"$next_token",function(){try{var R=y("return"),b=this,E=z,h=z,$=z,o=z;return C(b.scanner["$eos?"]())?[!1,"$"]:(d(b.notations,"each",[],function f(D){var m,s=null==f.$$s?this:f.$$s;if(null==s.scanner&&(s.scanner=z),null==D&&(D=z),m=s.scanner.$scan(D),!C(m))return z;R.$throw(["NOTATION",m])},{$$s:b,$$ret:R}),C(E=b.scanner.$scan(/\d+/))?["NUMBER",E.$to_i()]:C(h=b.scanner.$scan(/[<>!=]+/))?(h=p("Normalize").$comparison_operator(h),[C(h)?"CMP_OP":"ILLEGAL",h]):($=b.scanner.$getch().$upcase(),[C(o=p("SYMBOLS")["$[]"]($))?o:$.$to_sym(),$]))}catch(f){if(f===R)return f.$v;throw f}}),H(r,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/command/parsed"]=function(e){var P,G,K,l,k,_,L,A,z,Y=e.module,W=e.klass,c=e.def,B=e.return_ivar,C=e.truthy,d=[],H=e.nil;return P=d,G=z=[Y(d[0],"BCDice")].concat(P),K=A=[Y(z[0],"Command")].concat(G),k=[l=W(A[0],null,"Parsed")].concat(K),_=e.$r(k),(L=l.$$prototype).critical=L.fumble=L.dollar=L.modify_number=L.question_target=L.target_number=L.prefix_number=L.command=L.suffix_number=L.cmp_op=H,l.$attr_accessor("command"),l.$attr_accessor("prefix_number"),l.$attr_accessor("suffix_number"),l.$attr_accessor("critical"),l.$attr_accessor("fumble"),l.$attr_accessor("dollar"),l.$attr_accessor("modify_number"),l.$attr_accessor("cmp_op"),l.$attr_accessor("target_number"),l.$attr_writer("question_target"),c(l,"$initialize",function(){var n=this;return n.prefix_number=H,n.suffix_number=H,n.critical=H,n.fumble=H,n.dollar=H,n.cmp_op=H,n.target_number=H,n.question_target=!1}),c(l,"$question_target?",B("question_target")),c(l,"$to_s",function(n){var p=this,M=H,N=H,R=H,b=H,E=H;switch(null==n&&(n="after_command"),M=C(p.critical)?"@"+p.critical:H,N=C(p.fumble)?"#"+p.fumble:H,R=C(p.dollar)?"$"+p.dollar:H,b=_("Format").$modifier(p.modify_number),E=C(p.question_target)?"?":p.target_number,n){case"after_command":return[p.prefix_number,p.command,p.suffix_number,M,N,R,b,p.cmp_op,E].$join();case"after_modify_number":return[p.prefix_number,p.command,p.suffix_number,b,M,N,R,p.cmp_op,E].$join();case"after_target_number":return[p.prefix_number,p.command,p.suffix_number,b,p.cmp_op,E,M,N,R].$join();default:return H}},-1)},Opal.modules["bcdice/command/parser"]=function(e){var n,R,o,m,t,T,i,v,a,X,te,O,ce,f,D,s,ae,E,h,M,Y=e.klass,W=e.module,c=e.slice,B=e.extract_kwargs,C=e.ensure_kwargs,d=e.get_kwarg,H=e.send2,y=e.find_super,P=e.def,F=e.send,z=e.eqeq,Z=e.thrower,G=e.hash,j=e.const_set,A=e.truthy,q=e.to_ary,u=e.hash2,K=e.top,l=[],k=e.$r(l),_=e.nil,L=e.$$$;return K.$require("racc/parser.rb"),K.$require("bcdice/arithmetic/node"),K.$require("bcdice/command/lexer"),K.$require("bcdice/command/parsed"),Y(L(k("BCDice"),"Command"),L(k("Racc"),"Parser"),"Parser"),n=l,R=M=[W(l[0],"BCDice")].concat(n),E=[W(M[0],"Command")].concat(R),h=e.$r(E),o=E,D=[f=Y(E[0],L(h("Racc"),"Parser"),"Parser")].concat(o),s=e.$r(D),(ae=f.$$prototype).notations=ae.lexer=ae.modifier=ae.suffix_number=ae.prefix_number=ae.need_suffix_number=ae.need_prefix_number=ae.critical=ae.fumble=ae.dollar=ae.allowed_cmp_op=ae.question_target=_,P(f,"$initialize",function ee(I,V){var x,S,re,w,J=this;return ee.$$p=null,x=c(arguments),S=B(x),S=C(S),re=x,w=d(S,"round_type"),H(J,y(J,"initialize",ee,!1,!0),"initialize",[],null),J.notations=re,J.round_type=w,J.prefix_number=!1,J.suffix_number=!1,J.need_prefix_number=!1,J.need_suffix_number=!1,J.modifier=!0,J.critical=!1,J.fumble=!1,J.dollar=!1,J.allowed_cmp_op=[_,">=",">","<=","<","==","!="],J.question_target=!1},-2),P(f,"$disable_modifier",function(){return this.modifier=!1,this}),P(f,"$enable_prefix_number",function(){return this.prefix_number=!0,this}),P(f,"$enable_suffix_number",function(){return this.suffix_number=!0,this}),P(f,"$has_prefix_number",function(){var I=this;return I.prefix_number=!0,I.need_prefix_number=!0,I}),P(f,"$has_suffix_number",function(){var I=this;return I.suffix_number=!0,I.need_suffix_number=!0,I}),P(f,"$enable_critical",function(){return this.critical=!0,this}),P(f,"$enable_fumble",function(){return this.fumble=!0,this}),P(f,"$enable_dollar",function(){return this.dollar=!0,this}),P(f,"$restrict_cmp_op_to",function(I){var V,S=this;return V=c(arguments),S.allowed_cmp_op=V,S},-1),P(f,"$enable_question_target",function(){return this.question_target=!0,this}),P(f,"$parse",function(I){var V=this;try{return V.lexer=s("Lexer").$new(I,V.notations),V.$do_parse()}catch(x){if(!e.rescue(x,[s("ParseError"),s("ZeroDivisionError")]))throw x;try{return _}finally{e.pop_exception()}}}),f.$private(),P(f,"$parsed",function(I,V,x,S){try{return Z("eval_return"),F(s("Parsed").$new(),"tap",[],function U(J){var Q,ne,ie,le,fe,oe,de,me=null==U.$$s?this:U.$$s;return null==me.round_type&&(me.round_type=_),null==J&&(J=_),J["$command="](I["$[]"]("command")),J["$prefix_number="]((Q=I["$[]"]("prefix"))===_||null==Q?_:Q.$eval(me.round_type)),J["$suffix_number="]((ne=I["$[]"]("suffix"))===_||null==ne?_:ne.$eval(me.round_type)),J["$critical="]((ie=V["$[]"]("critical"))===_||null==ie?_:ie.$eval(me.round_type)),J["$fumble="]((le=V["$[]"]("fumble"))===_||null==le?_:le.$eval(me.round_type)),J["$dollar="]((fe=V["$[]"]("dollar"))===_||null==fe?_:fe.$eval(me.round_type)),J["$modify_number="](x.$eval(me.round_type)),J["$cmp_op="](S["$[]"]("cmp_op")),z(S["$[]"]("target"),"?")?(J["$question_target="](!0),F(J,"target_number=",oe=[0]),oe[oe.length-1]):(J["$question_target="](!1),oe=[(de=S["$[]"]("target"),de===_||null==de?_:de.$eval(me.round_type))],F(J,"target_number=",oe),oe[oe.length-1])},{$$s:this})}catch(U){if(U===e.t_eval_return)return U.$v;throw U}}),P(f,"$next_token",function(){return this.lexer.$next_token()}),m=e.large_array_unpack("6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,33,34,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,,,17,18,6,,5,,,17,18,,,5,23,24,25,26,56,54,55,57"),t=e.large_array_unpack("0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,,17,15,15,18,18,23,,18,30,30,23,23,24,,23,31,31,24,24,25,,24,44,44,25,25,28,,25,47,47,28,28,29,,28,48,48,29,29,33,,29,49,49,33,33,34,,33,50,50,34,34,36,,34,,,36,36,37,,36,,,37,37,,,37,27,27,27,27,52,52,52,52"),T=e.large_array_unpack("-2,4,16,-3,-1,11,,33,13,35,23,30,1,,28,40,,37,44,,,-2,,51,58,65,0,106,72,79,47,54,,86,93,,100,107,,,,,,,63,,,68,75,82,89,,120,,,,,"),i=e.large_array_unpack("-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29"),v=e.large_array_unpack("30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,,,21,47,48,40,51,52,49,50,44,46,3,,,,13,,,,,,,,32"),a=e.large_array_unpack("8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,,,4,8,8,5,7,7,8,8,9,5,6,,,,6,,,,,,,,6"),X=[_,6,13,3,9,-1,27,-15,-10,-1,-38],te=[_,_,_,_,_,_,19,16,15,_,_],O=e.large_array_unpack("0,0,racc_error,4,20,_reduce_1,4,20,_reduce_2,3,20,_reduce_3,3,21,_reduce_4,2,21,_reduce_5,2,21,_reduce_6,1,21,_reduce_7,0,22,_reduce_8,3,22,_reduce_9,3,22,_reduce_10,3,22,_reduce_11,2,23,_reduce_12,2,23,_reduce_13,3,23,_reduce_14,3,23,_reduce_15,0,24,_reduce_16,2,24,_reduce_17,2,24,_reduce_18,3,28,_reduce_19,3,28,_reduce_20,1,28,_reduce_none,3,27,_reduce_22,4,27,_reduce_23,1,27,_reduce_none,0,29,_reduce_25,1,29,_reduce_26,1,29,_reduce_27,1,29,_reduce_28,1,29,_reduce_29,2,26,_reduce_30,2,26,_reduce_31,1,26,_reduce_none,3,25,_reduce_33,1,25,_reduce_34"),ce=G(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),j(D[0],"Racc_arg",[m,t,i,T,v,a,te,X,19,O,ce,58,35,!0]),j(D[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),j(D[0],"Racc_debug_parser",!1),P(f,"$_reduce_1",function(I,V,x){var S,w=this;return A(w.modifier)||w.$raise(s("ParseError")),S=q(I),w.$parsed(null==S[0]?_:S[0],null==S[1]?_:S[1],null==S[2]?_:S[2],null==S[3]?_:S[3])}),P(f,"$_reduce_2",function(I,V,x){var S,w=this;return A(w.modifier)||w.$raise(s("ParseError")),S=q(I),w.$parsed(null==S[0]?_:S[0],null==S[2]?_:S[2],null==S[1]?_:S[1],null==S[3]?_:S[3])}),P(f,"$_reduce_3",function(I,V,x){var S,Q;return Q=null==(S=q(I))[2]?_:S[2],this.$parsed(null==S[0]?_:S[0],null==S[1]?_:S[1],L(L(s("Arithmetic"),"Node"),"Number").$new(0),Q)}),P(f,"$_reduce_4",function(I,V,x){var S=this;return A(S.prefix_number)&&A(S.suffix_number)||S.$raise(s("ParseError")),u(["command","prefix","suffix"],{command:I["$[]"](1),prefix:I["$[]"](0),suffix:I["$[]"](2)})}),P(f,"$_reduce_5",function(I,V,x){var S=this;return A(S.prefix_number)||S.$raise(s("ParseError")),A(S.need_suffix_number)&&S.$raise(s("ParseError")),u(["command","prefix"],{command:I["$[]"](1),prefix:I["$[]"](0)})}),P(f,"$_reduce_6",function(I,V,x){var S=this;return A(S.suffix_number)||S.$raise(s("ParseError")),A(S.need_prefix_number)&&S.$raise(s("ParseError")),u(["command","suffix"],{command:I["$[]"](0),suffix:I["$[]"](1)})}),P(f,"$_reduce_7",function(I,V,x){var S=this;return(A(S.need_prefix_number)||A(S.need_suffix_number))&&S.$raise(s("ParseError")),u(["command"],{command:I["$[]"](0)})}),P(f,"$_reduce_8",function(I,V,x){return u([],{})}),P(f,"$_reduce_9",function(I,V,x){var S,Q,U=_;return U=null==(S=q(I))[0]?_:S[0],Q=null==S[2]?_:S[2],A(this.critical)&&A(U["$[]"]("critical")["$nil?"]())||this.$raise(s("ParseError")),U["$[]="]("critical",Q),U}),P(f,"$_reduce_10",function(I,V,x){var S,Q,U=_;return U=null==(S=q(I))[0]?_:S[0],Q=null==S[2]?_:S[2],A(this.fumble)&&A(U["$[]"]("fumble")["$nil?"]())||this.$raise(s("ParseError")),U["$[]="]("fumble",Q),U}),P(f,"$_reduce_11",function(I,V,x){var S,Q,U=_;return U=null==(S=q(I))[0]?_:S[0],Q=null==S[2]?_:S[2],A(this.dollar)&&A(U["$[]"]("dollar")["$nil?"]())||this.$raise(s("ParseError")),U["$[]="]("dollar",Q),U}),P(f,"$_reduce_12",function(I,V,x){return I["$[]"](1)}),P(f,"$_reduce_13",function(I,V,x){return L(L(s("Arithmetic"),"Node"),"Negative").$new(I["$[]"](1))}),P(f,"$_reduce_14",function(I,V,x){return L(L(s("Arithmetic"),"Node"),"BinaryOp").$new(I["$[]"](0),"+",I["$[]"](2))}),P(f,"$_reduce_15",function(I,V,x){return L(L(s("Arithmetic"),"Node"),"BinaryOp").$new(I["$[]"](0),"-",I["$[]"](2))}),P(f,"$_reduce_16",function(I,V,x){return A(this.allowed_cmp_op["$include?"](_))||this.$raise(s("ParseError")),u([],{})}),P(f,"$_reduce_17",function(I,V,x){var S,U,J;return J=null==(S=q(I))[1]?_:S[1],A(this.allowed_cmp_op["$include?"](U=null==S[0]?_:S[0]))||this.$raise(s("ParseError")),u(["cmp_op","target"],{cmp_op:U,target:J})}),P(f,"$_reduce_18",function(I,V,x){var re,S=this;return re=I["$[]"](0),A(S.question_target)||S.$raise(s("ParseError")),A(S.allowed_cmp_op["$include?"](re))||S.$raise(s("ParseError")),u(["cmp_op","target"],{cmp_op:re,target:"?"})}),P(f,"$_reduce_19",function(I,V,x){return L(L(s("Arithmetic"),"Node"),"BinaryOp").$new(I["$[]"](0),"+",I["$[]"](2))}),P(f,"$_reduce_20",function(I,V,x){return L(L(s("Arithmetic"),"Node"),"BinaryOp").$new(I["$[]"](0),"-",I["$[]"](2))}),P(f,"$_reduce_22",function(I,V,x){return L(L(s("Arithmetic"),"Node"),"BinaryOp").$new(I["$[]"](0),"*",I["$[]"](2))}),P(f,"$_reduce_23",function(I,V,x){return I["$[]"](3).$new(I["$[]"](0),I["$[]"](2))}),P(f,"$_reduce_25",function(I,V,x){return L(L(s("Arithmetic"),"Node"),"DivideWithGameSystemDefault")}),P(f,"$_reduce_26",function(I,V,x){return L(L(s("Arithmetic"),"Node"),"DivideWithCeil")}),P(f,"$_reduce_27",function(I,V,x){return L(L(s("Arithmetic"),"Node"),"DivideWithCeil")}),P(f,"$_reduce_28",function(I,V,x){return L(L(s("Arithmetic"),"Node"),"DivideWithRound")}),P(f,"$_reduce_29",function(I,V,x){return L(L(s("Arithmetic"),"Node"),"DivideWithFloor")}),P(f,"$_reduce_30",function(I,V,x){return I["$[]"](1)}),P(f,"$_reduce_31",function(I,V,x){return L(L(s("Arithmetic"),"Node"),"Negative").$new(I["$[]"](1))}),P(f,"$_reduce_33",function(I,V,x){return I["$[]"](1)}),P(f,"$_reduce_34",function(I,V,x){return L(L(s("Arithmetic"),"Node"),"Number").$new(I["$[]"](0))}),P(f,"$_reduce_none",function(I,V,x){return I["$[]"](0)})},Opal.modules["bcdice/deprecated/checker"]=function(e){var F,j,K,l,k,_,q,Z,Y=e.module,W=e.send,c=e.eqeqeq,B=e.truthy,C=e.def,d=e.return_val,H=[],y=e.nil;return F=H,j=Z=[Y(H[0],"BCDice")].concat(F),K=q=[Y(Z[0],"Deprecated")].concat(j),k=[l=Y(q[0],"Checker")].concat(K),_=e.$r(k),l.$private(),C(l,"$check_result_legacy",function(r,n,p,M){var E,N=this,R=y,b=y,h=y,g=y;return R=W(n,"map",[],"sides".$to_proc()),E=(b=W(n,"map",[],"value".$to_proc())).$sum(),h=c([100],g=R)?N.$check_1D100(r,E,p,M):c([20],g)?N.$check_1D20(r,E,p,M):c([6,6],g)?N.$check_2D6(r,E,b,p,M):y,(B(h["$nil?"]())||B(h["$empty?"]()))&&(h=c([10],g=R.$uniq())?N.$check_nD10(r,E,b,p,M):c([6],g)?N.$check_nD6(r,E,b,p,M):y,B(h["$nil?"]())||B(h["$empty?"]()))?y:_("Result").$new(h.$delete_prefix(" \uff1e "))}),C(l,"$check_1D100",d(y)),C(l,"$check_1D20",d(y)),C(l,"$check_nD10",d(y)),C(l,"$check_2D6",d(y)),C(l,"$check_nD6",d(y))},Opal.modules["bcdice/base"]=function(e){var k,N,g,s,t,T,$,o,f,D,b,Y=e.module,W=e.klass,c=e.slice,B=e.rb_plus,C=e.truthy,d=e.def,H=e.regexp,y=e.send,P=e.thrower,F=e.return_ivar,z=e.assign_ivar_val,Z=e.eqeqeq,G=e.eqeq,j=e.return_val,A=e.range,q=e.rb_minus,u=e.rb_divide,K=e.rb_times,l=e.rb_ge,_=e.top,L=[],r=e.$r(L),n=e.nil,p=e.$$$;return _.$require("i18n"),_.$require("i18n/backend/fallbacks"),_.$require("bcdice/randomizer"),_.$require("bcdice/dice_table"),_.$require("bcdice/enum"),_.$require("bcdice/translate"),_.$require("bcdice/result"),_.$require("bcdice/command/parser"),_.$require("bcdice/deprecated/checker"),N=L,g=b=[Y(L[0],"BCDice")].concat(N),o=[$=W(b[0],null,"Base")].concat(g),f=e.$r(o),(D=$.$$prototype).raw_input=D.randomizer=D.enabled_upcase_input=D.debug=n,t=[s=e.get_singleton_class($)].concat(o),T=e.$r(t),s.$attr_reader("prefixes"),d(s,"$register_prefix",function(v){var X,te=this,O=n;return null==te.prefixes&&(te.prefixes=n),X=c(arguments),te.prefixes=B(C(O=te.prefixes)?O:[],X.$flatten())},-1),d(s,"$register_prefix_from_super_class",function(){return this.$register_prefix(this.$superclass().$prefixes())}),d(s,"$prefixes_pattern",function(){var v=this,a=n;return null==v.prefixes_pattern&&(v.prefixes_pattern=n),null==v.prefixes&&(v.prefixes=n),v.prefixes_pattern=C(a=v.prefixes_pattern)?a:n,C(v.prefixes_pattern)?v.prefixes_pattern:(v.prefixes=C(a=v.prefixes)?a:[],v.prefixes.$freeze(),v.prefixes_pattern=(C(v.prefixes["$empty?"]())?/(?!)/:H(["^(S)?(",v.prefixes.$join("|"),")"],"i")).$freeze())}),d(s,"$command_pattern",function(){var v=this,a=n,X=n;return null==v.command_pattern&&(v.command_pattern=n),null==v.prefixes&&(v.prefixes=n),v.command_pattern=C(a=v.command_pattern)?a:n,C(v.command_pattern)?v.command_pattern:(v.prefixes=C(a=v.prefixes)?a:[],v.prefixes.$freeze(),X=B(y(p(T("CommonCommand"),"COMMANDS"),"map",[],function(O){return null==O&&(O=n),p(O,"PREFIX_PATTERN").$source()}),v.prefixes),v.command_pattern=H(["^S?(",X.$join("|"),")"],"i").$freeze())}),d(s,"$eval",function(v){try{return P("eval_return"),this.$new(v).$eval()}catch(te){if(te===e.t_eval_return)return te.$v;throw te}}),$.$include(f("Translate")),$.$include(p(f("Deprecated"),"Checker")),d($,"$initialize",function(m){var t=this;return t.raw_input=m,t.sort_add_dice=!1,t.sort_barabara_dice=!1,t.d66_sort_type=p(f("D66SortType"),"NO_SORT"),t.enabled_d9=!1,t.round_type=p(f("RoundType"),"FLOOR"),t.sides_implicit_d=6,t.upper_dice_reroll_threshold=n,t.reroll_dice_reroll_threshold=n,t.default_cmp_op=n,t.default_target_number=n,t.enabled_upcase_input=!0,t.locale="ja_jp",t.randomizer=p(f("BCDice"),"Randomizer").$new(),t.debug=!1}),$.$attr_accessor("randomizer"),$.$attr_reader("d66_sort_type"),$.$attr_reader("round_type"),$.$attr_reader("sides_implicit_d"),$.$attr_reader("upper_dice_reroll_threshold"),$.$attr_reader("reroll_dice_reroll_threshold"),$.$attr_reader("default_cmp_op"),$.$attr_reader("default_target_number"),d($,"$sort_add_dice?",F("sort_add_dice")),d($,"$sort_barabara_dice?",F("sort_barabara_dice")),d($,"$enabled_d9?",F("enabled_d9")),d($,"$enable_debug",z("debug",!0)),d($,"$eval",function(){var t,i,m=this,T=n;return t=p(f("BCDice"),"Preprocessor").$process(m.raw_input,m),T=C(i=m.$dice_command(t))?i:m.$eval_common_command(m.raw_input),C(T)?(T["$rands="](m.randomizer.$rand_results()),T["$detailed_rands="](m.randomizer.$detailed_rand_results()),T):n}),d($,"$change_text",function(m){return m}),d($,"$check_result",function(m,t,T,i){var v=this,a=n,X=n,te=n,O=n,ue=n;return a=v.$check_result_legacy(m,t,T,i),C(a)?a:(X=y(t,"map",[],"sides".$to_proc()),O=(te=y(t,"map",[],"value".$to_proc())).$sum(),a=Z([100],ue=X)?v.$result_1d100(m,O,T,i):Z([20],ue)?v.$result_1d20(m,O,T,i):Z([6,6],ue)?v.$result_2d6(m,O,te,T,i):n,G(a,f("Result").$nothing())?n:C(a)?a:(a=Z([10],ue=X.$uniq())?v.$result_nd10(m,O,te,T,i):Z([6],ue)?v.$result_nd6(m,O,te,T,i):n,G(a,f("Result").$nothing())?n:C(a)?a:v.$result_ndx(m,T,i)))}),d($,"$grich_text",j(n)),$.$private(),d($,"$eval_common_command",function(m){try{P("eval_return");var T=P("return");return m=this.$change_text(m),y(p(f("CommonCommand"),"COMMANDS"),"each",[],function v(a){var te,X=null==v.$$s?this:v.$$s;if(null==X.randomizer&&(X.randomizer=n),null==a&&(a=n),te=a.$eval(m,X,X.randomizer),!C(te))return n;T.$throw(te)},{$$s:this,$$ret:T}),n}catch(v){if(v===e.t_eval_return||v===T)return v.$v;throw v}}),d($,"$dice_command",function(m){var t=this,T=n,i=n,v=n,a=n;return C(t.enabled_upcase_input)&&(m=m.$upcase()),T=t.$class().$prefixes_pattern().$match(m),C(T)?(i=T["$[]"](1)["$nil?"]()["$!"](),C(i)&&(m=m["$[]"](A(1,-1,!1))),v=t.$eval_game_system_specific_command(m),C(v["$is_a?"](f("Result")))?(v["$secret="](C(a=v["$secret?"]())?a:i),v):C(v["$nil?"]())||C(v["$empty?"]())||G(v,"1")?n:y(f("Result").$new(),"tap",[],function(te){var O;return null==te&&(te=n),te["$text="](v.$to_s()),y(te,"secret=",O=[i]),O[O.length-1]})):n}),d($,"$eval_game_system_specific_command",j(n)),d($,"$result_ndx",function(m,t,T){return C(T["$is_a?"](f("String")))?n:C(m.$send(t,T))?f("Result").$success(this.$translate("success")):f("Result").$failure(this.$translate("failure"))}),d($,"$result_1d100",j(n)),d($,"$result_1d20",j(n)),d($,"$result_nd10",j(n)),d($,"$result_2d6",j(n)),d($,"$result_nd6",j(n)),d($,"$get_table_by_2d6",function(m){return this.$get_table_by_nD6(m,2)}),d($,"$get_table_by_1d6",function(m){return this.$get_table_by_nD6(m,1)}),d($,"$get_table_by_nD6",function(m,t){return this.$get_table_by_nDx(m,t,6)}),d($,"$get_table_by_nDx",function(m,t,T){var v,a=n;return v=this.randomizer.$roll_sum(t,T),a=this.$get_table_value(m["$[]"](q(v,t))),C(a["$nil?"]())?["1",0]:[a,v]}),d($,"$get_table_by_1d3",function(m){var i,v,t=this,a=n;return t.$debug("get_table_by_1d3"),i=t.randomizer.$roll_sum(1,6),t.$debug("num",i),v=u(q(i,1),2).$to_i(),t.$debug("index",v),a=m["$[]"](v),C(a["$nil?"]())?["1",0]:[a,i]}),d($,"$get_table_by_d66_swap",function(m){var T;return T=this.randomizer.$roll_d66(p(f("D66SortType"),"ASC")),[this.$get_table_by_number(T,m),T]}),d($,"$get_table_by_d66",function(m){var T,i,v,X,a=n;return T=this.randomizer.$roll_once(6),i=this.randomizer.$roll_once(6),v=B(K(q(T,1),6),q(i,1)),a=m["$[]"](v),X=""+T+i,C(a["$nil?"]())?["1",X]:[a,X]}),d($,"$get_table_by_number",function(m,t,T){try{var i=P("return");return null==T&&(T="1"),y(t,"each",[],function a(X){var O,te=null==a.$$s?this:a.$$s;if(null==X&&(X=n),O=X["$[]"](0),!C(l(O,m)))return n;i.$throw(te.$get_table_value(X["$[]"](1)))},{$$s:this,$$ret:i}),this.$get_table_value(T)}catch(a){if(a===i)return a.$v;throw a}},-3),d($,"$get_table_value",function(m){return C(m["$is_a?"](f("Proc")))?m.$call():m}),d($,"$roll_tables",function(m,t){var i=n;return i=t["$[]"](m),C(i)?i.$roll(this.randomizer).$to_s():n}),d($,"$debug",function(m,t){var i,v=this,a=n,X=n;return i=c(arguments,1),C(v.debug)?(a=C(m["$is_a?"](f("String")))?m:m.$inspect(),C(i["$empty?"]())?v.$warn(a):(X=y(i,"map",[],function(O){return null==O&&(O=n),C(O["$is_a?"](f("String")))?'"'+O+'"':O.$inspect()}),v.$warn(a+": "+X.$join(", ")))):n},-2),p(p(r("I18n"),"Backend"),"Simple").$include(p(p(r("I18n"),"Backend"),"Fallbacks")),r("I18n").$load_path()["$<<"](r("Dir")["$[]"](r("File").$join("bcdice","../../i18n/**/*.yml"))),r("I18n")["$default_locale="]("ja_jp"),k=[["ja_jp"]],y(r("I18n").$fallbacks(),"defaults=",k),k[k.length-1]},Opal.modules["bcdice/game_system/sword_world/rating_lexer"]=function(e){var z,A,_,M,N,R,b,r,u,K,G,Y=e.module,W=e.klass,c=e.const_set,B=e.hash2,C=e.truthy,d=e.def,y=[],P=e.nil;return e.top.$require("strscan"),z=y,A=G=[Y(y[0],"BCDice")].concat(z),u=[Y(G[0],"GameSystem")].concat(A),K=e.$r(u),_=u,M=r=[W(u[0],K("Base"),"SwordWorld")].concat(_),R=[N=W(r[0],null,"RatingLexer")].concat(M),b=e.$r(R),N.$$prototype.scanner=P,c(R[0],"SYMBOLS",B(["+","-","*","/","(",")","[","]","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","[":"BRACKETL","]":"BRACKETR","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),d(N,"$initialize",function(g){var $,o,D;return g=C(D=($=(o=g)===P||null==o?P:o.$split(" ",2))===P||null==$?P:$.$first())?D:"",this.scanner=b("StringScanner").$new(g)}),d(N,"$next_token",function(){var g=this,$=P,o=P,D=P;return C(g.scanner["$eos?"]())?[!1,"$"]:C($=g.scanner.$scan(/\d+/))?["NUMBER",$.$to_i()]:(o=g.scanner.$getch().$upcase(),[C(D=b("SYMBOLS")["$[]"](o))?D:o.$to_sym(),o])}),d(N,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/game_system/sword_world/rating_parsed"]=function(e){var Z,q,L,N,R,b,E,h,n,K,l,j,Y=e.module,W=e.klass,c=e.def,B=e.truthy,C=e.rb_le,d=e.rb_plus,H=e.rb_lt,y=e.neqeq,P=[],F=e.nil;return Z=P,q=j=[Y(P[0],"BCDice")].concat(Z),K=[Y(j[0],"GameSystem")].concat(q),l=e.$r(K),L=K,N=n=[W(K[0],l("Base"),"SwordWorld")].concat(L),b=[R=W(n[0],null,"RatingParsed")].concat(N),E=e.$r(b),(h=R.$$prototype).modifier_after_half=h.semi_fixed_val=h.kept_modify=h.rate=h.greatest_fortune=h.modifier=F,R.$attr_accessor("rate"),R.$attr_accessor("critical"),R.$attr_accessor("kept_modify"),R.$attr_accessor("first_to"),R.$attr_accessor("first_modify"),R.$attr_accessor("rateup"),R.$attr_accessor("greatest_fortune"),R.$attr_accessor("semi_fixed_val"),R.$attr_accessor("tmp_fixed_val"),R.$attr_accessor("modifier"),R.$attr_accessor("modifier_after_half"),c(R,"$initialize",function($,o){var f=this;return f.rate=$,f.modifier=o,f.critical=13,f.kept_modify=0,f.first_to=0,f.first_modify=0,f.greatest_fortune=!1,f.rateup=0,f.semi_fixed_val=0,f.tmp_fixed_val=0,f.modifier_after_half=F}),c(R,"$half",function(){return this.modifier_after_half["$nil?"]()["$!"]()}),c(R,"$min_critical",function(){var $=this;return B(C($.semi_fixed_val,1))?3:d(d($.semi_fixed_val,$.kept_modify),2).$clamp(3,13)}),c(R,"$infinite_roll?",function(){return H(this.$critical(),this.$min_critical())}),c(R,"$to_s",function(){var $=this,o=F;return o="KeyNo."+$.rate,B(H($.$critical(),13))&&(o=d(o,"c["+$.$critical()+"]")),y($.$first_modify(),0)&&(o=d(o,"m["+E("Format").$modifier($.$first_modify())+"]")),y($.$first_to(),0)&&(o=d(o,"m["+$.$first_to()+"]")),y($.$rateup(),0)&&(o=d(o,"r["+$.$rateup()+"]")),B($.greatest_fortune)&&(o=d(o,"gf")),y($.$semi_fixed_val(),0)&&(o=d(o,"sf["+$.$semi_fixed_val()+"]")),y($.$tmp_fixed_val(),0)&&(o=d(o,"tf["+$.$tmp_fixed_val()+"]")),y($.$kept_modify(),0)&&(o=d(o,"a["+E("Format").$modifier($.$kept_modify())+"]")),y($.modifier,0)&&(o=d(o,E("Format").$modifier($.modifier))),o})},Opal.modules["bcdice/game_system/sword_world/rating_options"]=function(e){var y,Z,K,r,k,j,A,F,Y=e.module,W=e.klass,c=e.truthy,B=e.def,C=[];return y=C,Z=F=[Y(C[0],"BCDice")].concat(y),j=[Y(F[0],"GameSystem")].concat(Z),A=e.$r(j),K=j,k=[W(j[0],A("Base"),"SwordWorld")].concat(K),(r=W(k[0],null,"RatingOptions")).$attr_accessor("critical"),r.$attr_accessor("kept_modify"),r.$attr_accessor("first_to"),r.$attr_accessor("first_modify"),r.$attr_accessor("rateup"),r.$attr_accessor("greatest_fortune"),r.$attr_accessor("semi_fixed_val"),r.$attr_accessor("tmp_fixed_val"),r.$attr_accessor("modifier"),r.$attr_accessor("modifier_after_half"),B(r,"$settable_first_roll_adjust_option?",function(){var M;return c(M=this.$first_modify()["$nil?"]())?this.$first_to()["$nil?"]():M}),B(r,"$settable_non_2d_roll_option?",function(){var M,N,p=this;return c(M=c(N=p.$greatest_fortune()["$nil?"]())?p.$semi_fixed_val()["$nil?"]():N)?p.$tmp_fixed_val()["$nil?"]():M})},Opal.modules["bcdice/game_system/sword_world/rating_parser"]=function(e){var k,n,E,D,T,i,v,a,X,te,O,ue,$e,_e,s,m,t,I,g,$,M,N,L,Y=e.module,W=e.klass,c=e.ensure_kwargs,B=e.send2,C=e.find_super,d=e.def,H=e.send,y=e.truthy,P=e.not,F=e.thrower,z=e.hash,Z=e.const_set,G=e.to_ary,j=e.eqeq,A=e.top,q=[],u=e.nil,K=e.$$$;return A.$require("racc/parser.rb"),A.$require("bcdice/arithmetic/node"),A.$require("bcdice/enum"),A.$require("bcdice/game_system/sword_world/rating_lexer"),A.$require("bcdice/game_system/sword_world/rating_parsed"),A.$require("bcdice/game_system/sword_world/rating_options"),k=q,n=L=[Y(q[0],"BCDice")].concat(k),M=[Y(L[0],"GameSystem")].concat(n),N=e.$r(M),E=M,g=[W(M[0],N("Base"),"SwordWorld")].concat(E),$=e.$r(g),D=g,m=[s=W(g[0],K($("Racc"),"Parser"),"RatingParser")].concat(D),t=e.$r(m),(I=s.$$prototype).lexer=I.round_type=I.version=u,d(s,"$initialize",function V(x){var S,re,U=this;return V.$$p=null,null==(S=(x=c(x)).$$smap.version)&&(S="v1_0"),null==(re=x.$$smap.round_type)&&(re=K(t("RoundType"),"CEIL")),B(U,C(U,"initialize",V,!1,!0),"initialize",[],null),U.version=S,U.round_type=re},-1),d(s,"$set_debug",function(){return this.yydebug=!0,this}),d(s,"$parse",function(x){try{return this.lexer=t("RatingLexer").$new(x),this.$do_parse()}catch(re){if(!e.rescue(re,[t("ParseError"),t("ZeroDivisionError")]))throw re;try{return u}finally{e.pop_exception()}}}),s.$private(),d(s,"$parsed",function(x,S,re){try{return F("eval_return"),H(t("RatingParsed").$new(x,S),"tap",[],function J(Q){var ne,ie,le,fe,oe,de,me,be,he=null==J.$$s?this:J.$$s,ve=u;return null==he.round_type&&(he.round_type=u),null==Q&&(Q=u),Q["$kept_modify="](y(ve=(ne=re.$kept_modify())===u||null==ne?u:ne.$eval(he.round_type))?ve:0),Q["$first_to="](y(ve=re.$first_to())?ve:0),Q["$first_modify="](y(ve=re.$first_modify())?ve:0),Q["$rateup="](y(ve=(ie=re.$rateup())===u||null==ie?u:ie.$eval(he.round_type))?ve:0),P(re.$greatest_fortune()["$nil?"]())&&Q["$greatest_fortune="](re.$greatest_fortune()),Q["$semi_fixed_val="](y(ve=(le=re.$semi_fixed_val())===u||null==le?u:le.$clamp(1,6))?ve:0),Q["$tmp_fixed_val="](y(ve=(fe=re.$tmp_fixed_val())===u||null==fe?u:fe.$clamp(1,6))?ve:0),Q["$modifier_after_half="]((oe=re.$modifier_after_half())===u||null==oe?u:oe.$eval(he.round_type)),de=[y((be=re.$critical(),me=be===u||null==be?u:be.$eval(he.round_type),ve=me===u||null==me?u:me.$clamp(0,13)))?ve:y(Q.$half())?13:10],H(Q,"critical=",de),de[de.length-1]},{$$s:this})}catch(J){if(J===e.t_eval_return)return J.$v;throw J}}),d(s,"$next_token",function(){return this.lexer.$next_token()}),T=e.large_array_unpack("15,14,16,5,17,18,20,21,57,58,23,24,11,59,12,19,13,15,14,16,4,17,18,20,21,4,30,3,30,11,8,12,19,13,26,27,26,27,29,30,29,30,55,56,55,56,30,26,27,26,27,29,30,29,26,27,9,30,29,30,26,27,55,56,29,26,27,26,27,29,30,29,30,55,56,55,56,30,26,27,26,27,29,30,29,26,27,37,30,29,30,26,27,55,56,29,26,27,26,27,29,30,29,30,55,56,38,39,32,26,27,26,27,29,46,29,33,34,51,52,53,54"),i=e.large_array_unpack("6,6,6,1,6,6,6,6,49,49,10,10,6,49,6,6,6,22,22,22,3,22,22,22,22,0,11,0,12,22,4,22,22,22,11,11,12,12,11,14,12,15,41,41,43,43,19,14,14,15,15,14,20,15,19,19,5,21,19,23,20,20,44,44,20,21,21,23,23,21,24,23,26,45,45,50,50,27,24,24,26,26,24,29,26,27,27,16,55,27,56,29,29,62,62,29,55,55,56,56,55,57,56,58,63,63,17,18,13,57,57,58,58,57,25,58,13,13,33,34,38,39"),v=e.large_array_unpack("22,3,,17,28,56,-4,,,,0,24,26,106,37,39,80,99,100,44,50,55,13,57,68,97,70,75,,81,,,,116,117,,,,118,119,,30,,32,50,61,,,,-2,63,,,,,86,88,99,101,,,,81,92"),a=e.large_array_unpack("-33,-33,-4,-33,-33,-33,-1,-4,-3,64,-5,-33,-33,-33,-11,-33,-33,-33,-33,-33,-33,-33,-2,-33,-33,-33,-33,-33,-30,-33,-32,-7,-8,-33,-33,-12,-13,-14,-33,-33,-17,-18,-27,-19,-20,-21,-6,-28,-29,-33,-24,-9,-10,-15,-16,-33,-33,-33,-33,-31,-25,-26,-22,-23"),X=e.large_array_unpack("25,31,6,35,36,1,49,22,40,41,43,2,44,45,7,47,48,,50,,,,,,,,,,,,,,,,,,,,,,,,,,60,61,62,63"),te=e.large_array_unpack("5,5,3,5,5,1,7,3,5,6,6,2,6,6,2,5,5,,6,,,,,,,,,,,,,,,,,,,,,,,,,,5,5,6,6"),O=[u,5,11,0,u,-11,-11,-23,u],ue=[u,u,u,u,10,42,u,u,28],$e=e.large_array_unpack("0,0,racc_error,2,22,_reduce_1,3,22,_reduce_2,2,23,_reduce_3,0,24,_reduce_4,2,24,_reduce_5,4,24,_reduce_6,3,24,_reduce_7,3,24,_reduce_8,4,24,_reduce_9,4,24,_reduce_10,2,24,_reduce_11,3,24,_reduce_12,3,24,_reduce_13,3,24,_reduce_14,4,24,_reduce_15,4,24,_reduce_16,3,24,_reduce_17,2,25,_reduce_18,2,25,_reduce_19,3,25,_reduce_20,3,25,_reduce_21,3,28,_reduce_22,3,28,_reduce_23,1,28,_reduce_none,3,27,_reduce_25,3,27,_reduce_26,1,27,_reduce_none,2,26,_reduce_28,2,26,_reduce_29,1,26,_reduce_none,3,29,_reduce_31,1,29,_reduce_32"),_e=z(!1,0,"error",1,"NUMBER",2,"K",3,"R",4,"H",5,"G",6,"F",7,"S",8,"T",9,"PLUS",10,"MINUS",11,"ASTERISK",12,"SLASH",13,"PARENL",14,"PARENR",15,"BRACKETL",16,"BRACKETR",17,"AT",18,"SHARP",19,"DOLLAR",20),Z(m[0],"Racc_arg",[T,i,a,v,X,te,ue,O,21,$e,_e,64,33,!0]),Z(m[0],"Racc_token_to_s_table",["$end","error","NUMBER","K","R","H","G","F","S","T","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","BRACKETL","BRACKETR","AT","SHARP","DOLLAR","$start","expr","rate","option","modifier","unary","mul","add","term"]),Z(m[0],"Racc_debug_parser",!1),d(s,"$_reduce_1",function(x,S,re){try{F("eval_return");var U,ne,fe,ie=u,le=u;return ne=null==(U=G(x))[0]?u:U[0],le=y(fe=(ie=null==U[1]?u:U[1]).$modifier())?fe:K(K(t("Arithmetic"),"Node"),"Number").$new(0),this.$parsed(ne,le.$eval(this.round_type),ie)}catch(oe){if(oe===e.t_eval_return)return oe.$v;throw oe}}),d(s,"$_reduce_2",function(x,S,re){try{F("eval_return");var U,ie,fe,le=u,oe=u;return ie=null==(U=G(x))[1]?u:U[1],y((le=null==U[2]?u:U[2]).$modifier_after_half())||le["$modifier_after_half="](K(K(t("Arithmetic"),"Node"),"Number").$new(0)),oe=y(fe=le.$modifier())?fe:K(K(t("Arithmetic"),"Node"),"Number").$new(0),this.$parsed(ie,oe.$eval(this.round_type),le)}catch(de){if(de===e.t_eval_return)return de.$v;throw de}}),d(s,"$_reduce_3",function(x,S,re){return x["$[]"](1).$to_i()}),d(s,"$_reduce_4",function(x,S,re){return t("RatingOptions").$new()}),d(s,"$_reduce_5",function(x,S,re){var w,ne,Q=u;return ne=null==(w=G(x))[1]?u:w[1],y((Q=null==w[0]?u:w[0]).$modifier()["$nil?"]())||this.$raise(t("ParseError")),Q["$modifier="](ne),Q}),d(s,"$_reduce_6",function(x,S,re){var w,ie,Q=u;return ie=null==(w=G(x))[2]?u:w[2],y((Q=null==w[0]?u:w[0]).$critical()["$nil?"]())||this.$raise(t("ParseError")),Q["$critical="](ie),Q}),d(s,"$_reduce_7",function(x,S,re){var w,ie,Q=u;return ie=null==(w=G(x))[2]?u:w[2],y((Q=null==w[0]?u:w[0]).$critical()["$nil?"]())||this.$raise(t("ParseError")),Q["$critical="](ie),Q}),d(s,"$_reduce_8",function(x,S,re){var w,Q=u,ie=u;return ie=null==(w=G(x))[2]?u:w[2],y((Q=null==w[0]?u:w[0])["$settable_first_roll_adjust_option?"]())||this.$raise(t("ParseError")),Q["$first_to="](ie.$to_i()),Q}),d(s,"$_reduce_9",function(x,S,re){var w,Q=u,ie=u;return ie=null==(w=G(x))[3]?u:w[3],y((Q=null==w[0]?u:w[0])["$settable_first_roll_adjust_option?"]())||this.$raise(t("ParseError")),Q["$first_modify="](ie.$to_i()),Q}),d(s,"$_reduce_10",function(x,S,re){var w,Q=u,ie=u;return ie=null==(w=G(x))[3]?u:w[3],y((Q=null==w[0]?u:w[0])["$settable_first_roll_adjust_option?"]())||this.$raise(t("ParseError")),Q["$first_modify="](ie.$to_i()["$-@"]()),Q}),d(s,"$_reduce_11",function(x,S,re){var w,Q=u;return w=G(x),y((Q=null==w[0]?u:w[0]).$modifier_after_half()["$nil?"]())||this.$raise(t("ParseError")),Q["$modifier_after_half="](K(K(t("Arithmetic"),"Node"),"Number").$new(0)),Q}),d(s,"$_reduce_12",function(x,S,re){var w,ie,Q=u;return ie=null==(w=G(x))[2]?u:w[2],y((Q=null==w[0]?u:w[0]).$modifier_after_half()["$nil?"]())||this.$raise(t("ParseError")),Q["$modifier_after_half="](ie),Q}),d(s,"$_reduce_13",function(x,S,re){var w,ie,Q=u;return Q=null==(w=G(x))[0]?u:w[0],ie=null==w[2]?u:w[2],y(["v2_5","v2_0"]["$include?"](this.version))&&y(Q.$rateup()["$nil?"]())||this.$raise(t("ParseError")),Q["$rateup="](ie),Q}),d(s,"$_reduce_14",function(x,S,re){var w,Q=u;return Q=null==(w=G(x))[0]?u:w[0],y(["v2_5","v2_0"]["$include?"](this.version))&&y(Q["$settable_non_2d_roll_option?"]())||this.$raise(t("ParseError")),Q["$greatest_fortune="](!0),Q}),d(s,"$_reduce_15",function(x,S,re){var w,Q=u,ie=u;return Q=null==(w=G(x))[0]?u:w[0],ie=null==w[3]?u:w[3],y(["v2_5","v2_0"]["$include?"](this.version))&&y(Q["$settable_non_2d_roll_option?"]())||this.$raise(t("ParseError")),Q["$semi_fixed_val="](ie.$to_i()),Q}),d(s,"$_reduce_16",function(x,S,re){var w,Q=u,ie=u;return Q=null==(w=G(x))[0]?u:w[0],ie=null==w[3]?u:w[3],y(["v2_5","v2_0"]["$include?"](this.version))&&y(Q["$settable_non_2d_roll_option?"]())||this.$raise(t("ParseError")),Q["$tmp_fixed_val="](ie.$to_i()),Q}),d(s,"$_reduce_17",function(x,S,re){var w,ie,Q=u;return Q=null==(w=G(x))[0]?u:w[0],ie=null==w[2]?u:w[2],j(this.version,"v2_5")&&y(Q.$kept_modify()["$nil?"]())||this.$raise(t("ParseError")),Q["$kept_modify="](ie),Q}),d(s,"$_reduce_18",function(x,S,re){return x["$[]"](1)}),d(s,"$_reduce_19",function(x,S,re){return K(K(t("Arithmetic"),"Node"),"Negative").$new(x["$[]"](1))}),d(s,"$_reduce_20",function(x,S,re){return K(K(t("Arithmetic"),"Node"),"BinaryOp").$new(x["$[]"](0),"+",x["$[]"](2))}),d(s,"$_reduce_21",function(x,S,re){return K(K(t("Arithmetic"),"Node"),"BinaryOp").$new(x["$[]"](0),"-",x["$[]"](2))}),d(s,"$_reduce_22",function(x,S,re){return K(K(t("Arithmetic"),"Node"),"BinaryOp").$new(x["$[]"](0),"+",x["$[]"](2))}),d(s,"$_reduce_23",function(x,S,re){return K(K(t("Arithmetic"),"Node"),"BinaryOp").$new(x["$[]"](0),"-",x["$[]"](2))}),d(s,"$_reduce_25",function(x,S,re){return K(K(t("Arithmetic"),"Node"),"BinaryOp").$new(x["$[]"](0),"*",x["$[]"](2))}),d(s,"$_reduce_26",function(x,S,re){return K(K(t("Arithmetic"),"Node"),"DivideWithGameSystemDefault").$new(x["$[]"](0),x["$[]"](2))}),d(s,"$_reduce_28",function(x,S,re){return x["$[]"](1)}),d(s,"$_reduce_29",function(x,S,re){return K(K(t("Arithmetic"),"Node"),"Negative").$new(x["$[]"](1))}),d(s,"$_reduce_31",function(x,S,re){return x["$[]"](1)}),d(s,"$_reduce_32",function(x,S,re){return K(K(t("Arithmetic"),"Node"),"Number").$new(x["$[]"](0))}),d(s,"$_reduce_none",function(x,S,re){return x["$[]"](0)})},Opal.modules["bcdice/game_system/SwordWorld"]=function(e){var M,E,D,s,m,t,T,g,$,R,Y=e.module,W=e.klass,c=e.const_set,B=e.send2,C=e.find_super,d=e.def,H=e.truthy,y=e.rb_ge,P=e.rb_le,F=e.eqeq,z=e.neqeq,Z=e.rb_minus,G=e.rb_gt,j=e.hash2,A=e.send,q=e.to_ary,u=e.rb_plus,K=e.rb_lt,l=e.rb_times,k=e.thrower,_=e.rb_divide,L=e.top,r=[],n=e.nil;return L.$require("bcdice/base"),L.$require("bcdice/game_system/sword_world/rating_parser"),M=r,E=R=[Y(r[0],"BCDice")].concat(M),g=[Y(R[0],"GameSystem")].concat(E),$=e.$r(g),D=g,m=[s=W(g[0],$("Base"),"SwordWorld")].concat(D),t=e.$r(m),(T=s.$$prototype).rating_table=T.randomizer=n,c(m[0],"ID","SwordWorld"),c(m[0],"NAME","\u30bd\u30fc\u30c9\u30fb\u30ef\u30fc\u30eb\u30c9RPG"),c(m[0],"SORT_KEY","\u305d\u304a\u3068\u308f\u3042\u308b\u3068"),c(m[0],"HELP_MESSAGE","\u30fbSW\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3000(Kx[c]+m$f) (x:\u30ad\u30fc, c:\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024, m:\u30dc\u30fc\u30ca\u30b9, f:\u51fa\u76ee\u4fee\u6b63)\n"),s.$register_prefix("H?K"),d(s,"$initialize",function i(v){var X=this;return i.$$p=null,B(X,C(X,"initialize",i,!1,!0),"initialize",[v],null),X.rating_table=0}),d(s,"$result_2d6",function(v,a,X,te,O){return H(y(a,12))?t("Result").$critical(this.$translate("SwordWorld.critical")):H(P(a,2))?t("Result").$fumble(this.$translate("SwordWorld.fumble")):z(te,">=")||F(O,"?")?n:H(y(v,O))?t("Result").$success(this.$translate("success")):t("Result").$failure(this.$translate("failure"))}),d(s,"$eval_game_system_specific_command",function(v){return this.$rating(v)}),s.$private(),d(s,"$rating_parser",function(){return t("RatingParser").$new()}),d(s,"$rating",function(v){var a,X,te=this,O=n,ue=n,$e=n,ce=n,se=n,_e=n,ae=n,ee=n,I=n,V=n,x=n,S=n,re=n,w=n,J=n,Q=n;return te.$debug("rating string",v),O=te.$rating_parser().$parse(v),H(O)?(ue=te.$getSW2_0_RatingTable(),$e=Z(ue.$length(),1),te.$debug("keyMax",$e),H(G(O.$rate(),$e))?t("Result").$new(te.$translate("SwordWorld.keynumber_exceeds",j(["keyMax"],{keyMax:$e}))):H(O["$infinite_roll?"]())?t("Result").$new(te.$translate("SwordWorld.infinite_critical",j(["min_critical"],{min_critical:O.$min_critical()}))):(ce=te.$getNewRates(ue),se=O+" \uff1e ",_e=[],ae=[],ee=[],I=0,V=0,x=0,S=0,re=O.$first_to(),w=O.$first_modify(),function(){try{var ne=k("break");A(te,"loop",[],function ie(){var le,fe,be,he,oe=null==ie.$$s?this:ie.$$s,de=n,me=n;if(fe=oe.$rollDice(O,S),me=null==(le=q(fe))[1]?n:le[1],I=de=null==le[0]?n:le[0],z(re,0)?(I=de=re,re=0):z(w,0)&&(I=u(I,w),w=0),H(P(de,2))&&(_e["$<<"](de.$to_s()),ae["$<<"](me.$to_s()),ee["$<<"]("**"),S=u(S,1),ne.$throw()),z(O.$kept_modify(),0)&&z(I,2)&&(I=u(I,O.$kept_modify())),H(K(I,2))&&(I=2),H(G(I,12))&&(I=12),be=[u(O.$rate(),l(S,O.$rateup())),$e].$min(),oe.$debug("currentKey",be),he=ce["$[]"](I)["$[]"](be),oe.$debug("rateValue",he),x=u(x,he),V=u(V,I),_e["$<<"](I.$to_s()),ae["$<<"](me.$to_s()),ee["$<<"](H(G(I,2))?he:"**"),S=u(S,1),H(y(I,O.$critical())))return n;ne.$throw()},{$$s:te})}catch(ie){if(ie===ne)return ie.$v;throw ie}}(),X=te.$getResultText(x,O,ae,_e,ee,V,S),a=q(X),J=null==a[1]?n:a[1],Q=null==a[2]?n:a[2],se=u(se,null==a[0]?n:a[0]),A(t("Result").$new(),"tap",[],function(ie){var le;return null==ie&&(ie=n),ie["$text="](se),ie["$critical="](J),A(ie,"fumble=",le=[Q]),le[le.length-1]}))):(te.$debug("not matched"),"1")}),d(s,"$getSW2_0_RatingTable",function(){return["*,0,0,0,1,2,2,3,3,4,4","*,0,0,0,1,2,3,3,3,4,4","*,0,0,0,1,2,3,4,4,4,4","*,0,0,1,1,2,3,4,4,4,5","*,0,0,1,2,2,3,4,4,5,5","*,0,1,1,2,2,3,4,5,5,5","*,0,1,1,2,3,3,4,5,5,5","*,0,1,1,2,3,4,4,5,5,6","*,0,1,2,2,3,4,4,5,6,6","*,0,1,2,3,3,4,4,5,6,7","*,1,1,2,3,3,4,5,5,6,7","*,1,2,2,3,3,4,5,6,6,7","*,1,2,2,3,4,4,5,6,6,7","*,1,2,3,3,4,4,5,6,7,7","*,1,2,3,4,4,4,5,6,7,8","*,1,2,3,4,4,5,5,6,7,8","*,1,2,3,4,4,5,6,7,7,8","*,1,2,3,4,5,5,6,7,7,8","*,1,2,3,4,5,6,6,7,7,8","*,1,2,3,4,5,6,7,7,8,9","*,1,2,3,4,5,6,7,8,9,10","*,1,2,3,4,6,6,7,8,9,10","*,1,2,3,5,6,6,7,8,9,10","*,2,2,3,5,6,7,7,8,9,10","*,2,3,4,5,6,7,7,8,9,10","*,2,3,4,5,6,7,8,8,9,10","*,2,3,4,5,6,8,8,9,9,10","*,2,3,4,6,6,8,8,9,9,10","*,2,3,4,6,6,8,9,9,10,10","*,2,3,4,6,7,8,9,9,10,10","*,2,4,4,6,7,8,9,10,10,10","*,2,4,5,6,7,8,9,10,10,11","*,3,4,5,6,7,8,10,10,10,11","*,3,4,5,6,8,8,10,10,10,11","*,3,4,5,6,8,9,10,10,11,11","*,3,4,5,7,8,9,10,10,11,12","*,3,5,5,7,8,9,10,11,11,12","*,3,5,6,7,8,9,10,11,12,12","*,3,5,6,7,8,10,10,11,12,13","*,4,5,6,7,8,10,11,11,12,13","*,4,5,6,7,9,10,11,11,12,13","*,4,6,6,7,9,10,11,12,12,13","*,4,6,7,7,9,10,11,12,13,13","*,4,6,7,8,9,10,11,12,13,14","*,4,6,7,8,10,10,11,12,13,14","*,4,6,7,9,10,10,11,12,13,14","*,4,6,7,9,10,10,12,13,13,14","*,4,6,7,9,10,11,12,13,13,15","*,4,6,7,9,10,12,12,13,13,15","*,4,6,7,10,10,12,12,13,14,15","*,4,6,8,10,10,12,12,13,15,15","*,5,7,8,10,10,12,12,13,15,15","*,5,7,8,10,11,12,12,13,15,15","*,5,7,9,10,11,12,12,14,15,15","*,5,7,9,10,11,12,13,14,15,16","*,5,7,10,10,11,12,13,14,16,16","*,5,8,10,10,11,12,13,15,16,16","*,5,8,10,11,11,12,13,15,16,17","*,5,8,10,11,12,12,13,15,16,17","*,5,9,10,11,12,12,14,15,16,17","*,5,9,10,11,12,13,14,15,16,18","*,5,9,10,11,12,13,14,16,17,18","*,5,9,10,11,13,13,14,16,17,18","*,5,9,10,11,13,13,15,17,17,18","*,5,9,10,11,13,14,15,17,17,18","*,5,9,10,12,13,14,15,17,18,18","*,5,9,10,12,13,15,15,17,18,19","*,5,9,10,12,13,15,16,17,19,19","*,5,9,10,12,14,15,16,17,19,19","*,5,9,10,12,14,16,16,17,19,19","*,5,9,10,12,14,16,17,18,19,19","*,5,9,10,13,14,16,17,18,19,20","*,5,9,10,13,15,16,17,18,19,20","*,5,9,10,13,15,16,17,19,20,21","*,6,9,10,13,15,16,18,19,20,21","*,6,9,10,13,16,16,18,19,20,21","*,6,9,10,13,16,17,18,19,20,21","*,6,9,10,13,16,17,18,20,21,22","*,6,9,10,13,16,17,19,20,22,23","*,6,9,10,13,16,18,19,20,22,23","*,6,9,10,13,16,18,20,21,22,23","*,6,9,10,13,17,18,20,21,22,23","*,6,9,10,14,17,18,20,21,22,24","*,6,9,11,14,17,18,20,21,23,24","*,6,9,11,14,17,19,20,21,23,24","*,6,9,11,14,17,19,21,22,23,24","*,7,10,11,14,17,19,21,22,23,25","*,7,10,12,14,17,19,21,22,24,25","*,7,10,12,14,18,19,21,22,24,25","*,7,10,12,15,18,19,21,22,24,26","*,7,10,12,15,18,19,21,23,25,26","*,7,11,13,15,18,19,21,23,25,26","*,7,11,13,15,18,20,21,23,25,27","*,8,11,13,15,18,20,22,23,25,27","*,8,11,13,16,18,20,22,23,25,28","*,8,11,14,16,18,20,22,23,26,28","*,8,11,14,16,19,20,22,23,26,28","*,8,12,14,16,19,20,22,24,26,28","*,8,12,15,16,19,20,22,24,27,28","*,8,12,15,17,19,20,22,24,27,29","*,8,12,15,18,19,20,22,24,27,30"]}),d(s,"$getNewRates",function(v){var a,X,O=n,ue=n,$e=n,ce=n,se=n,_e=n,ae=n,ee=n,I=n,V=n,x=n;return O=[],ue=[],$e=[],ce=[],se=[],_e=[],ae=[],ee=[],I=[],V=[],x=[],A(v,"each",[],function(w){var U=n;return null==w&&(w=n),U=w.$split(/,/),x.$push(0),O.$push(U["$[]"](1).$to_i()),ue.$push(U["$[]"](2).$to_i()),$e.$push(U["$[]"](3).$to_i()),ce.$push(U["$[]"](4).$to_i()),se.$push(U["$[]"](5).$to_i()),_e.$push(U["$[]"](6).$to_i()),ae.$push(U["$[]"](7).$to_i()),ee.$push(U["$[]"](8).$to_i()),I.$push(U["$[]"](9).$to_i()),V.$push(U["$[]"](10).$to_i())}),F(this.rating_table,1)&&V["$[]="](31,(a=[32,(X=[33,10],A(V,"[]=",X),X[X.length-1])],A(V,"[]=",a),a[a.length-1])),[x,x,x,O,ue,$e,ce,se,_e,ae,ee,I,V]}),d(s,"$rollDice",function(v,a){var te=n;return[(te=this.randomizer.$roll_barabara(2,6)).$sum(),te.$join(",")]}),d(s,"$getResultText",function(v,a,X,te,O,ue,$e){var se=n,_e=n,ae=n,ee=n,I=n;return(se=[]).$push("2D:["+X.$join(" ")+"]="+te.$join(",")),H(P(ue,2))?(se.$push(O.$join(",")),se.$push(this.$translate("SwordWorld.fumble")),[se.$join(" \uff1e "),!1,!0]):(H(G(O.$size(),1))||z(a.$modifier(),0)?(_e=u(O.$join(","),t("Format").$modifier(a.$modifier())),H(a.$half())&&(_e="("+_e+")/2",z(a.$modifier_after_half(),0)&&(_e=u(_e,t("Format").$modifier(a.$modifier_after_half())))),se.$push(_e)):H(a.$half())&&(_e=O.$first()+"/2",z(a.$modifier_after_half(),0)&&(_e=u(_e,t("Format").$modifier(a.$modifier_after_half()))),se.$push(_e)),H(G($e,1))&&(ae=this.$translate("SwordWorld.round_text",j(["reroll_count"],{reroll_count:Z($e,1)})),se.$push(ae)),ee=u(v,a.$modifier()),H(a.$half())&&(ee=_(ee,2).$ceil(),z(a.$modifier_after_half(),0)&&(ee=u(ee,a.$modifier_after_half()))),I=ee.$to_s(),se.$push(I),[se.$join(" \uff1e "),G($e,1),!1])})},Opal.modules["bcdice/game_system/sword_world/transcendent_test"]=function(e){var A,l,p,E,h,g,$,o,N,_,L,u,Y=e.module,W=e.klass,c=e.def,B=e.truthy,C=e.rb_lt,d=e.hash2,H=e.not,y=e.rb_ge,P=e.rb_plus,F=e.send,z=e.top,Z=[],G=e.nil;return z.$require("bcdice/result"),z.$require("bcdice/translate"),A=Z,l=u=[Y(Z[0],"BCDice")].concat(A),_=[Y(u[0],"GameSystem")].concat(l),L=e.$r(_),p=_,E=N=[W(_[0],L("SwordWorld"),"SwordWorld2_0")].concat(p),g=[h=W(N[0],null,"TranscendentTest")].concat(E),$=e.$r(g),(o=h.$$prototype).modifier=o.critical_value=o.expression=o.modifier_str=o.target=o.cmp_op=G,h.$include($("Translate")),c(h,"$initialize",function(D,s,m,t,T){var i=this;return i.critical_value=D,i.modifier=s,i.cmp_op=m,i.target=t,i.locale=T,i.modifier_str=$("Format").$modifier(i.modifier),i.expression=i.$node_expression()}),c(h,"$execute",function(D){var T,i,v,s=this,m=G,t=G,a=G,X=G,te=G,O=G;if(B(C(s.critical_value,3)))return s.$translate("SwordWorld2_0.transcendent_critical_too_small",d(["expression"],{expression:s.expression}));if(t=[m=D.$roll_barabara(2,6)],T=m["$=="]([1,1]),i=m["$=="]([6,6]),H(T)&&H(i))for(;B(y(s.$sum_of_dice(t.$last()),s.critical_value));)t.$push(D.$roll_barabara(2,6));return v=s.$sum_of_dice(t),a=P(v,s.modifier),X=s.$result_status(a,t.$length(),T,i),te=d(["success","failure","super_success","critical","fumble"],{success:s.$translate("success"),failure:s.$translate("failure"),super_success:s.$translate("SwordWorld2_0.super_success"),critical:s.$translate("SwordWorld.critical"),fumble:s.$translate("SwordWorld.fumble")}).$freeze()["$[]"](X),O=["("+s.expression+")",""+s.$dice_str(t,v)+s.modifier_str,a,te].$compact(),F($("Result").$new(),"tap",[],function($e){var ce;return null==$e&&($e=G),$e["$text="](O.$join(" \uff1e ")),$e["$fumble="](X["$=="]("fumble")),$e["$critical="](X["$=="]("critical")),$e["$success="](["success","super_success","critical"]["$include?"](X)),ce=[["failure","fumble"]["$include?"](X)],F($e,"failure=",ce),ce[ce.length-1]})}),h.$private(),c(h,"$node_expression",function(){var s,D=this;return s="2D6@"+D.critical_value+D.modifier_str,B(D.target)?""+s+D.cmp_op+D.target:s}),c(h,"$sum_of_dice",function(D){return D.$flatten().$sum()}),c(h,"$dice_str",function(D,s){return""+s+F(D,"map",[],function(T){return null==T&&(T=G),"["+T.$join(",")+"]"}).$join()}),c(h,"$result_status",function(D,s,m,t){var T=this;return B(T.target)?B(m)?"fumble":B(t)?"critical":B(D.$send(T.cmp_op,T.target))?B(y(s,2))&&B(y(D,41))?"super_success":"success":"failure":"no_target"})},Opal.modules["bcdice/game_system/SwordWorld2_0"]=function(e){var _,p,h,g,$,o,f,N,R,r,Y=e.module,W=e.klass,c=e.const_set,B=e.send2,C=e.find_super,d=e.def,H=e.eqeqeq,y=e.truthy,P=e.hash2,F=e.rb_gt,z=e.rb_plus,Z=e.eqeq,G=e.rb_times,j=e.send,A=e.neqeq,q=e.top,u=[],K=e.nil,l=e.$$$;return q.$require("bcdice/arithmetic_evaluator"),q.$require("bcdice/game_system/SwordWorld"),q.$require("bcdice/game_system/sword_world/transcendent_test"),_=u,p=r=[Y(u[0],"BCDice")].concat(_),N=[Y(r[0],"GameSystem")].concat(p),R=e.$r(N),h=N,$=[g=W(N[0],R("SwordWorld"),"SwordWorld2_0")].concat(h),o=e.$r($),(f=g.$$prototype).locale=f.randomizer=K,c($[0],"ID","SwordWorld2.0"),c($[0],"NAME","\u30bd\u30fc\u30c9\u30fb\u30ef\u30fc\u30eb\u30c92.0"),c($[0],"SORT_KEY","\u305d\u304a\u3068\u308f\u3042\u308b\u30682.0"),c($[0],"HELP_MESSAGE",'\u81ea\u52d5\u7684\u6210\u529f\u3001\u6210\u529f\u3001\u5931\u6557\u3001\u81ea\u52d5\u7684\u5931\u6557\u306e\u81ea\u52d5\u5224\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u30fb\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3000(Kx)\n\u3000"K\u30ad\u30fc\u30ca\u30f3\u30d0\u30fc+\u30dc\u30fc\u30ca\u30b9"\u306e\u5f62\u3067\u8a18\u5165\u3057\u307e\u3059\u3002\n\u3000\u30dc\u30fc\u30ca\u30b9\u306e\u90e8\u5206\u306b\u300cK20+K30\u300d\u306e\u3088\u3046\u306b\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u53d6\u308b\u3053\u3068\u306f\u51fa\u6765\u307e\u305b\u3093\u3002\n\u3000\u307e\u305f\u3001\u30dc\u30fc\u30ca\u30b9\u306f\u8907\u6570\u53d6\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3082\u30c0\u30a4\u30b9\u30ed\u30fc\u30eb\u3068\u540c\u69d8\u306b\u3001\u4ed6\u306e\u30d7\u30ec\u30a4\u30e4\u30fc\u306b\u96a0\u308c\u3066\u30ed\u30fc\u30eb\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n\u3000\u4f8b\uff09K20\u3000\u3000\u3000K10+5\u3000\u3000\u3000k30\u3000\u3000\u3000k10+10\u3000\u3000\u3000Sk10-1\u3000\u3000\u3000k10+5+2\n\n\u30fb\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u306e\u8a2d\u5b9a\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u306f"[\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024]"\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u3000\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306f\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u502410\u3068\u3057\u307e\u3059\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u51e6\u7406\u304c\u5fc5\u8981\u306a\u3044\u3068\u304d\u306f13\u306a\u3069\u3068\u3057\u3066\u304f\u3060\u3055\u3044\u3002(\u9632\u5fa1\u6642\u306a\u3069\u306e\u5bfe\u5fdc)\n\u3000\u307e\u305f\u30bf\u30a4\u30d7\u306e\u8efd\u6e1b\u5316\u306e\u305f\u3081\u306b\u672b\u5c3e\u306b\u300c@\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u300d\u3067\u3082\u51e6\u7406\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\u3000\u4f8b\uff09K20[10]\u3000\u3000\u3000K10+5[9]\u3000\u3000\u3000k30[10]\u3000\u3000\u3000k10[9]+10\u3000\u3000\u3000k10-5@9\n\n\u30fb\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u306e\u534a\u6e1b (HKx, KxH+N)\n\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u306e\u5148\u982d\u307e\u305f\u306f\u672b\u5c3e\u306b"H"\u3092\u3064\u3051\u308b\u3068\u3001\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3092\u632f\u3063\u3066\u6700\u7d42\u7d50\u679c\u3092\u534a\u6e1b\u3055\u305b\u307e\u3059\u3002\n\u3000\u672b\u5c3e\u306b\u3064\u3051\u305f\u5834\u5408\u3001\u76f4\u5f8c\u306b\u4fee\u6b63\u3092\u3092\u3064\u3051\u308b\u3053\u3068\u3067\u3001\u534a\u6e1b\u5f8c\u306e\u52a0\u6e1b\u7b97\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u3000\u3053\u306e\u969b\u3001\u8907\u6570\u306e\u9805\u306b\u3088\u308b\u4fee\u6b63\u306b\u306f\u30ab\u30c3\u30b3\u3067\u56f2\u3046\u3053\u3068\u304c\u5fc5\u8981\u3067\u3059\uff08\u30ab\u30c3\u30b3\u304c\u306a\u3044\u3068\u30d1\u30fc\u30b9\u306b\u5931\u6557\u3057\u307e\u3059\uff09\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u3092\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u306a\u3057\u3068\u6271\u308f\u308c\u307e\u3059\u3002\n\u3000\u4f8b\uff09HK20\u3000\u3000K20h\u3000\u3000HK10-5@9\u3000\u3000K10-5@9H\u3000\u3000K20gfH\u3000\u3000K20+8H+2\u3000\u3000K20+8H(1+1)\n\n\u30fb\u30c0\u30a4\u30b9\u76ee\u306e\u4fee\u6b63\uff08\u904b\u547d\u5909\u8ee2\u3084\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u30ec\u30a4\u7528\uff09\n\u3000\u672b\u5c3e\u306b\u300c$\u4fee\u6b63\u5024\u300d\u3067\u30c0\u30a4\u30b9\u76ee\u306b\u4fee\u6b63\u304c\u304b\u304b\u308a\u307e\u3059\u3002\n\u3000$\uff0b\uff11\u3068\u4fee\u6b63\u8868\u8a18\u306a\u3089\u30c0\u30a4\u30b9\u76ee\u306b\uff0b\u4fee\u6b63\u3001\uff04\uff19\u306e\u3088\u3046\u306b\u56fa\u5b9a\u5024\u306a\u3089\u30c0\u30a4\u30b9\u76ee\u3092\u305d\u306e\u51fa\u76ee\u306b\u5dee\u3057\u66ff\u3048\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u3057\u305f\u5834\u5408\u3067\u3082\u56fa\u5b9a\u5024\u3084\u4fee\u6b63\u5024\u306e\u9069\u7528\u306f\u6700\u521d\u306e\u4e00\u56de\u3060\u3051\u3067\u3059\u3002\n\u3000\u4f8b\uff09K20$+1\u3000\u3000\u3000K10+5$9\u3000\u3000\u3000k10-5@9$+2\u3000\u3000\u3000k10[9]+10$9\n\n\u30fb\u9996\u5207\u308a\u5200\u7528\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u4e0a\u6607 r10\n\u3000\u4f8b\uff09K20r10\u3000K30+24@8R10\u3000K40+24@8$12r10\n\n\u30fb\u30b0\u30ec\u30a4\u30c6\u30b9\u30c8\u30d5\u30a9\u30fc\u30c1\u30e5\u30f3\u306f\u672b\u5c3e\u306b gf\n\u3000\u4f8b\uff09K20gf\u3000K30+24@8GF\u3000K40+24@8$12r10gf\n\n\u30fb\u5a01\u529b\u8868\u30921d+sf\u3067\u53c2\u7167 \u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5f8c\u3082\u7d99\u7d9a sf4\n\u3000\u4f8b\uff09k10sf4\u3000k0+5SF4@13\u3000k70+26sf3@9\n\n\u30fb\u5a01\u529b\u8868\u30921d+tf\u3067\u53c2\u7167 \u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5f8c\u306f2d\u3067\u53c2\u7167 tf3\n\u3000\u4f8b\uff09k10tf3\u3000k0+5TF4@13\u3000k70+26tf3@9\n\n\u30fb\u8d85\u8d8a\u5224\u5b9a\u7528\u306b2d6\u30ed\u30fc\u30eb\u306b 2D6@10 \u66f8\u5f0f\u3067\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u4ed8\u4e0e\u304c\u53ef\u80fd\u306b\u3002\n\u3000\u4f8b\uff092D6@10\u30002D6@10+11>=30\n\n\u30fb\u6210\u9577\u3000(Gr)\n\u3000\u672b\u5c3e\u306b\u6570\u5b57\u3092\u4ed8\u52a0\u3059\u308b\u3053\u3068\u3067\u3001\u8907\u6570\u56de\u306e\u6210\u9577\u3092\u307e\u3068\u3081\u3066\u884c\u3048\u307e\u3059\u3002\n\u3000\u4f8b\uff09Gr3\n\n\u30fb\u9632\u5fa1\u30d5\u30a1\u30f3\u30d6\u30eb\u8868\u3000(FT)\n\u3000\u9632\u5fa1\u30d5\u30a1\u30f3\u30d6\u30eb\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30fb\u7d61\u307f\u52b9\u679c\u8868\u3000(TT)\n\u3000\u7d61\u307f\u52b9\u679c\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n'),g.$register_prefix("H?K","Gr","2D6?@\\d+","FT","TT"),d(g,"$initialize",function D(s){var t=this;return D.$$p=null,B(t,C(t,"initialize",D,!1,!0),"initialize",[s],null),t.rating_table=2}),d(g,"$eval_game_system_specific_command",function D(s){var T,t=this,v=K;return D.$$p=null,H(/^Gr(\d+)?/i,T=s)?y(s["$=~"](/^Gr(\d+)/i))?t.$growth(o("Regexp").$last_match(1).$to_i()):t.$growth():H(/^2D6?@\d+/i,T)?(v=l(o("Command"),"Parser").$new(/2D6?/i,P(["round_type"],{round_type:l(l(o("BCDice"),"RoundType"),"CEIL")})).$enable_critical().$restrict_cmp_op_to(K,">=",">").$parse(s),y(v)?o("TranscendentTest").$new(v.$critical(),v.$modify_number(),v.$cmp_op(),v.$target_number(),t.locale).$execute(t.randomizer):K):H("FT",T)?t.$get_fumble_table():H("TT",T)?t.$get_tangle_table():B(t,C(t,"eval_game_system_specific_command",D,!1,!0),"eval_game_system_specific_command",[s],null)}),d(g,"$rating_parser",function(){return o("RatingParser").$new(P(["version"],{version:"v2_0"}))}),d(g,"$rollDice",function D(s,m){var T=this,i=K;return D.$$p=null,y(F(s.$semi_fixed_val(),0))?(i=T.randomizer.$roll_once(6),[z(i,s.$semi_fixed_val()),i+","+s.$semi_fixed_val()]):Z(m,0)&&y(F(s.$tmp_fixed_val(),0))?(i=T.randomizer.$roll_once(6),[z(i,s.$tmp_fixed_val()),i+","+s.$tmp_fixed_val()]):y(s.$greatest_fortune())?(i=T.randomizer.$roll_once(6),[G(i,2),i+","+i]):B(T,C(T,"rollDice",D,!1,!0),"rollDice",[s,m],null)}),d(g,"$growth",function(s){return null==s&&(s=1),j(e.Range.$new(1,s,!1),"map",[],function t(){return(null==t.$$s?this:t.$$s).$growth_step()},{$$s:this}).$join(" | ")},-1),d(g,"$growth_step",function(){var s=this,m=K,t=K,T=K;return t=(m=l(o("DiceTable"),"Table").$from_i18n("SwordWorld2_0.GrowthTable",s.locale)).$roll(s.randomizer),T=m.$roll(s.randomizer),A(t.$value(),T.$value())?"["+t.$value()+","+T.$value()+"]->("+t.$body()+" or "+T.$body()+")":"["+t.$value()+","+T.$value()+"]->("+t.$body()+")"}),d(g,"$get_fumble_table",function(){return l(o("DiceTable"),"Table").$from_i18n("SwordWorld2_0.FumbleTable",this.locale).$roll(this.randomizer)}),d(g,"$get_tangle_table",function(){return l(o("DiceTable"),"Table").$from_i18n("SwordWorld2_0.TangleTable",this.locale).$roll(this.randomizer)})},Opal.queue(function(e){var K,L,R,b,E,h,g,n,p,k,Y=e.module,W=e.klass,c=e.const_set,B=e.eqeqeq,C=e.send,d=e.hash2,H=e.truthy,y=e.send2,P=e.find_super,F=e.def,z=e.range,Z=e.rb_plus,j=[],A=e.nil,q=e.$$$;return e.top.$require("bcdice/game_system/SwordWorld2_0"),K=j,L=k=[Y(j[0],"BCDice")].concat(K),n=[Y(k[0],"GameSystem")].concat(L),p=e.$r(n),R=n,E=[b=W(n[0],p("SwordWorld2_0"),"SwordWorld2_5")].concat(R),h=e.$r(E),(g=b.$$prototype).randomizer=g.locale=A,c(E[0],"ID","SwordWorld2.5"),c(E[0],"NAME","\u30bd\u30fc\u30c9\u30fb\u30ef\u30fc\u30eb\u30c92.5"),c(E[0],"SORT_KEY","\u305d\u304a\u3068\u308f\u3042\u308b\u30682.5"),c(E[0],"HELP_MESSAGE",'\u81ea\u52d5\u7684\u6210\u529f\u3001\u6210\u529f\u3001\u5931\u6557\u3001\u81ea\u52d5\u7684\u5931\u6557\u306e\u81ea\u52d5\u5224\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u30fb\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3000(Kx)\n\u3000"K\u30ad\u30fc\u30ca\u30f3\u30d0\u30fc+\u30dc\u30fc\u30ca\u30b9"\u306e\u5f62\u3067\u8a18\u5165\u3057\u307e\u3059\u3002\n\u3000\u30dc\u30fc\u30ca\u30b9\u306e\u90e8\u5206\u306b\u300cK20+K30\u300d\u306e\u3088\u3046\u306b\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u53d6\u308b\u3053\u3068\u306f\u51fa\u6765\u307e\u305b\u3093\u3002\n\u3000\u307e\u305f\u3001\u30dc\u30fc\u30ca\u30b9\u306f\u8907\u6570\u53d6\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3082\u30c0\u30a4\u30b9\u30ed\u30fc\u30eb\u3068\u540c\u69d8\u306b\u3001\u4ed6\u306e\u30d7\u30ec\u30a4\u30e4\u30fc\u306b\u96a0\u308c\u3066\u30ed\u30fc\u30eb\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n\u3000\u4f8b\uff09K20\u3000\u3000\u3000K10+5\u3000\u3000\u3000k30\u3000\u3000\u3000k10+10\u3000\u3000\u3000Sk10-1\u3000\u3000\u3000k10+5+2\n\n\u30fb\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u306e\u8a2d\u5b9a\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u306f"[\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024]"\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u3000\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306f\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u502410\u3068\u3057\u307e\u3059\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u51e6\u7406\u304c\u5fc5\u8981\u306a\u3044\u3068\u304d\u306f13\u306a\u3069\u3068\u3057\u3066\u304f\u3060\u3055\u3044\u3002(\u9632\u5fa1\u6642\u306a\u3069\u306e\u5bfe\u5fdc)\n\u3000\u307e\u305f\u30bf\u30a4\u30d7\u306e\u8efd\u6e1b\u5316\u306e\u305f\u3081\u306b\u672b\u5c3e\u306b\u300c@\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u300d\u3067\u3082\u51e6\u7406\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\u3000\u4f8b\uff09K20[10]\u3000\u3000\u3000K10+5[9]\u3000\u3000\u3000k30[10]\u3000\u3000\u3000k10[9]+10\u3000\u3000\u3000k10-5@9\n\n\u30fb\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u306e\u534a\u6e1b (HKx, KxH+N)\n\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u306e\u5148\u982d\u307e\u305f\u306f\u672b\u5c3e\u306b"H"\u3092\u3064\u3051\u308b\u3068\u3001\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3092\u632f\u3063\u3066\u6700\u7d42\u7d50\u679c\u3092\u534a\u6e1b\u3055\u305b\u307e\u3059\u3002\n\u3000\u672b\u5c3e\u306b\u3064\u3051\u305f\u5834\u5408\u3001\u76f4\u5f8c\u306b\u4fee\u6b63\u3092\u3092\u3064\u3051\u308b\u3053\u3068\u3067\u3001\u534a\u6e1b\u5f8c\u306e\u52a0\u6e1b\u7b97\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u3000\u3053\u306e\u969b\u3001\u8907\u6570\u306e\u9805\u306b\u3088\u308b\u4fee\u6b63\u306b\u306f\u30ab\u30c3\u30b3\u3067\u56f2\u3046\u3053\u3068\u304c\u5fc5\u8981\u3067\u3059\uff08\u30ab\u30c3\u30b3\u304c\u306a\u3044\u3068\u30d1\u30fc\u30b9\u306b\u5931\u6557\u3057\u307e\u3059\uff09\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u3092\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u306a\u3057\u3068\u6271\u308f\u308c\u307e\u3059\u3002\n\u3000\u4f8b\uff09HK20\u3000\u3000K20h\u3000\u3000HK10-5@9\u3000\u3000K10-5@9H\u3000\u3000K20gfH\u3000\u3000K20+8H+2\u3000\u3000K20+8H+(1+1)\n\n\u30fb\u30c0\u30a4\u30b9\u76ee\u306e\u4fee\u6b63\uff08\u904b\u547d\u5909\u8ee2\u3084\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u30ec\u30a4\u7528\uff09\n\u3000\u672b\u5c3e\u306b\u300c$\u4fee\u6b63\u5024\u300d\u3067\u30c0\u30a4\u30b9\u76ee\u306b\u4fee\u6b63\u304c\u304b\u304b\u308a\u307e\u3059\u3002\n\u3000$\uff0b\uff11\u3068\u4fee\u6b63\u8868\u8a18\u306a\u3089\u30c0\u30a4\u30b9\u76ee\u306b\uff0b\u4fee\u6b63\u3001\uff04\uff19\u306e\u3088\u3046\u306b\u56fa\u5b9a\u5024\u306a\u3089\u30c0\u30a4\u30b9\u76ee\u3092\u305d\u306e\u51fa\u76ee\u306b\u5dee\u3057\u66ff\u3048\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u3057\u305f\u5834\u5408\u3067\u3082\u56fa\u5b9a\u5024\u3084\u4fee\u6b63\u5024\u306e\u9069\u7528\u306f\u6700\u521d\u306e\u4e00\u56de\u3060\u3051\u3067\u3059\u3002\n\u3000\u4f8b\uff09K20$+1\u3000\u3000\u3000K10+5$9\u3000\u3000\u3000k10-5@9$+2\u3000\u3000\u3000k10[9]+10$9\n\n\u30fb\u30c0\u30a4\u30b9\u76ee\u306e\u4fee\u6b63\uff08\u5fc5\u6bba\u653b\u6483\u7528\uff09\n\u3000\u300c\uff03\u4fee\u6b63\u5024\u300d\u3067\u30c0\u30a4\u30b9\u76ee\u306b\u4fee\u6b63\u304c\u304b\u304b\u308a\u307e\u3059\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u3057\u305f\u5834\u5408\u3067\u3082\u4fee\u6b63\u5024\u306e\u9069\u7528\u306f\u7d99\u7d9a\u3055\u308c\u307e\u3059\u3002\n\u3000\u4f8b\uff09K20#1\u3000\u3000\u3000k10-5@9#2\n\n\u30fb\u9996\u5207\u308a\u5200\u7528\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u4e0a\u6607 r5\n\u3000\u4f8b\uff09K20r5\u3000K30+24@8R5\u3000K40+24@8$12r5\n\n\u30fb\u30b0\u30ec\u30a4\u30c6\u30b9\u30c8\u30d5\u30a9\u30fc\u30c1\u30e5\u30f3\u306f\u672b\u5c3e\u306b gf\n\u3000\u4f8b\uff09K20gf\u3000K30+24@8GF\u3000K40+24@8$12r5gf\n\n\u30fb\u5a01\u529b\u8868\u30921d+sf\u3067\u53c2\u7167 \u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5f8c\u3082\u7d99\u7d9a sf4\n\u3000\u4f8b\uff09k10sf4\u3000k0+5sf4@13\u3000k70+26sf3@9\n\n\u30fb\u5a01\u529b\u8868\u30921d+tf\u3067\u53c2\u7167 \u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5f8c\u306f2d\u3067\u53c2\u7167 tf3\n\u3000\u4f8b\uff09k10tf3\u3000k0+5tf4@13\u3000k70+26tf3@9\n\n\u30fb\u8d85\u8d8a\u5224\u5b9a\u7528\u306b2d6\u30ed\u30fc\u30eb\u306b 2D6@10 \u66f8\u5f0f\u3067\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u4ed8\u4e0e\u304c\u53ef\u80fd\u306b\u3002\n\u3000\u4f8b\uff092D6@10\u30002D6@10+11>=30\n\n\u30fb\u6210\u9577\u3000(Gr)\n\u3000\u672b\u5c3e\u306b\u6570\u5b57\u3092\u4ed8\u52a0\u3059\u308b\u3053\u3068\u3067\u3001\u8907\u6570\u56de\u306e\u6210\u9577\u3092\u307e\u3068\u3081\u3066\u884c\u3048\u307e\u3059\u3002\n\u3000\u4f8b\uff09Gr3\n\n\u30fb\u9632\u5fa1\u30d5\u30a1\u30f3\u30d6\u30eb\u8868\u3000(FT)\n\u3000\u9632\u5fa1\u30d5\u30a1\u30f3\u30d6\u30eb\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30fb\u7d61\u307f\u52b9\u679c\u8868\u3000(TT)\n\u3000\u7d61\u307f\u52b9\u679c\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30fb\u30c9\u30eb\u30a4\u30c9\u306e\u7269\u7406\u9b54\u6cd5\u7528\u8868\u3000(Dru[2-6\u306e\u5024,7-9\u306e\u5024,10-12\u306e\u5024])\n\u3000\u4f8b\uff09Dru[0,3,6]+10-3\n\n\u30fb\u30a2\u30d3\u30b9\u30ab\u30fc\u30b9\u8868\u3000(ABT)\n\u3000\u30a2\u30d3\u30b9\u30ab\u30fc\u30b9\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n'),b.$register_prefix("H?K","Gr","2D6?@\\d+","FT","TT","Dru","ABT"),F(b,"$eval_game_system_specific_command",function $(o){var s,D=this,m=A,T=A;return $.$$p=null,B(/^dru\[(\d+),(\d+),(\d+)\]/i,s=o)?(m=C(h("Regexp").$last_match().$captures(),"map",[],"to_i".$to_proc()),T=q(h("Command"),"Parser").$new(/dru\[\d+,\d+,\d+\]/i,d(["round_type"],{round_type:q(q(h("BCDice"),"RoundType"),"CEIL")})).$parse(o),H(T)?D.$druid_dice(T,m):A):B("ABT",s)?D.$get_abyss_curse_table():y(D,P(D,"eval_game_system_specific_command",$,!1,!0),"eval_game_system_specific_command",[o],null)}),F(b,"$rating_parser",function(){return h("RatingParser").$new(d(["version"],{version:"v2_5"}))}),F(b,"$druid_dice",function(o,f){var m,t,T,i,v,s=A;return m=(s=this.randomizer.$roll_barabara(2,6)).$sum(),t=B(z(2,6,!1),T=m)?0:B(z(7,9,!1),T)?1:B(z(10,12,!1),T)?2:A,i=f["$[]"](t),v=Z(i,o.$modify_number()),["("+o.$command().$capitalize()+h("Format").$modifier(o.$modify_number())+")","2D["+s.$join(",")+"]="+m,""+i+h("Format").$modifier(o.$modify_number()),v].$join(" \uff1e ")}),F(b,"$get_abyss_curse_table",function(){var s,o=this,f=A,D=A;return f=q(h("DiceTable"),"D66GridTable").$from_i18n("SwordWorld2_5.AbyssCurseTable",o.locale).$roll(o.randomizer),D=B(14,s=f.$value())?q(h("DiceTable"),"D66ParityTable").$from_i18n("SwordWorld2_5.AbyssCurseCategoryTable",o.locale).$roll(o.randomizer).$to_s():B(25,s)?q(h("DiceTable"),"D66ParityTable").$from_i18n("SwordWorld2_5.AbyssCurseAttrTable",o.locale).$roll(o.randomizer).$to_s():A,[f.$to_s(),D].$compact().$join("\n")})})}}]);